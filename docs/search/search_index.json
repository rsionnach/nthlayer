{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"NthLayer","text":"<p>Reliability at build time, not incident time.</p> <p>Shift reliability left into your CI/CD pipeline. Validate before deploy, not after incidents.</p>"},{"location":"#the-reliability-pipeline","title":"The Reliability Pipeline","text":"<pre><code>   service.yaml / *.reliability.yaml\n        \u2502\n        \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Generate \u2502 \u2500\u2500\u25b6 \u2502  Validate \u2502 \u2500\u2500\u25b6 \u2502  Protect  \u2502 \u2500\u2500\u25b6 Deploy\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n   apply            verify           check-deploy\n   init             validate-spec    scorecard\n   migrate          --lint           alerts\n                                     portfolio\n</code></pre> Stage What Happens Exit Code Generate Create dashboards, alerts, SLOs from YAML - Validate Verify specs, lint PromQL, check contracts 1 if invalid Protect Block deploys when error budget exhausted 2 if blocked"},{"location":"#the-problem","title":"The Problem","text":"<p>Teams deploy code without reliability validation:</p> <ul> <li>Alerts created after the first incident</li> <li>Dashboards built after users complain</li> <li>SLOs defined after budget is exhausted</li> <li>No gates to prevent risky deploys</li> </ul>"},{"location":"#the-solution","title":"The Solution","text":"<p>NthLayer shifts reliability left - from incident response to CI/CD:</p> Legacy FormatOpenSRM Format service.yaml<pre><code>name: payment-api\ntier: critical\ntype: api\ndependencies:\n  - postgresql\n  - redis\n</code></pre> payment-api.reliability.yaml<pre><code>apiVersion: srm/v1\nkind: ServiceReliabilityManifest\nmetadata:\n  name: payment-api\n  tier: critical\nspec:\n  type: api\n  slos:\n    availability:\n      target: 99.95\n      window: 30d\n  contract:\n    availability: 0.999\n  dependencies:\n    - name: postgresql\n      type: database\n      critical: true\n</code></pre> <p>Both formats are supported. Use <code>nthlayer migrate</code> to convert legacy files.</p> <pre><code># Generate \u2192 Validate \u2192 Protect \u2192 Deploy\nnthlayer apply service.yaml --lint\nnthlayer verify service.yaml --prometheus-url $PROM_URL\nnthlayer check-deploy service.yaml --prometheus-url $PROM_URL\nkubectl apply -f generated/\n</code></pre>"},{"location":"#what-gets-generated","title":"What Gets Generated","text":"Output Description Dashboards Grafana dashboards with technology-aware panels Alerts Prometheus alert rules with best-practice thresholds SLOs OpenSLO-compatible definitions with error budgets Recording Rules Pre-aggregated metrics for performance"},{"location":"#key-features","title":"Key Features","text":""},{"location":"#deployment-gates","title":"Deployment Gates","text":"<p>Block deploys when error budget is exhausted:</p> <p></p> <pre><code>nthlayer check-deploy service.yaml --prometheus-url $PROM_URL\n# Exit code: 0=approved, 1=warning, 2=blocked\n</code></pre>"},{"location":"#slo-portfolio","title":"SLO Portfolio","text":"<p>Track reliability across your entire organization:</p> <p></p> <pre><code>nthlayer portfolio --path services/\n</code></pre>"},{"location":"#contract-verification","title":"Contract Verification","text":"<p>Verify declared metrics exist before deploy:</p> <p></p> <pre><code>nthlayer verify service.yaml --prometheus-url $PROM_URL\n</code></pre>"},{"location":"#reliability-scorecard","title":"Reliability Scorecard","text":"<p>Quantify reliability across your organization:</p> <pre><code>nthlayer scorecard --prometheus-url $PROM_URL\n# 0-100 score per service: SLO compliance, incidents, deploys, budget\n# Exit codes: 0=good, 1=fair, 2=poor \u2014 use in CI/CD gates\n</code></pre>"},{"location":"#intelligent-alerts","title":"Intelligent Alerts","text":"<p>Context-aware alert evaluation with technology-specific explanations:</p> <pre><code>nthlayer alerts evaluate services/ --path services/\nnthlayer alerts explain services/payment-api.yaml\nnthlayer alerts test services/payment-api.yaml --simulate-burn 90\n</code></pre>"},{"location":"#23-technology-templates","title":"23 Technology Templates","text":"<p>Pre-built monitoring for:</p> <ul> <li>Databases: PostgreSQL, MySQL, MongoDB, Redis, Elasticsearch</li> <li>Message Queues: Kafka, RabbitMQ, NATS, Pulsar</li> <li>Proxies: Nginx, HAProxy, Traefik</li> <li>Infrastructure: Kubernetes, etcd, Consul</li> </ul>"},{"location":"#cicd-integration","title":"CI/CD Integration","text":".github/workflows/deploy.yml<pre><code>jobs:\n  deploy:\n    steps:\n      - name: Validate Specs\n        run: nthlayer validate-spec services/\n\n      - name: Generate &amp; Lint\n        run: nthlayer apply services/*.yaml --lint\n\n      - name: Verify Metrics\n        run: nthlayer verify services/*.yaml --prometheus-url $PROM_URL\n\n      - name: Check Deploy Gate\n        run: nthlayer check-deploy services/*.yaml --prometheus-url $PROM_URL\n\n      - name: Deploy\n        if: success()\n        run: kubectl apply -f generated/\n</code></pre> <p>Integrates with GitHub Actions, GitLab CI, ArgoCD, Tekton, and Jenkins.</p>"},{"location":"#get-started","title":"Get Started","text":"<ul> <li> <p> Installation</p> <p>Install NthLayer with pip in 30 seconds</p> <p> Install</p> </li> <li> <p> Quick Start</p> <p>Generate your first dashboard in 5 minutes</p> <p> Quick Start</p> </li> <li> <p> Validate</p> <p>Catch issues before they reach production</p> <p> Validation</p> </li> <li> <p> Protect</p> <p>Block risky deploys with error budget gates</p> <p> Protection</p> </li> </ul>"},{"location":"#the-google-sre-connection","title":"The Google SRE Connection","text":"<p>NthLayer automates concepts from the Google SRE Book:</p> SRE Concept Manual Process NthLayer Automation Production Readiness Review Multi-week checklist <code>nthlayer verify</code> in CI Error Budget Policy Spreadsheet tracking <code>nthlayer check-deploy</code> gates Release Engineering Manual runbooks Generated artifacts + GitOps Monitoring Standards Wiki pages <code>service.yaml</code> spec"},{"location":"architecture/","title":"Architecture","text":"<p>This page provides comprehensive documentation of NthLayer's architecture, components, and tech stack.</p>"},{"location":"architecture/#platform-architecture","title":"Platform Architecture","text":"<p>The NthLayer platform sits between your service definitions and your observability stack, generating the complete reliability infrastructure.</p> <pre><code>architecture-beta\n   group git(logos:git-icon) [Git Repository]\n   group nthlayer(mdi:cog) [NthLayer Platform]\n   group observability(mdi:cloud) [Observability Stack]\n\n   service specs(mdi:file-code) [Service Definitions] in git\n\n   service reslayer(mdi:target) [ResLayer SLOs] in nthlayer\n   service govlayer(mdi:shield-check) [GovLayer Policies] in nthlayer\n   service obslayer(mdi:eye) [ObserveLayer Monitoring] in nthlayer\n\n   service prometheus(logos:prometheus) [Prometheus] in observability\n   service grafana(logos:grafana) [Grafana] in observability\n\n   specs:R --&gt; L:reslayer\n   specs:R --&gt; L:govlayer\n   specs:R --&gt; L:obslayer\n\n   reslayer:R --&gt; L:prometheus\n   obslayer:R --&gt; L:grafana</code></pre>"},{"location":"architecture/#tech-stack","title":"Tech Stack","text":"<p>NthLayer is built on these core technologies:</p> Category Technology Purpose Runtime Python 3.11+ Core language CLI argparse + Rich Command parsing and terminal UI HTTP Client httpx Async HTTP for Prometheus, Grafana APIs Validation Pydantic Schema validation for service specs Dashboard SDK grafana-foundation-sdk Type-safe Grafana dashboard generation Database SQLAlchemy + PostgreSQL State storage (optional, for SLO history) Cache Redis Caching layer (optional) Logging structlog Structured JSON logging Resilience tenacity + circuitbreaker Retry logic and circuit breakers Config PyYAML + Pydantic Settings YAML parsing and environment config"},{"location":"architecture/#core-modules","title":"Core Modules","text":"<p>NthLayer is organized into these modules:</p>"},{"location":"architecture/#specification-and-orchestration","title":"Specification and Orchestration","text":"Module Purpose Key Components <code>specs/</code> Parse and validate service.yaml files <code>ServiceContext</code>, <code>Resource</code>, <code>parse_service_file()</code> <code>orchestrator.py</code> Coordinate the generation workflow <code>ServiceOrchestrator</code>, <code>ApplyResult</code>, <code>PlanResult</code> <code>config/</code> Configuration and secrets management <code>Settings</code>, <code>get_settings()</code>, secrets providers"},{"location":"architecture/#generation-modules","title":"Generation Modules","text":"Module Purpose Key Components <code>dashboards/</code> Generate Grafana dashboards with 18+ technology templates <code>DashboardBuilder</code>, <code>IntentResolver</code>, technology templates <code>alerts/</code> Generate Prometheus alerting rules <code>AlertTemplateLoader</code>, <code>AlertRule</code> <code>recording_rules/</code> Generate Prometheus recording rules for performance <code>build_recording_rules()</code>, <code>RecordingRule</code> <code>slos/</code> SLO definitions, error budgets, and tracking <code>SLO</code>, <code>ErrorBudgetCalculator</code>, <code>SLOCollector</code> <code>loki/</code> Generate LogQL alerting rules <code>LokiAlertGenerator</code>, <code>LogQLAlert</code>"},{"location":"architecture/#validation-and-verification","title":"Validation and Verification","text":"Module Purpose Key Components <code>validation/</code> PromQL syntax and metadata validation <code>validate_promql()</code>, <code>validate_metadata()</code>, pint integration <code>verification/</code> Verify declared metrics exist in Prometheus <code>MetricVerifier</code>, <code>MetricContract</code>, <code>VerificationResult</code> <code>discovery/</code> Discover available metrics from Prometheus <code>MetricDiscoveryClient</code>, <code>MetricClassifier</code>"},{"location":"architecture/#policy-and-portfolio","title":"Policy and Portfolio","text":"Module Purpose Key Components <code>policies/</code> Deployment policy evaluation <code>ConditionEvaluator</code>, <code>PolicyContext</code> <code>portfolio/</code> Cross-service SLO aggregation <code>PortfolioAggregator</code>, <code>collect_portfolio()</code>"},{"location":"architecture/#providers-and-integrations","title":"Providers and Integrations","text":"Module Purpose Key Components <code>providers/</code> External service integrations Grafana, Prometheus providers <code>clients/</code> HTTP clients with retry/circuit breaker <code>CortexClient</code>, <code>SlackNotifier</code>"},{"location":"architecture/#cli-commands","title":"CLI Commands","text":""},{"location":"architecture/#generation-commands","title":"Generation Commands","text":"Command Purpose Exit Codes <code>nthlayer apply &lt;service.yaml&gt;</code> Generate all resources (dashboards, alerts, SLOs, etc.) 0=success, 1=error <code>nthlayer plan &lt;service.yaml&gt;</code> Preview what would be generated (dry-run) 0=success <code>nthlayer init</code> Create a new service.yaml interactively 0=success"},{"location":"architecture/#validation-commands","title":"Validation Commands","text":"Command Purpose Exit Codes <code>nthlayer apply --lint</code> Validate PromQL syntax using pint 0=valid, 1=errors <code>nthlayer validate &lt;service.yaml&gt;</code> Validate service.yaml schema 0=valid, 1=invalid <code>nthlayer verify &lt;service.yaml&gt;</code> Verify declared metrics exist in Prometheus 0=all exist, 1=missing"},{"location":"architecture/#enforcement-commands","title":"Enforcement Commands","text":"Command Purpose Exit Codes <code>nthlayer check-deploy &lt;service.yaml&gt;</code> Check error budget before deploy 0=safe, 1=budget exhausted <code>nthlayer portfolio [--format json]</code> Aggregate SLO health across all services 0=healthy, 1=warning, 2=critical"},{"location":"architecture/#slo-commands","title":"SLO Commands","text":"Command Purpose <code>nthlayer slo show &lt;service&gt;</code> Display SLO status for a service <code>nthlayer slo list</code> List all defined SLOs <code>nthlayer slo collect &lt;service&gt;</code> Collect current SLO metrics from Prometheus"},{"location":"architecture/#configuration-commands","title":"Configuration Commands","text":"Command Purpose <code>nthlayer setup</code> Interactive configuration wizard <code>nthlayer config show</code> Display current configuration <code>nthlayer env list</code> List environment configurations <pre><code>architecture-beta\n   group generate(mdi:cog) [Generate]\n   group validate(mdi:check-circle) [Validate]\n   group enforce(mdi:shield-check) [Enforce]\n\n   service apply(mdi:play) [nthlayer apply] in generate\n   service plan(mdi:file-search) [nthlayer plan] in generate\n\n   service lint(mdi:code-tags-check) [apply with lint] in validate\n   service verify(mdi:check-decagram) [nthlayer verify] in validate\n\n   service checkdeploy(mdi:gate) [check deploy] in enforce\n   service portfolio(mdi:chart-box) [nthlayer portfolio] in enforce\n\n   plan:R --&gt; L:apply\n   apply:R --&gt; L:lint\n   lint:R --&gt; L:verify\n   verify:R --&gt; L:checkdeploy</code></pre>"},{"location":"architecture/#data-flow","title":"Data Flow","text":""},{"location":"architecture/#apply-workflow","title":"Apply Workflow","text":"<p>When you run <code>nthlayer apply</code>, the following happens:</p> <ol> <li>Parse: <code>specs/parser.py</code> reads service.yaml into <code>ServiceContext</code></li> <li>Detect: <code>orchestrator.py</code> determines which resources to generate</li> <li>Generate: Each generator module creates its artifacts</li> <li>Output: Files written to <code>generated/</code> directory</li> </ol> <pre><code>architecture-beta\n   group inputgrp(mdi:file-document) [Input]\n   group processing(mdi:cog) [NthLayer Processing]\n   group outputgrp(mdi:package-variant) [Generated Artifacts]\n\n   service specfile(mdi:file-code) [Service Spec] in inputgrp\n\n   service parser(mdi:file-search) [Spec Parser] in processing\n   service slogen(mdi:target) [SLO Generator] in processing\n   service alertgen(mdi:bell-alert) [Alert Generator] in processing\n   service dashgen(mdi:view-dashboard) [Dashboard Builder] in processing\n\n   service slofile(mdi:file-check) [SLO File] in outputgrp\n   service alertfile(mdi:file-alert) [Alert Rules] in outputgrp\n   service dashfile(mdi:file-chart) [Dashboard] in outputgrp\n   service recfile(mdi:file-clock) [Recording Rules] in outputgrp\n\n   specfile:R --&gt; L:parser\n   parser:R --&gt; L:slogen\n   parser:R --&gt; L:alertgen\n   parser:R --&gt; L:dashgen\n\n   slogen:R --&gt; L:slofile\n   slogen:R --&gt; L:recfile\n   alertgen:R --&gt; L:alertfile\n   dashgen:R --&gt; L:dashfile</code></pre>"},{"location":"architecture/#verification-flow","title":"Verification Flow","text":"<p>When you run <code>nthlayer verify</code>:</p> <ol> <li>Extract: Parse service.yaml for declared metrics</li> <li>Query: Check each metric against Prometheus API</li> <li>Report: Show which metrics exist vs missing</li> </ol>"},{"location":"architecture/#portfolio-flow","title":"Portfolio Flow","text":"<p>When you run <code>nthlayer portfolio</code>:</p> <ol> <li>Scan: Find all service.yaml files in directory</li> <li>Collect: Query Prometheus for each SLO's current value</li> <li>Aggregate: Calculate health scores by tier</li> <li>Output: Terminal table, JSON, or CSV</li> </ol>"},{"location":"architecture/#technology-templates","title":"Technology Templates","text":"<p>NthLayer includes 18+ technology-specific templates that generate appropriate dashboards and alerts:</p>"},{"location":"architecture/#databases","title":"Databases","text":"Technology Template Key Metrics PostgreSQL <code>postgresql_intent.py</code> Connections, replication lag, locks, cache hit ratio MySQL <code>mysql_intent.py</code> Connections, queries, replication, InnoDB metrics MongoDB <code>mongodb_intent.py</code> Operations, connections, replication, locks Elasticsearch <code>elasticsearch_intent.py</code> JVM, indexing, search latency, cluster health"},{"location":"architecture/#caches-and-queues","title":"Caches and Queues","text":"Technology Template Key Metrics Redis <code>redis_intent.py</code> Memory, connections, commands, keyspace Kafka <code>kafka_intent.py</code> Consumer lag, partitions, throughput, replication RabbitMQ <code>rabbitmq_intent.py</code> Queue depth, consumers, publish/deliver rates NATS <code>nats_intent.py</code> Connections, messages, subscriptions Pulsar <code>pulsar_intent.py</code> Topics, subscriptions, throughput"},{"location":"architecture/#infrastructure","title":"Infrastructure","text":"Technology Template Key Metrics Kubernetes <code>kubernetes.py</code> Pod status, resource usage, restarts Nginx <code>nginx_intent.py</code> Requests, connections, response codes HAProxy <code>haproxy_intent.py</code> Backend health, sessions, response times Traefik <code>traefik_intent.py</code> Requests, entrypoints, services"},{"location":"architecture/#service-types","title":"Service Types","text":"Type Template Key Metrics HTTP/API <code>http_intent.py</code> Request rate, latency percentiles, error rate Worker <code>worker_intent.py</code> Job throughput, processing time, failures Stream <code>stream_intent.py</code> Events processed, lag, errors"},{"location":"architecture/#service-mesh","title":"Service Mesh","text":"Technology Template Key Metrics Consul <code>consul_intent.py</code> Service health, KV operations Etcd <code>etcd_intent.py</code> Leader elections, proposals, WAL"},{"location":"architecture/#integration-points","title":"Integration Points","text":""},{"location":"architecture/#cicd-integration","title":"CI/CD Integration","text":"<p>NthLayer integrates into your pipeline at these points:</p> <pre><code>architecture-beta\n   group cicd(mdi:pipe) [CICD Pipeline]\n   group observability(mdi:cloud) [Observability Stack]\n\n   service developer(mdi:account) [Developer] in cicd\n   service pipeline(mdi:source-branch) [Pipeline] in cicd\n   service nthlayer(mdi:cog) [NthLayer CLI] in cicd\n\n   service prometheus(logos:prometheus) [Prometheus] in observability\n   service grafana(logos:grafana) [Grafana] in observability\n\n   developer:R --&gt; L:pipeline\n   pipeline:R --&gt; L:nthlayer\n   nthlayer:R --&gt; L:prometheus\n   nthlayer:R --&gt; L:grafana</code></pre>"},{"location":"architecture/#environment-variables","title":"Environment Variables","text":"Variable Purpose <code>NTHLAYER_PROMETHEUS_URL</code> Prometheus server URL <code>NTHLAYER_GRAFANA_URL</code> Grafana server URL <code>NTHLAYER_GRAFANA_API_KEY</code> Grafana API key"},{"location":"architecture/#reliability-shift-left-flow","title":"Reliability Shift Left Flow","text":"<p>The complete validation pipeline from code to production:</p> <pre><code>architecture-beta\n   group dev(mdi:code-braces) [Development]\n   group validation(mdi:check-circle) [Validation]\n   group deploy(mdi:rocket-launch) [Deployment]\n\n   service code(mdi:git) [Git Push] in dev\n   service spec(mdi:file-code) [Service Spec] in dev\n\n   service lint(mdi:code-tags-check) [PromQL Lint] in validation\n   service verify(mdi:check-decagram) [Metric Verify] in validation\n   service budget(mdi:target) [Budget Check] in validation\n\n   service gate(mdi:gate) [Deploy Gate] in deploy\n   service prod(mdi:server) [Production] in deploy\n\n   code:R --&gt; L:spec\n   spec:R --&gt; L:lint\n   lint:R --&gt; L:verify\n   verify:R --&gt; L:budget\n   budget:R --&gt; L:gate\n   gate:R --&gt; L:prod</code></pre> Stage Command Blocks Deploy If Lint <code>nthlayer apply --lint</code> PromQL syntax errors Verify <code>nthlayer verify</code> Declared metrics don't exist Budget <code>nthlayer check-deploy</code> Error budget &lt; 10% remaining"},{"location":"demo/","title":"Live Demo","text":""},{"location":"demo/#20-hours-of-sre-work-in-5-minutes","title":"20 Hours of SRE Work in 5 Minutes","text":"<p>Define your service once. NthLayer generates SLOs, alerts, dashboards, recording rules, and runbooks\u2014with technology-specific best practices built in.</p> <ul> <li> <p> 99.6% Time Savings</p> </li> <li> <p> Tech-Aware (PostgreSQL, Redis, Kafka)</p> </li> <li> <p> One Command for Everything</p> </li> <li> <p> Real-Time Error Budget Tracking</p> </li> </ul>"},{"location":"demo/#live-grafana-dashboards","title":"Live Grafana Dashboards","text":"<p>See auto-generated dashboards for 6 production services. Each dashboard includes SLO metrics, service health, and technology-specific panels.</p> <ul> <li> <p> payment-api</p> <p>PostgreSQL + Redis</p> <p> View Dashboard</p> </li> <li> <p> checkout-service</p> <p>MySQL + Redis</p> <p> View Dashboard</p> </li> <li> <p> notification-worker</p> <p>Worker + Redis</p> <p> View Dashboard</p> </li> <li> <p> analytics-stream</p> <p>Stream + MongoDB</p> <p> View Dashboard</p> </li> <li> <p> identity-service</p> <p>PostgreSQL + Redis</p> <p> View Dashboard</p> </li> <li> <p> search-api</p> <p>Elasticsearch + Redis</p> <p> View Dashboard</p> </li> </ul> <p>Dashboard Structure</p> <p>Each dashboard is organized into: SLO Metrics \u2192 Service Health \u2192 Dependencies</p>"},{"location":"demo/#generated-alerts","title":"Generated Alerts","text":"<p>118 production-ready Prometheus alerts across all services, sourced from awesome-prometheus-alerts.</p> <ul> <li> <p>payment-api \u00b7 15 PostgreSQL alerts</p> <p>PostgresqlDown, PostgresqlRestarted, SlowQueries...</p> <p> View on GitHub</p> </li> <li> <p>checkout-service \u00b7 26 MySQL + Redis alerts</p> <p>MysqlDown, RedisMemoryHigh, ReplicationLag...</p> <p> View on GitHub</p> </li> <li> <p>notification-worker \u00b7 12 Redis alerts</p> <p>RedisDown, RedisMemoryHigh, TooManyConnections...</p> <p> View on GitHub</p> </li> <li> <p>analytics-stream \u00b7 19 MongoDB + Redis alerts</p> <p>MongodbDown, CursorsTimeouts, ReplicasetLag...</p> <p> View on GitHub</p> </li> <li> <p>identity-service \u00b7 27 PostgreSQL + Redis alerts</p> <p>PostgresqlDown, DeadLocks, RedisRejected...</p> <p> View on GitHub</p> </li> <li> <p>search-api \u00b7 19 Elasticsearch alerts</p> <p>ClusterRed, JvmHeapHigh, DiskSpaceLow...</p> <p> View on GitHub</p> </li> </ul>"},{"location":"demo/#slo-portfolio","title":"SLO Portfolio","text":"<p>Track org-wide reliability with tier-based health scoring:</p> <pre><code>================================================================================\n  NthLayer SLO Portfolio\n================================================================================\n\nOrganization Health: 78% (14/18 services meeting SLOs)\n\nBy Tier:\n  Critical:  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2591\u2591  83% (5/6 services)\n  Standard:  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2591\u2591\u2591  75% (6/8 services)\n  Low:       \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2591\u2591\u2591  75% (3/4 services)\n\n--------------------------------------------------------------------------------\nServices Needing Attention:\n--------------------------------------------------------------------------------\n\n  payment-api (Tier 1)\n    availability: 156% budget burned - EXHAUSTED\n    Remaining: -12.5 hours\n\n  search-api (Tier 2)\n    latency-p99: 95% budget burned - WARNING\n    Remaining: 1.2 hours\n\n--------------------------------------------------------------------------------\nTotal: 18 services, 16 with SLOs, 45 SLOs\n</code></pre> <p>Cross-Vendor Aggregation</p> <p>Why this matters: NthLayer aggregates SLOs across any backend (Prometheus, Datadog, etc.) in a single, vendor-neutral portfolio.</p>"},{"location":"demo/#what-gets-generated","title":"What Gets Generated","text":"<p>From a single <code>service.yaml</code>, NthLayer generates:</p> Output Description Example Dashboard 22 panels: health, SLOs, latency, errors, dependencies View JSON SLOs 3 SLOs with 30-day error budgets and burn rate calculations View YAML Alerts 15 PostgreSQL alerts with service labels and severity routing View YAML Recording Rules 21 pre-aggregated metrics for 10x faster dashboard queries View YAML"},{"location":"demo/#try-it-yourself","title":"Try It Yourself","text":"<pre><code># Install NthLayer\npipx install nthlayer\n\n# Interactive setup (configures Prometheus, Grafana)\nnthlayer setup\n\n# Generate configs for your service\nnthlayer apply payment-api.yaml\n\n# View org-wide SLO health\nnthlayer portfolio\n</code></pre> <ul> <li> <p> Get Started</p> <p>Install NthLayer and generate your first reliability stack</p> <p> Installation Guide</p> </li> <li> <p> Full Documentation</p> <p>Comprehensive guides for all features</p> <p> Documentation</p> </li> </ul>"},{"location":"commands/","title":"Commands Overview","text":"<p>NthLayer provides a comprehensive CLI for managing your reliability stack.</p>"},{"location":"commands/#generation-commands","title":"Generation Commands","text":"Command Description <code>nthlayer apply</code> Generate all configs from service spec <code>nthlayer plan</code> Preview what resources would be generated (dry-run) <code>nthlayer generate-dashboard</code> Generate Grafana dashboard <code>nthlayer generate-alerts</code> Generate Prometheus alerts <code>nthlayer generate-recording-rules</code> Generate Prometheus recording rules <code>nthlayer generate-loki-alerts</code> Generate Loki LogQL alerts"},{"location":"commands/#validation-commands","title":"Validation Commands","text":"Command Description <code>nthlayer verify</code> Verify declared metrics exist (contract verification) <code>nthlayer validate-spec</code> Validate service.yaml against OPA policies <code>nthlayer validate-metadata</code> Validate rule metadata (labels, annotations, URLs) <code>nthlayer validate-slo</code> Validate SLO metrics exist in Prometheus <code>nthlayer recommend-metrics</code> Recommend metrics based on service type and runtime <code>nthlayer lint</code> Lint Prometheus alert rules with pint"},{"location":"commands/#dependency-intelligence","title":"Dependency Intelligence","text":"Command Description <code>nthlayer deps</code> Show service dependencies <code>nthlayer blast-radius</code> Calculate deployment blast radius <code>nthlayer ownership</code> Show service ownership attribution <code>nthlayer identity</code> Service identity resolution and management"},{"location":"commands/#slo-error-budget","title":"SLO &amp; Error Budget","text":"Command Description <code>nthlayer slo</code> SLO and error budget commands <code>nthlayer portfolio</code> View org-wide SLO health <code>nthlayer check-deploy</code> Check deployment gate (error budget validation) <code>nthlayer drift</code> Analyze reliability drift for a service <code>nthlayer scorecard</code> Calculate per-service reliability scores"},{"location":"commands/#alerts-monitoring","title":"Alerts &amp; Monitoring","text":"Command Description <code>nthlayer alerts</code> Evaluate, simulate, and explain alert rules"},{"location":"commands/#environment-management","title":"Environment Management","text":"Command Description <code>nthlayer environments</code> List available environments <code>nthlayer diff-envs</code> Compare configurations between environments <code>nthlayer validate-env</code> Validate an environment configuration"},{"location":"commands/#setup-configuration","title":"Setup &amp; Configuration","text":"Command Description <code>nthlayer setup</code> Interactive first-time setup <code>nthlayer init</code> Initialize new NthLayer service <code>nthlayer migrate</code> Migrate legacy format to OpenSRM <code>nthlayer config</code> Configuration management <code>nthlayer secrets</code> Secrets management"},{"location":"commands/#quick-reference","title":"Quick Reference","text":"<pre><code># Generate configs\nnthlayer apply service.yaml\n\n# Validate before deployment\nnthlayer verify service.yaml --prometheus-url http://prometheus:9090\nnthlayer validate-slo service.yaml\n\n# View dependencies\nnthlayer deps service.yaml\nnthlayer blast-radius service.yaml\n\n# Check deployment readiness\nnthlayer check-deploy service.yaml\n\n# View portfolio health\nnthlayer portfolio\n\n# Check SLO status\nnthlayer slo show service.yaml\n</code></pre>"},{"location":"commands/#getting-help","title":"Getting Help","text":"<pre><code>nthlayer --help\nnthlayer &lt;command&gt; --help\n</code></pre>"},{"location":"commands/#see-also","title":"See Also","text":"<ul> <li>CLI Reference - Complete command reference</li> <li>Getting Started - First steps with NthLayer</li> </ul>"},{"location":"commands/alerts/","title":"nthlayer alerts","text":"<p>Evaluate, simulate, and explain alert rules for a service.</p>"},{"location":"commands/alerts/#synopsis","title":"Synopsis","text":"<pre><code>nthlayer alerts evaluate &lt;service-file&gt; [options]\nnthlayer alerts show &lt;service-file&gt; [options]\nnthlayer alerts explain &lt;service-file&gt; [options]\nnthlayer alerts test &lt;service-file&gt; [options]\n</code></pre>"},{"location":"commands/alerts/#description","title":"Description","text":"<p>The <code>alerts</code> command family provides an intelligent alerts pipeline that combines explicit alert rules from your manifest with auto-generated rules based on service tier and SLOs. It supports live evaluation against Prometheus, burn simulation, and context-aware explanations.</p>"},{"location":"commands/alerts/#subcommands","title":"Subcommands","text":"Subcommand Description <code>evaluate</code> Full pipeline evaluation against live or simulated budget data <code>show</code> Display effective alert rules (explicit + auto-generated) <code>explain</code> Show context-aware budget explanations with investigation actions <code>test</code> Simulate budget burn and show what alerts would fire"},{"location":"commands/alerts/#exit-codes","title":"Exit Codes","text":"Code Severity Meaning 0 Healthy No alerts triggered 1 Warning Warning-level alerts triggered 2 Critical Critical alerts triggered"},{"location":"commands/alerts/#subcommand-reference","title":"Subcommand Reference","text":""},{"location":"commands/alerts/#alerts-evaluate","title":"alerts evaluate","text":"<p>Run the full alert pipeline against a service or directory of manifests.</p> <p>Options:</p> Option Description <code>--prometheus-url URL</code>, <code>-p URL</code> Prometheus URL (or set <code>NTHLAYER_PROMETHEUS_URL</code>) <code>--dry-run</code> Evaluate without sending notifications <code>--no-notify</code> Suppress notification delivery <code>--format FORMAT</code> Output format: <code>table</code> (default), <code>json</code> <code>--path DIR</code> Evaluate all manifests in a directory <p>Example:</p> <pre><code>nthlayer alerts evaluate services/payment-api.yaml \\\n  --prometheus-url http://prometheus:9090\n</code></pre> <p>Output: <pre><code>Alert Evaluation Results\n\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2533\u2501\u2501\u2501\u2501\u2501\u2501\u2533\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2533\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2533\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2533\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Service     \u2503 SLOs \u2503 Rules \u2503 Alerts \u2503 Notifications \u2503 Status   \u2503\n\u2521\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2547\u2501\u2501\u2501\u2501\u2501\u2501\u2547\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2547\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2547\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2547\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2529\n\u2502 payment-api \u2502    2 \u2502     6 \u2502      1 \u2502             0 \u2502 WARNING  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre></p> <p>Evaluate a directory:</p> <pre><code>nthlayer alerts evaluate --path services/ \\\n  --prometheus-url http://prometheus:9090\n</code></pre>"},{"location":"commands/alerts/#alerts-show","title":"alerts show","text":"<p>Display the effective alert rules for a service \u2014 both explicitly defined rules and auto-generated rules based on service tier.</p> <p>Options:</p> Option Description <code>--format FORMAT</code> Output format: <code>table</code> (default), <code>json</code>, <code>yaml</code> <p>Example:</p> <pre><code>nthlayer alerts show services/payment-api.yaml\n</code></pre> <p>Output: <pre><code>Effective Alert Rules: payment-api\nTier: critical | Rules: 6\n\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2533\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2533\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2533\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2533\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2533\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Name                    \u2503 Type     \u2503 SLO          \u2503 Threshold \u2503 Severity \u2503 Enabled \u2503\n\u2521\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2547\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2547\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2547\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2547\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2547\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2529\n\u2502 budget_burn_fast        \u2502 burn     \u2502 availability \u2502      0.02 \u2502 critical \u2502 yes     \u2502\n\u2502 budget_burn_slow        \u2502 burn     \u2502 availability \u2502      0.05 \u2502 warning  \u2502 yes     \u2502\n\u2502 budget_burn_fast        \u2502 burn     \u2502 latency      \u2502      0.02 \u2502 critical \u2502 yes     \u2502\n\u2502 budget_burn_slow        \u2502 burn     \u2502 latency      \u2502      0.05 \u2502 warning  \u2502 yes     \u2502\n\u2502 slo_target_miss         \u2502 target   \u2502 availability \u2502      0.99 \u2502 warning  \u2502 yes     \u2502\n\u2502 slo_target_miss         \u2502 target   \u2502 latency      \u2502      0.99 \u2502 warning  \u2502 yes     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre></p>"},{"location":"commands/alerts/#alerts-explain","title":"alerts explain","text":"<p>Show context-aware budget explanations with technology-specific investigation actions.</p> <p>Options:</p> Option Description <code>--prometheus-url URL</code>, <code>-p URL</code> Prometheus URL (or set <code>NTHLAYER_PROMETHEUS_URL</code>) <code>--format FORMAT</code> Output format: <code>table</code> (default), <code>json</code>, <code>markdown</code> <code>--slo NAME</code> Filter explanations to a specific SLO <p>Example:</p> <pre><code>nthlayer alerts explain services/payment-api.yaml \\\n  --prometheus-url http://prometheus:9090\n</code></pre> <p>The explanation engine provides:</p> <ul> <li>Budget status and burn rate analysis</li> <li>Technology-specific investigation steps (e.g., PostgreSQL slow query checks, Redis memory analysis)</li> <li>Recommended actions based on service type and tier</li> <li>Links to relevant runbooks and dashboards</li> </ul>"},{"location":"commands/alerts/#alerts-test","title":"alerts test","text":"<p>Simulate budget burn at a specified level and show which alerts would fire.</p> <p>Options:</p> Option Description <code>--prometheus-url URL</code>, <code>-p URL</code> Prometheus URL (or set <code>NTHLAYER_PROMETHEUS_URL</code>) <code>--simulate-burn PCT</code> Percentage of budget consumed to simulate (default: 80) <code>--no-notify</code> Suppress sending notifications to configured channels <p>Example:</p> <pre><code>nthlayer alerts test services/payment-api.yaml --simulate-burn 95\n</code></pre> <p>Output: <pre><code>Alert Simulation: payment-api\nSimulated burn: 95.0%\n\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2533\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2533\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2533\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Rule             \u2503 SLO          \u2503 Severity \u2503 Message                              \u2503\n\u2521\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2547\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2547\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2547\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2529\n\u2502 budget_burn_fast \u2502 availability \u2502 CRITICAL \u2502 Budget burn rate exceeds threshold    \u2502\n\u2502 budget_burn_slow \u2502 availability \u2502 WARNING  \u2502 Slow budget erosion detected          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nExplanations:\n  Budget is 95% consumed \u2014 immediate investigation required\n</code></pre></p>"},{"location":"commands/alerts/#cicd-integration","title":"CI/CD Integration","text":""},{"location":"commands/alerts/#github-actions","title":"GitHub Actions","text":"<pre><code>jobs:\n  alert-check:\n    steps:\n      - name: Evaluate Alerts\n        run: |\n          nthlayer alerts evaluate services/payment-api.yaml \\\n            --prometheus-url ${{ secrets.PROMETHEUS_URL }} \\\n            --dry-run \\\n            --format json &gt; alerts.json\n\n          # Fail on critical\n          if [ $? -eq 2 ]; then\n            echo \"::error::Critical alerts detected\"\n            exit 1\n          fi\n</code></pre>"},{"location":"commands/alerts/#directory-wide-evaluation","title":"Directory-Wide Evaluation","text":"<pre><code>- name: Check All Services\n  run: |\n    nthlayer alerts evaluate \\\n      --path services/ \\\n      --prometheus-url ${{ secrets.PROMETHEUS_URL }} \\\n      --dry-run\n</code></pre>"},{"location":"commands/alerts/#environment-variables","title":"Environment Variables","text":"Variable Description <code>NTHLAYER_PROMETHEUS_URL</code> Default Prometheus URL"},{"location":"commands/alerts/#see-also","title":"See Also","text":"<ul> <li>Deployment Gates \u2014 Error budget gates</li> <li>Drift Detection \u2014 Trend analysis</li> <li>Reliability Scorecard \u2014 Quantitative reliability scoring</li> <li>Protection Overview \u2014 Full protection stack</li> </ul>"},{"location":"commands/apply/","title":"nthlayer apply","text":"<p>Generate all reliability configs from a service specification.</p>"},{"location":"commands/apply/#usage","title":"Usage","text":"<pre><code>nthlayer apply &lt;service.yaml&gt; [options]\n</code></pre>"},{"location":"commands/apply/#options","title":"Options","text":"Option Description <code>--push</code> Push dashboard to Grafana after generation <code>--output-dir DIR</code> Output directory (default: <code>generated/&lt;service&gt;</code>) <code>--dry-run</code> Show what would be generated without writing"},{"location":"commands/apply/#examples","title":"Examples","text":""},{"location":"commands/apply/#basic-generation","title":"Basic Generation","text":"<pre><code>nthlayer apply payment-api.yaml\n</code></pre> <p>Output: <pre><code>Generated: generated/payment-api/\n\u251c\u2500\u2500 dashboard.json       # Grafana dashboard\n\u251c\u2500\u2500 alerts.yaml          # Prometheus alert rules\n\u251c\u2500\u2500 slos.yaml            # OpenSLO definitions\n\u2514\u2500\u2500 recording-rules.yaml # Prometheus recording rules\n</code></pre></p>"},{"location":"commands/apply/#push-to-grafana","title":"Push to Grafana","text":"<pre><code>nthlayer apply payment-api.yaml --push\n</code></pre> <p>Requires <code>NTHLAYER_GRAFANA_URL</code> and <code>NTHLAYER_GRAFANA_API_KEY</code> to be configured.</p>"},{"location":"commands/apply/#custom-output-directory","title":"Custom Output Directory","text":"<pre><code>nthlayer apply payment-api.yaml --output-dir ./configs/payment-api\n</code></pre>"},{"location":"commands/apply/#what-gets-generated","title":"What Gets Generated","text":""},{"location":"commands/apply/#dashboard-dashboardjson","title":"Dashboard (dashboard.json)","text":"<p>A Grafana dashboard with:</p> <ul> <li>SLO Metrics Row: Availability, latency, error budget</li> <li>Service Health Row: Request rate, active connections, saturation</li> <li>Dependencies Row: Panels for each configured dependency (PostgreSQL, Redis, etc.)</li> </ul>"},{"location":"commands/apply/#alerts-alertsyaml","title":"Alerts (alerts.yaml)","text":"<p>Prometheus alert rules including:</p> <ul> <li>High error rate alerts</li> <li>Latency threshold alerts</li> <li>Error budget burn rate alerts</li> <li>Dependency-specific alerts (e.g., PostgreSQL replication lag)</li> </ul>"},{"location":"commands/apply/#slos-slosyaml","title":"SLOs (slos.yaml)","text":"<p>OpenSLO-compatible definitions:</p> <pre><code>apiVersion: openslo/v1\nkind: SLO\nmetadata:\n  name: payment-api-availability\nspec:\n  service: payment-api\n  indicator:\n    metadata:\n      name: availability\n    spec:\n      ratioMetric:\n        good:\n          metricSource:\n            type: prometheus\n            spec:\n              query: sum(rate(http_requests_total{service=\"payment-api\",status!~\"5..\"}[5m]))\n        total:\n          metricSource:\n            type: prometheus\n            spec:\n              query: sum(rate(http_requests_total{service=\"payment-api\"}[5m]))\n  objectives:\n    - target: 0.9995\n      window: 30d\n</code></pre>"},{"location":"commands/apply/#recording-rules-recording-rulesyaml","title":"Recording Rules (recording-rules.yaml)","text":"<p>Pre-aggregated metrics for dashboard performance:</p> <pre><code>groups:\n  - name: payment-api-recording\n    rules:\n      - record: service:http_requests:rate5m\n        expr: sum(rate(http_requests_total{service=\"payment-api\"}[5m]))\n      - record: service:http_errors:rate5m\n        expr: sum(rate(http_requests_total{service=\"payment-api\",status=~\"5..\"}[5m]))\n</code></pre>"},{"location":"commands/apply/#see-also","title":"See Also","text":"<ul> <li>Service YAML Schema - Full spec reference</li> <li>CLI Reference - All commands</li> </ul>"},{"location":"commands/blast-radius/","title":"nthlayer blast-radius","text":"<p>Calculate the deployment blast radius for a service by analyzing its dependency graph.</p> <p>Understanding blast radius helps teams assess the potential impact of changes before deployment.</p>"},{"location":"commands/blast-radius/#usage","title":"Usage","text":"<pre><code>nthlayer blast-radius &lt;service.yaml&gt; [options]\n</code></pre>"},{"location":"commands/blast-radius/#options","title":"Options","text":"Option Description <code>--prometheus-url, -p URL</code> Prometheus server URL <code>--env ENVIRONMENT</code> Environment name (dev, staging, prod) <code>--provider {prometheus,kubernetes,backstage,all}</code> Dependency provider to use (default: all) <code>--k8s-namespace NAMESPACE</code> Kubernetes namespace to search (default: all) <code>--backstage-url URL</code> Backstage catalog URL <code>--depth, -d DEPTH</code> Maximum depth for transitive analysis (default: 10) <code>--format {table,json}</code> Output format (default: table) <code>--demo</code> Show demo output with sample data"},{"location":"commands/blast-radius/#examples","title":"Examples","text":""},{"location":"commands/blast-radius/#calculate-blast-radius","title":"Calculate Blast Radius","text":"<pre><code>nthlayer blast-radius checkout-service.yaml\n</code></pre> <p>Output: <pre><code>\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 Blast Radius Analysis: checkout-service                                       \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n\nImpact Summary:\n  Direct dependents:     3 services\n  Transitive dependents: 7 services\n  Total blast radius:    10 services\n\nRisk Assessment: MEDIUM\n\nAffected Services by Tier:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Service            \u2502 Tier     \u2502 Distance  \u2502 Impact Path                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 web-frontend       \u2502 critical \u2502 1         \u2502 checkout \u2192 web-frontend         \u2502\n\u2502 mobile-app         \u2502 critical \u2502 1         \u2502 checkout \u2192 mobile-app           \u2502\n\u2502 order-service      \u2502 standard \u2502 1         \u2502 checkout \u2192 order-service        \u2502\n\u2502 notification-svc   \u2502 standard \u2502 2         \u2502 checkout \u2192 order \u2192 notification \u2502\n\u2502 analytics          \u2502 low      \u2502 2         \u2502 checkout \u2192 order \u2192 analytics    \u2502\n\u2502 reporting          \u2502 low      \u2502 3         \u2502 ... \u2192 analytics \u2192 reporting     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nRecommendations:\n  \u2022 2 critical-tier services affected - consider staged rollout\n  \u2022 Test changes in staging with mobile-app integration\n  \u2022 Notify platform-team (owns web-frontend)\n</code></pre></p>"},{"location":"commands/blast-radius/#limit-analysis-depth","title":"Limit Analysis Depth","text":"<pre><code># Only analyze direct dependencies (depth 1)\nnthlayer blast-radius service.yaml --depth 1\n\n# Analyze up to 3 levels deep\nnthlayer blast-radius service.yaml --depth 3\n</code></pre>"},{"location":"commands/blast-radius/#json-output","title":"JSON Output","text":"<pre><code>nthlayer blast-radius service.yaml --format json\n</code></pre> <pre><code>{\n  \"service\": \"checkout-service\",\n  \"direct_dependents\": 3,\n  \"transitive_dependents\": 7,\n  \"total_blast_radius\": 10,\n  \"risk_level\": \"medium\",\n  \"affected_services\": [\n    {\n      \"name\": \"web-frontend\",\n      \"tier\": \"critical\",\n      \"distance\": 1,\n      \"path\": [\"checkout-service\", \"web-frontend\"]\n    }\n  ]\n}\n</code></pre>"},{"location":"commands/blast-radius/#risk-assessment","title":"Risk Assessment","text":"<p>Risk levels are calculated based on:</p> Factor Weight Number of critical-tier dependents 40% Total blast radius size 30% Depth of dependency chain 20% Cross-team impact 10%"},{"location":"commands/blast-radius/#risk-levels","title":"Risk Levels","text":"Level Description <code>LOW</code> &lt; 3 total dependents, no critical tier <code>MEDIUM</code> 3-10 dependents or 1 critical-tier service <code>HIGH</code> &gt; 10 dependents or multiple critical-tier services <code>CRITICAL</code> Core infrastructure affecting &gt; 50% of services"},{"location":"commands/blast-radius/#cicd-integration","title":"CI/CD Integration","text":""},{"location":"commands/blast-radius/#deployment-gate","title":"Deployment Gate","text":"<pre><code># Block deployment if blast radius exceeds threshold\nBLAST_RADIUS=$(nthlayer blast-radius service.yaml --format json | jq '.total_blast_radius')\n\nif [ \"$BLAST_RADIUS\" -gt 20 ]; then\n  echo \"Blast radius too high ($BLAST_RADIUS services) - requires approval\"\n  exit 1\nfi\n</code></pre>"},{"location":"commands/blast-radius/#github-actions","title":"GitHub Actions","text":"<pre><code>- name: Check Blast Radius\n  run: |\n    nthlayer blast-radius service.yaml --format json &gt; blast-radius.json\n    RISK=$(jq -r '.risk_level' blast-radius.json)\n    if [ \"$RISK\" = \"critical\" ]; then\n      echo \"::warning::Critical blast radius - manual approval required\"\n    fi\n</code></pre>"},{"location":"commands/blast-radius/#see-also","title":"See Also","text":"<ul> <li>nthlayer deps - View service dependencies</li> <li>nthlayer check-deploy - Deployment gates</li> <li>Deployment Gates Concept</li> </ul>"},{"location":"commands/check-deploy/","title":"check-deploy","text":"<p>Check if deployment should be allowed based on error budget.</p>"},{"location":"commands/check-deploy/#synopsis","title":"Synopsis","text":"<pre><code>nthlayer check-deploy &lt;service-file&gt; [options]\n</code></pre>"},{"location":"commands/check-deploy/#description","title":"Description","text":"<p>The <code>check-deploy</code> command queries Prometheus for SLO metrics, calculates error budget consumption, and determines if deployment should proceed.</p> <p>This enables Shift Left reliability - catching issues before they reach production by blocking deploys when error budget is exhausted.</p>"},{"location":"commands/check-deploy/#exit-codes","title":"Exit Codes","text":"Code Result Meaning 0 Approved Budget healthy, safe to deploy 1 Warning Budget low, deploy with caution 2 Blocked Budget exhausted, do not deploy"},{"location":"commands/check-deploy/#options","title":"Options","text":"Option Description <code>--prometheus-url URL</code> Prometheus server URL (or use <code>PROMETHEUS_URL</code> env var) <code>--environment ENV</code> Environment name (dev, staging, prod) <code>--demo</code> Show demo output with sample data"},{"location":"commands/check-deploy/#examples","title":"Examples","text":""},{"location":"commands/check-deploy/#basic-check","title":"Basic Check","text":"<pre><code>nthlayer check-deploy services/payment-api.yaml \\\n  --prometheus-url http://prometheus:9090\n</code></pre>"},{"location":"commands/check-deploy/#with-environment","title":"With Environment","text":"<pre><code>nthlayer check-deploy services/api.yaml \\\n  --prometheus-url http://prometheus:9090 \\\n  --environment prod\n</code></pre>"},{"location":"commands/check-deploy/#cicd-integration","title":"CI/CD Integration","text":"<pre><code># In GitHub Actions, GitLab CI, etc.\nnthlayer check-deploy services/api.yaml \\\n  --prometheus-url \"$PROMETHEUS_URL\"\n\nif [ $? -eq 2 ]; then\n  echo \"Deployment blocked - error budget exhausted\"\n  exit 1\nfi\n</code></pre>"},{"location":"commands/check-deploy/#custom-thresholds","title":"Custom Thresholds","text":"<p>Override default tier-based thresholds with a <code>DeploymentGate</code> resource:</p> <pre><code># service.yaml\nresources:\n  - kind: DeploymentGate\n    name: custom-gate\n    spec:\n      thresholds:\n        warning: 30    # Warn when &lt;30% budget remaining\n        blocking: 5    # Block when &lt;5% budget remaining\n</code></pre>"},{"location":"commands/check-deploy/#conditional-policies","title":"Conditional Policies","text":"<p>Add time-based or context-aware conditions:</p> <pre><code>resources:\n  - kind: DeploymentGate\n    name: smart-gate\n    spec:\n      thresholds:\n        warning: 20\n        blocking: 10\n\n      conditions:\n        # Stricter during business hours\n        - name: business-hours\n          when: \"hour &gt;= 9 AND hour &lt;= 17 AND weekday\"\n          blocking: 15\n\n        # Complete freeze during holidays\n        - name: holiday-freeze\n          when: \"freeze_period('2024-12-20', '2025-01-02')\"\n          blocking: 100\n\n      exceptions:\n        # SRE can bypass gate\n        - team: sre-oncall\n          allow: always\n</code></pre>"},{"location":"commands/check-deploy/#condition-language","title":"Condition Language","text":"<p>The condition evaluator supports:</p>"},{"location":"commands/check-deploy/#comparisons","title":"Comparisons","text":"<pre><code>hour &gt;= 9\nbudget_remaining &lt; 20\ntier == 'critical'\n</code></pre>"},{"location":"commands/check-deploy/#boolean-operators","title":"Boolean Operators","text":"<pre><code>hour &gt;= 9 AND hour &lt;= 17\nweekday OR environment == 'dev'\nNOT freeze_period\n</code></pre>"},{"location":"commands/check-deploy/#built-in-functions","title":"Built-in Functions","text":"<pre><code>business_hours()                           # Mon-Fri 9-17\nweekday()                                  # Mon-Fri\nfreeze_period('2024-12-20', '2025-01-02') # Date range\n</code></pre>"},{"location":"commands/check-deploy/#available-variables","title":"Available Variables","text":"Variable Description <code>hour</code> Current hour (0-23) <code>weekday</code> True if Mon-Fri <code>date</code> Current date (YYYY-MM-DD) <code>budget_remaining</code> Budget remaining % <code>budget_consumed</code> Budget consumed % <code>tier</code> Service tier <code>environment</code> Deployment environment <code>downstream_count</code> Number of downstream services"},{"location":"commands/check-deploy/#environment-variables","title":"Environment Variables","text":"Variable Description <code>PROMETHEUS_URL</code> Prometheus server URL <code>PROMETHEUS_USERNAME</code> Basic auth username <code>PROMETHEUS_PASSWORD</code> Basic auth password"},{"location":"commands/check-deploy/#cicd-integrations","title":"CI/CD Integrations","text":"<p>See the CI/CD integration examples for:</p> <ul> <li>GitHub Actions</li> <li>ArgoCD (PreSync hook)</li> <li>GitLab CI</li> <li>Tekton</li> </ul>"},{"location":"commands/check-deploy/#see-also","title":"See Also","text":"<ul> <li>Deployment Gates Concept</li> <li>SLO Command</li> <li>Portfolio Command</li> </ul>"},{"location":"commands/config/","title":"nthlayer config","text":"<p>Manage NthLayer configuration.</p>"},{"location":"commands/config/#commands","title":"Commands","text":"<pre><code>nthlayer config show              # Show current configuration\nnthlayer config init              # Interactive configuration wizard\nnthlayer config set KEY VALUE     # Set a configuration value\n</code></pre>"},{"location":"commands/config/#nthlayer-config-show","title":"nthlayer config show","text":"<p>Display current configuration:</p> <pre><code>nthlayer config show\n</code></pre> <pre><code>============================================================\n  NthLayer Configuration\n============================================================\n\nConfig file: /Users/you/.nthlayer/config.yaml\n\nPrometheus:\n  Default profile: default\n  [default] *\n    Type: prometheus\n    URL: http://localhost:9090\n\nGrafana:\n  Default profile: default\n  [default] *\n    Type: grafana\n    URL: http://localhost:3000\n    Org ID: 1\n    API Key: ****\n\nAlerting:\n  Slack: disabled\n  Datadog: disabled\n</code></pre>"},{"location":"commands/config/#reveal-secrets","title":"Reveal Secrets","text":"<pre><code>nthlayer config show --reveal-secrets\n</code></pre>"},{"location":"commands/config/#nthlayer-config-init","title":"nthlayer config init","text":"<p>Interactive wizard for advanced configuration:</p> <pre><code>nthlayer config init\n</code></pre> <p>This is the advanced version of <code>nthlayer setup</code> with options for:</p> <ul> <li>Multiple environment profiles</li> <li>Cloud secret backends (Vault, AWS, Azure, GCP, Doppler)</li> <li>Detailed alerting configuration</li> </ul>"},{"location":"commands/config/#nthlayer-config-set","title":"nthlayer config set","text":"<p>Set individual configuration values:</p> <pre><code># Set Prometheus URL\nnthlayer config set prometheus.profiles.default.url http://prometheus:9090\n\n# Set Grafana API key (prompts for secret)\nnthlayer config set grafana.profiles.default.api_key --secret\n</code></pre>"},{"location":"commands/config/#configuration-file","title":"Configuration File","text":"<p>Located at <code>~/.nthlayer/config.yaml</code>:</p> <pre><code>prometheus:\n  default: default\n  profiles:\n    default:\n      name: default\n      type: prometheus\n      url: http://localhost:9090\n    production:\n      name: production\n      type: grafana-cloud\n      url: https://prometheus-prod.grafana.net\n      username: 12345\n      password_secret: prometheus/prod/password\n\ngrafana:\n  default: default\n  profiles:\n    default:\n      name: default\n      type: grafana\n      url: http://localhost:3000\n      org_id: 1\n      api_key_secret: grafana/api_key\n\nalerting:\n  slack:\n    enabled: false\n    webhook_url_secret: slack/webhook_url\n    default_channel: \"#alerts\"\n  datadog:\n    enabled: false\n</code></pre>"},{"location":"commands/config/#environment-variables","title":"Environment Variables","text":"<p>Override configuration with environment variables:</p> <pre><code># Prometheus\nexport NTHLAYER_PROMETHEUS_URL=http://prometheus:9090\n\n# Grafana\nexport NTHLAYER_GRAFANA_URL=http://grafana:3000\nexport NTHLAYER_GRAFANA_API_KEY=glsa_xxxxx\nexport NTHLAYER_GRAFANA_ORG_ID=1\n</code></pre>"},{"location":"commands/config/#multiple-profiles","title":"Multiple Profiles","text":"<p>Use different configurations for different environments:</p> <pre><code># Use production profile\nexport NTHLAYER_PROFILE=production\nnthlayer apply service.yaml\n\n# Or specify inline\nnthlayer apply service.yaml --profile production\n</code></pre>"},{"location":"commands/config/#see-also","title":"See Also","text":"<ul> <li>nthlayer setup - Quick setup wizard</li> <li>Integrations - Integration guides</li> </ul>"},{"location":"commands/deps/","title":"nthlayer deps","text":"<p>Discover and display service dependencies from multiple sources.</p> <p>This command queries various dependency providers (Kubernetes, Backstage, Prometheus) to build a comprehensive view of what services depend on what.</p>"},{"location":"commands/deps/#usage","title":"Usage","text":"<pre><code>nthlayer deps &lt;service.yaml&gt; [options]\n</code></pre>"},{"location":"commands/deps/#options","title":"Options","text":"Option Description <code>--prometheus-url, -p URL</code> Prometheus server URL <code>--env ENVIRONMENT</code> Environment name (dev, staging, prod) <code>--provider {prometheus,kubernetes,backstage,all}</code> Dependency provider to use (default: all) <code>--k8s-namespace NAMESPACE</code> Kubernetes namespace to search (default: all) <code>--backstage-url URL</code> Backstage catalog URL <code>--upstream, -u</code> Show only upstream dependencies (what this service calls) <code>--downstream, -d</code> Show only downstream dependencies (what calls this service) <code>--format {table,json}</code> Output format (default: table) <code>--demo</code> Show demo output with sample data"},{"location":"commands/deps/#environment-variables","title":"Environment Variables","text":"Variable Description <code>NTHLAYER_PROMETHEUS_URL</code> Default Prometheus URL <code>NTHLAYER_BACKSTAGE_URL</code> Default Backstage catalog URL <code>KUBECONFIG</code> Kubernetes configuration file"},{"location":"commands/deps/#examples","title":"Examples","text":""},{"location":"commands/deps/#basic-dependency-discovery","title":"Basic Dependency Discovery","text":"<pre><code>nthlayer deps checkout-service.yaml\n</code></pre> <p>Output: <pre><code>\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 Dependencies: checkout-service                                                \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n\nUpstream Dependencies (what checkout-service calls):\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Service         \u2502 Type         \u2502 Provider   \u2502 Confidence\u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 payment-api     \u2502 service      \u2502 kubernetes \u2502 0.95      \u2502\n\u2502 user-service    \u2502 service      \u2502 backstage  \u2502 0.90      \u2502\n\u2502 postgres-main   \u2502 datastore    \u2502 kubernetes \u2502 0.95      \u2502\n\u2502 redis-cache     \u2502 datastore    \u2502 prometheus \u2502 0.85      \u2502\n\u2502 stripe          \u2502 external     \u2502 backstage  \u2502 0.90      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nDownstream Dependencies (what calls checkout-service):\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Service         \u2502 Type         \u2502 Provider   \u2502 Confidence\u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 mobile-app      \u2502 service      \u2502 prometheus \u2502 0.80      \u2502\n\u2502 web-frontend    \u2502 service      \u2502 kubernetes \u2502 0.95      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nSummary: 5 upstream, 2 downstream dependencies\n</code></pre></p>"},{"location":"commands/deps/#filter-by-provider","title":"Filter by Provider","text":"<pre><code># Only discover from Kubernetes\nnthlayer deps service.yaml --provider kubernetes\n\n# Only discover from Backstage catalog\nnthlayer deps service.yaml --provider backstage --backstage-url https://backstage.company.com\n</code></pre>"},{"location":"commands/deps/#json-output-for-cicd","title":"JSON Output for CI/CD","text":"<pre><code>nthlayer deps service.yaml --format json &gt; dependencies.json\n</code></pre>"},{"location":"commands/deps/#show-demo-data","title":"Show Demo Data","text":"<pre><code>nthlayer deps service.yaml --demo\n</code></pre>"},{"location":"commands/deps/#dependency-providers","title":"Dependency Providers","text":""},{"location":"commands/deps/#kubernetes-provider","title":"Kubernetes Provider","text":"<p>Discovers dependencies from: - Service selectors and labels - ConfigMap references - Environment variables pointing to other services - Ingress/egress network policies</p> <p>Confidence: 0.95 (high - explicit configuration)</p>"},{"location":"commands/deps/#backstage-provider","title":"Backstage Provider","text":"<p>Discovers dependencies from: - <code>spec.dependsOn</code> in catalog entities - API relationships - System membership</p> <p>Confidence: 0.90 (high - curated catalog)</p>"},{"location":"commands/deps/#prometheus-provider","title":"Prometheus Provider","text":"<p>Discovers dependencies from: - Metric labels showing service-to-service calls - Request rate patterns between services</p> <p>Confidence: 0.80-0.85 (medium - inferred from metrics)</p>"},{"location":"commands/deps/#dependency-types","title":"Dependency Types","text":"Type Description <code>service</code> Another microservice <code>datastore</code> Database, cache, or storage <code>queue</code> Message queue or event bus <code>external</code> External API or third-party service <code>infrastructure</code> Infrastructure component (e.g., Vault, Consul)"},{"location":"commands/deps/#confidence-scores","title":"Confidence Scores","text":"<p>Dependencies are assigned confidence scores (0.0-1.0):</p> Range Meaning 0.90-1.0 High confidence (explicit configuration) 0.75-0.89 Medium confidence (strong inference) 0.50-0.74 Low confidence (weak inference) &lt;0.50 Very low (may be false positive)"},{"location":"commands/deps/#see-also","title":"See Also","text":"<ul> <li>nthlayer blast-radius - Calculate deployment impact</li> <li>nthlayer ownership - Find service owners</li> <li>Architecture Overview - System architecture</li> </ul>"},{"location":"commands/drift/","title":"drift","text":"<p>Analyze reliability drift for a service by detecting degradation trends over time.</p>"},{"location":"commands/drift/#synopsis","title":"Synopsis","text":"<pre><code>nthlayer drift &lt;service-file&gt; [options]\n</code></pre>"},{"location":"commands/drift/#description","title":"Description","text":"<p>The <code>drift</code> command queries Prometheus for historical SLO metrics, analyzes trends using linear regression, and detects patterns that indicate reliability degradation.</p> <p>This enables proactive reliability management - identifying issues before they become incidents by detecting gradual budget erosion, sudden drops, or volatile patterns.</p>"},{"location":"commands/drift/#exit-codes","title":"Exit Codes","text":"Code Severity Meaning 0 None/Info No significant drift or improving trend 1 Warning Drift detected, investigate soon 2 Critical Severe drift, immediate action needed"},{"location":"commands/drift/#options","title":"Options","text":"Option Description <code>--prometheus-url URL</code> Prometheus server URL (or use <code>NTHLAYER_PROMETHEUS_URL</code> env var) <code>--environment ENV</code> Environment name (dev, staging, prod) <code>--window WINDOW</code> Analysis window (e.g., <code>30d</code>, <code>14d</code>). Uses tier default if not specified <code>--slo SLO</code> SLO to analyze (default: <code>availability</code>) <code>--format FORMAT</code> Output format: <code>table</code> or <code>json</code> <code>--demo</code> Show demo output with sample data"},{"location":"commands/drift/#examples","title":"Examples","text":""},{"location":"commands/drift/#basic-analysis","title":"Basic Analysis","text":"<pre><code>nthlayer drift services/payment-api.yaml \\\n  --prometheus-url http://prometheus:9090\n</code></pre> <p>Output: <pre><code>\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502  Drift Analysis: payment-api                                 \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n\nSLO: availability\nWindow: 30d\nData Range: 2024-12-09 \u2192 2025-01-08\n\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2533\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Metric               \u2503         Value \u2503\n\u2521\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2547\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2529\n\u2502 Current Budget       \u2502        72.34% \u2502\n\u2502 Trend                \u2502   -0.523%/week\u2502\n\u2502 Pattern              \u2502 Gradual Decline\u2502\n\u2502 Fit Quality (R\u00b2)     \u2502         0.847 \u2502\n\u2502 Data Points          \u2502           720 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nProjection:\n  Days to Exhaustion   138 days\n  Budget in 30d        70.25%\n  Budget in 60d        68.17%\n  Confidence           85%\n\n\u26a0 Severity: WARN\nError budget declining at 0.52% per week with high confidence (R\u00b2=0.85).\n\nRecommendation: Investigate recent changes. Common causes: increased traffic,\ndependency degradation, or configuration drift. Run `nthlayer verify` to check\nmetric coverage.\n</code></pre></p>"},{"location":"commands/drift/#json-output-for-cicd","title":"JSON Output for CI/CD","text":"<pre><code>nthlayer drift services/api.yaml \\\n  --prometheus-url http://prometheus:9090 \\\n  --format json\n</code></pre>"},{"location":"commands/drift/#custom-analysis-window","title":"Custom Analysis Window","text":"<pre><code># Analyze last 14 days instead of tier default\nnthlayer drift services/api.yaml \\\n  --prometheus-url http://prometheus:9090 \\\n  --window 14d\n</code></pre>"},{"location":"commands/drift/#analyze-specific-slo","title":"Analyze Specific SLO","text":"<pre><code>nthlayer drift services/api.yaml \\\n  --prometheus-url http://prometheus:9090 \\\n  --slo latency_p99\n</code></pre>"},{"location":"commands/drift/#drift-patterns","title":"Drift Patterns","text":"<p>The analyzer classifies drift into six patterns:</p> Pattern Description Typical Cause Stable No significant trend Healthy service Gradual Decline Slow, steady budget erosion Creeping technical debt Gradual Improvement Slow, steady recovery Recent fixes taking effect Step Change Down Sudden budget drop Incident, bad deploy Step Change Up Sudden improvement Fix deployed, incident resolved Volatile High variance, no clear trend Intermittent issues"},{"location":"commands/drift/#tier-based-defaults","title":"Tier-Based Defaults","text":"<p>Default analysis windows and thresholds vary by service tier:</p> Tier Default Window Warn Threshold Critical Threshold Critical 30d -0.2%/week -0.5%/week Standard 30d -0.5%/week -1.0%/week Low 14d Disabled by default Disabled by default"},{"location":"commands/drift/#integration-with-check-deploy","title":"Integration with check-deploy","text":"<p>Combine drift analysis with deployment gates:</p> <pre><code>nthlayer check-deploy services/api.yaml \\\n  --prometheus-url http://prometheus:9090 \\\n  --include-drift\n</code></pre> <p>This adds drift analysis to the deployment gate check, blocking deploys if critical drift is detected.</p>"},{"location":"commands/drift/#integration-with-portfolio","title":"Integration with portfolio","text":"<p>View drift across all services:</p> <pre><code>nthlayer portfolio --drift --prometheus-url http://prometheus:9090\n</code></pre> <p>Output includes a drift analysis table showing trends, patterns, and exhaustion projections for each service.</p>"},{"location":"commands/drift/#cicd-integration","title":"CI/CD Integration","text":""},{"location":"commands/drift/#github-actions","title":"GitHub Actions","text":"<pre><code>jobs:\n  check-reliability:\n    steps:\n      - name: Check for Drift\n        run: |\n          nthlayer drift services/api.yaml \\\n            --prometheus-url ${{ secrets.PROMETHEUS_URL }} \\\n            --format json &gt; drift-report.json\n\n          # Fail on critical drift\n          if [ $? -eq 2 ]; then\n            echo \"::error::Critical drift detected - investigate before deploying\"\n            exit 1\n          fi\n</code></pre>"},{"location":"commands/drift/#weekly-drift-reports","title":"Weekly Drift Reports","text":"<pre><code># .github/workflows/drift-report.yml\nname: Weekly Drift Report\n\non:\n  schedule:\n    - cron: '0 9 * * 1'  # Monday 9am\n\njobs:\n  report:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Generate Drift Report\n        run: |\n          nthlayer portfolio --drift \\\n            --prometheus-url ${{ secrets.PROMETHEUS_URL }} \\\n            --format markdown &gt; drift-report.md\n\n      - name: Post to Slack\n        uses: slackapi/slack-github-action@v1\n        with:\n          payload-file-path: drift-report.md\n</code></pre>"},{"location":"commands/drift/#environment-variables","title":"Environment Variables","text":"Variable Description <code>NTHLAYER_PROMETHEUS_URL</code> Prometheus server URL <code>NTHLAYER_METRICS_USER</code> Basic auth username <code>NTHLAYER_METRICS_PASSWORD</code> Basic auth password"},{"location":"commands/drift/#algorithm-details","title":"Algorithm Details","text":""},{"location":"commands/drift/#trend-calculation","title":"Trend Calculation","text":"<p>Drift uses linear regression (least squares) on time-series data:</p> <ol> <li>Query Prometheus for <code>slo:error_budget_remaining:ratio</code> over the analysis window</li> <li>Calculate slope (budget change per week) and R\u00b2 (fit quality)</li> <li>Project days until budget exhaustion based on current trend</li> </ol>"},{"location":"commands/drift/#severity-classification","title":"Severity Classification","text":"<p>Priority order for severity assignment:</p> <ol> <li>Projected exhaustion within critical window \u2192 CRITICAL</li> <li>Step change down detected \u2192 CRITICAL</li> <li>Slope exceeds critical threshold \u2192 CRITICAL</li> <li>Projected exhaustion within warn window \u2192 WARN</li> <li>Slope exceeds warn threshold \u2192 WARN</li> <li>Any negative slope \u2192 INFO</li> <li>Otherwise \u2192 NONE</li> </ol>"},{"location":"commands/drift/#see-also","title":"See Also","text":"<ul> <li>Deployment Gates - Error budget gates</li> <li>SLO Portfolio - Organization-wide view</li> <li>SLOs &amp; Error Budgets - Understanding SLOs</li> </ul>"},{"location":"commands/environments/","title":"Environment Management","text":"<p>NthLayer supports multi-environment deployments with environment-specific configurations.</p>"},{"location":"commands/environments/#overview","title":"Overview","text":"<p>Environments allow you to customize service configurations for different deployment targets (dev, staging, production) while keeping a single source of truth in your service.yaml.</p>"},{"location":"commands/environments/#commands","title":"Commands","text":""},{"location":"commands/environments/#list-environments","title":"list-environments","text":"<p>Discover available environment configurations.</p> <pre><code># List environments in current directory\nnthlayer list-environments\n\n# List environments for a specific service\nnthlayer list-environments --service services/payment-api.yaml\n\n# Search a specific directory\nnthlayer list-environments --directory ./config\n</code></pre> <p>Example output:</p> <pre><code>NthLayer: List Environments\n\nDirectory: /home/user/project\n\n\u2713 Found 3 environment(s):\n\n\ud83d\udce6 development\n   Shared: development.yaml\n\n\ud83d\udce6 staging\n   Shared: staging.yaml\n   Service-specific: 2 file(s)\n      \u2022 payment-api: payment-api-staging.yaml\n      \u2022 user-service: user-service-staging.yaml\n\n\ud83d\udce6 production\n   Shared: production.yaml\n   Service-specific: 1 file(s)\n      \u2022 payment-api: payment-api-production.yaml\n\nUsage:\n   nthlayer generate-slo service.yaml --env development\n   nthlayer validate service.yaml --env development\n</code></pre>"},{"location":"commands/environments/#diff-envs","title":"diff-envs","text":"<p>Compare configurations between two environments to see what changes between them.</p> <pre><code>nthlayer diff-envs services/payment-api.yaml staging production\n</code></pre> <p>Example output:</p> <pre><code>NthLayer: Environment Diff\n\nService: payment-api\nComparing: staging \u2192 production\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Field           \u2502 staging     \u2502 production  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 replicas        \u2502 2           \u2502 5           \u2502\n\u2502 resources.cpu   \u2502 500m        \u2502 2000m       \u2502\n\u2502 resources.memory\u2502 512Mi       \u2502 2Gi         \u2502\n\u2502 slo.availability\u2502 99.5%       \u2502 99.95%      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n3 differences found\n</code></pre> <p>Options:</p> Option Description <code>--show-all</code> Show all fields, not just differences"},{"location":"commands/environments/#validate-env","title":"validate-env","text":"<p>Validate an environment configuration for correctness.</p> <pre><code># Basic validation\nnthlayer validate-env production\n\n# Validate against a specific service\nnthlayer validate-env production --service services/payment-api.yaml\n\n# Strict mode (warnings become errors)\nnthlayer validate-env production --strict\n</code></pre> <p>What gets validated:</p> <ul> <li>Environment file syntax (valid YAML)</li> <li>Required fields present</li> <li>Value types match expected schema</li> <li>Variable references resolve correctly</li> <li>No conflicts with service defaults</li> </ul> <p>Example output:</p> <pre><code>NthLayer: Validate Environment\n\nEnvironment: production\nDirectory: ./environments\n\n\u2713 Found environment file: production.yaml\n\nValidating...\n  \u2713 Valid YAML syntax\n  \u2713 Required fields present\n  \u2713 Value types correct\n  \u26a0 Warning: 'debug_mode' is set to true in production\n\nValidation passed with 1 warning(s)\n</code></pre>"},{"location":"commands/environments/#environment-file-structure","title":"Environment File Structure","text":""},{"location":"commands/environments/#shared-environment-file","title":"Shared Environment File","text":"<p><code>environments/production.yaml</code>:</p> <pre><code>environment: production\n\n# Override service defaults\ndefaults:\n  replicas: 3\n  resources:\n    cpu: \"1000m\"\n    memory: \"1Gi\"\n\n# Environment-specific SLO targets\nslo:\n  availability: 99.95\n  latency_p99_ms: 200\n\n# Prometheus endpoint for this environment\nprometheus:\n  url: https://prometheus.prod.example.com\n\n# Grafana for this environment\ngrafana:\n  url: https://grafana.prod.example.com\n  folder: Production\n</code></pre>"},{"location":"commands/environments/#service-specific-environment-file","title":"Service-Specific Environment File","text":"<p><code>environments/payment-api-production.yaml</code>:</p> <pre><code>environment: production\nservice: payment-api\n\n# Service-specific overrides for production\nreplicas: 5\nresources:\n  cpu: \"2000m\"\n  memory: \"2Gi\"\n\n# Stricter SLO for payment service\nslo:\n  availability: 99.99\n  latency_p99_ms: 100\n</code></pre>"},{"location":"commands/environments/#using-environments","title":"Using Environments","text":""},{"location":"commands/environments/#with-generate-commands","title":"With Generate Commands","text":"<pre><code># Generate with environment-specific config\nnthlayer apply services/payment-api.yaml --env production\n\n# Preview what would be generated\nnthlayer plan services/payment-api.yaml --env production\n</code></pre>"},{"location":"commands/environments/#with-validation-commands","title":"With Validation Commands","text":"<pre><code># Verify metrics exist in production Prometheus\nnthlayer verify services/payment-api.yaml --env production\n\n# Check deployment gate against production SLOs\nnthlayer check-deploy services/payment-api.yaml --env production\n</code></pre>"},{"location":"commands/environments/#with-slo-commands","title":"With SLO Commands","text":"<pre><code># Collect SLO metrics from production\nnthlayer slo collect services/payment-api.yaml --env production\n</code></pre>"},{"location":"commands/environments/#best-practices","title":"Best Practices","text":""},{"location":"commands/environments/#1-use-shared-defaults","title":"1. Use Shared Defaults","text":"<p>Put common configuration in shared environment files, override only what's different per-service.</p>"},{"location":"commands/environments/#2-validate-before-deploy","title":"2. Validate Before Deploy","text":"<pre><code># In CI/CD pipeline\nnthlayer validate-env $ENVIRONMENT --strict\nnthlayer validate services/*.yaml --env $ENVIRONMENT\n</code></pre>"},{"location":"commands/environments/#3-compare-before-promotion","title":"3. Compare Before Promotion","text":"<pre><code># Before promoting staging to production\nnthlayer diff-envs services/payment-api.yaml staging production\n</code></pre>"},{"location":"commands/environments/#4-keep-environments-consistent","title":"4. Keep Environments Consistent","text":"<p>Use the same environment names across all services for predictable behavior.</p>"},{"location":"commands/environments/#directory-structure","title":"Directory Structure","text":"<p>Recommended layout:</p> <pre><code>project/\n\u251c\u2500\u2500 services/\n\u2502   \u251c\u2500\u2500 payment-api.yaml\n\u2502   \u251c\u2500\u2500 user-service.yaml\n\u2502   \u2514\u2500\u2500 notification-worker.yaml\n\u251c\u2500\u2500 environments/\n\u2502   \u251c\u2500\u2500 development.yaml           # Shared dev config\n\u2502   \u251c\u2500\u2500 staging.yaml               # Shared staging config\n\u2502   \u251c\u2500\u2500 production.yaml            # Shared production config\n\u2502   \u251c\u2500\u2500 payment-api-production.yaml    # Service-specific override\n\u2502   \u2514\u2500\u2500 user-service-staging.yaml      # Service-specific override\n\u2514\u2500\u2500 generated/\n    \u251c\u2500\u2500 development/\n    \u251c\u2500\u2500 staging/\n    \u2514\u2500\u2500 production/\n</code></pre>"},{"location":"commands/generate-alerts/","title":"nthlayer generate-alerts","text":"<p>Generate Prometheus alert rules from a service specification.</p>"},{"location":"commands/generate-alerts/#synopsis","title":"Synopsis","text":"<pre><code>nthlayer generate-alerts &lt;service-file&gt; [options]\n</code></pre>"},{"location":"commands/generate-alerts/#description","title":"Description","text":"<p>The <code>generate-alerts</code> command creates Prometheus alerting rules based on your service's technology stack and tier. It leverages 400+ battle-tested alert templates from the awesome-prometheus-alerts community repository.</p>"},{"location":"commands/generate-alerts/#options","title":"Options","text":"Option Description <code>--output, -o PATH</code> Output file path (default: <code>generated/alerts/{service}.yaml</code>) <code>--env, --environment ENV</code> Environment name (dev, staging, prod) <code>--auto-env</code> Auto-detect environment from CI/CD context <code>--dry-run</code> Preview alerts without writing file <code>--runbook-url URL</code> Base URL for runbook links <code>--notification-channel CHANNEL</code> Notification channel (slack, etc.)"},{"location":"commands/generate-alerts/#examples","title":"Examples","text":""},{"location":"commands/generate-alerts/#basic-generation","title":"Basic Generation","text":"<pre><code>nthlayer generate-alerts services/payment-api.yaml\n</code></pre> <p>Generates alerts based on the service's technology stack:</p> <pre><code># generated/alerts/payment-api.yaml\ngroups:\n  - name: payment-api-alerts\n    rules:\n      - alert: PaymentAPIHighErrorRate\n        expr: |\n          sum(rate(http_requests_total{service=\"payment-api\",status=~\"5..\"}[5m]))\n          /\n          sum(rate(http_requests_total{service=\"payment-api\"}[5m])) &gt; 0.01\n        for: 5m\n        labels:\n          severity: critical\n          service: payment-api\n          tier: \"1\"\n        annotations:\n          summary: \"High error rate on payment-api\"\n          description: \"Error rate is {{ $value | humanizePercentage }} (threshold: 1%)\"\n          runbook_url: \"https://runbooks.example.com/payment-api/high-error-rate\"\n\n      - alert: PaymentAPIHighLatency\n        expr: |\n          histogram_quantile(0.99, sum(rate(http_request_duration_seconds_bucket{service=\"payment-api\"}[5m])) by (le)) &gt; 0.5\n        for: 5m\n        labels:\n          severity: warning\n          service: payment-api\n        annotations:\n          summary: \"High p99 latency on payment-api\"\n          description: \"p99 latency is {{ $value | humanizeDuration }}\"\n</code></pre>"},{"location":"commands/generate-alerts/#with-runbook-urls","title":"With Runbook URLs","text":"<pre><code>nthlayer generate-alerts services/api.yaml \\\n  --runbook-url https://wiki.example.com/runbooks\n</code></pre>"},{"location":"commands/generate-alerts/#preview-mode","title":"Preview Mode","text":"<pre><code>nthlayer generate-alerts services/api.yaml --dry-run\n</code></pre>"},{"location":"commands/generate-alerts/#technology-specific-alerts","title":"Technology-Specific Alerts","text":"<p>Based on the <code>technologies</code> section in your service.yaml, appropriate alerts are generated:</p> Technology Alert Examples PostgreSQL Connection pool exhaustion, replication lag, slow queries Redis Memory usage, connection count, evictions Kafka Consumer lag, partition offline, under-replicated Kubernetes Pod restarts, OOMKilled, resource limits HTTP/API Error rate, latency percentiles, availability"},{"location":"commands/generate-alerts/#example-service-with-technologies","title":"Example Service with Technologies","text":"<pre><code>service:\n  name: payment-api\n  tier: tier-1\n  team: payments-team\n\ntechnologies:\n  - name: postgresql\n    role: primary-database\n  - name: redis\n    role: cache\n  - name: kafka\n    role: event-bus\n</code></pre> <p>This generates alerts for the service itself plus technology-specific alerts for PostgreSQL, Redis, and Kafka.</p>"},{"location":"commands/generate-alerts/#tier-based-severity","title":"Tier-Based Severity","text":"<p>Alert severity is adjusted based on service tier:</p> Tier Error Rate Critical Latency Warning Tier 1 (Critical) &gt; 0.1% &gt; 200ms Tier 2 (Standard) &gt; 1% &gt; 500ms Tier 3 (Low) &gt; 5% &gt; 1s"},{"location":"commands/generate-alerts/#cicd-integration","title":"CI/CD Integration","text":"<pre><code>jobs:\n  generate:\n    steps:\n      - name: Generate Alerts\n        run: |\n          nthlayer generate-alerts services/api.yaml \\\n            --runbook-url ${{ vars.RUNBOOK_BASE_URL }} \\\n            --env prod\n</code></pre>"},{"location":"commands/generate-alerts/#output-structure","title":"Output Structure","text":"<pre><code>generated/\n\u2514\u2500\u2500 alerts/\n    \u251c\u2500\u2500 payment-api.yaml\n    \u251c\u2500\u2500 user-service.yaml\n    \u2514\u2500\u2500 order-service.yaml\n</code></pre>"},{"location":"commands/generate-alerts/#see-also","title":"See Also","text":"<ul> <li>nthlayer apply - Generate all resources at once</li> <li>Technology Templates - Available templates</li> <li>nthlayer generate-loki-alerts - Log-based alerts</li> </ul>"},{"location":"commands/generate-dashboard/","title":"nthlayer generate-dashboard","text":"<p>Generate Grafana dashboards from a service specification.</p>"},{"location":"commands/generate-dashboard/#synopsis","title":"Synopsis","text":"<pre><code>nthlayer generate-dashboard &lt;service-file&gt; [options]\n</code></pre>"},{"location":"commands/generate-dashboard/#description","title":"Description","text":"<p>The <code>generate-dashboard</code> command creates Grafana dashboards tailored to your service's technology stack. Dashboards include SLO panels, health metrics, and technology-specific visualizations.</p>"},{"location":"commands/generate-dashboard/#options","title":"Options","text":"Option Description <code>--output, -o PATH</code> Output file path (default: <code>generated/dashboards/{service}.json</code>) <code>--env, --environment ENV</code> Environment name (dev, staging, prod) <code>--auto-env</code> Auto-detect environment from CI/CD context <code>--dry-run</code> Print dashboard JSON without writing file <code>--full</code> Include all template panels (default: overview only) <code>--prometheus-url, -p URL</code> Prometheus URL for metric discovery"},{"location":"commands/generate-dashboard/#examples","title":"Examples","text":""},{"location":"commands/generate-dashboard/#basic-generation","title":"Basic Generation","text":"<pre><code>nthlayer generate-dashboard services/payment-api.yaml\n</code></pre> <p>Generates a Grafana dashboard JSON:</p> <pre><code>{\n  \"title\": \"payment-api - Service Dashboard\",\n  \"uid\": \"payment-api-dashboard\",\n  \"tags\": [\"nthlayer\", \"payment-api\", \"tier-1\"],\n  \"panels\": [\n    {\n      \"title\": \"Error Budget Remaining\",\n      \"type\": \"gauge\",\n      \"gridPos\": {\"h\": 8, \"w\": 6, \"x\": 0, \"y\": 0}\n    },\n    {\n      \"title\": \"Request Rate\",\n      \"type\": \"timeseries\",\n      \"gridPos\": {\"h\": 8, \"w\": 12, \"x\": 6, \"y\": 0}\n    }\n  ]\n}\n</code></pre>"},{"location":"commands/generate-dashboard/#full-dashboard","title":"Full Dashboard","text":"<pre><code>nthlayer generate-dashboard services/api.yaml --full\n</code></pre> <p>Includes all technology-specific panels (28+ panels vs 6-12 in overview mode).</p>"},{"location":"commands/generate-dashboard/#preview-mode","title":"Preview Mode","text":"<pre><code>nthlayer generate-dashboard services/api.yaml --dry-run | jq .\n</code></pre>"},{"location":"commands/generate-dashboard/#with-metric-discovery","title":"With Metric Discovery","text":"<pre><code>nthlayer generate-dashboard services/api.yaml \\\n  --prometheus-url http://prometheus:9090\n</code></pre> <p>When Prometheus URL is provided, the command validates that dashboard metrics exist.</p>"},{"location":"commands/generate-dashboard/#dashboard-panels","title":"Dashboard Panels","text":""},{"location":"commands/generate-dashboard/#overview-mode-default","title":"Overview Mode (Default)","text":"Panel Description Error Budget Gauge showing remaining error budget SLO Status Current SLO compliance percentage Request Rate Requests per second over time Error Rate 5xx errors as percentage Latency (p50/p95/p99) Request latency percentiles Availability Uptime percentage"},{"location":"commands/generate-dashboard/#full-mode-full","title":"Full Mode (<code>--full</code>)","text":"<p>Adds technology-specific panels:</p> <p>PostgreSQL: - Active connections - Transaction rate - Replication lag - Cache hit ratio</p> <p>Redis: - Memory usage - Hit/miss ratio - Connected clients - Evictions</p> <p>Kubernetes: - Pod status - Resource utilization - Restart count - Network I/O</p>"},{"location":"commands/generate-dashboard/#technology-templates","title":"Technology Templates","text":"Technology Panels HTTP/API 8 panels PostgreSQL 12 panels Redis 10 panels Kubernetes 10 panels"},{"location":"commands/generate-dashboard/#output-structure","title":"Output Structure","text":"<pre><code>generated/\n\u2514\u2500\u2500 dashboards/\n    \u251c\u2500\u2500 payment-api.json\n    \u251c\u2500\u2500 user-service.json\n    \u2514\u2500\u2500 order-service.json\n</code></pre>"},{"location":"commands/generate-dashboard/#importing-to-grafana","title":"Importing to Grafana","text":""},{"location":"commands/generate-dashboard/#via-api","title":"Via API","text":"<pre><code># Generate dashboard\nnthlayer generate-dashboard services/api.yaml\n\n# Import to Grafana\ncurl -X POST \\\n  -H \"Content-Type: application/json\" \\\n  -H \"Authorization: Bearer $GRAFANA_TOKEN\" \\\n  -d @generated/dashboards/payment-api.json \\\n  http://grafana:3000/api/dashboards/db\n</code></pre>"},{"location":"commands/generate-dashboard/#via-grafana-ui","title":"Via Grafana UI","text":"<ol> <li>Navigate to Dashboards &gt; Import</li> <li>Upload the generated JSON file</li> <li>Select your Prometheus data source</li> </ol>"},{"location":"commands/generate-dashboard/#cicd-integration","title":"CI/CD Integration","text":"<pre><code>jobs:\n  generate:\n    steps:\n      - name: Generate Dashboards\n        run: |\n          for service in services/*.yaml; do\n            nthlayer generate-dashboard \"$service\" --full\n          done\n\n      - name: Upload to Grafana\n        run: |\n          for dashboard in generated/dashboards/*.json; do\n            curl -X POST \\\n              -H \"Authorization: Bearer ${{ secrets.GRAFANA_TOKEN }}\" \\\n              -d @\"$dashboard\" \\\n              ${{ vars.GRAFANA_URL }}/api/dashboards/db\n          done\n</code></pre>"},{"location":"commands/generate-dashboard/#see-also","title":"See Also","text":"<ul> <li>nthlayer apply - Generate all resources at once</li> <li>Grafana Integration - Grafana setup</li> <li>Technology Templates - Available templates</li> <li>nthlayer generate-recording-rules - Recording rules for dashboard performance</li> </ul>"},{"location":"commands/generate-loki-alerts/","title":"generate-loki-alerts","text":"<p>Generate LogQL alert rules for Grafana Loki based on service dependencies.</p>"},{"location":"commands/generate-loki-alerts/#synopsis","title":"Synopsis","text":"<pre><code>nthlayer generate-loki-alerts &lt;service-file&gt; [options]\n</code></pre>"},{"location":"commands/generate-loki-alerts/#description","title":"Description","text":"<p>Automatically generates LogQL alert rules for Grafana Loki Ruler based on your service's declared dependencies. This extends NthLayer's \"generate from YAML\" pattern to logs.</p>"},{"location":"commands/generate-loki-alerts/#options","title":"Options","text":"Option Description <code>--output</code>, <code>-o</code> Output file path (default: <code>generated/{service}/loki-alerts.yaml</code>) <code>--dry-run</code> Preview alerts without writing file"},{"location":"commands/generate-loki-alerts/#examples","title":"Examples","text":""},{"location":"commands/generate-loki-alerts/#generate-alerts","title":"Generate Alerts","text":"<pre><code>nthlayer generate-loki-alerts services/payment-api.yaml\n</code></pre>"},{"location":"commands/generate-loki-alerts/#preview-without-writing","title":"Preview Without Writing","text":"<pre><code>nthlayer generate-loki-alerts services/api.yaml --dry-run\n</code></pre>"},{"location":"commands/generate-loki-alerts/#custom-output-path","title":"Custom Output Path","text":"<pre><code>nthlayer generate-loki-alerts services/api.yaml -o alerts/loki/api.yaml\n</code></pre>"},{"location":"commands/generate-loki-alerts/#supported-technologies","title":"Supported Technologies","text":"<p>NthLayer generates LogQL alerts for 15+ technologies:</p> Category Technologies Databases PostgreSQL, MySQL, MongoDB, Redis Message Queues Kafka, RabbitMQ, NATS, Pulsar Search Elasticsearch Orchestration Kubernetes Load Balancers Nginx, HAProxy, Traefik Service Discovery Consul, etcd"},{"location":"commands/generate-loki-alerts/#alert-types","title":"Alert Types","text":""},{"location":"commands/generate-loki-alerts/#database-alerts","title":"Database Alerts","text":"<ul> <li>Fatal/panic errors</li> <li>Connection failures</li> <li>Replication lag</li> <li>Deadlocks</li> <li>Slow queries</li> </ul>"},{"location":"commands/generate-loki-alerts/#message-queue-alerts","title":"Message Queue Alerts","text":"<ul> <li>Under-replicated partitions (Kafka)</li> <li>Memory/disk alarms (RabbitMQ)</li> <li>Consumer lag</li> <li>Broker failures</li> </ul>"},{"location":"commands/generate-loki-alerts/#kubernetes-alerts","title":"Kubernetes Alerts","text":"<ul> <li>OOMKilled containers</li> <li>CrashLoopBackOff</li> <li>Node not ready</li> <li>Probe failures</li> </ul>"},{"location":"commands/generate-loki-alerts/#output-format","title":"Output Format","text":"<p>Alerts are generated in Grafana Loki Ruler YAML format:</p> <pre><code>groups:\n  - name: payment-api\n    rules:\n      - alert: payment-api_postgresql_PostgresqlFatalError\n        expr: count_over_time({app=\"postgresql\", service=\"payment-api\"} |= \"FATAL\" [1m]) &gt; 0\n        for: 0m\n        labels:\n          severity: critical\n          service: payment-api\n          tier: critical\n          technology: postgresql\n        annotations:\n          summary: \"[payment-api/postgresql] PostgreSQL FATAL error detected\"\n          description: \"PostgreSQL logged a FATAL error...\"\n</code></pre>"},{"location":"commands/generate-loki-alerts/#integration-with-loki","title":"Integration with Loki","text":""},{"location":"commands/generate-loki-alerts/#deploy-to-loki-ruler","title":"Deploy to Loki Ruler","text":"<pre><code># Generate alerts\nnthlayer generate-loki-alerts services/api.yaml\n\n# Deploy to Loki (using mimirtool or Loki API)\nmimirtool rules load generated/api/loki-alerts.yaml\n</code></pre>"},{"location":"commands/generate-loki-alerts/#with-grafana-cloud","title":"With Grafana Cloud","text":"<pre><code># Generate\nnthlayer generate-loki-alerts services/api.yaml\n\n# Upload via Grafana Cloud API\ncurl -X POST \"https://your-instance.grafana.net/loki/api/v1/rules/nthlayer\" \\\n  -H \"Authorization: Bearer $GRAFANA_API_KEY\" \\\n  -H \"Content-Type: application/yaml\" \\\n  --data-binary @generated/api/loki-alerts.yaml\n</code></pre>"},{"location":"commands/generate-loki-alerts/#how-dependencies-are-detected","title":"How Dependencies Are Detected","text":"<p>Dependencies are extracted from your <code>service.yaml</code>:</p> <pre><code>resources:\n  - kind: Dependencies\n    name: external\n    spec:\n      databases:\n        - name: payment-db\n          type: postgresql\n        - name: cache\n          type: redis\n      services:\n        - name: kafka-cluster\n          type: kafka\n</code></pre>"},{"location":"commands/generate-loki-alerts/#see-also","title":"See Also","text":"<ul> <li>apply Command - Generate all artifacts including Loki alerts</li> </ul>"},{"location":"commands/generate-recording-rules/","title":"nthlayer generate-recording-rules","text":"<p>Generate Prometheus recording rules from a service specification.</p>"},{"location":"commands/generate-recording-rules/#synopsis","title":"Synopsis","text":"<pre><code>nthlayer generate-recording-rules &lt;service-file&gt; [options]\n</code></pre>"},{"location":"commands/generate-recording-rules/#description","title":"Description","text":"<p>The <code>generate-recording-rules</code> command creates Prometheus recording rules that pre-compute expensive queries. This dramatically improves dashboard performance and enables efficient SLO calculations.</p> <p>Recording rules pre-aggregate metrics so dashboards load in milliseconds instead of seconds, especially for high-cardinality data.</p>"},{"location":"commands/generate-recording-rules/#options","title":"Options","text":"Option Description <code>--output, -o PATH</code> Output file path (default: <code>generated/recording-rules/{service}.yaml</code>) <code>--env, --environment ENV</code> Environment name (dev, staging, prod) <code>--auto-env</code> Auto-detect environment from CI/CD context <code>--dry-run</code> Print YAML without writing file"},{"location":"commands/generate-recording-rules/#examples","title":"Examples","text":""},{"location":"commands/generate-recording-rules/#basic-generation","title":"Basic Generation","text":"<pre><code>nthlayer generate-recording-rules services/payment-api.yaml\n</code></pre> <p>Generates recording rules:</p> <pre><code># generated/recording-rules/payment-api.yaml\ngroups:\n  - name: payment-api-recording-rules\n    interval: 30s\n    rules:\n      # Request rate (pre-aggregated)\n      - record: service:http_requests:rate5m\n        expr: sum(rate(http_requests_total{service=\"payment-api\"}[5m]))\n        labels:\n          service: payment-api\n\n      # Error rate\n      - record: service:http_errors:rate5m\n        expr: sum(rate(http_requests_total{service=\"payment-api\",status=~\"5..\"}[5m]))\n        labels:\n          service: payment-api\n\n      # Error ratio (for SLO)\n      - record: service:http_errors:ratio_rate5m\n        expr: |\n          service:http_errors:rate5m{service=\"payment-api\"}\n          /\n          service:http_requests:rate5m{service=\"payment-api\"}\n        labels:\n          service: payment-api\n\n      # Latency percentiles\n      - record: service:http_request_duration_seconds:p50\n        expr: histogram_quantile(0.50, sum(rate(http_request_duration_seconds_bucket{service=\"payment-api\"}[5m])) by (le))\n        labels:\n          service: payment-api\n\n      - record: service:http_request_duration_seconds:p95\n        expr: histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket{service=\"payment-api\"}[5m])) by (le))\n        labels:\n          service: payment-api\n\n      - record: service:http_request_duration_seconds:p99\n        expr: histogram_quantile(0.99, sum(rate(http_request_duration_seconds_bucket{service=\"payment-api\"}[5m])) by (le))\n        labels:\n          service: payment-api\n\n      # Error budget remaining\n      - record: slo:error_budget_remaining:ratio\n        expr: |\n          1 - (\n            sum_over_time(service:http_errors:ratio_rate5m{service=\"payment-api\"}[30d])\n            /\n            (30 * 24 * 12)  # 30 days of 5-minute windows\n          ) / (1 - 0.999)  # 99.9% SLO target\n        labels:\n          service: payment-api\n          slo: availability\n</code></pre>"},{"location":"commands/generate-recording-rules/#preview-mode","title":"Preview Mode","text":"<pre><code>nthlayer generate-recording-rules services/api.yaml --dry-run\n</code></pre>"},{"location":"commands/generate-recording-rules/#environment-specific","title":"Environment-Specific","text":"<pre><code>nthlayer generate-recording-rules services/api.yaml --env prod\n</code></pre>"},{"location":"commands/generate-recording-rules/#generated-metrics","title":"Generated Metrics","text":"Metric Description Use Case <code>service:http_requests:rate5m</code> Request rate Traffic monitoring <code>service:http_errors:rate5m</code> Error rate Error tracking <code>service:http_errors:ratio_rate5m</code> Error ratio SLO calculation <code>service:http_request_duration_seconds:p50</code> p50 latency Performance baseline <code>service:http_request_duration_seconds:p95</code> p95 latency Performance monitoring <code>service:http_request_duration_seconds:p99</code> p99 latency SLO calculation <code>slo:error_budget_remaining:ratio</code> Budget remaining Error budget tracking"},{"location":"commands/generate-recording-rules/#performance-impact","title":"Performance Impact","text":"<p>Recording rules provide 10x dashboard performance improvement by:</p> <ol> <li>Pre-aggregation: Expensive <code>rate()</code> and <code>histogram_quantile()</code> computed once</li> <li>Reduced cardinality: Results stored with minimal labels</li> <li>Instant queries: Dashboards query pre-computed metrics</li> </ol> <p>Before recording rules: <pre><code>Dashboard load time: 3-5 seconds\nQuery complexity: High (full aggregation on each load)\n</code></pre></p> <p>After recording rules: <pre><code>Dashboard load time: 200-500ms\nQuery complexity: Low (simple metric lookup)\n</code></pre></p>"},{"location":"commands/generate-recording-rules/#output-structure","title":"Output Structure","text":"<pre><code>generated/\n\u2514\u2500\u2500 recording-rules/\n    \u251c\u2500\u2500 payment-api.yaml\n    \u251c\u2500\u2500 user-service.yaml\n    \u2514\u2500\u2500 order-service.yaml\n</code></pre>"},{"location":"commands/generate-recording-rules/#loading-into-prometheus","title":"Loading into Prometheus","text":""},{"location":"commands/generate-recording-rules/#file-based","title":"File-based","text":"<pre><code># prometheus.yml\nrule_files:\n  - /etc/prometheus/rules/*.yaml\n</code></pre> <p>Copy generated files to your Prometheus rules directory:</p> <pre><code>cp generated/recording-rules/*.yaml /etc/prometheus/rules/\n# Reload Prometheus\ncurl -X POST http://prometheus:9090/-/reload\n</code></pre>"},{"location":"commands/generate-recording-rules/#mimircortex-ruler-api","title":"Mimir/Cortex Ruler API","text":"<pre><code>nthlayer apply services/api.yaml --push-ruler \\\n  --ruler-url http://mimir:8080\n</code></pre>"},{"location":"commands/generate-recording-rules/#cicd-integration","title":"CI/CD Integration","text":"<pre><code>jobs:\n  generate:\n    steps:\n      - name: Generate Recording Rules\n        run: |\n          nthlayer generate-recording-rules services/api.yaml\n\n      - name: Deploy to Prometheus\n        run: |\n          kubectl create configmap prometheus-rules \\\n            --from-file=generated/recording-rules/ \\\n            --dry-run=client -o yaml | kubectl apply -f -\n\n          # Trigger Prometheus reload\n          kubectl rollout restart deployment/prometheus\n</code></pre>"},{"location":"commands/generate-recording-rules/#see-also","title":"See Also","text":"<ul> <li>nthlayer apply - Generate all resources at once</li> <li>nthlayer generate-dashboard - Dashboard generation</li> <li>Prometheus Integration - Prometheus setup</li> <li>Mimir Integration - Mimir ruler API</li> </ul>"},{"location":"commands/generate-slo/","title":"nthlayer generate-slo","text":"<p>Generate SLO definitions from a service specification.</p>"},{"location":"commands/generate-slo/#synopsis","title":"Synopsis","text":"<pre><code>nthlayer generate-slo &lt;service-file&gt; [options]\n</code></pre>"},{"location":"commands/generate-slo/#description","title":"Description","text":"<p>The <code>generate-slo</code> command creates SLO definitions from your service.yaml specification. It supports multiple output formats for different SLO tooling ecosystems.</p>"},{"location":"commands/generate-slo/#options","title":"Options","text":"Option Description <code>--output DIR</code> Output directory for generated files <code>--format FORMAT</code> Output format: <code>sloth</code> (default), <code>prometheus</code>, <code>openslo</code> <code>--env, --environment ENV</code> Environment name (dev, staging, prod) <code>--auto-env</code> Auto-detect environment from CI/CD context <code>--dry-run</code> Preview without writing files"},{"location":"commands/generate-slo/#examples","title":"Examples","text":""},{"location":"commands/generate-slo/#basic-generation","title":"Basic Generation","text":"<pre><code>nthlayer generate-slo services/payment-api.yaml\n</code></pre> <p>Generates SLO definitions in the default Sloth format:</p> <pre><code># generated/slos/payment-api.yaml\nversion: prometheus/v1\nservice: payment-api\nslos:\n  - name: availability\n    objective: 99.9\n    description: \"Payment API availability SLO\"\n    sli:\n      events:\n        error_query: sum(rate(http_requests_total{service=\"payment-api\",status=~\"5..\"}[{{.window}}]))\n        total_query: sum(rate(http_requests_total{service=\"payment-api\"}[{{.window}}]))\n    alerting:\n      name: PaymentAPIAvailability\n      page_alert:\n        labels:\n          severity: critical\n      ticket_alert:\n        labels:\n          severity: warning\n</code></pre>"},{"location":"commands/generate-slo/#prometheus-native-format","title":"Prometheus Native Format","text":"<pre><code>nthlayer generate-slo services/api.yaml --format prometheus\n</code></pre> <p>Generates Prometheus recording rules directly:</p> <pre><code>groups:\n  - name: payment-api-slo\n    rules:\n      - record: slo:sli_error:ratio_rate5m\n        expr: |\n          sum(rate(http_requests_total{service=\"payment-api\",status=~\"5..\"}[5m]))\n          /\n          sum(rate(http_requests_total{service=\"payment-api\"}[5m]))\n        labels:\n          service: payment-api\n          slo: availability\n</code></pre>"},{"location":"commands/generate-slo/#openslo-format","title":"OpenSLO Format","text":"<pre><code>nthlayer generate-slo services/api.yaml --format openslo\n</code></pre> <pre><code>apiVersion: openslo/v1\nkind: SLO\nmetadata:\n  name: payment-api-availability\nspec:\n  service: payment-api\n  indicator:\n    metadata:\n      name: availability-ratio\n    spec:\n      ratioMetric:\n        counter: true\n        good:\n          metricSource:\n            type: Prometheus\n            spec:\n              query: sum(rate(http_requests_total{service=\"payment-api\",status!~\"5..\"}[{{.window}}]))\n        total:\n          metricSource:\n            type: Prometheus\n            spec:\n              query: sum(rate(http_requests_total{service=\"payment-api\"}[{{.window}}]))\n  objectives:\n    - displayName: 99.9% Availability\n      target: 0.999\n</code></pre>"},{"location":"commands/generate-slo/#environment-specific-generation","title":"Environment-Specific Generation","text":"<pre><code># Generate for production\nnthlayer generate-slo services/api.yaml --env prod\n\n# Auto-detect from CI/CD\nnthlayer generate-slo services/api.yaml --auto-env\n</code></pre>"},{"location":"commands/generate-slo/#preview-mode","title":"Preview Mode","text":"<pre><code>nthlayer generate-slo services/api.yaml --dry-run\n</code></pre> <p>Outputs the generated YAML to stdout without writing files.</p>"},{"location":"commands/generate-slo/#output-structure","title":"Output Structure","text":"<p>Default output directory structure:</p> <pre><code>generated/\n\u2514\u2500\u2500 slos/\n    \u251c\u2500\u2500 payment-api.yaml\n    \u251c\u2500\u2500 user-service.yaml\n    \u2514\u2500\u2500 order-service.yaml\n</code></pre>"},{"location":"commands/generate-slo/#service-yaml-reference","title":"Service YAML Reference","text":"<p>SLOs are defined in the <code>slos</code> section of your service.yaml:</p> <pre><code>service:\n  name: payment-api\n  tier: tier-1\n  team: payments-team\n\nslos:\n  - name: availability\n    objective: 99.9\n    window: 30d\n    indicator:\n      type: availability\n      query: \"sum(rate(http_requests_total{status!~'5..'}[5m])) / sum(rate(http_requests_total[5m]))\"\n\n  - name: latency-p99\n    objective: 99.0\n    window: 30d\n    indicator:\n      type: latency\n      threshold: 500ms\n      query: \"histogram_quantile(0.99, sum(rate(http_request_duration_seconds_bucket[5m])) by (le))\"\n</code></pre>"},{"location":"commands/generate-slo/#cicd-integration","title":"CI/CD Integration","text":"<pre><code>jobs:\n  generate:\n    steps:\n      - name: Generate SLOs\n        run: |\n          nthlayer generate-slo services/api.yaml \\\n            --format sloth \\\n            --env ${{ github.ref == 'refs/heads/main' &amp;&amp; 'prod' || 'staging' }}\n</code></pre>"},{"location":"commands/generate-slo/#see-also","title":"See Also","text":"<ul> <li>nthlayer apply - Generate all resources at once</li> <li>SLOs &amp; Error Budgets - Understanding SLOs</li> <li>Service YAML Schema - Full schema reference</li> </ul>"},{"location":"commands/identity/","title":"nthlayer identity","text":"<p>Service identity resolution and management for consistent naming across systems.</p> <p>Services often have different names across systems (Kubernetes, Prometheus, Backstage, etc.). This command helps resolve and normalize service identities.</p>"},{"location":"commands/identity/#usage","title":"Usage","text":"<pre><code>nthlayer identity &lt;subcommand&gt; [options]\n</code></pre>"},{"location":"commands/identity/#subcommands","title":"Subcommands","text":""},{"location":"commands/identity/#resolve","title":"resolve","text":"<p>Resolve a service name to its canonical identity.</p> <pre><code>nthlayer identity resolve &lt;service-name&gt;\n</code></pre>"},{"location":"commands/identity/#list","title":"list","text":"<p>List all known service identities.</p> <pre><code>nthlayer identity list\n</code></pre>"},{"location":"commands/identity/#normalize","title":"normalize","text":"<p>Show how a service name gets normalized.</p> <pre><code>nthlayer identity normalize &lt;service-name&gt;\n</code></pre>"},{"location":"commands/identity/#add-mapping","title":"add-mapping","text":"<p>Add an explicit identity mapping.</p> <pre><code>nthlayer identity add-mapping &lt;alias&gt; &lt;canonical-name&gt;\n</code></pre>"},{"location":"commands/identity/#examples","title":"Examples","text":""},{"location":"commands/identity/#resolve-service-identity","title":"Resolve Service Identity","text":"<pre><code>nthlayer identity resolve checkout-svc\n</code></pre> <p>Output: <pre><code>\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 Identity Resolution: checkout-svc                                             \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n\nCanonical Name: checkout-service\n\nKnown Aliases:\n  \u2022 checkout-svc (kubernetes deployment)\n  \u2022 checkout_service (prometheus metrics)\n  \u2022 CheckoutService (backstage)\n\nResolution Path:\n  Input: checkout-svc\n  Normalized: checkout-svc\n  Matched: checkout-service (similarity: 0.92)\n  Canonical: checkout-service\n</code></pre></p>"},{"location":"commands/identity/#list-all-identities","title":"List All Identities","text":"<pre><code>nthlayer identity list\n</code></pre> <p>Output: <pre><code>Known Service Identities:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Canonical Name      \u2502 Aliases                                                \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 checkout-service    \u2502 checkout-svc, checkout_service, CheckoutService        \u2502\n\u2502 payment-api         \u2502 payment-service, payments-api, PaymentAPI              \u2502\n\u2502 user-service        \u2502 user-svc, users, UserService                           \u2502\n\u2502 order-service       \u2502 orders, order-api, OrderService                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre></p>"},{"location":"commands/identity/#show-normalization","title":"Show Normalization","text":"<pre><code>nthlayer identity normalize \"Payment-API_v2\"\n</code></pre> <p>Output: <pre><code>Normalization Steps:\n  1. Input:      \"Payment-API_v2\"\n  2. Lowercase:  \"payment-api_v2\"\n  3. Normalize:  \"payment-api-v2\"\n  4. Strip:      \"payment-api\"\n  5. Canonical:  \"payment-api\"\n</code></pre></p>"},{"location":"commands/identity/#add-custom-mapping","title":"Add Custom Mapping","text":"<pre><code>nthlayer identity add-mapping \"legacy-checkout\" \"checkout-service\"\n</code></pre> <p>Output: <pre><code>Added mapping: legacy-checkout \u2192 checkout-service\n</code></pre></p>"},{"location":"commands/identity/#normalization-rules","title":"Normalization Rules","text":"<p>Service names are normalized using these rules:</p> Rule Example Lowercase <code>PaymentAPI</code> \u2192 <code>paymentapi</code> Replace underscores <code>payment_api</code> \u2192 <code>payment-api</code> Strip version suffixes <code>service-v2</code> \u2192 <code>service</code> Strip environment suffixes <code>service-prod</code> \u2192 <code>service</code> Strip common suffixes <code>payment-service</code> \u2192 <code>payment</code> (optional)"},{"location":"commands/identity/#identity-sources","title":"Identity Sources","text":"<p>Identities are discovered from:</p> <ol> <li>service.yaml - Explicit <code>service.name</code> declaration</li> <li>Backstage - Catalog entity names</li> <li>Kubernetes - Deployment/Service names</li> <li>Prometheus - Metric label values</li> </ol>"},{"location":"commands/identity/#configuration","title":"Configuration","text":""},{"location":"commands/identity/#custom-mappings-file","title":"Custom Mappings File","text":"<p>Create <code>.nthlayer/identity-mappings.yaml</code>:</p> <pre><code>mappings:\n  # Explicit aliases\n  legacy-checkout: checkout-service\n  old-payment-system: payment-api\n\n  # Regex patterns\n  patterns:\n    - match: \"^(.+)-prod$\"\n      canonical: \"$1\"\n    - match: \"^(.+)_service$\"\n      canonical: \"$1-service\"\n</code></pre>"},{"location":"commands/identity/#environment-specific-names","title":"Environment-Specific Names","text":"<pre><code># service.yaml\nservice:\n  name: checkout-service\n  identity:\n    kubernetes: checkout-svc\n    prometheus: checkout_service\n    backstage: CheckoutService\n</code></pre>"},{"location":"commands/identity/#use-cases","title":"Use Cases","text":""},{"location":"commands/identity/#cross-system-correlation","title":"Cross-System Correlation","text":"<pre><code># Find all references to a service across systems\ncanonical=$(nthlayer identity resolve \"$ALERT_SERVICE\" | grep \"Canonical\" | awk '{print $3}')\necho \"Looking for $canonical in all systems...\"\n</code></pre>"},{"location":"commands/identity/#metric-queries","title":"Metric Queries","text":"<pre><code># Get the Prometheus-style name for queries\nprom_name=$(nthlayer identity normalize \"$SERVICE\" --style prometheus)\ncurl \"$PROMETHEUS_URL/api/v1/query?query=up{service=\\\"$prom_name\\\"}\"\n</code></pre>"},{"location":"commands/identity/#service-discovery","title":"Service Discovery","text":"<pre><code># Resolve service name from Kubernetes event\nk8s_name=$(kubectl get events -o json | jq -r '.items[0].involvedObject.name')\ncanonical=$(nthlayer identity resolve \"$k8s_name\")\n</code></pre>"},{"location":"commands/identity/#see-also","title":"See Also","text":"<ul> <li>nthlayer ownership - Find service owners</li> <li>nthlayer deps - View service dependencies</li> <li>Service YAML Schema</li> </ul>"},{"location":"commands/init/","title":"nthlayer init","text":"<p>Interactively create a new service specification file.</p>"},{"location":"commands/init/#synopsis","title":"Synopsis","text":"<pre><code>nthlayer init [options]\n</code></pre>"},{"location":"commands/init/#description","title":"Description","text":"<p>The <code>init</code> command guides you through creating a <code>service.yaml</code> file with interactive prompts. It auto-generates appropriate resources based on your selections.</p>"},{"location":"commands/init/#options","title":"Options","text":"Option Description <code>--output, -o PATH</code> Output file path (default: <code>service.yaml</code>) <code>--template NAME</code> Use a pre-built template <code>--no-interactive</code> Use defaults without prompts"},{"location":"commands/init/#interactive-mode","title":"Interactive Mode","text":"<pre><code>nthlayer init\n</code></pre> <p>The wizard prompts for:</p> <ol> <li>Service name - e.g., <code>payment-api</code></li> <li>Team - e.g., <code>platform</code></li> <li>Tier - critical, standard, or low</li> <li>Type - api, worker, stream, web, batch, or ml</li> <li>Dependencies - databases, caches, queues</li> </ol>"},{"location":"commands/init/#example-session","title":"Example Session","text":"<pre><code>\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502  NthLayer Service Generator                                  \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n\nService name: payment-api\nTeam: payments\n\nSelect service tier:\n  \u276f critical  - 99.95% availability, 5min escalation\n    standard  - 99.9% availability, 15min escalation\n    low       - 99.5% availability, business hours\n\nSelect service type:\n  \u276f api       - HTTP/REST API service\n    worker    - Background job processor\n    stream    - Event/stream processor\n    web       - Web application\n    batch     - Batch processing job\n    ml        - ML inference service\n\nSelect dependencies (space to toggle):\n  \u25c9 postgresql\n  \u25c9 redis\n  \u25cb kafka\n  \u25cb mongodb\n  \u25cb elasticsearch\n  \u25cb rabbitmq\n\n\u2713 Created services/payment-api.yaml\n</code></pre>"},{"location":"commands/init/#generated-output","title":"Generated Output","text":"<p>Based on your selections, <code>init</code> generates appropriate resources:</p>"},{"location":"commands/init/#critical-tier-api","title":"Critical Tier API","text":"<pre><code>service:\n  name: payment-api\n  team: payments\n  tier: critical\n  type: api\n\nresources:\n  # Availability SLO (99.95% for critical)\n  - kind: SLO\n    name: availability\n    spec:\n      objective: 99.95\n      window: 30d\n      indicator:\n        type: availability\n\n  # Latency SLO (auto-added for API type)\n  - kind: SLO\n    name: latency-p99\n    spec:\n      objective: 99.0\n      threshold_ms: 200\n      indicator:\n        type: latency\n        percentile: 99\n\n  # Dependencies\n  - kind: Dependencies\n    name: deps\n    spec:\n      databases:\n        - type: postgresql\n          criticality: high\n      caches:\n        - type: redis\n          criticality: high\n</code></pre>"},{"location":"commands/init/#standard-tier-worker","title":"Standard Tier Worker","text":"<pre><code>service:\n  name: email-worker\n  team: notifications\n  tier: standard\n  type: worker\n\nresources:\n  - kind: SLO\n    name: availability\n    spec:\n      objective: 99.9\n      window: 30d\n</code></pre>"},{"location":"commands/init/#resource-auto-generation","title":"Resource Auto-Generation","text":"Selection Generated Resources Tier: critical Higher SLO targets Tier: standard Standard SLO targets Tier: low Lower SLO targets Type: api Latency SLO Type: worker Job completion SLO Type: stream Throughput SLO Dependencies Dependencies resource"},{"location":"commands/init/#templates","title":"Templates","text":"<p>Use pre-built templates for common patterns:</p> <pre><code># List available templates\nnthlayer init --list-templates\n\n# Use a template\nnthlayer init --template api-with-postgres\n</code></pre>"},{"location":"commands/init/#available-templates","title":"Available Templates","text":"Template Description <code>api-basic</code> Simple API with availability SLO <code>api-with-postgres</code> API with PostgreSQL dependency <code>worker-basic</code> Background worker <code>stream-kafka</code> Kafka stream processor"},{"location":"commands/init/#non-interactive-mode","title":"Non-Interactive Mode","text":"<p>Generate with defaults:</p> <pre><code>nthlayer init --no-interactive \\\n  --name my-service \\\n  --team platform \\\n  --tier standard \\\n  --type api\n</code></pre>"},{"location":"commands/init/#see-also","title":"See Also","text":"<ul> <li>nthlayer apply - Generate configs from service spec</li> <li>Service YAML Schema - Full specification</li> <li>Quick Start - Getting started guide</li> </ul>"},{"location":"commands/migrate/","title":"nthlayer migrate","text":"<p>Convert legacy NthLayer service.yaml files to the OpenSRM format.</p>"},{"location":"commands/migrate/#synopsis","title":"Synopsis","text":"<pre><code>nthlayer migrate &lt;service-file&gt; [options]\n</code></pre>"},{"location":"commands/migrate/#description","title":"Description","text":"<p>The <code>migrate</code> command converts legacy flat-YAML service specifications to the OpenSRM <code>srm/v1</code> format. The migration:</p> <ul> <li>Adds <code>apiVersion: srm/v1</code> and <code>kind: ServiceReliabilityManifest</code></li> <li>Restructures fields into <code>metadata</code> and <code>spec</code> sections</li> <li>Converts <code>resources[kind=SLO]</code> entries into <code>spec.slos</code> map</li> <li>Normalizes service type aliases (e.g. <code>background-job</code> \u2192 <code>worker</code>)</li> <li>Preserves all existing configuration</li> </ul> <p>If the input file is already in OpenSRM format, the command reports this and exits cleanly.</p>"},{"location":"commands/migrate/#exit-codes","title":"Exit Codes","text":"Code Meaning 0 Migration successful (or file already OpenSRM) 1 Error (file not found, parse failure, output exists without <code>--force</code>)"},{"location":"commands/migrate/#options","title":"Options","text":"Option Description <code>--output DIR</code>, <code>-o DIR</code> Output directory (default: same directory as input) <code>--dry-run</code> Print migrated YAML to stdout without writing a file <code>--force</code> Overwrite existing output file if it already exists"},{"location":"commands/migrate/#examples","title":"Examples","text":""},{"location":"commands/migrate/#basic-migration","title":"Basic Migration","text":"<pre><code>nthlayer migrate services/payment-api.yaml\n</code></pre> <p>Output: <pre><code>Migration Complete: payment-api\n\n  \u2713 Converted from legacy NthLayer format to OpenSRM\n\n  Changes:\n    \u2022 Added apiVersion: srm/v1\n    \u2022 Added kind: ServiceReliabilityManifest\n    \u2022 Restructured metadata and spec sections\n\n  Output: services/payment-api.reliability.yaml\n\n  Next steps:\n    1. Review the migrated file: services/payment-api.reliability.yaml\n    2. Validate: nthlayer validate services/payment-api.reliability.yaml\n    3. Test: nthlayer plan services/payment-api.reliability.yaml\n\n  \u26a0 The legacy file (payment-api.yaml) can be removed after validation\n</code></pre></p>"},{"location":"commands/migrate/#dry-run-preview","title":"Dry-Run Preview","text":"<pre><code>nthlayer migrate services/payment-api.yaml --dry-run\n</code></pre> <p>Prints the full migrated YAML to stdout without writing any files.</p>"},{"location":"commands/migrate/#custom-output-directory","title":"Custom Output Directory","text":"<pre><code>nthlayer migrate services/payment-api.yaml --output opensrm/\n</code></pre> <p>Writes the migrated file to <code>opensrm/payment-api.reliability.yaml</code>.</p>"},{"location":"commands/migrate/#batch-migration","title":"Batch Migration","text":"<pre><code>for f in services/*.yaml; do\n  nthlayer migrate \"$f\" --output opensrm/ --force\ndone\n</code></pre>"},{"location":"commands/migrate/#what-changes","title":"What Changes","text":"<p>The output file uses the naming convention <code>&lt;service-name&gt;.reliability.yaml</code> and contains the full OpenSRM structure:</p> Legacy Field OpenSRM Location <code>name</code> <code>metadata.name</code> <code>team</code> <code>metadata.team</code> <code>tier</code> <code>metadata.tier</code> <code>type</code> <code>spec.type</code> <code>dependencies</code> <code>spec.dependencies</code> <code>resources[kind=SLO]</code> <code>spec.slos</code> <code>resources[kind=Alert]</code> <code>spec.alerting.rules</code> <code>resources[kind=Dependencies]</code> <code>spec.dependencies</code> <code>environments</code> <code>spec.deployment.environments</code>"},{"location":"commands/migrate/#see-also","title":"See Also","text":"<ul> <li>OpenSRM Format \u2014 Format guide and schema overview</li> <li>Service YAML Schema \u2014 Full field reference</li> </ul>"},{"location":"commands/ownership/","title":"nthlayer ownership","text":"<p>Resolve service ownership from multiple sources with confidence-based attribution.</p> <p>This command queries Backstage, CODEOWNERS, and Kubernetes labels to determine who owns a service.</p>"},{"location":"commands/ownership/#usage","title":"Usage","text":"<pre><code>nthlayer ownership &lt;service.yaml&gt; [options]\n</code></pre>"},{"location":"commands/ownership/#options","title":"Options","text":"Option Description <code>--env ENVIRONMENT</code> Environment name (dev, staging, prod) <code>--format {table,json}</code> Output format (default: table) <code>--backstage-url URL</code> Backstage catalog URL <code>--k8s-namespace NAMESPACE</code> Kubernetes namespace to search <code>--codeowners-root PATH</code> Root directory for CODEOWNERS file <code>--demo</code> Show demo output with sample data"},{"location":"commands/ownership/#environment-variables","title":"Environment Variables","text":"Variable Description <code>NTHLAYER_BACKSTAGE_URL</code> Default Backstage catalog URL <code>KUBECONFIG</code> Kubernetes configuration file"},{"location":"commands/ownership/#examples","title":"Examples","text":""},{"location":"commands/ownership/#basic-ownership-resolution","title":"Basic Ownership Resolution","text":"<pre><code>nthlayer ownership checkout-service.yaml\n</code></pre> <p>Output: <pre><code>\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 Ownership: checkout-service                                                   \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n\nPrimary Owner:\n  Team:        payments-team\n  Confidence:  0.95 (high)\n  Source:      backstage\n\nOwnership Sources:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Source          \u2502 Owner           \u2502 Confidence \u2502 Details                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Backstage       \u2502 payments-team   \u2502 0.95       \u2502 spec.owner in catalog       \u2502\n\u2502 CODEOWNERS      \u2502 @acme/payments  \u2502 0.85       \u2502 /services/checkout/**       \u2502\n\u2502 Kubernetes      \u2502 team=payments   \u2502 0.80       \u2502 Label on deployment         \u2502\n\u2502 service.yaml    \u2502 payments-team   \u2502 1.00       \u2502 service.team field          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nOn-Call Contact:\n  Name:     Jane Smith\n  Email:    jane.smith@company.com\n  Slack:    @jsmith\n  Schedule: payments-team-primary\n\nEscalation Path:\n  1. payments-team-primary (0-15 min)\n  2. payments-team-secondary (15-30 min)\n  3. payments-team-manager (30+ min)\n</code></pre></p>"},{"location":"commands/ownership/#json-output","title":"JSON Output","text":"<pre><code>nthlayer ownership service.yaml --format json\n</code></pre> <pre><code>{\n  \"service\": \"checkout-service\",\n  \"primary_owner\": {\n    \"team\": \"payments-team\",\n    \"confidence\": 0.95,\n    \"source\": \"backstage\"\n  },\n  \"sources\": [\n    {\n      \"source\": \"backstage\",\n      \"owner\": \"payments-team\",\n      \"confidence\": 0.95\n    }\n  ],\n  \"on_call\": {\n    \"name\": \"Jane Smith\",\n    \"email\": \"jane.smith@company.com\"\n  }\n}\n</code></pre>"},{"location":"commands/ownership/#demo-mode","title":"Demo Mode","text":"<pre><code>nthlayer ownership service.yaml --demo\n</code></pre>"},{"location":"commands/ownership/#ownership-sources","title":"Ownership Sources","text":""},{"location":"commands/ownership/#backstage-catalog-095-confidence","title":"Backstage Catalog (0.95 confidence)","text":"<p>Reads <code>spec.owner</code> from Backstage catalog entities:</p> <pre><code># catalog-info.yaml\napiVersion: backstage.io/v1alpha1\nkind: Component\nmetadata:\n  name: checkout-service\nspec:\n  owner: payments-team\n</code></pre>"},{"location":"commands/ownership/#codeowners-085-confidence","title":"CODEOWNERS (0.85 confidence)","text":"<p>Parses GitHub/GitLab CODEOWNERS file:</p> <pre><code># CODEOWNERS\n/services/checkout/** @acme/payments\n</code></pre>"},{"location":"commands/ownership/#kubernetes-labels-080-confidence","title":"Kubernetes Labels (0.80 confidence)","text":"<p>Reads labels from Kubernetes resources:</p> <pre><code>metadata:\n  labels:\n    team: payments\n    owner: payments-team\n</code></pre>"},{"location":"commands/ownership/#serviceyaml-100-confidence","title":"service.yaml (1.00 confidence)","text":"<p>Explicit declaration in the service file:</p> <pre><code>service:\n  name: checkout-service\n  team: payments-team\n</code></pre>"},{"location":"commands/ownership/#confidence-resolution","title":"Confidence Resolution","text":"<p>When multiple sources provide ownership information:</p> <ol> <li>Unanimous - All sources agree: highest confidence</li> <li>Majority - Most sources agree: weighted average</li> <li>Conflict - Sources disagree: lowest confidence, requires resolution</li> </ol>"},{"location":"commands/ownership/#use-cases","title":"Use Cases","text":""},{"location":"commands/ownership/#incident-response","title":"Incident Response","text":"<pre><code># Find who to page during an incident\nnthlayer ownership failing-service.yaml --format json | jq '.on_call'\n</code></pre>"},{"location":"commands/ownership/#dependency-notification","title":"Dependency Notification","text":"<pre><code># Notify owners of affected services before deployment\nfor dep in $(nthlayer blast-radius service.yaml --format json | jq -r '.affected_services[].name'); do\n  owner=$(nthlayer ownership $dep.yaml --format json | jq -r '.primary_owner.team')\n  echo \"Notifying $owner about $dep\"\ndone\n</code></pre>"},{"location":"commands/ownership/#ownership-audit","title":"Ownership Audit","text":"<pre><code># Find services with unclear ownership\nnthlayer ownership service.yaml --format json | jq 'select(.primary_owner.confidence &lt; 0.8)'\n</code></pre>"},{"location":"commands/ownership/#see-also","title":"See Also","text":"<ul> <li>nthlayer deps - View service dependencies</li> <li>nthlayer blast-radius - Calculate deployment impact</li> <li>nthlayer identity - Service identity resolution</li> </ul>"},{"location":"commands/portfolio/","title":"nthlayer portfolio","text":"<p>View SLO health across your entire organization.</p>"},{"location":"commands/portfolio/#usage","title":"Usage","text":"<pre><code>nthlayer portfolio [options]\n</code></pre>"},{"location":"commands/portfolio/#options","title":"Options","text":"Option Description <code>--format FORMAT</code> Output format: <code>text</code> (default), <code>json</code>, <code>csv</code> <code>--services-dir DIR</code> Directory to scan for services"},{"location":"commands/portfolio/#example-output","title":"Example Output","text":"<pre><code>nthlayer portfolio\n</code></pre> <pre><code>================================================================================\n  NthLayer SLO Portfolio\n================================================================================\n\nOrganization Health: 78% (14/18 services meeting SLOs)\n\nBy Tier:\n  Tier 1 (Critical):     83%  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591  5/6 services\n  Tier 2 (Standard):     75%  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591  6/8 services\n  Tier 3 (Low):          75%  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591  3/4 services\n\n--------------------------------------------------------------------------------\nServices Needing Attention:\n--------------------------------------------------------------------------------\n\n  payment-api (Tier 1)\n    availability: 156% budget burned - EXHAUSTED\n    Remaining: -12.5 hours\n\n  search-api (Tier 2)\n    latency-p99: 95% budget burned - WARNING\n    Remaining: 1.2 hours\n\n--------------------------------------------------------------------------------\nInsights:\n--------------------------------------------------------------------------------\n  - 2 services have no SLOs defined: legacy-api, internal-tools\n  - payment-api has aggressive targets (99.99%) - consider 99.95%\n\n--------------------------------------------------------------------------------\nTotal: 18 services, 16 with SLOs, 45 SLOs\n</code></pre>"},{"location":"commands/portfolio/#json-export","title":"JSON Export","text":"<p>For integration with other tools:</p> <pre><code>nthlayer portfolio --format json\n</code></pre> <pre><code>{\n  \"timestamp\": \"2024-12-06T10:30:00Z\",\n  \"total_services\": 18,\n  \"services_with_slos\": 16,\n  \"total_slos\": 45,\n  \"healthy_services\": 14,\n  \"org_health_percent\": 77.78,\n  \"by_tier\": [\n    {\n      \"tier\": 1,\n      \"tier_name\": \"Critical\",\n      \"total_services\": 6,\n      \"healthy_services\": 5,\n      \"health_percent\": 83.33\n    }\n  ],\n  \"services\": [\n    {\n      \"name\": \"payment-api\",\n      \"tier\": 1,\n      \"overall_status\": \"exhausted\",\n      \"slos\": [\n        {\n          \"name\": \"availability\",\n          \"status\": \"exhausted\",\n          \"budget_consumed_percent\": 156.0\n        }\n      ]\n    }\n  ]\n}\n</code></pre>"},{"location":"commands/portfolio/#csv-export","title":"CSV Export","text":"<p>For spreadsheet analysis:</p> <pre><code>nthlayer portfolio --format csv\n</code></pre> <pre><code>service,tier,slo,status,budget_consumed,budget_remaining_hours\npayment-api,1,availability,exhausted,156.0,-12.5\npayment-api,1,latency-p99,healthy,45.0,18.2\nsearch-api,2,availability,healthy,32.0,22.1\nsearch-api,2,latency-p99,warning,95.0,1.2\n</code></pre>"},{"location":"commands/portfolio/#health-status-levels","title":"Health Status Levels","text":"Status Budget Consumed Description Healthy &lt; 80% On track Warning 80-100% Approaching limit Critical 100-150% Over budget Exhausted &gt; 150% Severely over budget"},{"location":"commands/portfolio/#scanning-multiple-directories","title":"Scanning Multiple Directories","text":"<pre><code>nthlayer portfolio --services-dir ./services --services-dir ./legacy\n</code></pre> <p>Default search paths: - <code>./services</code> - <code>./examples/services</code></p>"},{"location":"commands/portfolio/#use-cases","title":"Use Cases","text":""},{"location":"commands/portfolio/#weekly-slo-review","title":"Weekly SLO Review","text":"<pre><code>nthlayer portfolio --format json &gt; slo-report-$(date +%Y%m%d).json\n</code></pre>"},{"location":"commands/portfolio/#cicd-gate","title":"CI/CD Gate","text":"<pre><code># Fail if any critical service is exhausted\nnthlayer portfolio --format json | jq -e '.services[] | select(.tier == 1 and .overall_status == \"exhausted\") | empty'\n</code></pre>"},{"location":"commands/portfolio/#stakeholder-reports","title":"Stakeholder Reports","text":"<pre><code>nthlayer portfolio --format csv &gt; monthly-slo-report.csv\n</code></pre>"},{"location":"commands/portfolio/#see-also","title":"See Also","text":"<ul> <li>SLOs &amp; Error Budgets - Understanding SLOs</li> <li>nthlayer slo - Per-service SLO commands</li> </ul>"},{"location":"commands/recommend-metrics/","title":"nthlayer recommend-metrics","text":"<p>Generate metric recommendations based on service type and runtime, following OpenTelemetry Semantic Conventions.</p>"},{"location":"commands/recommend-metrics/#synopsis","title":"Synopsis","text":"<pre><code>nthlayer recommend-metrics &lt;service-file&gt; [options]\n</code></pre>"},{"location":"commands/recommend-metrics/#description","title":"Description","text":"<p>The <code>recommend-metrics</code> command analyzes your service specification and recommends metrics based on:</p> <ul> <li>Service type (api, grpc, worker, queue-consumer, database-client, gateway, cache)</li> <li>Runtime (Python, JVM, Go, Node.js)</li> <li>OpenTelemetry Semantic Conventions for standardized metric names</li> </ul> <p>This helps teams instrument services consistently and ensures critical metrics are captured for SLO monitoring.</p>"},{"location":"commands/recommend-metrics/#exit-codes","title":"Exit Codes","text":"Code Meaning 0 All required metrics found (with <code>--check</code>) or recommendations generated 1 Some required metrics missing (with <code>--check</code>)"},{"location":"commands/recommend-metrics/#options","title":"Options","text":"Option Description <code>--prometheus-url, -p URL</code> Prometheus URL for metric discovery <code>--format FORMAT</code> Output format: <code>table</code> (default), <code>json</code>, <code>yaml</code> <code>--level LEVEL</code> Metrics to show: <code>required</code>, <code>recommended</code>, <code>all</code> (default) <code>--check</code> Validate metrics exist in live Prometheus <code>--show-code</code> Show instrumentation code snippets <code>--env, -e ENV</code> Environment for variable substitution <code>--selector-label LABEL</code> Prometheus label for service selection (default: <code>service</code>)"},{"location":"commands/recommend-metrics/#examples","title":"Examples","text":""},{"location":"commands/recommend-metrics/#basic-recommendations","title":"Basic Recommendations","text":"<pre><code>nthlayer recommend-metrics services/payment-api.yaml\n</code></pre> <p>Output: <pre><code>Metric Recommendations: payment-api (api)\n\nRequired Metrics (4):\n  http_server_request_duration_seconds    histogram   Request latency\n  http_server_requests_total              counter     Total requests\n  http_server_active_requests             gauge       Active requests\n  http_server_request_body_size_bytes     histogram   Request body size\n\nRecommended Metrics (3):\n  http_server_response_body_size_bytes    histogram   Response body size\n  process_cpu_seconds_total               counter     CPU usage\n  process_resident_memory_bytes           gauge       Memory usage\n\nRuntime Metrics (Python):\n  python_gc_collections_total             counter     GC collections\n  python_gc_objects_collected_total       counter     Objects collected\n</code></pre></p>"},{"location":"commands/recommend-metrics/#check-against-live-prometheus","title":"Check Against Live Prometheus","text":"<pre><code>nthlayer recommend-metrics services/api.yaml \\\n  --prometheus-url http://prometheus:9090 \\\n  --check\n</code></pre> <p>Output: <pre><code>Metric Validation: payment-api\n\nRequired Metrics:\n  http_server_request_duration_seconds    Found\n  http_server_requests_total              Found\n  http_server_active_requests             MISSING\n  http_server_request_body_size_bytes     Found (alias: http_request_size_bytes)\n\nStatus: 3/4 required metrics found\n\nRecommendation: Add instrumentation for http_server_active_requests.\nUse --show-code for implementation examples.\n</code></pre></p>"},{"location":"commands/recommend-metrics/#show-instrumentation-code","title":"Show Instrumentation Code","text":"<pre><code>nthlayer recommend-metrics services/api.yaml --show-code\n</code></pre> <p>Output includes language-specific instrumentation snippets:</p> <pre><code># Python (prometheus_client)\nfrom prometheus_client import Counter, Histogram, Gauge\n\nREQUEST_LATENCY = Histogram(\n    'http_server_request_duration_seconds',\n    'Request latency in seconds',\n    ['method', 'path', 'status']\n)\n\nREQUEST_COUNT = Counter(\n    'http_server_requests_total',\n    'Total HTTP requests',\n    ['method', 'path', 'status']\n)\n</code></pre>"},{"location":"commands/recommend-metrics/#json-output","title":"JSON Output","text":"<pre><code>nthlayer recommend-metrics services/api.yaml --format json\n</code></pre> <pre><code>{\n  \"service\": \"payment-api\",\n  \"service_type\": \"api\",\n  \"runtime\": \"python\",\n  \"metrics\": {\n    \"required\": [\n      {\n        \"name\": \"http_server_request_duration_seconds\",\n        \"type\": \"histogram\",\n        \"description\": \"Request latency\",\n        \"otel_convention\": \"http.server.request.duration\"\n      }\n    ],\n    \"recommended\": [...],\n    \"runtime\": [...]\n  }\n}\n</code></pre>"},{"location":"commands/recommend-metrics/#service-type-templates","title":"Service Type Templates","text":"Type Description Key Metrics <code>api</code> HTTP/REST APIs Request duration, count, errors <code>grpc</code> gRPC services RPC duration, count, codes <code>worker</code> Background workers Job duration, count, queue depth <code>queue-consumer</code> Message consumers Message latency, throughput, lag <code>database-client</code> Database clients Query duration, connections, errors <code>gateway</code> API gateways Upstream latency, routing metrics <code>cache</code> Cache services Hit ratio, latency, evictions"},{"location":"commands/recommend-metrics/#metric-aliases","title":"Metric Aliases","text":"<p>The command recognizes 50+ common metric name variations:</p> Semantic Convention Common Aliases <code>http_server_request_duration_seconds</code> <code>http_request_duration_seconds</code>, <code>request_latency_seconds</code> <code>http_server_requests_total</code> <code>http_requests_total</code>, <code>requests_total</code> <code>process_cpu_seconds_total</code> <code>cpu_seconds_total</code>, <code>node_cpu_seconds_total</code>"},{"location":"commands/recommend-metrics/#cicd-integration","title":"CI/CD Integration","text":""},{"location":"commands/recommend-metrics/#github-actions","title":"GitHub Actions","text":"<pre><code>jobs:\n  validate-metrics:\n    steps:\n      - name: Check Required Metrics\n        run: |\n          nthlayer recommend-metrics services/api.yaml \\\n            --prometheus-url ${{ secrets.PROMETHEUS_URL }} \\\n            --check \\\n            --level required\n</code></pre>"},{"location":"commands/recommend-metrics/#pre-deploy-validation","title":"Pre-deploy Validation","text":"<pre><code># Fail if required metrics are missing\nnthlayer recommend-metrics services/api.yaml \\\n  --prometheus-url http://prometheus:9090 \\\n  --check \\\n  --level required\n\nif [ $? -ne 0 ]; then\n  echo \"Missing required metrics - deploy blocked\"\n  exit 1\nfi\n</code></pre>"},{"location":"commands/recommend-metrics/#environment-variables","title":"Environment Variables","text":"Variable Description <code>NTHLAYER_PROMETHEUS_URL</code> Default Prometheus URL"},{"location":"commands/recommend-metrics/#see-also","title":"See Also","text":"<ul> <li>nthlayer verify - Contract verification</li> <li>Technology Templates - Template reference</li> <li>Service Specs - Service YAML schema</li> </ul>"},{"location":"commands/scorecard/","title":"nthlayer scorecard","text":"<p>Calculate per-service reliability scores with weighted components and team aggregation.</p>"},{"location":"commands/scorecard/#synopsis","title":"Synopsis","text":"<pre><code>nthlayer scorecard [options]\n</code></pre>"},{"location":"commands/scorecard/#description","title":"Description","text":"<p>The <code>scorecard</code> command provides quantitative reliability metrics across your organization. Each service receives a score from 0-100 based on weighted components:</p> Component Weight Description SLO Compliance 40% Percentage of SLOs meeting targets Incident Score 30% Inverse score based on incident count Deploy Success Rate 20% Percentage of successful deployments Error Budget Remaining 10% Percentage of budget still available <p>Scores are aggregated at the team level using tier-based weighting, ensuring critical services have proportionally higher impact on team scores.</p>"},{"location":"commands/scorecard/#exit-codes","title":"Exit Codes","text":"Code Band Score Range 0 Excellent/Good 75-100 1 Fair 50-74 2 Poor/Critical 0-49"},{"location":"commands/scorecard/#options","title":"Options","text":"Option Description <code>--format FORMAT</code> Output format: <code>table</code> (default), <code>json</code>, <code>csv</code> <code>--path PATH</code> Additional paths to search for service files <code>--prometheus-url URL</code> Prometheus URL for live data (or set <code>NTHLAYER_PROMETHEUS_URL</code>) <code>--by-team</code> Group and display scores by team <code>--top N</code> Number of top/bottom services to highlight (default: 5)"},{"location":"commands/scorecard/#examples","title":"Examples","text":""},{"location":"commands/scorecard/#basic-scorecard","title":"Basic Scorecard","text":"<pre><code>nthlayer scorecard --prometheus-url http://prometheus:9090\n</code></pre> <p>Output: <pre><code>\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 Reliability Scorecard                                                        \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n\n\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 Organization Score \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 \u2713 82  GOOD                                                                   \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n\n                            Service Scores\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2533\u2501\u2501\u2501\u2501\u2501\u2501\u2533\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2533\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2533\u2501\u2501\u2501\u2501\u2501\u2501\u2533\u2501\u2501\u2501\u2501\u2501\u2533\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Service       \u2503 Tier \u2503 Team          \u2503 Score \u2503 Band \u2503 SLO \u2503 Budget \u2503\n\u2521\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2547\u2501\u2501\u2501\u2501\u2501\u2501\u2547\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2547\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2547\u2501\u2501\u2501\u2501\u2501\u2501\u2547\u2501\u2501\u2501\u2501\u2501\u2547\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2529\n\u2502 payment-api   \u2502  1   \u2502 payments-team \u2502    95 \u2502 \u2713    \u2502 2/2 \u2502    92% \u2502\n\u2502 user-service  \u2502  1   \u2502 platform-team \u2502    88 \u2502 \u2713    \u2502 2/2 \u2502    85% \u2502\n\u2502 order-service \u2502  1   \u2502 commerce-team \u2502    76 \u2502 \u2713    \u2502 2/2 \u2502    68% \u2502\n\u2502 search-api    \u2502  2   \u2502 search-team   \u2502    62 \u2502 !    \u2502 1/2 \u2502    45% \u2502\n\u2502 analytics-api \u2502  3   \u2502 data-eng      \u2502    58 \u2502 !    \u2502 1/2 \u2502    32% \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nTotal: 5 services, 5 teams\n</code></pre></p>"},{"location":"commands/scorecard/#team-view","title":"Team View","text":"<pre><code>nthlayer scorecard --by-team\n</code></pre> <p>Output: <pre><code>\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 Reliability Scorecard - By Team                                              \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n\n\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 Organization Score \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 \u2713 82  GOOD                                                                   \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n\n                             Team Scores\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2533\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2533\u2501\u2501\u2501\u2501\u2501\u2501\u2533\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2533\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2533\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2533\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Team          \u2503 Score \u2503 Band \u2503 Services \u2503 Tier 1 \u2503 Tier 2 \u2503 Tier 3 \u2503\n\u2521\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2547\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2547\u2501\u2501\u2501\u2501\u2501\u2501\u2547\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2547\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2547\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2547\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2529\n\u2502 payments-team \u2502    95 \u2502 \u2713    \u2502        1 \u2502     95 \u2502      - \u2502      - \u2502\n\u2502 platform-team \u2502    88 \u2502 \u2713    \u2502        2 \u2502     88 \u2502     82 \u2502      - \u2502\n\u2502 commerce-team \u2502    76 \u2502 \u2713    \u2502        1 \u2502     76 \u2502      - \u2502      - \u2502\n\u2502 search-team   \u2502    62 \u2502 !    \u2502        1 \u2502      - \u2502     62 \u2502      - \u2502\n\u2502 data-eng      \u2502    58 \u2502 !    \u2502        1 \u2502      - \u2502      - \u2502     58 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre></p>"},{"location":"commands/scorecard/#json-export","title":"JSON Export","text":"<pre><code>nthlayer scorecard --format json\n</code></pre> <pre><code>{\n  \"timestamp\": \"2026-01-18T21:10:26.045633+00:00\",\n  \"period\": \"30d\",\n  \"summary\": {\n    \"org_score\": 82.0,\n    \"org_band\": \"good\",\n    \"total_services\": 5,\n    \"total_teams\": 5\n  },\n  \"services\": [\n    {\n      \"service\": \"payment-api\",\n      \"tier\": 1,\n      \"team\": \"payments-team\",\n      \"score\": 95.0,\n      \"band\": \"excellent\",\n      \"components\": {\n        \"slo_compliance\": 100.0,\n        \"incident_score\": 100,\n        \"deploy_success_rate\": 100,\n        \"error_budget_remaining\": 92\n      }\n    }\n  ],\n  \"teams\": [...],\n  \"rankings\": {\n    \"top_services\": [...],\n    \"bottom_services\": [...]\n  }\n}\n</code></pre>"},{"location":"commands/scorecard/#csv-export","title":"CSV Export","text":"<pre><code>nthlayer scorecard --format csv &gt; reliability-report.csv\n</code></pre> <pre><code>service,tier,team,type,score,band,slo_compliance,incident_score,deploy_success_rate,error_budget_remaining\npayment-api,1,payments-team,api,95.0,excellent,100.0,100,100,92\nuser-service,1,platform-team,api,88.0,good,100.0,90,100,85\n</code></pre>"},{"location":"commands/scorecard/#score-bands","title":"Score Bands","text":"Band Score Range Icon Description Excellent 90-100 \u2713 (bold) Exceptional reliability Good 75-89 \u2713 Meeting expectations Fair 50-74 ! Needs attention Poor 25-49 !! Significant issues Critical 0-24 \u2717 Immediate action required"},{"location":"commands/scorecard/#tier-weighting","title":"Tier Weighting","text":"<p>Team and organization scores use tier-based weighting to ensure critical services have proportionally higher impact:</p> Tier Weight Description Tier 1 (Critical) 3x Revenue-critical, customer-facing Tier 2 (Standard) 2x Important internal services Tier 3 (Low) 1x Non-critical, batch jobs <p>Example calculation: <pre><code>Team with:\n  - Tier 1 service scoring 90\n  - Tier 2 service scoring 70\n\nTeam Score = (90 \u00d7 3 + 70 \u00d7 2) / (3 + 2)\n           = (270 + 140) / 5\n           = 82\n</code></pre></p>"},{"location":"commands/scorecard/#cicd-integration","title":"CI/CD Integration","text":""},{"location":"commands/scorecard/#deployment-gate","title":"Deployment Gate","text":"<pre><code>#!/bin/bash\nnthlayer scorecard --format json &gt; scorecard.json\nexit_code=$?\n\nif [ $exit_code -eq 2 ]; then\n  echo \"Reliability score is POOR/CRITICAL - deploy blocked\"\n  exit 1\nfi\n</code></pre>"},{"location":"commands/scorecard/#github-actions","title":"GitHub Actions","text":"<pre><code>jobs:\n  reliability-check:\n    steps:\n      - name: Check Reliability Score\n        run: |\n          nthlayer scorecard \\\n            --prometheus-url ${{ secrets.PROMETHEUS_URL }} \\\n            --format json &gt; scorecard.json\n\n          # Extract org score\n          score=$(jq '.summary.org_score' scorecard.json)\n          echo \"Organization reliability score: $score\"\n\n          # Fail if below threshold\n          if (( $(echo \"$score &lt; 50\" | bc -l) )); then\n            echo \"::error::Reliability score below threshold\"\n            exit 1\n          fi\n</code></pre>"},{"location":"commands/scorecard/#weekly-reports","title":"Weekly Reports","text":"<pre><code>name: Weekly Reliability Report\n\non:\n  schedule:\n    - cron: '0 9 * * 1'  # Monday 9am\n\njobs:\n  report:\n    runs-on: ubuntu-latest\n    steps:\n      - name: Generate Scorecard\n        run: |\n          nthlayer scorecard \\\n            --prometheus-url ${{ secrets.PROMETHEUS_URL }} \\\n            --format csv &gt; reliability-$(date +%Y%m%d).csv\n</code></pre>"},{"location":"commands/scorecard/#environment-variables","title":"Environment Variables","text":"Variable Description <code>NTHLAYER_PROMETHEUS_URL</code> Default Prometheus URL"},{"location":"commands/scorecard/#see-also","title":"See Also","text":"<ul> <li>nthlayer portfolio - SLO portfolio health</li> <li>nthlayer drift - Reliability trend analysis</li> <li>Service Tiers - Understanding tier classification</li> <li>SLOs &amp; Error Budgets - SLO fundamentals</li> </ul>"},{"location":"commands/setup/","title":"nthlayer setup","text":"<p>Interactive first-time setup wizard for NthLayer.</p>"},{"location":"commands/setup/#usage","title":"Usage","text":"<pre><code>nthlayer setup [options]\n</code></pre>"},{"location":"commands/setup/#options","title":"Options","text":"Option Description <code>--quick</code> Use simplified setup (default) <code>--advanced</code> Use full configuration wizard <code>--test</code> Test connections only <code>--skip-service</code> Skip first service creation prompt"},{"location":"commands/setup/#quick-setup-mode","title":"Quick Setup Mode","text":"<p>The default mode configures the essentials:</p> <pre><code>nthlayer setup\n</code></pre> <pre><code>================================================================================\n  Welcome to NthLayer!\n  The missing layer of reliability - 20 hours of SRE work in 5 minutes\n================================================================================\n\nQuick Setup\n----------------------------------------\n1. Prometheus Configuration\n   Prometheus URL [http://localhost:9090]:\n   Does Prometheus require authentication? [y/N]:\n\n2. Grafana Configuration (optional)\n   Configure Grafana? [Y/n]: y\n   Grafana URL [http://localhost:3000]:\n   API Key (press Enter to skip): ****\n\nTesting Connections\n----------------------------------------\n  Prometheus (http://localhost:9090)\n    [OK] Connected (Prometheus 2.45.0)\n\n  Grafana (http://localhost:3000)\n    [OK] Connected - Org: Main Org\n\nConfiguration saved to: ~/.nthlayer/config.yaml\n\nCreate your first service? [Y/n]:\n</code></pre>"},{"location":"commands/setup/#advanced-setup-mode","title":"Advanced Setup Mode","text":"<p>For power users with multiple environments:</p> <pre><code>nthlayer setup --advanced\n</code></pre> <p>This includes:</p> <ul> <li>Multiple Prometheus/Grafana profiles (dev, staging, prod)</li> <li>Cloud secret backends (Vault, AWS Secrets Manager, etc.)</li> <li>Slack notification configuration</li> </ul>"},{"location":"commands/setup/#test-connections-only","title":"Test Connections Only","text":"<p>Verify your configuration:</p> <pre><code>nthlayer setup --test\n</code></pre> <pre><code>Testing Connections\n----------------------------------------\n  Prometheus (http://localhost:9090)\n    [OK] Connected (Prometheus 2.45.0)\n\n  Grafana (http://localhost:3000)\n    [OK] Connected - Org: Main Org\n\nAll configured services are operational!\n</code></pre>"},{"location":"commands/setup/#configuration-file","title":"Configuration File","text":"<p>Setup creates <code>~/.nthlayer/config.yaml</code>:</p> <pre><code>prometheus:\n  default: default\n  profiles:\n    default:\n      url: http://localhost:9090\n      type: prometheus\n\ngrafana:\n  default: default\n  profiles:\n    default:\n      url: http://localhost:3000\n      type: grafana\n      api_key_secret: grafana/api_key\n\nalerting:\n  slack:\n    enabled: false\n</code></pre>"},{"location":"commands/setup/#environment-variables","title":"Environment Variables","text":"<p>Alternatively, configure via environment variables:</p> <pre><code>export NTHLAYER_PROMETHEUS_URL=http://prometheus:9090\nexport NTHLAYER_GRAFANA_URL=http://grafana:3000\nexport NTHLAYER_GRAFANA_API_KEY=glsa_xxxxx\n</code></pre>"},{"location":"commands/setup/#see-also","title":"See Also","text":"<ul> <li>nthlayer config - Manual configuration</li> <li>Quick Start - Full setup guide</li> </ul>"},{"location":"commands/slo/","title":"nthlayer slo","text":"<p>Query and manage SLOs for individual services.</p>"},{"location":"commands/slo/#commands","title":"Commands","text":"<pre><code>nthlayer slo show &lt;service.yaml&gt;     # Show SLO definitions\nnthlayer slo list &lt;service.yaml&gt;     # List SLOs briefly\nnthlayer slo collect &lt;service.yaml&gt;  # Query live metrics from Prometheus\n</code></pre>"},{"location":"commands/slo/#nthlayer-slo-show","title":"nthlayer slo show","text":"<p>Display detailed SLO information:</p> <pre><code>nthlayer slo show payment-api.yaml\n</code></pre> <pre><code>================================================================================\n  SLOs for payment-api\n================================================================================\n\navailability\n  Type: availability\n  Objective: 99.95%\n  Window: 30 days\n  Error Budget: 21.6 minutes/month\n\nlatency-p99\n  Type: latency\n  Objective: 99.0% of requests &lt; 200ms\n  Window: 30 days\n  Percentile: p99\n</code></pre>"},{"location":"commands/slo/#nthlayer-slo-list","title":"nthlayer slo list","text":"<p>Brief listing:</p> <pre><code>nthlayer slo list payment-api.yaml\n</code></pre> <pre><code>payment-api SLOs:\n  - availability: 99.95% (30d)\n  - latency-p99: 99.0% &lt; 200ms (30d)\n</code></pre>"},{"location":"commands/slo/#nthlayer-slo-collect","title":"nthlayer slo collect","text":"<p>Query live metrics from Prometheus:</p> <pre><code>nthlayer slo collect payment-api.yaml\n</code></pre> <pre><code>================================================================================\n  Live SLO Status: payment-api\n================================================================================\n\navailability\n  Current: 99.92%\n  Target: 99.95%\n  Status: WARNING (approaching budget)\n  Budget Consumed: 87.5%\n  Budget Remaining: 2.7 hours\n\nlatency-p99\n  Current: 185ms\n  Target: 200ms\n  Status: HEALTHY\n  Budget Consumed: 45.2%\n  Budget Remaining: 11.8 hours\n</code></pre>"},{"location":"commands/slo/#options","title":"Options","text":"Option Description <code>--prometheus-url URL</code> Prometheus server URL <code>--window DURATION</code> Query window (default: 30d)"},{"location":"commands/slo/#environment-variables","title":"Environment Variables","text":"<pre><code>export NTHLAYER_PROMETHEUS_URL=http://prometheus:9090\n</code></pre>"},{"location":"commands/slo/#understanding-slo-status","title":"Understanding SLO Status","text":"Status Meaning HEALTHY &lt; 80% budget consumed WARNING 80-100% budget consumed CRITICAL 100-150% budget consumed EXHAUSTED &gt; 150% budget consumed"},{"location":"commands/slo/#error-budget-calculation","title":"Error Budget Calculation","text":"<p>For a 99.95% availability SLO over 30 days:</p> <pre><code>Error Budget = (1 - 0.9995) \u00d7 30 days \u00d7 24 hours \u00d7 60 minutes\n             = 0.0005 \u00d7 43,200 minutes\n             = 21.6 minutes\n</code></pre>"},{"location":"commands/slo/#see-also","title":"See Also","text":"<ul> <li>nthlayer portfolio - Org-wide SLO view</li> <li>SLOs &amp; Error Budgets - Concepts</li> </ul>"},{"location":"commands/validate-metadata/","title":"validate-metadata","text":"<p>Validate Prometheus/Loki rule metadata beyond PromQL syntax.</p>"},{"location":"commands/validate-metadata/#synopsis","title":"Synopsis","text":"<pre><code>nthlayer validate-metadata &lt;file-or-directory&gt; [options]\n</code></pre>"},{"location":"commands/validate-metadata/#description","title":"Description","text":"<p>Enhanced validation that goes beyond PromQL syntax checking (pint). Validates:</p> <ul> <li>Required labels (severity, team, service)</li> <li>Required annotations (summary, description, runbook_url)</li> <li>Label value patterns (regex validation)</li> <li>Runbook URL format and accessibility</li> <li>Range query vs data retention limits</li> <li>Alert <code>for</code> duration bounds</li> </ul>"},{"location":"commands/validate-metadata/#options","title":"Options","text":"Option Description <code>--strict</code> Require runbook_url, team, and service labels <code>--check-urls</code> Actually check if runbook URLs are accessible (makes HTTP requests) <code>--use-promruval</code> Also run promruval if installed <code>--verbose</code>, <code>-v</code> Show detailed output with suggestions"},{"location":"commands/validate-metadata/#exit-codes","title":"Exit Codes","text":"Code Meaning 0 All rules passed 1 Warnings found (no errors) 2 Errors found"},{"location":"commands/validate-metadata/#examples","title":"Examples","text":""},{"location":"commands/validate-metadata/#basic-validation","title":"Basic Validation","text":"<pre><code>nthlayer validate-metadata generated/payment-api/alerts.yaml\n</code></pre>"},{"location":"commands/validate-metadata/#strict-mode","title":"Strict Mode","text":"<p>Requires runbook_url, team, and service labels:</p> <pre><code>nthlayer validate-metadata alerts.yaml --strict\n</code></pre>"},{"location":"commands/validate-metadata/#validate-directory","title":"Validate Directory","text":"<pre><code>nthlayer validate-metadata generated/ --strict --verbose\n</code></pre>"},{"location":"commands/validate-metadata/#check-url-accessibility","title":"Check URL Accessibility","text":"<p>Actually makes HTTP requests to verify runbook URLs are accessible:</p> <pre><code>nthlayer validate-metadata alerts.yaml --check-urls\n</code></pre>"},{"location":"commands/validate-metadata/#validators","title":"Validators","text":""},{"location":"commands/validate-metadata/#built-in-validators","title":"Built-in Validators","text":"Validator Description <code>hasRequiredLabels</code> Check for required labels <code>hasRequiredAnnotations</code> Check for required annotations <code>validSeverityLevel</code> Validate severity is one of: critical, warning, info, page, ticket <code>noEmptyLabels</code> Labels must have non-empty values <code>noEmptyAnnotations</code> Annotations must have non-empty values <code>labelMatchesPattern</code> Label values match regex patterns <code>validRunbookUrl</code> Runbook URL is well-formed <code>rangeQueryMaxDuration</code> Range queries don't exceed retention <code>alertForDuration</code> Alert <code>for</code> duration is reasonable <code>ruleNamePattern</code> Rule names follow naming convention"},{"location":"commands/validate-metadata/#default-mode","title":"Default Mode","text":"<p>Checks: - Required: <code>severity</code> label - Required: <code>summary</code>, <code>description</code> annotations - Valid severity level - No empty labels or annotations</p>"},{"location":"commands/validate-metadata/#strict-mode_1","title":"Strict Mode","text":"<p>Additional checks: - Required: <code>team</code>, <code>service</code> labels - Required: <code>runbook_url</code> annotation - Runbook URL format validation - Range query vs 15d retention - Alert <code>for</code> duration bounds (0s - 1h)</p>"},{"location":"commands/validate-metadata/#integration-with-cicd","title":"Integration with CI/CD","text":""},{"location":"commands/validate-metadata/#github-actions","title":"GitHub Actions","text":"<pre><code>- name: Validate alert metadata\n  run: |\n    nthlayer validate-metadata generated/ --strict\n</code></pre>"},{"location":"commands/validate-metadata/#pre-commit-hook","title":"Pre-commit Hook","text":"<pre><code>repos:\n  - repo: local\n    hooks:\n      - id: validate-metadata\n        name: Validate alert metadata\n        entry: nthlayer validate-metadata --strict\n        language: system\n        files: alerts\\.yaml$\n</code></pre>"},{"location":"commands/validate-metadata/#programmatic-usage","title":"Programmatic Usage","text":"<pre><code>from nthlayer.validation import (\n    MetadataValidator,\n    HasRequiredLabels,\n    ValidRunbookUrl,\n    validate_metadata,\n)\n\n# Quick validation\nresult = validate_metadata(\"alerts.yaml\", strict=True)\nif not result.passed:\n    for issue in result.issues:\n        print(f\"{issue.severity.value}: {issue.message}\")\n\n# Custom validators\nvalidator = MetadataValidator()\nvalidator.add_validator(HasRequiredLabels([\"severity\", \"team\", \"tier\"]))\nvalidator.add_validator(ValidRunbookUrl(check_accessibility=True))\n\nresult = validator.validate_file(\"alerts.yaml\")\n</code></pre>"},{"location":"commands/validate-metadata/#see-also","title":"See Also","text":"<ul> <li>lint Command - PromQL syntax validation with pint</li> <li>apply Command - Generate artifacts with optional validation</li> </ul>"},{"location":"commands/validate-slo/","title":"nthlayer validate-slo","text":"<p>Validate that SLO metrics exist in Prometheus before deployment.</p> <p>This command checks that all metrics referenced in SLO definitions actually exist and are queryable, preventing broken SLO dashboards and alerts.</p>"},{"location":"commands/validate-slo/#usage","title":"Usage","text":"<pre><code>nthlayer validate-slo &lt;service.yaml&gt; [options]\n</code></pre>"},{"location":"commands/validate-slo/#options","title":"Options","text":"Option Description <code>--env ENVIRONMENT</code> Environment name (dev, staging, prod) <code>--format {table,json}</code> Output format (default: table) <code>--prometheus-url URL</code> Prometheus server URL <code>--demo</code> Show demo output with sample data"},{"location":"commands/validate-slo/#environment-variables","title":"Environment Variables","text":"Variable Description <code>PROMETHEUS_URL</code> Default Prometheus URL <code>PROMETHEUS_USERNAME</code> Basic auth username <code>PROMETHEUS_PASSWORD</code> Basic auth password"},{"location":"commands/validate-slo/#exit-codes","title":"Exit Codes","text":"Code Meaning <code>0</code> All SLO metrics exist and are valid <code>1</code> Some metrics missing (deployment may fail) <code>2</code> Critical SLO metrics missing (block deployment)"},{"location":"commands/validate-slo/#examples","title":"Examples","text":""},{"location":"commands/validate-slo/#basic-validation","title":"Basic Validation","text":"<pre><code>nthlayer validate-slo checkout-service.yaml --prometheus-url http://prometheus:9090\n</code></pre> <p>Output: <pre><code>\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 SLO Validation: checkout-service                                              \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n\nTarget: http://prometheus:9090\nEnvironment: production\n\nSLO: availability (99.95% target)\n  Indicator: success_ratio\n  \u2713 total_query: sum(rate(http_requests_total{service=\"checkout\"}[5m]))\n    \u2514\u2500 Metric: http_requests_total \u2713 exists (1.2M samples)\n  \u2713 good_query: sum(rate(http_requests_total{service=\"checkout\",status!~\"5..\"}[5m]))\n    \u2514\u2500 Metric: http_requests_total \u2713 exists\n\nSLO: latency (p99 &lt; 200ms)\n  Indicator: latency\n  \u2713 query: histogram_quantile(0.99, rate(http_request_duration_seconds_bucket{...}[5m]))\n    \u2514\u2500 Metric: http_request_duration_seconds_bucket \u2713 exists\n\nSummary:\n  SLOs validated: 2\n  Metrics checked: 3\n  All metrics exist \u2713\n\n\u2713 SLO validation passed - safe to deploy\n</code></pre></p>"},{"location":"commands/validate-slo/#missing-metrics","title":"Missing Metrics","text":"<p>When metrics are missing:</p> <pre><code>SLO: availability (99.95% target)\n  Indicator: success_ratio\n  \u2717 total_query: sum(rate(api_requests_total{service=\"checkout\"}[5m]))\n    \u2514\u2500 Metric: api_requests_total \u2717 NOT FOUND\n\n    Suggestions:\n    \u2022 Did you mean: http_requests_total?\n    \u2022 Check metric name in application instrumentation\n    \u2022 Ensure service label matches: service=\"checkout\"\n\nSummary:\n  SLOs validated: 2\n  Metrics checked: 3\n  Missing: 1 (critical)\n\n\u2717 SLO validation failed - missing critical metrics\n</code></pre>"},{"location":"commands/validate-slo/#json-output","title":"JSON Output","text":"<pre><code>nthlayer validate-slo service.yaml --format json\n</code></pre> <pre><code>{\n  \"service\": \"checkout-service\",\n  \"prometheus_url\": \"http://prometheus:9090\",\n  \"valid\": true,\n  \"slos\": [\n    {\n      \"name\": \"availability\",\n      \"target\": 99.95,\n      \"valid\": true,\n      \"metrics\": [\n        {\n          \"name\": \"http_requests_total\",\n          \"exists\": true,\n          \"sample_count\": 1200000\n        }\n      ]\n    }\n  ],\n  \"summary\": {\n    \"slos_validated\": 2,\n    \"metrics_checked\": 3,\n    \"metrics_missing\": 0\n  }\n}\n</code></pre>"},{"location":"commands/validate-slo/#demo-mode","title":"Demo Mode","text":"<pre><code>nthlayer validate-slo service.yaml --demo\n</code></pre>"},{"location":"commands/validate-slo/#what-gets-validated","title":"What Gets Validated","text":""},{"location":"commands/validate-slo/#slo-indicator-metrics","title":"SLO Indicator Metrics","text":"<p>All metrics referenced in SLO indicator queries:</p> <pre><code>resources:\n  - kind: SLO\n    name: availability\n    spec:\n      objective: 99.95\n      indicators:\n        - type: availability\n          success_ratio:\n            total_query: sum(rate(http_requests_total{service=\"checkout\"}[5m]))\n            good_query: sum(rate(http_requests_total{service=\"checkout\",status!~\"5..\"}[5m]))\n</code></pre>"},{"location":"commands/validate-slo/#recording-rule-dependencies","title":"Recording Rule Dependencies","text":"<p>If SLOs use recording rules, validates those exist too:</p> <pre><code># If SLO references a recording rule\ntotal_query: checkout:requests:rate5m\n# Validates that checkout:requests:rate5m exists\n</code></pre>"},{"location":"commands/validate-slo/#label-consistency","title":"Label Consistency","text":"<p>Checks that label selectors match existing label values:</p> <pre><code># Validates that service=\"checkout\" exists in the metric\ntotal_query: sum(rate(http_requests_total{service=\"checkout\"}[5m]))\n</code></pre>"},{"location":"commands/validate-slo/#validation-vs-verification","title":"Validation vs Verification","text":"Command Purpose When to Use <code>validate-slo</code> Check SLO metric existence Before deploying SLO configs <code>verify</code> Full contract verification Before promoting to production <p>Use <code>validate-slo</code> as a quick check during development. Use <code>verify</code> in CI/CD pipelines for comprehensive validation.</p>"},{"location":"commands/validate-slo/#cicd-integration","title":"CI/CD Integration","text":""},{"location":"commands/validate-slo/#pre-deployment-check","title":"Pre-Deployment Check","text":"<pre><code># Validate before deploying Prometheus rules\nnthlayer validate-slo service.yaml --prometheus-url $PROMETHEUS_URL\n\nif [ $? -ne 0 ]; then\n  echo \"SLO metrics missing - check instrumentation\"\n  exit 1\nfi\n\n# Safe to deploy\nkubectl apply -f generated/recording-rules.yaml\n</code></pre>"},{"location":"commands/validate-slo/#github-actions","title":"GitHub Actions","text":"<pre><code>- name: Validate SLO Metrics\n  run: |\n    nthlayer validate-slo service.yaml \\\n      --prometheus-url ${{ secrets.PROMETHEUS_URL }} \\\n      --format json &gt; slo-validation.json\n\n    if [ $(jq '.valid' slo-validation.json) != \"true\" ]; then\n      echo \"::error::SLO metrics validation failed\"\n      exit 1\n    fi\n</code></pre>"},{"location":"commands/validate-slo/#troubleshooting","title":"Troubleshooting","text":""},{"location":"commands/validate-slo/#metric-not-found","title":"Metric Not Found","text":"<ol> <li>Check metric name - Typos in metric names are common</li> <li>Check labels - Ensure label selectors match your instrumentation</li> <li>Check time range - New metrics may not have data yet</li> <li>Check scrape config - Ensure Prometheus is scraping the target</li> </ol>"},{"location":"commands/validate-slo/#label-mismatch","title":"Label Mismatch","text":"<pre><code># List available label values\ncurl \"$PROMETHEUS_URL/api/v1/label/service/values\"\n</code></pre>"},{"location":"commands/validate-slo/#recording-rule-missing","title":"Recording Rule Missing","text":"<pre><code># Check if recording rule exists\ncurl \"$PROMETHEUS_URL/api/v1/rules\" | jq '.data.groups[].rules[] | select(.name == \"checkout:requests:rate5m\")'\n</code></pre>"},{"location":"commands/validate-slo/#see-also","title":"See Also","text":"<ul> <li>nthlayer verify - Full contract verification</li> <li>nthlayer apply - Generate SLO configs</li> <li>SLO Concepts - Understanding SLOs</li> </ul>"},{"location":"commands/validate-spec/","title":"nthlayer validate-spec","text":"<p>Validate service specifications against organizational policies using OPA/Rego.</p>"},{"location":"commands/validate-spec/#synopsis","title":"Synopsis","text":"<pre><code>nthlayer validate-spec &lt;file-or-directory&gt; [options]\n</code></pre>"},{"location":"commands/validate-spec/#description","title":"Description","text":"<p>The <code>validate-spec</code> command checks service YAML files against policy rules. This catches configuration issues before they cause problems:</p> <ul> <li>Missing required fields</li> <li>Invalid tier or type values</li> <li>Critical services without proper SLOs</li> <li>Aggressive SLO targets that may be unrealistic</li> </ul>"},{"location":"commands/validate-spec/#options","title":"Options","text":"Option Description <code>--policy-dir PATH</code> Custom policy directory (default: <code>policies/</code>) <code>--verbose, -v</code> Show detailed policy evaluation"},{"location":"commands/validate-spec/#exit-codes","title":"Exit Codes","text":"Code Meaning <code>0</code> All checks passed <code>1</code> Warnings found (non-blocking) <code>2</code> Errors found (blocking)"},{"location":"commands/validate-spec/#examples","title":"Examples","text":""},{"location":"commands/validate-spec/#validate-a-single-file","title":"Validate a Single File","text":"<pre><code>nthlayer validate-spec services/payment-api.yaml\n</code></pre> <p>Output: <pre><code>\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502  Policy Validation: payment-api                              \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n\n  \u2713 Required fields present\n  \u2713 Tier value valid (critical)\n  \u2713 Type value valid (api)\n  \u2713 SLO objectives within range\n  \u2713 Critical tier requirements met\n\n  Result: PASSED (0 errors, 0 warnings)\n</code></pre></p>"},{"location":"commands/validate-spec/#validate-all-services","title":"Validate All Services","text":"<pre><code>nthlayer validate-spec services/\n</code></pre>"},{"location":"commands/validate-spec/#with-verbose-output","title":"With Verbose Output","text":"<pre><code>nthlayer validate-spec services/api.yaml --verbose\n</code></pre> <p>Output: <pre><code>Evaluating policies from: policies/\n\nPolicy: service.rego\n  \u2713 deny_missing_name: PASSED\n  \u2713 deny_missing_team: PASSED\n  \u2713 deny_invalid_tier: PASSED\n  \u2713 deny_invalid_type: PASSED\n  \u2713 deny_critical_without_slo: PASSED\n\nPolicy: slo.rego\n  \u2713 deny_invalid_objective: PASSED\n  \u26a0 warn_aggressive_objective: 99.99% may be unrealistic\n\nPolicy: dependencies.rego\n  \u2713 deny_missing_criticality: PASSED\n</code></pre></p>"},{"location":"commands/validate-spec/#built-in-policies","title":"Built-in Policies","text":"<p>NthLayer includes default policies in <code>policies/</code>:</p>"},{"location":"commands/validate-spec/#servicerego","title":"service.rego","text":"Rule Severity Description <code>deny_missing_name</code> Error Service must have a name <code>deny_missing_team</code> Error Service must have a team <code>deny_invalid_tier</code> Error Tier must be critical/standard/low <code>deny_invalid_type</code> Error Type must be api/worker/stream/web/batch/ml <code>deny_critical_without_slo</code> Error Critical tier requires SLO"},{"location":"commands/validate-spec/#slorego","title":"slo.rego","text":"Rule Severity Description <code>deny_invalid_objective</code> Error Objective must be 0-100 <code>warn_aggressive_objective</code> Warning Objectives &gt;99.99% flagged <code>warn_critical_low_availability</code> Warning Critical tier &lt;99.9% flagged"},{"location":"commands/validate-spec/#dependenciesrego","title":"dependencies.rego","text":"Rule Severity Description <code>warn_missing_criticality</code> Warning Dependencies should have criticality <code>deny_invalid_database_type</code> Error Database type must be known"},{"location":"commands/validate-spec/#custom-policies","title":"Custom Policies","text":"<p>Add custom Rego policies to your <code>policies/</code> directory:</p> <pre><code># policies/custom.rego\npackage nthlayer.custom\n\n# Deny services without runbook\ndeny_missing_runbook[msg] {\n    input.service.tier == \"critical\"\n    not input.service.runbook_url\n    msg := \"Critical services must have a runbook_url\"\n}\n\n# Warn about missing description\nwarn_missing_description[msg] {\n    not input.service.description\n    msg := \"Service should have a description\"\n}\n</code></pre>"},{"location":"commands/validate-spec/#using-conftest","title":"Using conftest","text":"<p>If conftest is installed, <code>validate-spec</code> uses it for evaluation. Otherwise, it falls back to a native Python implementation.</p>"},{"location":"commands/validate-spec/#install-conftest","title":"Install conftest","text":"<pre><code># macOS\nbrew install conftest\n\n# Linux\ncurl -sL https://github.com/open-policy-agent/conftest/releases/latest/download/conftest_Linux_x86_64.tar.gz | tar xz\nsudo mv conftest /usr/local/bin/\n</code></pre>"},{"location":"commands/validate-spec/#benefits-of-conftest","title":"Benefits of conftest","text":"<ul> <li>Full OPA/Rego support</li> <li>Faster evaluation</li> <li>Additional output formats (<code>--output json</code>)</li> </ul>"},{"location":"commands/validate-spec/#cicd-integration","title":"CI/CD Integration","text":""},{"location":"commands/validate-spec/#github-actions","title":"GitHub Actions","text":"<pre><code>- name: Validate Service Specs\n  run: nthlayer validate-spec services/\n</code></pre>"},{"location":"commands/validate-spec/#pre-commit-hook","title":"Pre-commit Hook","text":"<pre><code>repos:\n  - repo: local\n    hooks:\n      - id: validate-specs\n        name: Validate Service Specs\n        entry: nthlayer validate-spec\n        language: system\n        files: services/.*\\.yaml$\n</code></pre>"},{"location":"commands/validate-spec/#see-also","title":"See Also","text":"<ul> <li>Validation Overview</li> <li>Contract Verification</li> <li>conftest Documentation</li> </ul>"},{"location":"commands/verify/","title":"nthlayer verify","text":"<p>Verify that declared metrics exist in Prometheus before promoting to production.</p> <p>This implements the Contract Verification pattern - ensuring that metrics declared in <code>service.yaml</code> actually exist before deployment promotion.</p>"},{"location":"commands/verify/#usage","title":"Usage","text":"<pre><code>nthlayer verify &lt;service.yaml&gt; [options]\n</code></pre>"},{"location":"commands/verify/#options","title":"Options","text":"Option Description <code>--prometheus-url, -p URL</code> Target Prometheus URL <code>--env ENVIRONMENT</code> Environment name (dev, staging, prod) <code>--no-fail</code> Don't fail on missing metrics (always exit 0)"},{"location":"commands/verify/#environment-variables","title":"Environment Variables","text":"Variable Description <code>PROMETHEUS_URL</code> Default Prometheus URL (if <code>--prometheus-url</code> not provided) <code>PROMETHEUS_USERNAME</code> Basic auth username <code>PROMETHEUS_PASSWORD</code> Basic auth password"},{"location":"commands/verify/#exit-codes","title":"Exit Codes","text":"Code Meaning <code>0</code> All metrics verified <code>1</code> Optional metrics missing (warning) <code>2</code> Critical SLO metrics missing (block promotion)"},{"location":"commands/verify/#examples","title":"Examples","text":""},{"location":"commands/verify/#basic-verification","title":"Basic Verification","text":"<pre><code>nthlayer verify checkout-service.yaml --prometheus-url http://prometheus:9090\n</code></pre> <p>Output: <pre><code>\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 Contract Verification: checkout-service                                       \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n\nTarget: http://prometheus:9090\nService: checkout-service\n\nSLO Metrics (Critical):\n  \u2713 http_requests_total\n  \u2713 http_request_duration_seconds_bucket\n\nObservability Metrics (Optional):\n  \u2713 checkout_started_total\n  \u2713 checkout_completed_total\n\nSummary:\n  Total: 4 metrics\n  \u2713 Verified: 4\n\n\u2713 All declared metrics verified\nContract verification passed - safe to promote\n</code></pre></p>"},{"location":"commands/verify/#cicd-pipeline-integration","title":"CI/CD Pipeline Integration","text":"<pre><code># Verify against sandbox before promoting to production\nnthlayer verify service.yaml -p $SANDBOX_PROMETHEUS_URL\n\n# Exit code determines pipeline gate\nif [ $? -eq 2 ]; then\n  echo \"Critical metrics missing - blocking promotion\"\n  exit 1\nfi\n</code></pre>"},{"location":"commands/verify/#missing-metrics-output","title":"Missing Metrics Output","text":"<p>When critical metrics are missing:</p> <pre><code>SLO Metrics (Critical):\n  \u2713 http_requests_total\n  \u2717 payment_processed_total \u2190 MISSING\n\nSummary:\n  Total: 4 metrics\n  \u2713 Verified: 3\n  \u2717 Critical missing: 1\n\n\u2717 Critical SLO metrics missing - blocking promotion\n\nRecommendations:\n  \u2022 Ensure payment_processed_total is instrumented\n  \u2022 Run integration tests to generate traffic before re-verifying\n</code></pre>"},{"location":"commands/verify/#what-gets-verified","title":"What Gets Verified","text":""},{"location":"commands/verify/#slo-indicator-metrics-critical","title":"SLO Indicator Metrics (Critical)","text":"<p>Metrics extracted from SLO indicator queries in <code>service.yaml</code>:</p> <pre><code>resources:\n  - kind: SLO\n    name: availability\n    spec:\n      indicators:\n        - type: availability\n          success_ratio:\n            total_query: sum(rate(http_requests_total{service=\"checkout\"}[5m]))\n            good_query: sum(rate(http_requests_total{service=\"checkout\",status!~\"5..\"}[5m]))\n</code></pre> <p>Extracts: <code>http_requests_total</code> \u2192 Critical (blocks promotion if missing)</p>"},{"location":"commands/verify/#observability-metrics-optional","title":"Observability Metrics (Optional)","text":"<p>Metrics declared in the Observability resource:</p> <pre><code>resources:\n  - kind: Observability\n    name: observability\n    spec:\n      metrics:\n        - checkout_started_total\n        - checkout_completed_total\n</code></pre> <p>These are Optional (warning only if missing, doesn't block promotion)</p>"},{"location":"commands/verify/#philosophy","title":"Philosophy","text":"<p>\"Declarative First, Verify Later\"</p> Step Runtime Required? Description <code>nthlayer apply</code> No Generate configs from declarations (Shift Left) <code>nthlayer verify</code> Yes Verify contract before promotion <p>This solves the \"Chicken and Egg\" problem: - You can generate production-ready configs without the service running - You verify the contract in lower environments before promoting</p>"},{"location":"commands/verify/#tekton-pipeline-example","title":"Tekton Pipeline Example","text":"<pre><code>tasks:\n  - name: generate-configs\n    taskRef:\n      name: nthlayer-apply\n    params:\n      - name: service-file\n        value: services/checkout-service.yaml\n\n  - name: deploy-to-sandbox\n    runAfter: [generate-configs]\n    taskRef:\n      name: deploy\n\n  - name: verify-metrics\n    runAfter: [deploy-to-sandbox]\n    taskRef:\n      name: nthlayer-verify\n    params:\n      - name: service-file\n        value: services/checkout-service.yaml\n      - name: prometheus-url\n        value: $(params.sandbox-prometheus-url)\n\n  - name: deploy-to-production\n    runAfter: [verify-metrics]  # Blocked if verify fails\n    taskRef:\n      name: deploy\n</code></pre>"},{"location":"commands/verify/#github-actions-example","title":"GitHub Actions Example","text":"<pre><code>jobs:\n  verify-and-promote:\n    steps:\n      - name: Deploy to Staging\n        run: kubectl apply -f generated/\n\n      - name: Wait for Metrics\n        run: sleep 60  # Allow time for metrics to appear\n\n      - name: Verify Contract\n        run: |\n          nthlayer verify service.yaml \\\n            --prometheus-url ${{ secrets.STAGING_PROMETHEUS_URL }}\n\n      - name: Promote to Production\n        if: success()\n        run: kubectl apply -f generated/ --context production\n</code></pre>"},{"location":"commands/verify/#see-also","title":"See Also","text":"<ul> <li>Service YAML Schema - Full spec reference</li> <li>nthlayer apply - Generate configs</li> <li>CLI Reference - All commands</li> </ul>"},{"location":"concepts/contracts/","title":"Contracts &amp; Assumptions","text":"<p>NthLayer's verification commands (<code>nthlayer verify</code>, <code>nthlayer check-deploy</code>) depend on specific contracts between your services and your observability stack. This page documents what NthLayer expects and how to ensure your services meet these requirements.</p>"},{"location":"concepts/contracts/#metric-naming-conventions","title":"Metric Naming Conventions","text":""},{"location":"concepts/contracts/#required-labels","title":"Required Labels","text":"<p>NthLayer expects metrics to include a <code>service</code> label that matches the service name in your <code>service.yaml</code>:</p> <pre><code># service.yaml\nname: checkout-api\n</code></pre> <pre><code># Expected metric labels\nhttp_requests_total{service=\"checkout-api\", status=\"200\"}\nhttp_request_duration_seconds_bucket{service=\"checkout-api\", le=\"0.5\"}\n</code></pre>"},{"location":"concepts/contracts/#service-label-matching","title":"Service Label Matching","text":"<p>The <code>service</code> label must exactly match the <code>name</code> field in your service.yaml:</p> service.yaml name Expected label <code>checkout-api</code> <code>service=\"checkout-api\"</code> <code>user-service</code> <code>service=\"user-service\"</code> <code>PaymentAPI</code> <code>service=\"PaymentAPI\"</code> <p>Common mistake: Using <code>app</code> or <code>application</code> instead of <code>service</code>: <pre><code># \u274c Won't match\nhttp_requests_total{app=\"checkout-api\"}\n\n# \u2705 Will match\nhttp_requests_total{service=\"checkout-api\"}\n</code></pre></p>"},{"location":"concepts/contracts/#statuscode-labels","title":"Status/Code Labels","text":"<p>For availability SLOs, NthLayer expects error status indicators:</p> Service Type Success Pattern Error Pattern API <code>status!~\"5..\"</code> <code>status=~\"5..\"</code> Worker <code>status!=\"failed\"</code> <code>status=\"failed\"</code> Stream <code>status!=\"error\"</code> <code>status=\"error\"</code> <p>Alternatively, use <code>code</code> instead of <code>status</code>: <pre><code>http_requests_total{service=\"checkout-api\", code=\"200\"}\n</code></pre></p>"},{"location":"concepts/contracts/#what-metric-exists-means","title":"What \"Metric Exists\" Means","text":"<p>When <code>nthlayer verify</code> checks if a metric exists, it queries Prometheus for any time series matching the metric name and service label within the last 5 minutes.</p>"},{"location":"concepts/contracts/#verification-query","title":"Verification Query","text":"<pre><code># NthLayer runs approximately this query:\ncount(http_requests_total{service=\"checkout-api\"}[5m]) &gt; 0\n</code></pre>"},{"location":"concepts/contracts/#what-passes-verification","title":"What Passes Verification","text":"<p>\u2705 Passes: At least one time series exists with any value <pre><code>http_requests_total{service=\"checkout-api\", status=\"200\"} 1523\n</code></pre></p> <p>\u2705 Passes: Multiple time series exist <pre><code>http_requests_total{service=\"checkout-api\", status=\"200\"} 1523\nhttp_requests_total{service=\"checkout-api\", status=\"500\"} 12\n</code></pre></p>"},{"location":"concepts/contracts/#what-fails-verification","title":"What Fails Verification","text":"<p>\u274c Fails: No time series in last 5 minutes - Service not instrumented - Service not running - Wrong service label</p> <p>\u274c Fails: Metric exists but wrong label <pre><code># Metric exists but service label doesn't match\nhttp_requests_total{app=\"checkout-api\"} 1523  # Uses 'app' not 'service'\n</code></pre></p>"},{"location":"concepts/contracts/#required-base-metrics","title":"Required Base Metrics","text":""},{"location":"concepts/contracts/#api-services-type-api","title":"API Services (type: api)","text":"Metric Purpose Required For <code>http_requests_total</code> Request count Availability SLO <code>http_request_duration_seconds_bucket</code> Latency histogram Latency SLO"},{"location":"concepts/contracts/#worker-services-type-worker","title":"Worker Services (type: worker)","text":"Metric Purpose Required For <code>job_processed_total</code> Job count Throughput SLO <code>job_duration_seconds_bucket</code> Job duration Processing time SLO"},{"location":"concepts/contracts/#stream-services-type-stream","title":"Stream Services (type: stream)","text":"Metric Purpose Required For <code>messages_processed_total</code> Message count Throughput SLO <code>message_processing_duration_seconds_bucket</code> Processing time Latency SLO"},{"location":"concepts/contracts/#multi-cluster-multi-tenant-handling","title":"Multi-Cluster &amp; Multi-Tenant Handling","text":""},{"location":"concepts/contracts/#federated-prometheus","title":"Federated Prometheus","text":"<p>If you use Prometheus federation, NthLayer queries the federation endpoint. Ensure:</p> <ol> <li>Metrics are federated with original labels intact</li> <li>The <code>service</code> label is not rewritten during federation</li> <li>Query latency accounts for federation delay</li> </ol>"},{"location":"concepts/contracts/#multi-tenant-prometheus-mimircortex","title":"Multi-Tenant Prometheus (Mimir/Cortex)","text":"<p>Set the tenant header via environment variable:</p> <pre><code>export MIMIR_TENANT_ID=your-tenant\nnthlayer verify services/checkout-api.yaml\n</code></pre> <p>Or in your service.yaml:</p> <pre><code>environments:\n  production:\n    prometheus:\n      url: https://mimir.example.com/prometheus\n      tenant_id: production\n</code></pre>"},{"location":"concepts/contracts/#recording-rules","title":"Recording Rules","text":"<p>If your SLO metrics are computed via recording rules:</p> <pre><code># Recording rule\n- record: service:http_requests:rate5m\n  expr: sum(rate(http_requests_total[5m])) by (service)\n</code></pre> <p>NthLayer can verify these, but there's a delay: - Recording rules evaluate on interval (typically 1-5 minutes) - New services may not have recorded metrics immediately - Use <code>--no-fail</code> flag during initial rollout</p>"},{"location":"concepts/contracts/#verification-modes","title":"Verification Modes","text":""},{"location":"concepts/contracts/#strict-mode-default","title":"Strict Mode (Default)","text":"<pre><code>nthlayer verify services/checkout-api.yaml\n</code></pre> <ul> <li>Exit code 0: All metrics found</li> <li>Exit code 1: Optional metrics missing (warning)</li> <li>Exit code 2: Required SLO metrics missing (block)</li> </ul>"},{"location":"concepts/contracts/#lenient-mode","title":"Lenient Mode","text":"<pre><code>nthlayer verify services/checkout-api.yaml --no-fail\n</code></pre> <ul> <li>Always exit code 0</li> <li>Prints warnings for missing metrics</li> <li>Use during initial adoption or new service rollout</li> </ul>"},{"location":"concepts/contracts/#troubleshooting-verification-failures","title":"Troubleshooting Verification Failures","text":""},{"location":"concepts/contracts/#metric-not-found-for-a-running-service","title":"\"Metric not found\" for a running service","text":"<ol> <li> <p>Check label spelling:    <pre><code># Query Prometheus directly\ncurl \"$PROMETHEUS_URL/api/v1/query?query=http_requests_total{service='checkout-api'}\"\n</code></pre></p> </li> <li> <p>Check service name matches:    <pre><code># service.yaml\nname: checkout-api  # Must match exactly\n</code></pre></p> </li> <li> <p>Check metric exists at all:    <pre><code>curl \"$PROMETHEUS_URL/api/v1/query?query=http_requests_total\"\n</code></pre></p> </li> </ol>"},{"location":"concepts/contracts/#metric-not-found-for-a-new-service","title":"\"Metric not found\" for a new service","text":"<ol> <li>Wait for scrape interval: Prometheus scrapes every 15-60 seconds</li> <li>Generate some traffic: Metrics may not exist until first request</li> <li>Use --no-fail: For new services, verify in warning mode first</li> </ol>"},{"location":"concepts/contracts/#recording-rule-metrics-not-found","title":"Recording rule metrics not found","text":"<ol> <li>Wait for recording rule evaluation: Usually 1-5 minutes</li> <li>Check recording rule is deployed: Rules must be loaded by Prometheus</li> <li>Check recording rule expression: Ensure it produces output for your service</li> </ol>"},{"location":"concepts/contracts/#customizing-metric-names","title":"Customizing Metric Names","text":"<p>If your metrics use different names, specify them in your service.yaml:</p> <pre><code>name: checkout-api\ntype: api\n\nslos:\n  - name: availability\n    metric: custom_requests_total  # Instead of http_requests_total\n    success_filter: 'result=\"success\"'  # Instead of status!~\"5..\"\n\n  - name: latency\n    metric: custom_latency_histogram_seconds_bucket\n</code></pre>"},{"location":"concepts/contracts/#opensrm-contract-validation","title":"OpenSRM Contract Validation","text":"<p>When using the OpenSRM format (<code>apiVersion: srm/v1</code>), NthLayer supports richer contract validation through the <code>ContractRegistry</code>.</p>"},{"location":"concepts/contracts/#contract-block","title":"Contract Block","text":"<p>OpenSRM manifests can declare external contracts \u2014 promises your service makes to consumers:</p> <pre><code>apiVersion: srm/v1\nkind: ServiceReliabilityManifest\nmetadata:\n  name: payment-api\n  tier: critical\nspec:\n  type: api\n  slos:\n    availability:\n      target: 99.95          # Internal target (tighter)\n      window: 30d\n  contract:\n    availability: 0.999      # External promise (99.9%)\n    latency:\n      p99: 500ms\n  dependencies:\n    - name: user-service\n      type: api\n      critical: true\n      slo:\n        availability: 99.9   # What you expect from this dependency\n</code></pre> <p>Internal SLOs should be tighter than external contracts, giving margin for operational variance.</p>"},{"location":"concepts/contracts/#cross-service-validation-with-registry-dir","title":"Cross-Service Validation with <code>--registry-dir</code>","text":"<p>The <code>--registry-dir</code> flag enables validation across multiple service manifests:</p> <pre><code>nthlayer validate services/payment-api.yaml --registry-dir services/\n</code></pre> <p>This scans the directory to build a <code>ContractRegistry</code>, then validates:</p> <ol> <li> <p>Dependency expectation validation \u2014 Warns when a dependency's expected availability (in <code>dependencies[].slo</code>) exceeds the provider's published contract. For example, if <code>payment-api</code> expects <code>user-service</code> at 99.99% but <code>user-service</code> only contracts 99.9%.</p> </li> <li> <p>Transitive feasibility check \u2014 Warns when a service's contract availability is mathematically infeasible given its critical dependency chain. Uses a serial chain model: if your critical dependencies have availabilities of 99.95% and 99.9%, your maximum achievable is ~99.85%.</p> </li> </ol> <p>All contract validation produces warnings (not errors) to allow progressive adoption.</p>"},{"location":"concepts/contracts/#contractregistry","title":"ContractRegistry","text":"<p>The <code>ContractRegistry</code> is a file-based registry that scans directories for manifest contracts:</p> <pre><code>from nthlayer.specs.contracts import ContractRegistry\n\n# Build registry from a directory of manifests\nregistry = ContractRegistry.from_directory(\"services/\")\n\n# Validate a specific manifest against the registry\nwarnings = registry.validate_dependency_expectations(manifest)\nwarnings += registry.validate_transitive_feasibility(manifest)\n</code></pre>"},{"location":"concepts/contracts/#platform-team-checklist","title":"Platform Team Checklist","text":"<p>Before rolling out NthLayer verification to your organization:</p> <ul> <li>[ ] Standardize on <code>service</code> label across all metrics</li> <li>[ ] Document which base metrics each service type must emit</li> <li>[ ] Configure Prometheus federation/tenant access</li> <li>[ ] Test verification against existing services</li> <li>[ ] Start with <code>--no-fail</code> and graduate to strict mode</li> </ul>"},{"location":"concepts/deployment-gates/","title":"Deployment Gates","text":"<p>Deployment gates block or warn about deployments when error budget is exhausted. This is the core of NthLayer's Shift Left approach - catching reliability issues before they reach production.</p>"},{"location":"concepts/deployment-gates/#why-deployment-gates","title":"Why Deployment Gates?","text":"<p>Traditional monitoring tells you after a deployment causes problems. Deployment gates tell you before - enabling you to:</p> <ul> <li>Prevent incidents by blocking deploys when reliability is already degraded</li> <li>Make informed decisions with real-time error budget visibility</li> <li>Enforce SLO discipline across your organization</li> </ul>"},{"location":"concepts/deployment-gates/#how-it-works","title":"How It Works","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   CI/CD     \u2502\u2500\u2500\u2500\u2500\u25b6\u2502  NthLayer   \u2502\u2500\u2500\u2500\u2500\u25b6\u2502 Prometheus  \u2502\n\u2502  Pipeline   \u2502     \u2502 check-deploy \u2502     \u2502   Query     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                           \u2502\n                           \u25bc\n                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                    \u2502   Result    \u2502\n                    \u2502 0=Approved  \u2502\n                    \u2502 1=Warning   \u2502\n                    \u2502 2=Blocked   \u2502\n                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <ol> <li>Pipeline triggers: Your CI/CD pipeline calls <code>nthlayer check-deploy</code></li> <li>Query SLOs: NthLayer queries Prometheus for current SLI values</li> <li>Calculate budget: Error budget consumption is calculated</li> <li>Return decision: Exit code determines if deploy proceeds</li> </ol>"},{"location":"concepts/deployment-gates/#default-thresholds","title":"Default Thresholds","text":"<p>Thresholds are based on service tier:</p> Tier Warning Blocking Critical &lt;20% remaining &lt;10% remaining Standard &lt;20% remaining None (advisory) Low &lt;30% remaining None (advisory) <p>Critical services block deploys at 10% remaining budget. Standard and low tiers only warn.</p>"},{"location":"concepts/deployment-gates/#custom-policies","title":"Custom Policies","text":"<p>Override defaults with a <code>DeploymentGate</code> resource in your <code>service.yaml</code>:</p> <pre><code>resources:\n  - kind: DeploymentGate\n    name: custom-gate\n    spec:\n      thresholds:\n        warning: 30\n        blocking: 5\n</code></pre>"},{"location":"concepts/deployment-gates/#conditional-thresholds","title":"Conditional Thresholds","text":"<p>Apply different thresholds based on conditions:</p> <pre><code>resources:\n  - kind: DeploymentGate\n    name: smart-gate\n    spec:\n      thresholds:\n        warning: 20\n        blocking: 10\n\n      conditions:\n        # Stricter during business hours\n        - name: business-hours\n          when: \"hour &gt;= 9 AND hour &lt;= 17 AND weekday\"\n          blocking: 15\n\n        # Complete freeze during incidents\n        - name: incident-freeze\n          when: \"budget_remaining &lt; 5\"\n          blocking: 100\n</code></pre>"},{"location":"concepts/deployment-gates/#team-exceptions","title":"Team Exceptions","text":"<p>Allow specific teams to bypass gates:</p> <pre><code>spec:\n  exceptions:\n    - team: sre-oncall\n      allow: always\n</code></pre>"},{"location":"concepts/deployment-gates/#integration-points","title":"Integration Points","text":""},{"location":"concepts/deployment-gates/#cicd-pipelines","title":"CI/CD Pipelines","text":"<p>NthLayer integrates with:</p> <ul> <li>GitHub Actions - Reusable action</li> <li>ArgoCD - PreSync hook</li> <li>GitLab CI - Reusable template</li> <li>Tekton - Reusable task</li> </ul> <p>See examples/cicd/ for templates.</p>"},{"location":"concepts/deployment-gates/#manual-check","title":"Manual Check","text":"<p>Test locally before integrating:</p> <pre><code>nthlayer check-deploy services/api.yaml \\\n  --prometheus-url http://prometheus:9090\n\necho \"Exit code: $?\"\n</code></pre>"},{"location":"concepts/deployment-gates/#blast-radius-awareness","title":"Blast Radius Awareness","text":"<p>Gates consider downstream dependencies:</p> <pre><code>resources:\n  - kind: Dependencies\n    name: downstream\n    spec:\n      services:\n        - name: checkout-service\n          criticality: high\n        - name: analytics\n          criticality: low\n</code></pre> <p>High-criticality downstream services increase the gate's caution level.</p>"},{"location":"concepts/deployment-gates/#best-practices","title":"Best Practices","text":""},{"location":"concepts/deployment-gates/#1-start-with-advisory-mode","title":"1. Start with Advisory Mode","text":"<p>Begin with warnings only, then enable blocking:</p> <pre><code>spec:\n  thresholds:\n    warning: 20\n    blocking: null  # Advisory only\n</code></pre>"},{"location":"concepts/deployment-gates/#2-use-environment-specific-thresholds","title":"2. Use Environment-Specific Thresholds","text":"<p>Be lenient in dev, strict in prod:</p> <pre><code># dev environment\nspec:\n  thresholds:\n    warning: 50\n    blocking: null\n\n# prod environment\nspec:\n  thresholds:\n    warning: 20\n    blocking: 10\n</code></pre>"},{"location":"concepts/deployment-gates/#3-define-slo-queries","title":"3. Define SLO Queries","text":"<p>Gates need working SLO queries to calculate budget:</p> <pre><code>- kind: SLO\n  name: availability\n  spec:\n    objective: 99.95\n    window: 30d\n    indicator:\n      query: |\n        sum(rate(http_requests_total{status!~\"5..\"}[5m]))\n        /\n        sum(rate(http_requests_total[5m]))\n</code></pre>"},{"location":"concepts/deployment-gates/#4-test-before-production","title":"4. Test Before Production","text":"<p>Use the demo mode to see gate behavior:</p> <pre><code>nthlayer check-deploy services/api.yaml --demo\n</code></pre>"},{"location":"concepts/deployment-gates/#see-also","title":"See Also","text":"<ul> <li>check-deploy Command</li> <li>SLO Concepts</li> <li>Shift Left Philosophy</li> </ul>"},{"location":"concepts/opensrm/","title":"OpenSRM Format","text":"<p>The OpenSRM (Open Service Reliability Manifest) format is NthLayer's structured schema for declaring service reliability requirements. It replaces the legacy flat YAML format with a richer, namespaced structure that supports contracts, deployment gates, ownership, and cross-service validation.</p>"},{"location":"concepts/opensrm/#what-is-opensrm","title":"What is OpenSRM?","text":"<p>An OpenSRM manifest is a YAML file with:</p> <pre><code>apiVersion: srm/v1\nkind: ServiceReliabilityManifest\n</code></pre> <p>It describes everything NthLayer needs to generate, validate, and protect a service: SLOs, dependencies, contracts, ownership, observability configuration, and deployment gates \u2014 all in one file.</p>"},{"location":"concepts/opensrm/#why-opensrm","title":"Why OpenSRM?","text":"<p>The legacy <code>service.yaml</code> format works well for simple services but lacks structure for:</p> <ul> <li>External contracts \u2014 promises your service makes to consumers</li> <li>Deployment gates \u2014 automated deploy blocking based on error budget, SLO compliance, and incident counts</li> <li>Cross-service validation \u2014 checking that dependency expectations are feasible</li> <li>Ownership metadata \u2014 team, escalation, runbooks, PagerDuty integration</li> <li>Observability config \u2014 metric prefixes, log labels, trace service names</li> <li>Templates \u2014 shared base configurations with service-specific overrides</li> </ul> <p>OpenSRM provides all of this in a single, validated schema.</p>"},{"location":"concepts/opensrm/#schema-overview","title":"Schema Overview","text":"<pre><code>apiVersion: srm/v1\nkind: ServiceReliabilityManifest\n\nmetadata:\n  name: payment-api              # Service identifier\n  team: payments                 # Owning team\n  tier: critical                 # critical, standard, or low\n  description: Payment processing API\n  labels:                        # Arbitrary key-value labels\n    domain: commerce\n  annotations:                   # Metadata annotations\n    owner: \"@payments-team\"\n  template: base-api             # Optional base template\n\nspec:\n  type: api                      # Service type\n\n  slos:                          # SLO definitions\n    availability:\n      target: 99.95\n      window: 30d\n    latency:\n      target: 200\n      unit: ms\n      percentile: p99\n      window: 30d\n\n  contract:                      # External promises to consumers\n    availability: 0.999\n    latency:\n      p99: 500ms\n\n  dependencies:                  # Upstream dependencies\n    - name: postgres-primary\n      type: database\n      critical: true\n      database_type: postgresql\n      slo:\n        availability: 99.99\n    - name: redis-cache\n      type: cache\n      critical: false\n\n  ownership:                     # Team and escalation info\n    team: payments\n    slack: \"#payments-oncall\"\n    email: payments-oncall@example.com\n    pagerduty:\n      service_id: P123ABC\n    runbook: https://wiki.example.com/runbooks/payment-api\n\n  observability:                 # Metric and tracing config\n    metrics_prefix: payment_api\n    logs_label: app=payment-api\n    traces_service: payment-api\n\n  deployment:                    # Deployment configuration\n    environments:\n      - production\n      - staging\n    gates:\n      error_budget:\n        enabled: true\n        threshold: 0.10\n      slo_compliance:\n        threshold: 0.99\n      recent_incidents:\n        p1_max: 0\n        lookback: 7d\n    rollback:\n      automatic: true\n      criteria:\n        error_rate_increase: 5%\n        latency_increase: 50%\n</code></pre>"},{"location":"concepts/opensrm/#service-types","title":"Service Types","text":"<p>OpenSRM supports 7 service types, each with appropriate default SLOs and metric templates:</p> Type Description Default SLO Metrics <code>api</code> HTTP/REST service Request rate, latency, error rate <code>worker</code> Background job processor Job throughput, processing time <code>stream</code> Event/message processor Message throughput, processing latency <code>ai-gate</code> AI judgment service Reversal rate, calibration, feedback latency <code>batch</code> Batch processing job Job completion, duration <code>database</code> Database service Query latency, connection utilization <code>web</code> Web frontend Page load time, error rate"},{"location":"concepts/opensrm/#legacy-vs-opensrm","title":"Legacy vs OpenSRM","text":"Feature Legacy Format OpenSRM Format Format identifier None (flat YAML) <code>apiVersion: srm/v1</code> SLO definitions <code>resources[kind=SLO]</code> <code>spec.slos</code> map Dependencies <code>dependencies: [string]</code> <code>spec.dependencies</code> with SLO targets External contracts Not supported <code>spec.contract</code> Deployment gates Not supported <code>spec.deployment.gates</code> Ownership <code>team</code> field only <code>spec.ownership</code> with full escalation Observability Not supported <code>spec.observability</code> Templates Not supported <code>metadata.template</code> with deep merge Cross-service validation Not supported <code>ContractRegistry</code> + <code>--registry-dir</code> Service types api, worker, stream api, worker, stream, ai-gate, batch, database, web <p>Both formats are fully supported. NthLayer auto-detects the format when loading files.</p>"},{"location":"concepts/opensrm/#minimal-example","title":"Minimal Example","text":"<pre><code>apiVersion: srm/v1\nkind: ServiceReliabilityManifest\nmetadata:\n  name: my-service\n  team: my-team\n  tier: standard\nspec:\n  type: api\n  slos:\n    availability:\n      target: 99.9\n      window: 30d\n  dependencies:\n    - name: postgresql\n      type: database\n</code></pre>"},{"location":"concepts/opensrm/#full-example","title":"Full Example","text":"<p>See <code>examples/opensrm/api-critical.reliability.yaml</code> for a comprehensive example with all fields.</p>"},{"location":"concepts/opensrm/#migrating-from-legacy-format","title":"Migrating from Legacy Format","text":"<p>Use the <code>nthlayer migrate</code> command to convert existing service.yaml files:</p> <pre><code># Preview the migration\nnthlayer migrate service.yaml --dry-run\n\n# Convert and write to file\nnthlayer migrate service.yaml\n\n# Convert to a specific output directory\nnthlayer migrate service.yaml --output /path/to/output/\n</code></pre> <p>The migration preserves all existing configuration and adds the OpenSRM structure. See nthlayer migrate for full details.</p>"},{"location":"concepts/opensrm/#see-also","title":"See Also","text":"<ul> <li>Service YAML Schema \u2014 Full field reference for both formats</li> <li>nthlayer migrate \u2014 Migration command reference</li> <li>Contracts &amp; Assumptions \u2014 Contract verification and validation</li> </ul>"},{"location":"concepts/service-specs/","title":"Service Specifications","text":"<p>A service spec is a YAML file that describes your service and its reliability requirements.</p>"},{"location":"concepts/service-specs/#structure","title":"Structure","text":"<pre><code># Basic metadata\nname: payment-api\nteam: payments\ntier: critical      # 1, 2, 3 or critical, standard, low\ntype: api           # api, worker, stream\n\n# Dependencies (optional)\ndependencies:\n  - postgresql\n  - redis\n\n# Custom resources (optional)\nresources:\n  - kind: SLO\n    name: availability\n    spec:\n      objective: 99.95\n      ...\n</code></pre>"},{"location":"concepts/service-specs/#required-fields","title":"Required Fields","text":"Field Description <code>name</code> Service identifier (lowercase, hyphens allowed) <code>tier</code> Priority level: <code>1</code>/<code>critical</code>, <code>2</code>/<code>standard</code>, <code>3</code>/<code>low</code> <code>type</code> Service type: <code>api</code>, <code>worker</code>, <code>stream</code>"},{"location":"concepts/service-specs/#optional-fields","title":"Optional Fields","text":"Field Description <code>team</code> Team responsible for the service <code>description</code> Human-readable description <code>dependencies</code> List of technology dependencies <code>resources</code> Custom SLO and alert configs"},{"location":"concepts/service-specs/#service-types","title":"Service Types","text":""},{"location":"concepts/service-specs/#api-type-api","title":"API (<code>type: api</code>)","text":"<p>HTTP/REST services with request/response patterns.</p> <p>Default Metrics:</p> <ul> <li><code>http_requests_total</code> - Request count by status</li> <li><code>http_request_duration_seconds</code> - Latency histogram</li> </ul> <p>Default SLOs:</p> <ul> <li>Availability: % of non-5xx responses</li> <li>Latency: p99 response time</li> </ul>"},{"location":"concepts/service-specs/#worker-type-worker","title":"Worker (<code>type: worker</code>)","text":"<p>Background job processors.</p> <p>Default Metrics:</p> <ul> <li><code>job_processed_total</code> - Jobs completed</li> <li><code>job_duration_seconds</code> - Processing time</li> <li><code>job_failed_total</code> - Failed jobs</li> </ul> <p>Default SLOs:</p> <ul> <li>Throughput: Jobs processed per minute</li> <li>Success rate: % of successful jobs</li> </ul>"},{"location":"concepts/service-specs/#stream-type-stream","title":"Stream (<code>type: stream</code>)","text":"<p>Event/message processors.</p> <p>Default Metrics:</p> <ul> <li><code>messages_processed_total</code> - Messages handled</li> <li><code>consumer_lag</code> - Messages behind</li> <li><code>processing_duration_seconds</code> - Processing time</li> </ul> <p>Default SLOs:</p> <ul> <li>Throughput: Messages per second</li> <li>Lag: Consumer lag in messages</li> </ul>"},{"location":"concepts/service-specs/#dependencies","title":"Dependencies","text":"<p>List technologies your service depends on:</p> <pre><code>dependencies:\n  - postgresql\n  - redis\n  - kafka\n</code></pre> <p>Each dependency adds:</p> <ul> <li>Dashboard panels with technology-specific metrics</li> <li>Alerts for common failure modes</li> <li>Recording rules for aggregation</li> </ul> <p>See Technologies for all 18 supported technologies.</p>"},{"location":"concepts/service-specs/#custom-resources","title":"Custom Resources","text":"<p>Override defaults or add custom configurations:</p>"},{"location":"concepts/service-specs/#custom-slo","title":"Custom SLO","text":"<pre><code>resources:\n  - kind: SLO\n    name: availability\n    spec:\n      objective: 99.99        # Override default\n      window: 7d              # Custom window\n      indicator:\n        type: availability\n        query: |\n          sum(rate(http_requests_total{service=\"payment-api\",status!~\"5..\"}[5m])) /\n          sum(rate(http_requests_total{service=\"payment-api\"}[5m]))\n</code></pre>"},{"location":"concepts/service-specs/#custom-alert","title":"Custom Alert","text":"<pre><code>resources:\n  - kind: Alert\n    name: high-latency\n    spec:\n      expr: |\n        histogram_quantile(0.99,\n          sum by (le) (rate(http_request_duration_seconds_bucket{service=\"payment-api\"}[5m]))\n        ) &gt; 0.5\n      for: 5m\n      severity: warning\n      annotations:\n        summary: \"High latency on payment-api\"\n</code></pre>"},{"location":"concepts/service-specs/#environment-overrides","title":"Environment Overrides","text":"<p>Different settings per environment:</p> <pre><code># payment-api.yaml\nname: payment-api\ntier: critical\ntype: api\n\nenvironments:\n  production:\n    resources:\n      - kind: SLO\n        name: availability\n        spec:\n          objective: 99.99\n\n  staging:\n    resources:\n      - kind: SLO\n        name: availability\n        spec:\n          objective: 99.9\n</code></pre>"},{"location":"concepts/service-specs/#validation","title":"Validation","text":"<p>Validate your spec before applying:</p> <pre><code>nthlayer validate payment-api.yaml\n</code></pre> <pre><code>\u2713 payment-api.yaml is valid\n  - 2 SLOs defined\n  - 2 dependencies (postgresql, redis)\n</code></pre>"},{"location":"concepts/service-specs/#examples","title":"Examples","text":"<p>See the examples/services directory for complete examples.</p>"},{"location":"concepts/shift-left/","title":"Reliability Shift Left","text":""},{"location":"concepts/shift-left/#what-is-shift-left","title":"What is Shift Left?","text":"<p>\"Shift Left\" means moving validation and testing earlier in the software development lifecycle. Instead of discovering issues in production, you catch them during development or CI/CD.</p> <p>Traditional approach: <pre><code>Code \u2192 Deploy \u2192 Monitor \u2192 Incident \u2192 Fix \u2192 Repeat\n                           \u2191\n                   \"We found out the hard way\"\n</code></pre></p> <p>Shift Left approach: <pre><code>Code \u2192 Validate \u2192 Verify \u2192 Gate \u2192 Deploy \u2192 Monitor\n         \u2191          \u2191        \u2191\n   \"Is it valid?\" \"Does it exist?\" \"Is it safe?\"\n</code></pre></p>"},{"location":"concepts/shift-left/#how-nthlayer-shifts-reliability-left","title":"How NthLayer Shifts Reliability Left","text":""},{"location":"concepts/shift-left/#1-contract-verification-nthlayer-verify","title":"1. Contract Verification (<code>nthlayer verify</code>)","text":"<p>Before deploying, verify that the metrics your SLOs depend on actually exist in Prometheus:</p> <pre><code>$ nthlayer verify service.yaml --prometheus-url $PROM_URL\n\nVerifying metrics for payment-api...\n\n  \u2713 http_requests_total{service=\"payment-api\"}\n  \u2713 http_request_duration_seconds_bucket{service=\"payment-api\"}\n  \u2717 http_requests_total{service=\"payment-api\",status=~\"5..\"}  NOT FOUND\n\nContract verification failed: 1 metric(s) not found\n</code></pre> <p>Pipeline integration: <pre><code># GitHub Actions\n- name: Verify SLO Metrics\n  run: nthlayer verify service.yaml --prometheus-url $PROM_URL\n  # Fails pipeline if metrics don't exist\n</code></pre></p>"},{"location":"concepts/shift-left/#2-deployment-gates-nthlayer-check-deploy","title":"2. Deployment Gates (<code>nthlayer check-deploy</code>)","text":"<p>Block deployments when error budget is exhausted:</p> <pre><code>$ nthlayer check-deploy service.yaml --prometheus-url $PROM_URL\n\n\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502  Deployment Gate Check                                       \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n\n  Service:       payment-api\n  Tier:          critical\n  Window:        30d\n\n  SLO Results:\n    availability   99.87%  (target: 99.95%)   budget: 42% remaining   \u26a0 WARNING\n    latency_p99    187ms   (target: 200ms)    budget: 78% remaining   \u2713 OK\n\n  Decision:  \u26a0 PROCEED WITH CAUTION\n</code></pre> <p>Exit codes: - <code>0</code> - Deploy approved - <code>1</code> - Warning (budget low, but allowed) - <code>2</code> - Blocked (budget exhausted)</p>"},{"location":"concepts/shift-left/#3-promql-validation-nthlayer-apply-lint","title":"3. PromQL Validation (<code>nthlayer apply --lint</code>)","text":"<p>Catch syntax errors before they reach Prometheus:</p> <pre><code>$ nthlayer apply service.yaml --lint\n\nApplied 4 resources in 0.3s \u2192 generated/payment-api/\n\nValidating alerts with pint...\n  \u2713 12 rules validated\n\n  \u26a0 [promql/series] Line 45: metric \"http_errors_total\" not found\n</code></pre>"},{"location":"concepts/shift-left/#the-google-sre-connection","title":"The Google SRE Connection","text":"<p>NthLayer automates concepts from the Google SRE Book:</p> SRE Concept Manual Process NthLayer Automation Production Readiness Review Multi-week checklist <code>nthlayer verify</code> in CI Error Budget Policy Spreadsheet tracking <code>nthlayer check-deploy</code> gates Release Engineering Manual runbooks Generated artifacts + GitOps Monitoring Standards Wiki pages <code>service.yaml</code> spec"},{"location":"concepts/shift-left/#cicd-pipeline-example","title":"CI/CD Pipeline Example","text":""},{"location":"concepts/shift-left/#tekton-pipeline","title":"Tekton Pipeline","text":"<pre><code>apiVersion: tekton.dev/v1\nkind: Pipeline\nmetadata:\n  name: deploy-with-reliability-gates\nspec:\n  tasks:\n    - name: generate\n      taskRef:\n        name: nthlayer-apply\n      params:\n        - name: service-file\n          value: service.yaml\n\n    - name: verify-metrics\n      taskRef:\n        name: nthlayer-verify\n      runAfter: [generate]\n\n    - name: check-budget\n      taskRef:\n        name: nthlayer-check-deploy\n      runAfter: [verify-metrics]\n\n    - name: deploy\n      taskRef:\n        name: kubectl-apply\n      runAfter: [check-budget]\n      # Only runs if all gates pass\n</code></pre>"},{"location":"concepts/shift-left/#github-actions","title":"GitHub Actions","text":"<pre><code>jobs:\n  deploy:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Install NthLayer\n        run: pip install nthlayer\n\n      - name: Generate &amp; Lint\n        run: nthlayer apply service.yaml --lint\n\n      - name: Verify Metrics Exist\n        run: nthlayer verify service.yaml --prometheus-url $PROM_URL\n        env:\n          PROM_URL: ${{ secrets.PROMETHEUS_URL }}\n\n      - name: Check Deployment Gate\n        run: nthlayer check-deploy service.yaml --prometheus-url $PROM_URL\n        env:\n          PROM_URL: ${{ secrets.PROMETHEUS_URL }}\n\n      - name: Deploy\n        if: success()\n        run: kubectl apply -f generated/\n</code></pre>"},{"location":"concepts/shift-left/#benefits","title":"Benefits","text":""},{"location":"concepts/shift-left/#prevent-dont-react","title":"Prevent, Don't React","text":"Traditional Shift Left Deploy first, monitor later Validate before deploy Alert after incident Block risky deploys SLOs as documentation SLOs as enforcement Manual PRR checklist Automated verification"},{"location":"concepts/shift-left/#measurable-outcomes","title":"Measurable Outcomes","text":"<p>Teams using reliability shift left typically see:</p> <ul> <li>60% reduction in incidents caused by missing monitoring</li> <li>80% faster SLO setup (5 min vs 20 hours)</li> <li>Zero deploys with missing metrics</li> <li>Reduced MTTR - dashboards exist from day 1</li> </ul>"},{"location":"concepts/shift-left/#see-also","title":"See Also","text":"<ul> <li>Contract Verification - Full <code>verify</code> command reference</li> <li>Deployment Gates - Full <code>check-deploy</code> reference</li> <li>SLO Concepts - Understanding SLOs and error budgets</li> </ul>"},{"location":"concepts/slos/","title":"SLOs &amp; Error Budgets","text":"<p>Service Level Objectives (SLOs) are the foundation of reliability engineering.</p>"},{"location":"concepts/slos/#what-is-an-slo","title":"What is an SLO?","text":"<p>An SLO is a target for service reliability, expressed as:</p> <p>\"99.9% of requests should succeed over a 30-day window\"</p> <p>Components:</p> <ul> <li>Objective: The target (99.9%)</li> <li>Indicator: What we measure (successful requests)</li> <li>Window: Time period (30 days)</li> </ul>"},{"location":"concepts/slos/#error-budgets","title":"Error Budgets","text":"<p>The error budget is the inverse of your SLO:</p> <pre><code>Error Budget = 100% - SLO Objective\n</code></pre> <p>For a 99.9% SLO over 30 days:</p> <pre><code>Error Budget = 0.1% \u00d7 30 days \u00d7 24 hours \u00d7 60 minutes\n             = 43.2 minutes of allowed downtime\n</code></pre>"},{"location":"concepts/slos/#how-nthlayer-uses-slos","title":"How NthLayer Uses SLOs","text":""},{"location":"concepts/slos/#1-automatic-generation","title":"1. Automatic Generation","text":"<p>Define your tier, get sensible defaults:</p> <pre><code>name: payment-api\ntier: critical  # Gets 99.95% availability target\ntype: api\n</code></pre>"},{"location":"concepts/slos/#2-dashboard-visualization","title":"2. Dashboard Visualization","text":"<p>Generated dashboards show:</p> <ul> <li>Current SLO compliance</li> <li>Error budget remaining</li> <li>Burn rate trends</li> </ul>"},{"location":"concepts/slos/#3-portfolio-view","title":"3. Portfolio View","text":"<p>See all services at once:</p> <pre><code>nthlayer portfolio\n</code></pre>"},{"location":"concepts/slos/#4-live-queries","title":"4. Live Queries","text":"<p>Query Prometheus for real-time status:</p> <pre><code>nthlayer slo collect payment-api.yaml\n</code></pre>"},{"location":"concepts/slos/#slo-types","title":"SLO Types","text":""},{"location":"concepts/slos/#availability-slo","title":"Availability SLO","text":"<p>Percentage of successful requests:</p> <pre><code>resources:\n  - kind: SLO\n    name: availability\n    spec:\n      objective: 99.95\n      window: 30d\n      indicator:\n        type: availability\n        query: |\n          sum(rate(http_requests_total{service=\"$service\",status!~\"5..\"}[5m])) /\n          sum(rate(http_requests_total{service=\"$service\"}[5m]))\n</code></pre>"},{"location":"concepts/slos/#latency-slo","title":"Latency SLO","text":"<p>Percentage of requests under a threshold:</p> <pre><code>resources:\n  - kind: SLO\n    name: latency-p99\n    spec:\n      objective: 99.0\n      window: 30d\n      threshold_ms: 200\n      indicator:\n        type: latency\n        percentile: 99\n        query: |\n          histogram_quantile(0.99,\n            sum by (le) (rate(http_request_duration_seconds_bucket{service=\"$service\"}[5m]))\n          )\n</code></pre>"},{"location":"concepts/slos/#throughput-slo","title":"Throughput SLO","text":"<p>Minimum requests/operations per second:</p> <pre><code>resources:\n  - kind: SLO\n    name: throughput\n    spec:\n      objective: 99.0\n      window: 30d\n      threshold_rps: 100\n      indicator:\n        type: throughput\n        query: sum(rate(http_requests_total{service=\"$service\"}[5m]))\n</code></pre>"},{"location":"concepts/slos/#tier-based-defaults","title":"Tier-Based Defaults","text":"Tier Availability Latency (p99) Error Budget Critical 99.95% 200ms 21.6 min/month Standard 99.9% 500ms 43.2 min/month Low 99.5% 1000ms 216 min/month"},{"location":"concepts/slos/#budget-consumption","title":"Budget Consumption","text":"<p>NthLayer tracks how much budget has been consumed:</p> Status Budget Consumed Action Healthy &lt; 80% Continue normal development Warning 80-100% Slow down, focus on stability Critical 100-150% Freeze changes, investigate Exhausted &gt; 150% Incident mode, all hands"},{"location":"concepts/slos/#best-practices","title":"Best Practices","text":""},{"location":"concepts/slos/#1-start-conservative","title":"1. Start Conservative","text":"<p>Begin with achievable targets and tighten over time:</p> <pre><code># Start here\ntier: standard  # 99.9%\n\n# After proving stability\ntier: critical  # 99.95%\n</code></pre>"},{"location":"concepts/slos/#2-match-business-impact","title":"2. Match Business Impact","text":"<p>Tier should reflect business criticality:</p> <ul> <li>Critical: Payment processing, authentication</li> <li>Standard: Main application features</li> <li>Low: Internal tools, analytics</li> </ul>"},{"location":"concepts/slos/#3-use-multiple-slos","title":"3. Use Multiple SLOs","text":"<p>Cover different failure modes:</p> <pre><code>resources:\n  - kind: SLO\n    name: availability\n    spec:\n      objective: 99.95\n\n  - kind: SLO\n    name: latency-p99\n    spec:\n      objective: 99.0\n      threshold_ms: 200\n\n  - kind: SLO\n    name: latency-p50\n    spec:\n      objective: 99.9\n      threshold_ms: 50\n</code></pre>"},{"location":"concepts/slos/#4-review-regularly","title":"4. Review Regularly","text":"<p>Use the portfolio view for weekly reviews:</p> <pre><code>nthlayer portfolio --format json &gt; slo-review-$(date +%Y%m%d).json\n</code></pre>"},{"location":"concepts/slos/#further-reading","title":"Further Reading","text":"<ul> <li>Google SRE Book - SLOs</li> <li>The Art of SLOs</li> </ul>"},{"location":"concepts/tiers/","title":"Service Tiers","text":"<p>Tiers are the foundation of NthLayer's reliability requirements. A service's tier determines its SLO targets, alerting thresholds, escalation urgency, and deployment gate strictness.</p>"},{"location":"concepts/tiers/#what-tier-means","title":"What Tier Means","text":"<p>Tier represents business criticality, not technical complexity.</p> <p>A simple CRUD API that processes payments is tier <code>critical</code>. A sophisticated ML pipeline that generates recommendations is tier <code>standard</code>.</p> <p>The question is: What happens to the business if this service fails?</p> Tier Business Impact Examples critical Revenue loss, safety risk, core user flow blocked Checkout, Authentication, Payments, Core API standard Degraded experience, workarounds exist Search, Recommendations, Notifications low Minimal user impact, internal tooling Reports, Batch jobs, Admin dashboards"},{"location":"concepts/tiers/#what-tier-controls","title":"What Tier Controls","text":""},{"location":"concepts/tiers/#slo-targets","title":"SLO Targets","text":"Metric Critical Standard Low Availability 99.95% 99.5% 99.0% Latency P99 200ms 500ms 2000ms Error Rate 0.05% 0.5% 1.0%"},{"location":"concepts/tiers/#error-budget-gates","title":"Error Budget &amp; Gates","text":"Aspect Critical Standard Low Monthly error budget 21.6 min 3.6 hrs 7.2 hrs <code>check-deploy</code> blocks at &lt; 10% remaining &lt; 5% remaining Advisory only <code>check-deploy</code> warns at &lt; 20% remaining &lt; 10% remaining &lt; 20% remaining"},{"location":"concepts/tiers/#alerting-thresholds","title":"Alerting Thresholds","text":"Alert Type Critical Standard Low Error rate threshold &gt; 1% &gt; 5% &gt; 10% Latency P99 threshold &gt; 500ms &gt; 2s &gt; 5s Availability threshold &lt; 99.9% &lt; 99% &lt; 95%"},{"location":"concepts/tiers/#choosing-a-tier","title":"Choosing a Tier","text":""},{"location":"concepts/tiers/#ask-these-questions","title":"Ask These Questions","text":"<ol> <li>Revenue impact: Does downtime directly cost money?</li> <li>Yes \u2192 <code>critical</code></li> <li>Indirectly \u2192 <code>standard</code></li> <li> <p>No \u2192 <code>low</code></p> </li> <li> <p>User-facing: Do end users see this service's output?</p> </li> <li>Core flow (checkout, login) \u2192 <code>critical</code></li> <li>Supporting flow (search, recommendations) \u2192 <code>standard</code></li> <li> <p>Internal only \u2192 <code>low</code></p> </li> <li> <p>Recovery time: How quickly must this recover?</p> </li> <li>Minutes \u2192 <code>critical</code></li> <li>Hours \u2192 <code>standard</code></li> <li>Days acceptable \u2192 <code>low</code></li> </ol>"},{"location":"concepts/tiers/#common-mistakes","title":"Common Mistakes","text":"<p>\u274c Over-tiering: Making everything <code>critical</code> dilutes urgency and causes alert fatigue.</p> <p>\u274c Under-tiering: A payment service marked <code>low</code> won't get appropriate alerting or gates.</p> <p>\u274c Tiering by complexity: A complex service isn't necessarily critical. A simple service can be.</p>"},{"location":"concepts/tiers/#specifying-tier","title":"Specifying Tier","text":"<p>In your <code>service.yaml</code>:</p> <pre><code>name: checkout-api\nteam: payments\ntier: critical  # or: 1, \"tier-1\", \"t1\"\ntype: api\n</code></pre> <p>NthLayer accepts multiple formats:</p> Input Normalized To <code>critical</code>, <code>1</code>, <code>tier-1</code>, <code>t1</code> <code>critical</code> <code>standard</code>, <code>2</code>, <code>tier-2</code>, <code>t2</code> <code>standard</code> <code>low</code>, <code>3</code>, <code>tier-3</code>, <code>t3</code> <code>low</code>"},{"location":"concepts/tiers/#overriding-tier-defaults","title":"Overriding Tier Defaults","text":"<p>Tier sets defaults, but you can override any specific value:</p> <pre><code>name: checkout-api\ntier: critical\n\nslos:\n  - name: availability\n    target: 99.99  # Override: stricter than critical default (99.95)\n</code></pre>"},{"location":"concepts/tiers/#tier-changes","title":"Tier Changes","text":"<p>Changing a service's tier should be deliberate:</p> <p>Promoting to higher tier (e.g., <code>standard</code> \u2192 <code>critical</code>): - Requires tighter SLOs - Triggers more aggressive alerting - Enables stricter deployment gates - Consider: Is the service actually ready for this scrutiny?</p> <p>Demoting to lower tier (e.g., <code>critical</code> \u2192 <code>standard</code>): - Relaxes SLOs - Reduces alert sensitivity - Loosens deployment gates - Consider: Is this reflecting reality or just avoiding alerts?</p>"},{"location":"concepts/tiers/#platform-team-guidance","title":"Platform Team Guidance","text":"<p>For platform teams standardizing on NthLayer:</p> <ol> <li>Document your tier criteria specific to your organization</li> <li>Require justification for <code>critical</code> tier assignments</li> <li>Review tier assignments quarterly</li> <li>Start services at <code>standard</code> and promote based on evidence</li> </ol> <p>The tier system only works if it reflects actual business reality.</p>"},{"location":"getting-started/adoption-path/","title":"Adoption Path","text":"<p>NthLayer can be adopted incrementally. You don't need to enable all features on day one. This guide walks through a proven three-phase approach that lets teams build confidence before enabling enforcement.</p>"},{"location":"getting-started/adoption-path/#overview","title":"Overview","text":"Phase What You Do Risk Level Time to Value 1. Generate Run locally, review output None 1 day 2. Validate Add to CI, warnings only Low 1 week 3. Protect Enable gates, block deploys Medium 2-4 weeks"},{"location":"getting-started/adoption-path/#phase-1-generate-only","title":"Phase 1: Generate Only","text":"<p>Goal: See what NthLayer produces without any CI/CD integration.</p> <p>Duration: 1-3 days</p>"},{"location":"getting-started/adoption-path/#steps","title":"Steps","text":"<ol> <li> <p>Install NthLayer <pre><code>pip install nthlayer\n</code></pre></p> </li> <li> <p>Create a service spec <pre><code>nthlayer init\n# Or manually create service.yaml\n</code></pre></p> </li> <li> <p>Generate artifacts locally <pre><code>nthlayer apply services/checkout-api.yaml --output-dir ./generated\n</code></pre></p> </li> <li> <p>Review the output <pre><code>generated/\n\u2514\u2500\u2500 checkout-api/\n    \u251c\u2500\u2500 dashboard.json      # Grafana dashboard\n    \u251c\u2500\u2500 alerts.yaml         # Prometheus alert rules\n    \u251c\u2500\u2500 recording_rules.yaml\n    \u2514\u2500\u2500 slo.yaml            # SLO definitions\n</code></pre></p> </li> <li> <p>Compare to your existing setup</p> </li> <li>Are the generated alerts better than what you have?</li> <li>Does the dashboard cover what you need?</li> <li>Are SLO targets reasonable for this service?</li> </ol>"},{"location":"getting-started/adoption-path/#success-criteria","title":"Success Criteria","text":"<ul> <li>[ ] Generated artifacts look correct</li> <li>[ ] You understand what each file does</li> <li>[ ] You've identified any customizations needed</li> </ul>"},{"location":"getting-started/adoption-path/#what-you-learn","title":"What You Learn","text":"<ul> <li>How tier affects defaults</li> <li>What NthLayer generates vs what you need to customize</li> <li>Whether your service.yaml needs adjustments</li> </ul>"},{"location":"getting-started/adoption-path/#phase-2-validate-in-ci","title":"Phase 2: Validate in CI","text":"<p>Goal: Run NthLayer in CI to catch issues early, but don't block deploys yet.</p> <p>Duration: 1-2 weeks</p>"},{"location":"getting-started/adoption-path/#steps_1","title":"Steps","text":"<ol> <li>Add NthLayer to your CI pipeline</li> </ol> <pre><code># .github/workflows/ci.yml\n- name: Generate and validate reliability config\n  run: |\n    pip install nthlayer\n    nthlayer apply services/${{ matrix.service }}.yaml --lint\n</code></pre> <ol> <li>Enable verification in warning mode</li> </ol> <pre><code>- name: Verify metrics exist (warnings only)\n  run: |\n    nthlayer verify services/${{ matrix.service }}.yaml --no-fail\n  env:\n    PROMETHEUS_URL: ${{ secrets.PROMETHEUS_URL }}\n</code></pre> <ol> <li>Commit generated artifacts</li> </ol> <pre><code>- name: Check for uncommitted changes\n  run: |\n    git diff --exit-code generated/\n</code></pre>"},{"location":"getting-started/adoption-path/#what-to-watch-for","title":"What to Watch For","text":"<ul> <li>Lint failures: Invalid PromQL in generated alerts</li> <li>Verification warnings: Missing metrics in Prometheus</li> <li>Drift: Generated files that weren't committed</li> </ul>"},{"location":"getting-started/adoption-path/#success-criteria_1","title":"Success Criteria","text":"<ul> <li>[ ] CI runs NthLayer on every PR</li> <li>[ ] Team reviews NthLayer output in PRs</li> <li>[ ] No unexpected lint failures</li> <li>[ ] Verification warnings are understood (not necessarily fixed)</li> </ul>"},{"location":"getting-started/adoption-path/#what-you-learn_1","title":"What You Learn","text":"<ul> <li>Which services are missing required metrics</li> <li>Whether your Prometheus setup works with NthLayer</li> <li>Team comfort level with the generated artifacts</li> </ul>"},{"location":"getting-started/adoption-path/#phase-3-protect-in-cd","title":"Phase 3: Protect in CD","text":"<p>Goal: Enable deployment gates that block risky deploys.</p> <p>Duration: 2-4 weeks (gradual rollout)</p>"},{"location":"getting-started/adoption-path/#steps_2","title":"Steps","text":"<ol> <li>Start with non-critical services</li> </ol> <p>Pick 2-3 <code>standard</code> or <code>low</code> tier services first:    <pre><code># service.yaml\ntier: standard  # Start here, not critical\n</code></pre></p> <ol> <li>Enable check-deploy in warning mode</li> </ol> <pre><code># CD pipeline\n- name: Check deployment gate\n  run: |\n    nthlayer check-deploy services/${{ matrix.service }}.yaml || echo \"Gate warning (not blocking)\"\n  env:\n    PROMETHEUS_URL: ${{ secrets.PROMETHEUS_URL }}\n</code></pre> <ol> <li>Monitor for false positives</li> </ol> <p>Track:    - How often would deploys have been blocked?    - Were those blocks justified?    - Any false positives?</p> <ol> <li>Graduate to blocking mode</li> </ol> <pre><code>- name: Check deployment gate\n  run: |\n    nthlayer check-deploy services/${{ matrix.service }}.yaml\n  # Now exit code 2 will fail the pipeline\n</code></pre> <ol> <li>Expand to critical services</li> </ol> <p>Only after confidence is built:    <pre><code>tier: critical  # Now enable for high-stakes services\n</code></pre></p>"},{"location":"getting-started/adoption-path/#rollout-schedule","title":"Rollout Schedule","text":"Week Services Mode 1 2-3 low tier Warning only 2 All low tier Blocking 3 Standard tier Warning only 4 Standard tier Blocking 5+ Critical tier Warning, then blocking"},{"location":"getting-started/adoption-path/#success-criteria_2","title":"Success Criteria","text":"<ul> <li>[ ] Gates correctly block deploys with exhausted error budgets</li> <li>[ ] No false positives blocking valid deploys</li> <li>[ ] Team trusts the gate decisions</li> <li>[ ] Escalation path exists for gate overrides</li> </ul>"},{"location":"getting-started/adoption-path/#what-you-learn_2","title":"What You Learn","text":"<ul> <li>Whether your SLO targets are realistic</li> <li>How often services are actually at risk</li> <li>Team response to automated enforcement</li> </ul>"},{"location":"getting-started/adoption-path/#common-adoption-patterns","title":"Common Adoption Patterns","text":""},{"location":"getting-started/adoption-path/#pattern-a-platform-team-drives","title":"Pattern A: Platform Team Drives","text":"<ol> <li>Platform team adopts NthLayer</li> <li>Creates org-wide service templates</li> <li>Onboards service teams one by one</li> <li>Mandates adoption for new services</li> </ol> <p>Best for: Organizations with strong platform teams</p>"},{"location":"getting-started/adoption-path/#pattern-b-service-team-experiments","title":"Pattern B: Service Team Experiments","text":"<ol> <li>One service team tries NthLayer</li> <li>Shares results with other teams</li> <li>Organic adoption spreads</li> <li>Platform team eventually standardizes</li> </ol> <p>Best for: Bottom-up engineering cultures</p>"},{"location":"getting-started/adoption-path/#pattern-c-incident-driven","title":"Pattern C: Incident-Driven","text":"<ol> <li>Major incident reveals monitoring gaps</li> <li>NthLayer adopted for affected services</li> <li>Expanded based on incident learnings</li> <li>Eventually becomes standard</li> </ol> <p>Best for: Organizations learning from failures</p>"},{"location":"getting-started/adoption-path/#rollback-plan","title":"Rollback Plan","text":"<p>If adoption isn't working:</p>"},{"location":"getting-started/adoption-path/#phase-3-phase-2","title":"Phase 3 \u2192 Phase 2","text":"<ul> <li>Remove <code>check-deploy</code> from CD</li> <li>Keep <code>verify --no-fail</code> in CI</li> <li>Investigate why gates were problematic</li> </ul>"},{"location":"getting-started/adoption-path/#phase-2-phase-1","title":"Phase 2 \u2192 Phase 1","text":"<ul> <li>Remove NthLayer from CI</li> <li>Continue using generated artifacts manually</li> <li>Investigate lint/verify issues</li> </ul>"},{"location":"getting-started/adoption-path/#phase-1-nothing","title":"Phase 1 \u2192 Nothing","text":"<ul> <li>Stop using NthLayer</li> <li>Keep existing monitoring setup</li> <li>Document what didn't work for future reference</li> </ul>"},{"location":"getting-started/adoption-path/#timeline-summary","title":"Timeline Summary","text":"Milestone Typical Duration First service.yaml created Day 1 First generated artifacts reviewed Day 1-3 NthLayer running in CI Week 1 First service with blocking gate Week 3-4 All services with blocking gates Month 2-3 Full org standardization Month 3-6 <p>The key is incremental confidence: each phase proves value before the next adds risk.</p>"},{"location":"getting-started/first-service/","title":"Your First Service","text":"<p>Learn how to create a complete service specification.</p>"},{"location":"getting-started/first-service/#minimal-service","title":"Minimal Service","text":"<p>The simplest service spec:</p> <pre><code>name: my-api\ntier: standard\ntype: api\n</code></pre> <p>This generates default SLOs for a standard API (99.9% availability, 500ms p99 latency).</p>"},{"location":"getting-started/first-service/#complete-service-example","title":"Complete Service Example","text":"<pre><code>name: payment-api\nteam: payments\ntier: critical        # 1=critical, 2=standard, 3=low\ntype: api             # api, worker, stream\n\n# Technology dependencies\ndependencies:\n  - postgresql\n  - redis\n\n# Custom SLO overrides\nresources:\n  - kind: SLO\n    name: availability\n    spec:\n      objective: 99.95\n      window: 30d\n      indicator:\n        type: availability\n        query: |\n          sum(rate(http_requests_total{service=\"payment-api\",status!~\"5..\"}[5m])) /\n          sum(rate(http_requests_total{service=\"payment-api\"}[5m]))\n\n  - kind: SLO\n    name: latency-p99\n    spec:\n      objective: 99.0\n      window: 30d\n      threshold_ms: 200\n      indicator:\n        type: latency\n        percentile: 99\n</code></pre>"},{"location":"getting-started/first-service/#service-tiers","title":"Service Tiers","text":"Tier Availability Latency (p99) Error Budget (30d) 1 (Critical) 99.95% 200ms 21.6 min 2 (Standard) 99.9% 500ms 43.2 min 3 (Low) 99.5% 1000ms 3.6 hours"},{"location":"getting-started/first-service/#service-types","title":"Service Types","text":"Type Description Key Metrics api HTTP/REST services Request rate, latency, error rate worker Background jobs Job throughput, duration, failure rate stream Event processors Messages/sec, lag, processing time"},{"location":"getting-started/first-service/#dependencies","title":"Dependencies","text":"<p>NthLayer generates monitoring for these technologies:</p> DatabasesMessage QueuesProxiesInfrastructure <ul> <li><code>postgresql</code> - Connections, replication, locks</li> <li><code>mysql</code> - Connections, queries, replication</li> <li><code>mongodb</code> - Connections, operations, replication</li> <li><code>redis</code> - Memory, connections, hit rate</li> <li><code>elasticsearch</code> - Cluster health, indexing, search</li> </ul> <ul> <li><code>kafka</code> - Consumer lag, partitions, throughput</li> <li><code>rabbitmq</code> - Queue depth, consumers, rates</li> <li><code>nats</code> - Connections, messages, subscriptions</li> <li><code>pulsar</code> - Throughput, backlog, storage</li> </ul> <ul> <li><code>nginx</code> - Requests, connections, upstream</li> <li><code>haproxy</code> - Backend health, response time</li> <li><code>traefik</code> - Requests, entrypoints</li> </ul> <ul> <li><code>kubernetes</code> - Pod health, resources</li> <li><code>etcd</code> - Leader, proposals, DB size</li> <li><code>consul</code> - Health checks, services</li> </ul>"},{"location":"getting-started/first-service/#generate-and-apply","title":"Generate and Apply","text":"<pre><code># Preview what will be generated\nnthlayer plan payment-api.yaml\n\n# Generate all configs\nnthlayer apply payment-api.yaml\n\n# Push dashboard to Grafana (if configured)\nnthlayer apply payment-api.yaml --push\n</code></pre>"},{"location":"getting-started/first-service/#next-steps","title":"Next Steps","text":"<ul> <li>nthlayer apply - Full apply options</li> <li>Technologies - All 18 templates</li> <li>Service YAML Schema - Complete schema reference</li> </ul>"},{"location":"getting-started/installation/","title":"Installation","text":""},{"location":"getting-started/installation/#requirements","title":"Requirements","text":"<ul> <li>Python 3.11 or higher</li> <li>pip or pipx</li> </ul>"},{"location":"getting-started/installation/#install-with-pipx-recommended","title":"Install with pipx (Recommended)","text":"<pre><code>pipx install nthlayer\n</code></pre> <p>This installs NthLayer in an isolated environment.</p>"},{"location":"getting-started/installation/#install-with-pip","title":"Install with pip","text":"<pre><code>pip install nthlayer\n</code></pre>"},{"location":"getting-started/installation/#verify-installation","title":"Verify Installation","text":"<pre><code>nthlayer --version\n</code></pre>"},{"location":"getting-started/installation/#development-installation","title":"Development Installation","text":"<p>For contributors:</p> <pre><code>git clone https://github.com/rsionnach/nthlayer.git\ncd nthlayer\npip install -e \".[dev]\"\n</code></pre>"},{"location":"getting-started/installation/#next-steps","title":"Next Steps","text":"<ul> <li>Quick Start - Generate your first configs</li> <li>Your First Service - Create a service spec</li> </ul>"},{"location":"getting-started/quick-start/","title":"Quick Start","text":"<p>Generate your complete reliability stack in 5 minutes.</p>"},{"location":"getting-started/quick-start/#1-install-nthlayer","title":"1. Install NthLayer","text":"<pre><code>pipx install nthlayer\n</code></pre>"},{"location":"getting-started/quick-start/#2-run-interactive-setup","title":"2. Run Interactive Setup","text":"<pre><code>nthlayer setup\n</code></pre> <p>This guides you through configuring:</p> <ul> <li>Prometheus - For metric discovery and SLO queries</li> <li>Grafana - For dashboard deployment (optional)</li> </ul> <p>Example output: <pre><code>================================================================================\n  Welcome to NthLayer!\n================================================================================\n\nQuick Setup\n----------------------------------------\n1. Prometheus Configuration\n   Prometheus URL [http://localhost:9090]:\n\n2. Grafana Configuration (optional)\n   Configure Grafana? [Y/n]: y\n   Grafana URL [http://localhost:3000]:\n   API Key: ****\n\nTesting Connections\n----------------------------------------\n  Prometheus (http://localhost:9090)\n    [OK] Connected (Prometheus 2.45.0)\n\n  Grafana (http://localhost:3000)\n    [OK] Connected - Org: Main Org\n\nConfiguration saved to: ~/.nthlayer/config.yaml\n</code></pre></p>"},{"location":"getting-started/quick-start/#3-create-a-service-spec","title":"3. Create a Service Spec","text":"<p>Create <code>payment-api.yaml</code>:</p> <pre><code>name: payment-api\ntier: critical\ntype: api\nteam: payments\n\ndependencies:\n  - postgresql\n  - redis\n</code></pre>"},{"location":"getting-started/quick-start/#4-generate-configs","title":"4. Generate Configs","text":"<pre><code>nthlayer apply payment-api.yaml\n</code></pre> <p>Output: <pre><code>Generated: generated/payment-api/\n\u251c\u2500\u2500 dashboard.json       # Import to Grafana\n\u251c\u2500\u2500 alerts.yaml          # Add to Prometheus\n\u251c\u2500\u2500 slos.yaml            # OpenSLO format\n\u2514\u2500\u2500 recording-rules.yaml # Prometheus rules\n</code></pre></p>"},{"location":"getting-started/quick-start/#5-view-your-slo-portfolio","title":"5. View Your SLO Portfolio","text":"<pre><code>nthlayer portfolio\n</code></pre> <pre><code>================================================================================\n  NthLayer SLO Portfolio\n================================================================================\n\nOrganization Health: 100% (1/1 services meeting SLOs)\n\nBy Tier:\n  Critical:  100%  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588  1/1 services\n</code></pre>"},{"location":"getting-started/quick-start/#next-steps","title":"Next Steps","text":"<ul> <li>Your First Service - Detailed service spec guide</li> <li>Commands - Full CLI reference</li> <li>Technologies - 18 supported technologies</li> </ul>"},{"location":"integrations/cicd/","title":"CI/CD Integration","text":"<p>Integrate NthLayer into your deployment pipeline for automated reliability validation.</p>"},{"location":"integrations/cicd/#the-reliability-pipeline","title":"The Reliability Pipeline","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Generate \u2502 \u2192 \u2502 Validate \u2502 \u2192 \u2502  Protect \u2502 \u2192 \u2502  Deploy  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n  apply          validate-spec   check-deploy    kubectl\n                 verify                          argocd\n                 --lint\n</code></pre>"},{"location":"integrations/cicd/#recommended-gitops-mode","title":"Recommended: GitOps Mode","text":"<p>NthLayer supports two deployment patterns:</p> Mode Description When to Use GitOps (Recommended) Generate artifacts to repo, deploy via CD Production workflows Push Direct push to Grafana/Prometheus APIs Bootstrap, demos"},{"location":"integrations/cicd/#why-gitops-is-recommended","title":"Why GitOps is Recommended","text":"<ol> <li>Audit trail - All changes are PR-reviewed and committed</li> <li>Rollback - <code>git revert</code> undoes any change</li> <li>Separation of concerns - NthLayer generates, CD deploys</li> <li>No API credentials in NthLayer - CD handles deployment auth</li> </ol>"},{"location":"integrations/cicd/#gitops-workflow","title":"GitOps Workflow","text":"<pre><code># CI: Generate and validate\n- name: Generate configs\n  run: nthlayer apply services/*.yaml --output-dir generated/\n\n- name: Commit generated configs\n  run: |\n    git add generated/\n    git commit -m \"chore: regenerate reliability configs\"\n    git push\n\n# CD (ArgoCD/Flux): Deploy from generated/ directory\n</code></pre>"},{"location":"integrations/cicd/#push-mode-bootstrap-only","title":"Push Mode (Bootstrap Only)","text":"<p>Push mode is useful for initial setup or demos:</p> <pre><code># Push dashboards directly to Grafana\nnthlayer apply services/*.yaml --push\n\n# Push alert rules to Prometheus ruler API\nnthlayer apply services/*.yaml --push-ruler\n</code></pre> <p>Not recommended for production</p> <p>Push mode bypasses code review and has no audit trail. Use GitOps for production deployments.</p>"},{"location":"integrations/cicd/#github-actions","title":"GitHub Actions","text":""},{"location":"integrations/cicd/#complete-workflow","title":"Complete Workflow","text":"<pre><code>name: Deploy with Reliability Gates\n\non:\n  push:\n    branches: [main]\n    paths:\n      - 'services/**'\n\njobs:\n  validate:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Install NthLayer\n        run: pip install nthlayer\n\n      - name: Validate Service Specs\n        run: nthlayer validate-spec services/\n\n      - name: Generate Configs\n        run: nthlayer apply services/*.yaml --lint\n\n      - name: Upload Artifacts\n        uses: actions/upload-artifact@v4\n        with:\n          name: generated-configs\n          path: generated/\n\n  verify:\n    needs: validate\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Install NthLayer\n        run: pip install nthlayer\n\n      - name: Verify Metrics Exist\n        run: |\n          nthlayer verify services/*.yaml \\\n            --prometheus-url ${{ secrets.STAGING_PROMETHEUS_URL }}\n        env:\n          PROMETHEUS_USERNAME: ${{ secrets.PROMETHEUS_USERNAME }}\n          PROMETHEUS_PASSWORD: ${{ secrets.PROMETHEUS_PASSWORD }}\n\n  gate:\n    needs: verify\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Install NthLayer\n        run: pip install nthlayer\n\n      - name: Check Deployment Gate\n        id: gate\n        run: |\n          nthlayer check-deploy services/*.yaml \\\n            --prometheus-url ${{ secrets.PROD_PROMETHEUS_URL }}\n          echo \"exit_code=$?\" &gt;&gt; $GITHUB_OUTPUT\n        continue-on-error: true\n\n      - name: Block on Budget Exhausted\n        if: steps.gate.outputs.exit_code == '2'\n        run: |\n          echo \"::error::Deployment blocked - error budget exhausted\"\n          exit 1\n\n  deploy:\n    needs: gate\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Download Configs\n        uses: actions/download-artifact@v4\n        with:\n          name: generated-configs\n          path: generated/\n\n      - name: Deploy to Kubernetes\n        run: kubectl apply -f generated/\n</code></pre>"},{"location":"integrations/cicd/#reusable-action-coming-soon","title":"Reusable Action (Coming Soon)","text":"<pre><code>- uses: nthlayer/action@v1\n  with:\n    command: check-deploy\n    service-file: services/api.yaml\n    prometheus-url: ${{ secrets.PROMETHEUS_URL }}\n</code></pre>"},{"location":"integrations/cicd/#gitlab-ci","title":"GitLab CI","text":"<pre><code>stages:\n  - validate\n  - verify\n  - gate\n  - deploy\n\nvariables:\n  PIP_CACHE_DIR: \"$CI_PROJECT_DIR/.pip-cache\"\n\n.nthlayer:\n  image: python:3.11\n  before_script:\n    - pip install nthlayer\n\nvalidate:\n  extends: .nthlayer\n  stage: validate\n  script:\n    - nthlayer validate-spec services/\n    - nthlayer apply services/*.yaml --lint\n  artifacts:\n    paths:\n      - generated/\n\nverify:\n  extends: .nthlayer\n  stage: verify\n  script:\n    - nthlayer verify services/*.yaml --prometheus-url $STAGING_PROMETHEUS_URL\n\ngate:\n  extends: .nthlayer\n  stage: gate\n  script:\n    - |\n      nthlayer check-deploy services/*.yaml \\\n        --prometheus-url $PROD_PROMETHEUS_URL\n      EXIT_CODE=$?\n      if [ $EXIT_CODE -eq 2 ]; then\n        echo \"Deployment blocked - error budget exhausted\"\n        exit 1\n      fi\n  only:\n    - main\n\ndeploy:\n  stage: deploy\n  script:\n    - kubectl apply -f generated/\n  only:\n    - main\n  when: on_success\n</code></pre>"},{"location":"integrations/cicd/#argocd","title":"ArgoCD","text":""},{"location":"integrations/cicd/#presync-hook","title":"PreSync Hook","text":"<p>Block ArgoCD sync when error budget is exhausted:</p> <pre><code>apiVersion: batch/v1\nkind: Job\nmetadata:\n  name: nthlayer-gate\n  annotations:\n    argocd.argoproj.io/hook: PreSync\n    argocd.argoproj.io/hook-delete-policy: HookSucceeded\nspec:\n  template:\n    spec:\n      containers:\n        - name: check-deploy\n          image: ghcr.io/nthlayer/nthlayer:latest\n          command:\n            - nthlayer\n            - check-deploy\n            - /config/service.yaml\n            - --prometheus-url\n            - $(PROMETHEUS_URL)\n          envFrom:\n            - secretRef:\n                name: prometheus-credentials\n          volumeMounts:\n            - name: service-config\n              mountPath: /config\n      volumes:\n        - name: service-config\n          configMap:\n            name: service-yaml\n      restartPolicy: Never\n  backoffLimit: 0\n</code></pre>"},{"location":"integrations/cicd/#application-manifest","title":"Application Manifest","text":"<pre><code>apiVersion: argoproj.io/v1alpha1\nkind: Application\nmetadata:\n  name: payment-api\nspec:\n  source:\n    repoURL: https://github.com/org/repo\n    path: services/payment-api\n  syncPolicy:\n    automated:\n      prune: true\n      selfHeal: true\n    syncOptions:\n      - CreateNamespace=true\n</code></pre> <p>When the PreSync hook fails (exit code 2), ArgoCD blocks the sync.</p>"},{"location":"integrations/cicd/#tekton","title":"Tekton","text":""},{"location":"integrations/cicd/#task-definition","title":"Task Definition","text":"<pre><code>apiVersion: tekton.dev/v1\nkind: Task\nmetadata:\n  name: nthlayer-check-deploy\nspec:\n  params:\n    - name: service-file\n      type: string\n    - name: prometheus-url\n      type: string\n  steps:\n    - name: check\n      image: ghcr.io/nthlayer/nthlayer:latest\n      script: |\n        nthlayer check-deploy $(params.service-file) \\\n          --prometheus-url $(params.prometheus-url)\n\n        EXIT_CODE=$?\n        if [ $EXIT_CODE -eq 2 ]; then\n          echo \"Deployment blocked\"\n          exit 1\n        fi\n</code></pre>"},{"location":"integrations/cicd/#pipeline","title":"Pipeline","text":"<pre><code>apiVersion: tekton.dev/v1\nkind: Pipeline\nmetadata:\n  name: deploy-with-gates\nspec:\n  params:\n    - name: service-file\n      type: string\n    - name: prometheus-url\n      type: string\n\n  tasks:\n    - name: validate\n      taskRef:\n        name: nthlayer-validate\n\n    - name: generate\n      taskRef:\n        name: nthlayer-apply\n      runAfter: [validate]\n\n    - name: verify\n      taskRef:\n        name: nthlayer-verify\n      runAfter: [generate]\n\n    - name: gate\n      taskRef:\n        name: nthlayer-check-deploy\n      runAfter: [verify]\n      params:\n        - name: service-file\n          value: $(params.service-file)\n        - name: prometheus-url\n          value: $(params.prometheus-url)\n\n    - name: deploy\n      taskRef:\n        name: kubectl-apply\n      runAfter: [gate]\n</code></pre>"},{"location":"integrations/cicd/#jenkins","title":"Jenkins","text":"<pre><code>pipeline {\n    agent any\n\n    environment {\n        PROMETHEUS_URL = credentials('prometheus-url')\n    }\n\n    stages {\n        stage('Validate') {\n            steps {\n                sh 'pip install nthlayer'\n                sh 'nthlayer validate-spec services/'\n                sh 'nthlayer apply services/*.yaml --lint'\n            }\n        }\n\n        stage('Verify') {\n            steps {\n                sh \"\"\"\n                    nthlayer verify services/*.yaml \\\n                        --prometheus-url ${PROMETHEUS_URL}\n                \"\"\"\n            }\n        }\n\n        stage('Gate') {\n            steps {\n                script {\n                    def exitCode = sh(\n                        script: \"\"\"\n                            nthlayer check-deploy services/*.yaml \\\n                                --prometheus-url ${PROMETHEUS_URL}\n                        \"\"\",\n                        returnStatus: true\n                    )\n                    if (exitCode == 2) {\n                        error('Deployment blocked - error budget exhausted')\n                    }\n                }\n            }\n        }\n\n        stage('Deploy') {\n            steps {\n                sh 'kubectl apply -f generated/'\n            }\n        }\n    }\n}\n</code></pre>"},{"location":"integrations/cicd/#environment-variables","title":"Environment Variables","text":"<p>All CI/CD integrations support these environment variables:</p> Variable Description <code>PROMETHEUS_URL</code> Prometheus server URL <code>PROMETHEUS_USERNAME</code> Basic auth username <code>PROMETHEUS_PASSWORD</code> Basic auth password <code>GRAFANA_URL</code> Grafana server URL <code>GRAFANA_API_KEY</code> Grafana API key"},{"location":"integrations/cicd/#best-practices","title":"Best Practices","text":""},{"location":"integrations/cicd/#1-validate-early-protect-late","title":"1. Validate Early, Protect Late","text":"<pre><code>commit \u2192 validate-spec \u2192 apply --lint \u2192 verify \u2192 check-deploy \u2192 deploy\n           \u2191                               \u2191           \u2191\n       No Prometheus              Staging Prom   Prod Prom\n</code></pre>"},{"location":"integrations/cicd/#2-use-staging-for-verification","title":"2. Use Staging for Verification","text":"<p>Verify metrics exist in staging before checking production gates:</p> <pre><code>- name: Verify in Staging\n  run: nthlayer verify services/*.yaml --prometheus-url $STAGING_URL\n\n- name: Gate in Production\n  run: nthlayer check-deploy services/*.yaml --prometheus-url $PROD_URL\n</code></pre>"},{"location":"integrations/cicd/#3-cache-nthlayer-installation","title":"3. Cache NthLayer Installation","text":"<pre><code>- uses: actions/cache@v4\n  with:\n    path: ~/.cache/pip\n    key: ${{ runner.os }}-pip-nthlayer\n</code></pre>"},{"location":"integrations/cicd/#4-fail-fast","title":"4. Fail Fast","text":"<p>Put validation early in your pipeline to catch issues quickly.</p>"},{"location":"integrations/cicd/#see-also","title":"See Also","text":"<ul> <li>Deployment Gates</li> <li>Contract Verification</li> <li>Validation Overview</li> </ul>"},{"location":"integrations/grafana/","title":"Grafana Integration","text":"<p>NthLayer generates and optionally pushes dashboards to Grafana.</p>"},{"location":"integrations/grafana/#configuration","title":"Configuration","text":""},{"location":"integrations/grafana/#via-setup-wizard","title":"Via Setup Wizard","text":"<pre><code>nthlayer setup\n</code></pre>"},{"location":"integrations/grafana/#via-environment-variables","title":"Via Environment Variables","text":"<pre><code>export NTHLAYER_GRAFANA_URL=http://grafana:3000\nexport NTHLAYER_GRAFANA_API_KEY=glsa_xxxxxxxxxxxx\nexport NTHLAYER_GRAFANA_ORG_ID=1  # Optional, default: 1\n</code></pre>"},{"location":"integrations/grafana/#via-config-file","title":"Via Config File","text":"<pre><code># ~/.nthlayer/config.yaml\ngrafana:\n  default: default\n  profiles:\n    default:\n      url: http://localhost:3000\n      type: grafana\n      org_id: 1\n      api_key_secret: grafana/api_key\n</code></pre>"},{"location":"integrations/grafana/#supported-backends","title":"Supported Backends","text":"Type Description <code>grafana</code> Self-hosted Grafana <code>grafana-cloud</code> Grafana Cloud"},{"location":"integrations/grafana/#creating-an-api-key","title":"Creating an API Key","text":"<ol> <li>Go to Administration &gt; Service accounts</li> <li>Create a new service account</li> <li>Add a token with Editor role</li> <li>Copy the token (starts with <code>glsa_</code>)</li> </ol>"},{"location":"integrations/grafana/#dashboard-generation","title":"Dashboard Generation","text":""},{"location":"integrations/grafana/#generate-only-default","title":"Generate Only (Default)","text":"<pre><code>nthlayer apply payment-api.yaml\n</code></pre> <p>Creates <code>generated/payment-api/dashboard.json</code> - import manually to Grafana.</p>"},{"location":"integrations/grafana/#auto-push-to-grafana","title":"Auto-Push to Grafana","text":"<pre><code>nthlayer apply payment-api.yaml --push\n</code></pre> <p>Pushes directly to Grafana API.</p>"},{"location":"integrations/grafana/#dashboard-structure","title":"Dashboard Structure","text":"<p>Generated dashboards include:</p>"},{"location":"integrations/grafana/#slo-metrics-row","title":"SLO Metrics Row","text":"<ul> <li>Availability - Current vs target</li> <li>Error Budget - Remaining budget gauge</li> <li>Latency P99 - Current latency vs threshold</li> </ul>"},{"location":"integrations/grafana/#service-health-row","title":"Service Health Row","text":"<ul> <li>Request Rate - Requests per second</li> <li>Error Rate - 5xx errors percentage</li> <li>Active Connections - Current connections</li> <li>Saturation - Resource utilization</li> </ul>"},{"location":"integrations/grafana/#dependencies-row","title":"Dependencies Row","text":"<p>One row per dependency with technology-specific panels:</p> <ul> <li>PostgreSQL: Connections, replication lag, locks</li> <li>Redis: Memory usage, hit rate, connections</li> <li>Kafka: Consumer lag, partition status</li> </ul>"},{"location":"integrations/grafana/#dashboard-variables","title":"Dashboard Variables","text":"<p>Dashboards include variables for filtering:</p> Variable Description <code>$service</code> Service name <code>$environment</code> Environment (dev/staging/prod)"},{"location":"integrations/grafana/#manual-import","title":"Manual Import","text":"<p>If not using <code>--push</code>:</p> <ol> <li>Go to Dashboards &gt; Import</li> <li>Upload <code>generated/&lt;service&gt;/dashboard.json</code></li> <li>Select Prometheus data source</li> <li>Click Import</li> </ol>"},{"location":"integrations/grafana/#testing-connection","title":"Testing Connection","text":"<pre><code>nthlayer setup --test\n</code></pre> <pre><code>  Grafana (http://localhost:3000)\n    [OK] Connected - Org: Main Org\n</code></pre>"},{"location":"integrations/grafana/#troubleshooting","title":"Troubleshooting","text":""},{"location":"integrations/grafana/#invalid-api-key","title":"Invalid API Key","text":"<pre><code>[FAIL] Invalid API key\n</code></pre> <ul> <li>Verify token starts with <code>glsa_</code></li> <li>Check token has Editor role</li> <li>Ensure token isn't expired</li> </ul>"},{"location":"integrations/grafana/#dashboard-already-exists","title":"Dashboard Already Exists","text":"<p>Dashboards are upserted by UID. Existing dashboards with the same UID are updated.</p>"},{"location":"integrations/grafana/#wrong-organization","title":"Wrong Organization","text":"<p>Set <code>NTHLAYER_GRAFANA_ORG_ID</code> if using multiple orgs:</p> <pre><code>export NTHLAYER_GRAFANA_ORG_ID=2\n</code></pre>"},{"location":"integrations/mimir/","title":"Mimir/Cortex Integration","text":"<p>Push alert rules directly to Grafana Mimir or Cortex via the Ruler API.</p>"},{"location":"integrations/mimir/#overview","title":"Overview","text":"<p>NthLayer can push generated alert rules directly to Mimir or Cortex, eliminating the need for manual file deployment. This is ideal for GitOps workflows where you want to:</p> <ol> <li>Generate alerts from <code>service.yaml</code></li> <li>Push directly to Mimir/Cortex Ruler API</li> <li>Rules become active immediately</li> </ol>"},{"location":"integrations/mimir/#setup","title":"Setup","text":""},{"location":"integrations/mimir/#environment-variables","title":"Environment Variables","text":"<pre><code># Required: Mimir Ruler API URL\nexport MIMIR_RULER_URL=https://your-mimir:8080\n\n# Optional: Multi-tenant setups\nexport MIMIR_TENANT_ID=your-tenant\n\n# Optional: Authentication\nexport MIMIR_API_KEY=your-api-key          # Bearer token\n# OR\nexport MIMIR_USERNAME=your-username        # Basic auth\nexport MIMIR_PASSWORD=your-password\n</code></pre>"},{"location":"integrations/mimir/#usage","title":"Usage","text":""},{"location":"integrations/mimir/#push-alerts-to-mimir","title":"Push Alerts to Mimir","text":"<pre><code>nthlayer apply service.yaml --push-ruler\n</code></pre> <p>Output: <pre><code>Applied 4 resources in 0.3s \u2192 generated/payment-api/\n\nPushing alerts to Mimir Ruler...\n  URL: https://mimir:8080\n  Tenant: my-tenant\n  \u2713 Pushed 2 rule group(s) to namespace 'payment-api'\n</code></pre></p>"},{"location":"integrations/mimir/#combined-with-grafana-push","title":"Combined with Grafana Push","text":"<pre><code># Push dashboards to Grafana AND alerts to Mimir\nnthlayer apply service.yaml --push --push-ruler\n</code></pre>"},{"location":"integrations/mimir/#api-details","title":"API Details","text":"<p>NthLayer uses the Mimir Ruler API:</p> Endpoint Method Description <code>/api/v1/rules/{namespace}</code> POST Create/update rule groups <code>/api/v1/rules/{namespace}</code> DELETE Delete all rules in namespace <code>/api/v1/rules/{namespace}/{groupName}</code> DELETE Delete specific group <code>/api/v1/rules</code> GET List all rules <p>The namespace is set to the service name from <code>service.yaml</code>.</p>"},{"location":"integrations/mimir/#tekton-pipeline-example","title":"Tekton Pipeline Example","text":"<pre><code>apiVersion: tekton.dev/v1\nkind: Task\nmetadata:\n  name: nthlayer-apply\nspec:\n  params:\n    - name: service-file\n      type: string\n  steps:\n    - name: generate-and-push\n      image: python:3.11-slim\n      env:\n        - name: MIMIR_RULER_URL\n          valueFrom:\n            secretKeyRef:\n              name: mimir-credentials\n              key: url\n        - name: MIMIR_TENANT_ID\n          valueFrom:\n            secretKeyRef:\n              name: mimir-credentials\n              key: tenant-id\n        - name: MIMIR_API_KEY\n          valueFrom:\n            secretKeyRef:\n              name: mimir-credentials\n              key: api-key\n      script: |\n        pip install nthlayer\n        nthlayer apply $(params.service-file) --push-ruler --lint\n</code></pre>"},{"location":"integrations/mimir/#github-actions-example","title":"GitHub Actions Example","text":"<pre><code>jobs:\n  deploy-alerts:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Install NthLayer\n        run: pip install nthlayer\n\n      - name: Generate and Push Alerts\n        env:\n          MIMIR_RULER_URL: ${{ secrets.MIMIR_RULER_URL }}\n          MIMIR_TENANT_ID: ${{ secrets.MIMIR_TENANT_ID }}\n          MIMIR_API_KEY: ${{ secrets.MIMIR_API_KEY }}\n        run: |\n          nthlayer apply service.yaml --push-ruler --lint\n</code></pre>"},{"location":"integrations/mimir/#multi-tenant-setup","title":"Multi-Tenant Setup","text":"<p>For Mimir multi-tenant deployments, set the <code>MIMIR_TENANT_ID</code>:</p> <pre><code>export MIMIR_TENANT_ID=team-payments\nnthlayer apply payment-api.yaml --push-ruler\n</code></pre> <p>This sets the <code>X-Scope-OrgID</code> header on all API requests.</p>"},{"location":"integrations/mimir/#cortex-compatibility","title":"Cortex Compatibility","text":"<p>The Ruler API is compatible with both Grafana Mimir and Cortex. The same configuration works for either:</p> <pre><code># Mimir\nexport MIMIR_RULER_URL=https://mimir.example.com:8080\n\n# Cortex\nexport MIMIR_RULER_URL=https://cortex.example.com:9009\n</code></pre>"},{"location":"integrations/mimir/#troubleshooting","title":"Troubleshooting","text":""},{"location":"integrations/mimir/#connection-refused","title":"Connection Refused","text":"<pre><code>\u2717 Mimir error: Failed to connect to Mimir at https://mimir:8080/api/v1/rules/payment-api\n</code></pre> <ul> <li>Verify <code>MIMIR_RULER_URL</code> is correct</li> <li>Check network connectivity</li> <li>Ensure Ruler component is enabled in Mimir</li> </ul>"},{"location":"integrations/mimir/#authentication-failed","title":"Authentication Failed","text":"<pre><code>\u2717 Failed to push rules: 401 Unauthorized\n</code></pre> <ul> <li>Verify <code>MIMIR_API_KEY</code> or <code>MIMIR_USERNAME</code>/<code>MIMIR_PASSWORD</code></li> <li>Check tenant ID is correct for multi-tenant setups</li> </ul>"},{"location":"integrations/mimir/#invalid-yaml","title":"Invalid YAML","text":"<pre><code>\u2717 Failed to push rules: 400 Bad Request - invalid rule syntax\n</code></pre> <ul> <li>Run <code>nthlayer apply service.yaml --lint</code> first to validate</li> <li>Check PromQL queries are valid</li> </ul>"},{"location":"integrations/mimir/#see-also","title":"See Also","text":"<ul> <li>Prometheus Integration - Query metrics for verification</li> <li>Grafana Integration - Push dashboards</li> <li>CLI Reference - Full command options</li> </ul>"},{"location":"integrations/prometheus/","title":"Prometheus Integration","text":"<p>NthLayer uses Prometheus for metric discovery, SLO queries, and alert rules.</p>"},{"location":"integrations/prometheus/#configuration","title":"Configuration","text":""},{"location":"integrations/prometheus/#via-setup-wizard","title":"Via Setup Wizard","text":"<pre><code>nthlayer setup\n</code></pre>"},{"location":"integrations/prometheus/#via-environment-variables","title":"Via Environment Variables","text":"<pre><code>export NTHLAYER_PROMETHEUS_URL=http://prometheus:9090\n\n# If authentication required\nexport NTHLAYER_METRICS_USER=admin\nexport NTHLAYER_METRICS_PASSWORD=secret\n</code></pre>"},{"location":"integrations/prometheus/#via-config-file","title":"Via Config File","text":"<pre><code># ~/.nthlayer/config.yaml\nprometheus:\n  default: default\n  profiles:\n    default:\n      url: http://localhost:9090\n      type: prometheus\n    production:\n      url: https://prometheus-prod.example.com\n      type: prometheus\n      username: admin\n      password_secret: prometheus/password\n</code></pre>"},{"location":"integrations/prometheus/#supported-backends","title":"Supported Backends","text":"Type Description <code>prometheus</code> Standard Prometheus server <code>mimir</code> Grafana Mimir <code>grafana-cloud</code> Grafana Cloud Prometheus"},{"location":"integrations/prometheus/#what-nthlayer-generates","title":"What NthLayer Generates","text":""},{"location":"integrations/prometheus/#alert-rules","title":"Alert Rules","text":"<pre><code>groups:\n  - name: payment-api-alerts\n    rules:\n      - alert: PaymentApiHighErrorRate\n        expr: |\n          sum(rate(http_requests_total{service=\"payment-api\",status=~\"5..\"}[5m])) /\n          sum(rate(http_requests_total{service=\"payment-api\"}[5m])) &gt; 0.01\n        for: 5m\n        labels:\n          severity: critical\n          service: payment-api\n        annotations:\n          summary: High error rate on payment-api\n          description: Error rate is {{ $value | humanizePercentage }}\n</code></pre>"},{"location":"integrations/prometheus/#recording-rules","title":"Recording Rules","text":"<pre><code>groups:\n  - name: payment-api-recording\n    rules:\n      - record: service:http_requests:rate5m\n        expr: sum(rate(http_requests_total{service=\"payment-api\"}[5m]))\n      - record: service:http_errors:rate5m\n        expr: sum(rate(http_requests_total{service=\"payment-api\",status=~\"5..\"}[5m]))\n      - record: service:http_latency_p99:5m\n        expr: |\n          histogram_quantile(0.99,\n            sum by (le) (rate(http_request_duration_seconds_bucket{service=\"payment-api\"}[5m]))\n          )\n</code></pre>"},{"location":"integrations/prometheus/#slo-queries","title":"SLO Queries","text":"<p>NthLayer queries Prometheus for live SLO status:</p> <pre><code>nthlayer slo collect payment-api.yaml\n</code></pre> <p>Uses queries like:</p> <pre><code># Availability over 30 days\navg_over_time(\n  (\n    sum(rate(http_requests_total{service=\"payment-api\",status!~\"5..\"}[5m])) /\n    sum(rate(http_requests_total{service=\"payment-api\"}[5m]))\n  )[30d:5m]\n)\n</code></pre>"},{"location":"integrations/prometheus/#metric-discovery","title":"Metric Discovery","text":"<p>NthLayer discovers available metrics to customize dashboards:</p> <pre><code># Discovers metrics matching service label\nnthlayer plan payment-api.yaml --discover\n</code></pre>"},{"location":"integrations/prometheus/#testing-connection","title":"Testing Connection","text":"<pre><code>nthlayer setup --test\n</code></pre> <pre><code>  Prometheus (http://localhost:9090)\n    [OK] Connected (Prometheus 2.45.0)\n</code></pre>"},{"location":"integrations/prometheus/#troubleshooting","title":"Troubleshooting","text":""},{"location":"integrations/prometheus/#connection-refused","title":"Connection Refused","text":"<pre><code>[FAIL] Connection refused - is Prometheus running?\n</code></pre> <ul> <li>Verify Prometheus is running: <code>curl http://localhost:9090/-/healthy</code></li> <li>Check firewall rules</li> <li>Verify URL is correct</li> </ul>"},{"location":"integrations/prometheus/#authentication-failed","title":"Authentication Failed","text":"<pre><code>[FAIL] Authentication required\n</code></pre> <ul> <li>Set <code>NTHLAYER_METRICS_USER</code> and <code>NTHLAYER_METRICS_PASSWORD</code></li> <li>Or configure in <code>~/.nthlayer/config.yaml</code></li> </ul>"},{"location":"integrations/prometheus/#no-metrics-found","title":"No Metrics Found","text":"<ul> <li>Ensure your application exports metrics with <code>service</code> label</li> <li>Check metric names match expected patterns</li> </ul>"},{"location":"integrations/technologies/","title":"Supported Technologies","text":"<p>NthLayer includes pre-built monitoring templates for 18 technologies.</p>"},{"location":"integrations/technologies/#overview","title":"Overview","text":"Category Technologies Databases PostgreSQL, MySQL, MongoDB, Redis, Elasticsearch Message Queues Kafka, RabbitMQ, NATS, Pulsar Proxies/Load Balancers Nginx, HAProxy, Traefik Infrastructure Kubernetes, etcd, Consul"},{"location":"integrations/technologies/#databases","title":"Databases","text":""},{"location":"integrations/technologies/#postgresql","title":"PostgreSQL","text":"<pre><code>dependencies:\n  - postgresql\n</code></pre> <p>Generated Panels:</p> Panel Metric Active Connections <code>pg_stat_activity_count</code> Replication Lag <code>pg_replication_lag</code> Transactions/sec <code>pg_stat_database_xact_commit</code> Cache Hit Ratio <code>pg_stat_database_blks_hit</code> Dead Tuples <code>pg_stat_user_tables_n_dead_tup</code> <p>Alerts:</p> <ul> <li>High connection count (&gt; 80% of max)</li> <li>Replication lag &gt; 30s</li> <li>Low cache hit ratio (&lt; 90%)</li> </ul>"},{"location":"integrations/technologies/#mysql-mariadb","title":"MySQL / MariaDB","text":"<pre><code>dependencies:\n  - mysql\n  # or\n  - mariadb\n</code></pre> <p>Generated Panels:</p> Panel Metric Connections <code>mysql_global_status_threads_connected</code> Queries/sec <code>mysql_global_status_queries</code> Slow Queries <code>mysql_global_status_slow_queries</code> Replication Lag <code>mysql_slave_status_seconds_behind_master</code>"},{"location":"integrations/technologies/#mongodb","title":"MongoDB","text":"<pre><code>dependencies:\n  - mongodb\n</code></pre> <p>Generated Panels:</p> Panel Metric Connections <code>mongodb_connections</code> Operations/sec <code>mongodb_op_counters_total</code> Replication Lag <code>mongodb_replset_member_replication_lag</code> Document Operations <code>mongodb_mongod_metrics_document_total</code>"},{"location":"integrations/technologies/#redis","title":"Redis","text":"<pre><code>dependencies:\n  - redis\n</code></pre> <p>Generated Panels:</p> Panel Metric Memory Usage <code>redis_memory_used_bytes</code> Connected Clients <code>redis_connected_clients</code> Hit Rate <code>redis_keyspace_hits_total / (hits + misses)</code> Commands/sec <code>redis_commands_processed_total</code> Evictions <code>redis_evicted_keys_total</code>"},{"location":"integrations/technologies/#elasticsearch","title":"Elasticsearch","text":"<pre><code>dependencies:\n  - elasticsearch\n</code></pre> <p>Generated Panels:</p> Panel Metric Cluster Health <code>elasticsearch_cluster_health_status</code> JVM Heap <code>elasticsearch_jvm_memory_used_bytes</code> Indexing Rate <code>elasticsearch_indices_indexing_index_total</code> Search Rate <code>elasticsearch_indices_search_query_total</code> Pending Tasks <code>elasticsearch_cluster_health_number_of_pending_tasks</code>"},{"location":"integrations/technologies/#message-queues","title":"Message Queues","text":""},{"location":"integrations/technologies/#kafka","title":"Kafka","text":"<pre><code>dependencies:\n  - kafka\n</code></pre> <p>Generated Panels:</p> Panel Metric Consumer Lag <code>kafka_consumer_group_lag</code> Messages/sec <code>kafka_server_brokertopicmetrics_messagesin_total</code> Partitions <code>kafka_topic_partitions</code> Under-replicated <code>kafka_server_replicamanager_underreplicatedpartitions</code> <p>Alerts:</p> <ul> <li>Consumer lag &gt; 10,000 messages</li> <li>Under-replicated partitions &gt; 0</li> </ul>"},{"location":"integrations/technologies/#rabbitmq","title":"RabbitMQ","text":"<pre><code>dependencies:\n  - rabbitmq\n  # or\n  - rabbit\n</code></pre> <p>Generated Panels:</p> Panel Metric Queue Messages <code>rabbitmq_queue_messages</code> Consumers <code>rabbitmq_queue_consumers</code> Publish Rate <code>rabbitmq_channel_messages_published_total</code> Connections <code>rabbitmq_connections</code> Memory <code>rabbitmq_node_mem_used</code>"},{"location":"integrations/technologies/#nats","title":"NATS","text":"<pre><code>dependencies:\n  - nats\n</code></pre> <p>Generated Panels:</p> Panel Metric Connections <code>nats_connections</code> Messages In/Out <code>nats_messages_total</code> Bytes In/Out <code>nats_bytes_total</code> Subscriptions <code>nats_subscriptions</code> Slow Consumers <code>nats_slow_consumers</code>"},{"location":"integrations/technologies/#pulsar","title":"Pulsar","text":"<pre><code>dependencies:\n  - pulsar\n</code></pre> <p>Generated Panels:</p> Panel Metric Throughput In <code>pulsar_throughput_in</code> Throughput Out <code>pulsar_throughput_out</code> Message Backlog <code>pulsar_msg_backlog</code> Subscriptions <code>pulsar_subscriptions_count</code> Storage Size <code>pulsar_storage_size</code>"},{"location":"integrations/technologies/#proxies-load-balancers","title":"Proxies / Load Balancers","text":""},{"location":"integrations/technologies/#nginx","title":"Nginx","text":"<pre><code>dependencies:\n  - nginx\n</code></pre> <p>Generated Panels:</p> Panel Metric Requests/sec <code>nginx_http_requests_total</code> Active Connections <code>nginx_connections_active</code> Response Codes <code>nginx_http_requests_total</code> by status Request Duration <code>nginx_http_request_duration_seconds</code> Upstream Response Time <code>nginx_upstream_response_time</code>"},{"location":"integrations/technologies/#haproxy","title":"HAProxy","text":"<pre><code>dependencies:\n  - haproxy\n</code></pre> <p>Generated Panels:</p> Panel Metric Request Rate <code>haproxy_frontend_http_requests_total</code> Active Connections <code>haproxy_frontend_current_sessions</code> Response Time <code>haproxy_backend_response_time_average_seconds</code> Backend Status <code>haproxy_backend_up</code> Error Rate <code>haproxy_backend_http_responses_total{code=\"5xx\"}</code> Queue Length <code>haproxy_backend_current_queue</code>"},{"location":"integrations/technologies/#traefik","title":"Traefik","text":"<pre><code>dependencies:\n  - traefik\n</code></pre> <p>Generated Panels:</p> Panel Metric Requests/sec <code>traefik_service_requests_total</code> Request Duration <code>traefik_service_request_duration_seconds</code> Response Codes <code>traefik_service_requests_total</code> by code Open Connections <code>traefik_service_open_connections</code> Entrypoint Requests <code>traefik_entrypoint_requests_total</code>"},{"location":"integrations/technologies/#infrastructure","title":"Infrastructure","text":""},{"location":"integrations/technologies/#kubernetes","title":"Kubernetes","text":"<pre><code>dependencies:\n  - kubernetes\n</code></pre> <p>Generated Panels:</p> Panel Metric Pod Status <code>kube_pod_status_phase</code> Container Restarts <code>kube_pod_container_status_restarts_total</code> CPU Usage <code>container_cpu_usage_seconds_total</code> Memory Usage <code>container_memory_usage_bytes</code> PVC Usage <code>kubelet_volume_stats_used_bytes</code>"},{"location":"integrations/technologies/#etcd","title":"etcd","text":"<pre><code>dependencies:\n  - etcd\n</code></pre> <p>Generated Panels:</p> Panel Metric Leader Status <code>etcd_server_has_leader</code> DB Size <code>etcd_mvcc_db_total_size_in_bytes</code> Proposals <code>etcd_server_proposals_committed_total</code> WAL Fsync <code>etcd_disk_wal_fsync_duration_seconds</code> Network Peer RTT <code>etcd_network_peer_round_trip_time_seconds</code>"},{"location":"integrations/technologies/#consul","title":"Consul","text":"<pre><code>dependencies:\n  - consul\n</code></pre> <p>Generated Panels:</p> Panel Metric Leader <code>consul_raft_leader</code> Peers <code>consul_raft_peers</code> Services <code>consul_catalog_services</code> Health Checks <code>consul_health_checks_critical</code> RPC Rate <code>consul_rpc_request</code>"},{"location":"integrations/technologies/#adding-custom-technologies","title":"Adding Custom Technologies","text":"<p>See Service Specifications for extending with your own configurations.</p>"},{"location":"protect/","title":"Protect","text":"<p>Block risky deploys before they cause incidents.</p> <p>NthLayer's protection layer enforces reliability policies in production. When error budget is exhausted, deployments are blocked - automatically.</p>"},{"location":"protect/#the-protection-stack","title":"The Protection Stack","text":"Feature Command What It Does Deployment Gates <code>nthlayer check-deploy</code> Block deploys when budget exhausted Drift Detection <code>nthlayer drift</code> Detect reliability degradation trends SLO Portfolio <code>nthlayer portfolio</code> Org-wide reliability visibility Reliability Scorecard <code>nthlayer scorecard</code> Quantitative per-service reliability scores (0-100) Intelligent Alerts <code>nthlayer alerts</code> Context-aware alert evaluation and budget explanations Metric Recommendations <code>nthlayer recommend-metrics</code> Validate instrumentation coverage Error Budgets <code>nthlayer slo collect</code> Real-time budget consumption"},{"location":"protect/#why-deployment-gates","title":"Why Deployment Gates?","text":"<p>Traditional monitoring tells you after a deployment causes problems:</p> <pre><code>Deploy \u2192 Incident \u2192 Page \u2192 Investigate \u2192 Rollback \u2192 Postmortem\n                      \u2191\n               \"The deploy broke it\"\n</code></pre> <p>Deployment gates tell you before:</p> <pre><code>Check Budget \u2192 Block/Allow \u2192 Deploy\n      \u2191\n  \"Budget exhausted - don't deploy\"\n</code></pre>"},{"location":"protect/#quick-start","title":"Quick Start","text":""},{"location":"protect/#1-check-before-deploy","title":"1. Check Before Deploy","text":"<pre><code>nthlayer check-deploy services/payment-api.yaml \\\n  --prometheus-url http://prometheus:9090\n</code></pre> <p>Output: <pre><code>\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502  Deployment Gate: payment-api                                \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n\n  Tier:          critical\n  Window:        30d\n\n  SLO Status:\n    availability   99.87%  (target: 99.95%)   42% remaining   \u26a0 WARNING\n    latency_p99    187ms   (target: 200ms)    78% remaining   \u2713 OK\n\n  Decision: \u26a0 PROCEED WITH CAUTION\n  Exit code: 1\n</code></pre></p>"},{"location":"protect/#2-view-portfolio-health","title":"2. View Portfolio Health","text":"<pre><code>nthlayer portfolio --path services/\n</code></pre> <p>Output: <pre><code>\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502  NthLayer SLO Portfolio                                      \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n\n  Organization Health: 78% (14/18 services meeting SLOs)\n\n  By Tier:\n    Critical:  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2591\u2591  83% (5/6 services)\n    Standard:  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2591\u2591\u2591  75% (6/8 services)\n    Low:       \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2591\u2591\u2591  75% (3/4 services)\n\n  \u26a0 Services Needing Attention:\n    payment-api    availability  156% burned  EXHAUSTED\n    search-api     latency       95% burned   WARNING\n</code></pre></p>"},{"location":"protect/#exit-codes","title":"Exit Codes","text":"<p>Deployment gates use exit codes for CI/CD integration:</p> Code Decision Pipeline Action <code>0</code> Approved Deploy proceeds <code>1</code> Warning Deploy with caution <code>2</code> Blocked Fail pipeline"},{"location":"protect/#tier-based-thresholds","title":"Tier-Based Thresholds","text":"<p>Default thresholds vary by service tier:</p> Tier Warning Blocking Critical &lt;20% remaining &lt;10% remaining Standard &lt;20% remaining None (advisory) Low &lt;30% remaining None (advisory) <p>Critical services block deploys at 10% remaining budget. Lower tiers only warn.</p>"},{"location":"protect/#custom-policies","title":"Custom Policies","text":"<p>Override defaults with a <code>DeploymentGate</code> resource:</p> <pre><code>resources:\n  - kind: DeploymentGate\n    name: strict-gate\n    spec:\n      thresholds:\n        warning: 30\n        blocking: 15\n\n      conditions:\n        # Stricter during business hours\n        - name: business-hours\n          when: \"hour &gt;= 9 AND hour &lt;= 17 AND weekday\"\n          blocking: 20\n\n        # Complete freeze during incidents\n        - name: low-budget\n          when: \"budget_remaining &lt; 5\"\n          blocking: 100\n</code></pre>"},{"location":"protect/#cicd-integration","title":"CI/CD Integration","text":""},{"location":"protect/#github-actions","title":"GitHub Actions","text":"<pre><code>jobs:\n  deploy:\n    steps:\n      - name: Check Deployment Gate\n        run: |\n          nthlayer check-deploy services/api.yaml \\\n            --prometheus-url ${{ secrets.PROMETHEUS_URL }}\n\n      - name: Deploy\n        if: success()  # Only if gate passed\n        run: kubectl apply -f generated/\n</code></pre>"},{"location":"protect/#argocd-presync-hook","title":"ArgoCD PreSync Hook","text":"<pre><code>apiVersion: batch/v1\nkind: Job\nmetadata:\n  name: deployment-gate\n  annotations:\n    argocd.argoproj.io/hook: PreSync\nspec:\n  template:\n    spec:\n      containers:\n        - name: check\n          image: ghcr.io/nthlayer/nthlayer:latest\n          command:\n            - nthlayer\n            - check-deploy\n            - /config/service.yaml\n            - --prometheus-url\n            - $(PROMETHEUS_URL)\n</code></pre>"},{"location":"protect/#drift-detection","title":"Drift Detection","text":"<p>Deployment gates check the current budget state. Drift detection looks at trends over time:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Deployment Gate: \"Is budget OK right now?\"                         \u2502\n\u2502  Drift Detection: \"Is budget trending toward exhaustion?\"           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"protect/#analyze-drift","title":"Analyze Drift","text":"<pre><code>nthlayer drift services/payment-api.yaml \\\n  --prometheus-url http://prometheus:9090\n</code></pre> <p>Output: <pre><code>\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502  Drift Analysis: payment-api                                 \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n\n  Current Budget:     72.34%\n  Trend:              -0.52%/week\n  Pattern:            Gradual Decline\n  Days to Exhaustion: 138 days\n\n  \u26a0 Severity: WARN\n  Recommendation: Investigate recent changes.\n</code></pre></p>"},{"location":"protect/#drift-patterns","title":"Drift Patterns","text":"Pattern What It Means Action Gradual Decline Slow erosion over time Investigate technical debt Step Change Down Sudden drop (incident/bad deploy) Immediate investigation Volatile High variance, no trend Check for intermittent issues Stable No significant trend Continue monitoring"},{"location":"protect/#integrate-with-deployment-gates","title":"Integrate with Deployment Gates","text":"<p>Add drift analysis to your deployment gate check:</p> <pre><code>nthlayer check-deploy services/api.yaml \\\n  --prometheus-url http://prometheus:9090 \\\n  --include-drift\n</code></pre>"},{"location":"protect/#org-wide-drift-view","title":"Org-Wide Drift View","text":"<pre><code>nthlayer portfolio --drift --prometheus-url http://prometheus:9090\n</code></pre>"},{"location":"protect/#the-google-sre-connection","title":"The Google SRE Connection","text":"<p>NthLayer automates the Error Budget Policy from the Google SRE Book:</p> <p>\"If our SLO says we can have 0.1% downtime per month, and we've already used 0.08%, we should be very careful about deploying new features.\"</p> SRE Concept Manual Process NthLayer Automation Error Budget Policy Spreadsheet tracking <code>nthlayer check-deploy</code> Release Freeze Calendar reminders Automatic blocking Budget Visibility Monthly reports <code>nthlayer portfolio</code>"},{"location":"protect/#reliability-scorecard","title":"Reliability Scorecard","text":"<p>Quantify reliability across your organization with weighted scores:</p> <pre><code>nthlayer scorecard --prometheus-url http://prometheus:9090\n</code></pre> <p>Scores combine SLO compliance (40%), incident score (30%), deploy success (20%), and error budget (10%) into a 0-100 score per service. Use <code>--by-team</code> for team-level aggregation. Exit codes enable CI/CD gating: 0=good, 1=fair, 2=poor.</p> <p>See nthlayer scorecard for full reference.</p>"},{"location":"protect/#intelligent-alerts","title":"Intelligent Alerts","text":"<p>Evaluate alert rules and get context-aware explanations:</p> <pre><code># Evaluate alerts against live data\nnthlayer alerts evaluate services/payment-api.yaml \\\n  --prometheus-url http://prometheus:9090\n\n# Simulate burn and see what would fire\nnthlayer alerts test services/payment-api.yaml --simulate-burn 90\n</code></pre> <p>The explanation engine provides technology-specific investigation actions based on your service's dependencies and type.</p> <p>See nthlayer alerts for full reference.</p>"},{"location":"protect/#next-steps","title":"Next Steps","text":"<ul> <li>Deployment Gates - Full command reference</li> <li>Drift Detection - Trend analysis command</li> <li>SLO Portfolio - Organization-wide view</li> <li>Reliability Scorecard - Quantitative scoring</li> <li>Intelligent Alerts - Alert evaluation and simulation</li> <li>Error Budgets - Understanding SLOs</li> <li>CI/CD Integration - Pipeline examples</li> </ul>"},{"location":"reference/cli/","title":"CLI Reference","text":"<p>Complete command-line interface reference.</p>"},{"location":"reference/cli/#global-options","title":"Global Options","text":"<pre><code>nthlayer [--help] [--version] &lt;command&gt;\n</code></pre> Option Description <code>--help</code> Show help message <code>--version</code> Show version number"},{"location":"reference/cli/#commands","title":"Commands","text":""},{"location":"reference/cli/#apply","title":"apply","text":"<p>Generate reliability configs from service spec.</p> <pre><code>nthlayer apply &lt;service.yaml&gt; [options]\n</code></pre> Option Description <code>--push</code> Push dashboard to Grafana <code>--push-ruler</code> Push alerts to Mimir/Cortex Ruler API <code>--output-dir DIR</code> Custom output directory <code>--dry-run</code> Preview without writing <code>--lint</code> Validate generated alerts with pint"},{"location":"reference/cli/#setup","title":"setup","text":"<p>Interactive first-time setup.</p> <pre><code>nthlayer setup [options]\n</code></pre> Option Description <code>--quick</code> Simplified setup (default) <code>--advanced</code> Full configuration wizard <code>--test</code> Test connections only <code>--skip-service</code> Skip first service creation"},{"location":"reference/cli/#portfolio","title":"portfolio","text":"<p>View org-wide SLO health.</p> <pre><code>nthlayer portfolio [options]\n</code></pre> Option Description <code>--format FORMAT</code> Output: text, json, csv <code>--services-dir DIR</code> Directory to scan"},{"location":"reference/cli/#slo","title":"slo","text":"<p>SLO management commands.</p> <pre><code>nthlayer slo &lt;subcommand&gt; &lt;service.yaml&gt;\n</code></pre> Subcommand Description <code>show</code> Display SLO definitions <code>list</code> Brief SLO listing <code>collect</code> Query live metrics <p>Options for <code>collect</code>:</p> Option Description <code>--prometheus-url URL</code> Prometheus server <code>--window DURATION</code> Query window"},{"location":"reference/cli/#config","title":"config","text":"<p>Configuration management.</p> <pre><code>nthlayer config &lt;subcommand&gt;\n</code></pre> Subcommand Description <code>show</code> Show current config <code>init</code> Interactive wizard <code>set KEY VALUE</code> Set config value <p>Options for <code>show</code>:</p> Option Description <code>--reveal-secrets</code> Show secret values"},{"location":"reference/cli/#plan","title":"plan","text":"<p>Preview what would be generated.</p> <pre><code>nthlayer plan &lt;service.yaml&gt;\n</code></pre>"},{"location":"reference/cli/#validate","title":"validate","text":"<p>Validate service spec.</p> <pre><code>nthlayer validate &lt;service.yaml&gt;\n</code></pre>"},{"location":"reference/cli/#generate-dashboard","title":"generate-dashboard","text":"<p>Generate dashboard only.</p> <pre><code>nthlayer generate-dashboard &lt;service.yaml&gt; [options]\n</code></pre> Option Description <code>--push</code> Push to Grafana"},{"location":"reference/cli/#generate-alerts","title":"generate-alerts","text":"<p>Generate alerts only.</p> <pre><code>nthlayer generate-alerts &lt;service.yaml&gt;\n</code></pre>"},{"location":"reference/cli/#generate-slo","title":"generate-slo","text":"<p>Generate SLO definitions only.</p> <pre><code>nthlayer generate-slo &lt;service.yaml&gt;\n</code></pre>"},{"location":"reference/cli/#generate-recording-rules","title":"generate-recording-rules","text":"<p>Generate recording rules only.</p> <pre><code>nthlayer generate-recording-rules &lt;service.yaml&gt;\n</code></pre>"},{"location":"reference/cli/#verify","title":"verify","text":"<p>Verify declared metrics exist in Prometheus (contract verification).</p> <pre><code>nthlayer verify &lt;service.yaml&gt; [options]\n</code></pre> Option Description <code>--prometheus-url, -p URL</code> Target Prometheus URL <code>--env ENVIRONMENT</code> Environment name <code>--no-fail</code> Don't fail on missing metrics <p>Exit codes: - <code>0</code> = All metrics verified - <code>1</code> = Optional metrics missing (warning) - <code>2</code> = Critical SLO metrics missing (block)</p>"},{"location":"reference/cli/#validate-slo","title":"validate-slo","text":"<p>Validate that SLO metrics exist in Prometheus.</p> <pre><code>nthlayer validate-slo &lt;service.yaml&gt; [options]\n</code></pre> Option Description <code>--env ENVIRONMENT</code> Environment name <code>--format FORMAT</code> Output: table, json <code>--prometheus-url URL</code> Prometheus server URL <code>--demo</code> Show demo output <p>Exit codes: - <code>0</code> = All SLO metrics exist - <code>1</code> = Some metrics missing - <code>2</code> = Critical metrics missing</p>"},{"location":"reference/cli/#deps","title":"deps","text":"<p>Show service dependencies from multiple sources.</p> <pre><code>nthlayer deps &lt;service.yaml&gt; [options]\n</code></pre> Option Description <code>--env ENVIRONMENT</code> Environment name <code>--format FORMAT</code> Output: table, json, dot <code>--depth N</code> Traversal depth (default: 1) <code>--providers LIST</code> Providers: backstage, k8s, prometheus <code>--demo</code> Show demo output"},{"location":"reference/cli/#blast-radius","title":"blast-radius","text":"<p>Calculate deployment blast radius and affected services.</p> <pre><code>nthlayer blast-radius &lt;service.yaml&gt; [options]\n</code></pre> Option Description <code>--env ENVIRONMENT</code> Environment name <code>--format FORMAT</code> Output: table, json <code>--depth N</code> Traversal depth (default: 2) <code>--demo</code> Show demo output <p>Exit codes: - <code>0</code> = Low risk (&lt; 5 affected) - <code>1</code> = Medium risk (5-15 affected) - <code>2</code> = High risk (&gt; 15 affected)</p>"},{"location":"reference/cli/#ownership","title":"ownership","text":"<p>Resolve service ownership from multiple sources.</p> <pre><code>nthlayer ownership &lt;service.yaml&gt; [options]\n</code></pre> Option Description <code>--env ENVIRONMENT</code> Environment name <code>--format FORMAT</code> Output: table, json <code>--backstage-url URL</code> Backstage catalog URL <code>--demo</code> Show demo output"},{"location":"reference/cli/#identity","title":"identity","text":"<p>Service identity resolution and management.</p> <pre><code>nthlayer identity &lt;subcommand&gt; [options]\n</code></pre> Subcommand Description <code>resolve NAME</code> Resolve service to canonical name <code>list</code> List known service identities <code>normalize NAME</code> Show normalization steps <code>add-mapping ALIAS CANONICAL</code> Add identity mapping"},{"location":"reference/cli/#drift","title":"drift","text":"<p>Analyze reliability drift for a service.</p> <pre><code>nthlayer drift &lt;service.yaml&gt; [options]\n</code></pre> Option Description <code>--env ENVIRONMENT</code> Environment name <code>--format FORMAT</code> Output: table, json <code>--prometheus-url URL</code> Prometheus server URL <code>--baseline PERIOD</code> Baseline period (default: 30d) <code>--demo</code> Show demo output"},{"location":"reference/cli/#check-deploy","title":"check-deploy","text":"<p>Check deployment gate based on error budget.</p> <pre><code>nthlayer check-deploy &lt;service.yaml&gt; [options]\n</code></pre> Option Description <code>--prometheus-url, -p URL</code> Target Prometheus URL <code>--env ENVIRONMENT</code> Environment name <code>--auto-env</code> Auto-detect environment <p>Exit codes: - <code>0</code> = Approved (budget healthy) - <code>1</code> = Warning (budget 10-20% remaining) - <code>2</code> = Blocked (budget &lt; 10% for critical tier)</p>"},{"location":"reference/cli/#lint","title":"lint","text":"<p>Lint generated Prometheus rules.</p> <pre><code>nthlayer lint &lt;alerts.yaml&gt;\n</code></pre> <p>Uses pint for validation.</p>"},{"location":"reference/cli/#init","title":"init","text":"<p>Create new service spec from template.</p> <pre><code>nthlayer init [options]\n</code></pre> Option Description <code>--name NAME</code> Service name <code>--team TEAM</code> Team name <code>--template TEMPLATE</code> Template name"},{"location":"reference/cli/#list-templates","title":"list-templates","text":"<p>Show available templates.</p> <pre><code>nthlayer list-templates\n</code></pre>"},{"location":"reference/cli/#list-services","title":"list-services","text":"<p>List available services from demo data.</p> <pre><code>nthlayer list-services\n</code></pre>"},{"location":"reference/cli/#list-teams","title":"list-teams","text":"<p>List available teams from demo data.</p> <pre><code>nthlayer list-teams\n</code></pre>"},{"location":"reference/cli/#list-environments","title":"list-environments","text":"<p>List available environment configurations.</p> <pre><code>nthlayer list-environments [options]\n</code></pre> Option Description <code>--service FILE</code> Service YAML file to scope search <code>--directory DIR</code> Directory to search for environments"},{"location":"reference/cli/#diff-envs","title":"diff-envs","text":"<p>Compare configurations between two environments.</p> <pre><code>nthlayer diff-envs &lt;service.yaml&gt; &lt;env1&gt; &lt;env2&gt; [options]\n</code></pre> Option Description <code>--show-all</code> Show all fields, not just differences"},{"location":"reference/cli/#validate-env","title":"validate-env","text":"<p>Validate an environment configuration.</p> <pre><code>nthlayer validate-env &lt;environment&gt; [options]\n</code></pre> Option Description <code>--service FILE</code> Service file to test against <code>--directory DIR</code> Directory containing environments <code>--strict</code> Treat warnings as errors"},{"location":"reference/cli/#validate-spec","title":"validate-spec","text":"<p>Validate service.yaml against OPA/Rego policies.</p> <pre><code>nthlayer validate-spec &lt;service.yaml&gt; [options]\n</code></pre> Option Description <code>--policy-dir DIR</code> Directory containing .rego policies <code>--strict</code> Treat warnings as errors <p>Exit codes: - <code>0</code> = All policies pass - <code>1</code> = Policy violations found</p>"},{"location":"reference/cli/#validate-metadata","title":"validate-metadata","text":"<p>Validate Prometheus rule metadata (labels, annotations, URLs).</p> <pre><code>nthlayer validate-metadata &lt;alerts.yaml&gt; [options]\n</code></pre> Option Description <code>--check-urls</code> Verify runbook URLs are reachable <code>--strict</code> Treat warnings as errors"},{"location":"reference/cli/#generate-loki-alerts","title":"generate-loki-alerts","text":"<p>Generate Loki LogQL alert rules from service spec.</p> <pre><code>nthlayer generate-loki-alerts &lt;service.yaml&gt; [options]\n</code></pre> Option Description <code>--output-dir DIR</code> Output directory <code>--dry-run</code> Preview without writing"},{"location":"reference/cli/#secrets","title":"secrets","text":"<p>Secret management commands.</p> <pre><code>nthlayer secrets &lt;subcommand&gt;\n</code></pre> Subcommand Description <code>list</code> List available secrets <code>verify</code> Verify required secrets <code>set PATH</code> Set a secret <code>get PATH</code> Get a secret <code>migrate SOURCE TARGET</code> Migrate secrets"},{"location":"reference/cli/#environment-variables","title":"Environment Variables","text":"Variable Description <code>PROMETHEUS_URL</code> Prometheus server URL (for verify command) <code>PROMETHEUS_USERNAME</code> Prometheus basic auth username <code>PROMETHEUS_PASSWORD</code> Prometheus basic auth password <code>NTHLAYER_PROMETHEUS_URL</code> Prometheus server URL (legacy) <code>NTHLAYER_GRAFANA_URL</code> Grafana server URL <code>NTHLAYER_GRAFANA_API_KEY</code> Grafana API key <code>NTHLAYER_GRAFANA_ORG_ID</code> Grafana organization ID <code>MIMIR_RULER_URL</code> Mimir/Cortex Ruler API URL <code>MIMIR_TENANT_ID</code> Mimir tenant ID (multi-tenant) <code>MIMIR_API_KEY</code> Mimir API key (if auth required) <code>NTHLAYER_PROFILE</code> Config profile to use"},{"location":"reference/cli/#exit-codes","title":"Exit Codes","text":"Code Meaning <code>0</code> Success <code>1</code> General error <code>2</code> Invalid arguments <code>3</code> Configuration error <code>4</code> Connection error"},{"location":"reference/service-yaml/","title":"Service YAML Schema","text":"<p>Complete reference for service specification files.</p>"},{"location":"reference/service-yaml/#full-schema","title":"Full Schema","text":"<pre><code># Required fields\nname: string              # Service identifier (lowercase, hyphens)\ntier: integer | string    # 1/2/3 or critical/standard/low\ntype: string              # api, worker, stream\n\n# Optional fields\nteam: string              # Team name\ndescription: string       # Human-readable description\n\n# Technology dependencies\ndependencies:\n  - string                # postgresql, redis, kafka, etc.\n\n# Custom resource definitions\nresources:\n  - kind: string          # SLO, Alert, Dependencies\n    name: string          # Resource identifier\n    spec: object          # Resource-specific configuration\n\n# Environment-specific overrides\nenvironments:\n  production: object      # Override for production\n  staging: object         # Override for staging\n</code></pre>"},{"location":"reference/service-yaml/#field-reference","title":"Field Reference","text":""},{"location":"reference/service-yaml/#name","title":"name","text":"<p>Required | <code>string</code></p> <p>Service identifier. Must be:</p> <ul> <li>Lowercase letters, numbers, hyphens only</li> <li>Cannot start or end with hyphen</li> <li>Unique within your organization</li> </ul> <pre><code>name: payment-api        # Valid\nname: Payment-API        # Invalid (uppercase)\nname: -payment-api       # Invalid (starts with hyphen)\n</code></pre>"},{"location":"reference/service-yaml/#tier","title":"tier","text":"<p>Required | <code>integer</code> or <code>string</code></p> <p>Service priority level:</p> Value Meaning Default SLO <code>1</code> / <code>critical</code> Business-critical 99.95% <code>2</code> / <code>standard</code> Important 99.9% <code>3</code> / <code>low</code> Best-effort 99.5% <pre><code>tier: 1\n# or\ntier: critical\n</code></pre>"},{"location":"reference/service-yaml/#type","title":"type","text":"<p>Required | <code>string</code></p> <p>Service type determines default metrics and SLOs:</p> Type Description <code>api</code> HTTP/REST service <code>worker</code> Background job processor <code>stream</code> Event/message processor"},{"location":"reference/service-yaml/#team","title":"team","text":"<p>Optional | <code>string</code></p> <p>Team responsible for the service. Used for:</p> <ul> <li>Dashboard grouping</li> <li>Alert routing</li> <li>Scorecard aggregation</li> </ul> <pre><code>team: payments\n</code></pre>"},{"location":"reference/service-yaml/#dependencies","title":"dependencies","text":"<p>Optional | <code>list[string]</code></p> <p>Technology dependencies. Each adds dashboard panels and alerts.</p> <pre><code>dependencies:\n  - postgresql\n  - redis\n  - kafka\n</code></pre> <p>Supported values: See Technologies</p>"},{"location":"reference/service-yaml/#resources","title":"resources","text":"<p>Optional | <code>list[Resource]</code></p> <p>Custom resource definitions.</p>"},{"location":"reference/service-yaml/#slo-resource","title":"SLO Resource","text":"<pre><code>resources:\n  - kind: SLO\n    name: availability      # Unique name\n    spec:\n      objective: 99.95      # Target percentage\n      window: 30d           # Time window\n      threshold_ms: 200     # For latency SLOs\n      indicator:\n        type: availability  # availability, latency, throughput\n        percentile: 99      # For latency SLOs\n        query: |            # PromQL query\n          sum(rate(...))\n</code></pre>"},{"location":"reference/service-yaml/#alert-resource","title":"Alert Resource","text":"<pre><code>resources:\n  - kind: Alert\n    name: high-error-rate\n    spec:\n      expr: |               # PromQL expression\n        sum(rate(http_requests_total{status=~\"5..\"}[5m])) /\n        sum(rate(http_requests_total[5m])) &gt; 0.01\n      for: 5m               # Duration before firing\n      severity: critical    # critical, warning, info\n      labels:\n        team: payments\n      annotations:\n        summary: \"High error rate\"\n        description: \"{{ $value | humanizePercentage }}\"\n</code></pre>"},{"location":"reference/service-yaml/#dependencies-resource","title":"Dependencies Resource","text":"<pre><code>resources:\n  - kind: Dependencies\n    name: upstream\n    spec:\n      services:\n        - name: user-service\n          criticality: high\n        - name: inventory-service\n          criticality: medium\n</code></pre>"},{"location":"reference/service-yaml/#environments","title":"environments","text":"<p>Optional | <code>object</code></p> <p>Environment-specific overrides:</p> <pre><code>environments:\n  production:\n    tier: critical\n    resources:\n      - kind: SLO\n        name: availability\n        spec:\n          objective: 99.99\n\n  staging:\n    tier: standard\n    resources:\n      - kind: SLO\n        name: availability\n        spec:\n          objective: 99.5\n</code></pre>"},{"location":"reference/service-yaml/#complete-example","title":"Complete Example","text":"<pre><code>name: payment-api\nteam: payments\ntier: critical\ntype: api\ndescription: Handles payment processing\n\ndependencies:\n  - postgresql\n  - redis\n\nresources:\n  - kind: SLO\n    name: availability\n    spec:\n      objective: 99.95\n      window: 30d\n      indicator:\n        type: availability\n        query: |\n          sum(rate(http_requests_total{service=\"payment-api\",status!~\"5..\"}[5m])) /\n          sum(rate(http_requests_total{service=\"payment-api\"}[5m]))\n\n  - kind: SLO\n    name: latency-p99\n    spec:\n      objective: 99.0\n      window: 30d\n      threshold_ms: 200\n      indicator:\n        type: latency\n        percentile: 99\n        query: |\n          histogram_quantile(0.99,\n            sum by (le) (rate(http_request_duration_seconds_bucket{service=\"payment-api\"}[5m]))\n          )\n\n  - kind: Alert\n    name: high-error-rate\n    spec:\n      expr: |\n        sum(rate(http_requests_total{service=\"payment-api\",status=~\"5..\"}[5m])) /\n        sum(rate(http_requests_total{service=\"payment-api\"}[5m])) &gt; 0.01\n      for: 5m\n      severity: critical\n\nenvironments:\n  production:\n    resources:\n      - kind: SLO\n        name: availability\n        spec:\n          objective: 99.99\n</code></pre>"},{"location":"reference/service-yaml/#opensrm-format-srmv1","title":"OpenSRM Format (<code>srm/v1</code>)","text":"<p>NthLayer also supports the OpenSRM format \u2014 a richer, namespaced schema that adds contracts, deployment gates, ownership, and cross-service validation. Both formats are fully supported and auto-detected.</p>"},{"location":"reference/service-yaml/#opensrm-schema","title":"OpenSRM Schema","text":"<pre><code>apiVersion: srm/v1\nkind: ServiceReliabilityManifest\n\nmetadata:\n  name: string              # Service identifier\n  team: string              # Owning team\n  tier: string              # critical, standard, low\n  description: string       # Human-readable description\n  labels: object            # Arbitrary key-value labels\n  annotations: object       # Metadata annotations\n  template: string          # Optional base template name\n\nspec:\n  type: string              # api, worker, stream, ai-gate, batch, database, web\n\n  slos:                     # SLO definitions (map, not list)\n    &lt;slo-name&gt;:\n      target: number        # Target value\n      window: string        # Time window (e.g. 30d)\n      unit: string          # ms, percent (optional)\n      percentile: string    # p50, p99, etc. (optional)\n\n  contract:                 # External promises to consumers\n    availability: number    # e.g. 0.999 for 99.9%\n    latency:\n      p99: string           # e.g. 500ms\n\n  dependencies:             # Upstream dependencies\n    - name: string          # Dependency identifier\n      type: string          # database, cache, api, queue\n      critical: boolean     # Is this a critical dependency?\n      database_type: string # postgresql, mysql, etc. (for type: database)\n      slo:\n        availability: number\n\n  ownership:                # Team and escalation info\n    team: string\n    slack: string\n    email: string\n    escalation: string\n    pagerduty:\n      service_id: string\n      escalation_policy_id: string\n    runbook: string\n    documentation: string\n\n  observability:            # Metric and tracing config\n    metrics_prefix: string\n    logs_label: string\n    traces_service: string\n    prometheus_job: string\n    labels: object\n\n  deployment:               # Deployment configuration\n    environments: list      # Environment names\n    gates:\n      error_budget:\n        enabled: boolean\n        threshold: number   # Block if budget below this ratio\n      slo_compliance:\n        threshold: number\n      recent_incidents:\n        p1_max: integer\n        p2_max: integer\n        lookback: string    # e.g. 7d\n    rollback:\n      automatic: boolean\n      criteria:\n        error_rate_increase: string\n        latency_increase: string\n</code></pre>"},{"location":"reference/service-yaml/#opensrm-example","title":"OpenSRM Example","text":"<pre><code>apiVersion: srm/v1\nkind: ServiceReliabilityManifest\nmetadata:\n  name: payment-api\n  team: payments\n  tier: critical\nspec:\n  type: api\n  slos:\n    availability:\n      target: 99.95\n      window: 30d\n    latency:\n      target: 200\n      unit: ms\n      percentile: p99\n      window: 30d\n  contract:\n    availability: 0.999\n    latency:\n      p99: 500ms\n  dependencies:\n    - name: postgres-primary\n      type: database\n      critical: true\n      database_type: postgresql\n      slo:\n        availability: 99.99\n    - name: redis-cache\n      type: cache\n      critical: false\n  ownership:\n    team: payments\n    slack: \"#payments-oncall\"\n    runbook: https://wiki.example.com/runbooks/payment-api\n  deployment:\n    gates:\n      error_budget:\n        enabled: true\n        threshold: 0.10\n</code></pre> <p>See OpenSRM Format for a full guide and migration instructions.</p>"},{"location":"reference/service-yaml/#validation","title":"Validation","text":"<pre><code>nthlayer validate payment-api.yaml\n</code></pre>"},{"location":"validate/","title":"Validate","text":"<p>Catch reliability issues before deploy, not after incidents.</p> <p>NthLayer's validation layer ensures your reliability configuration is correct before it reaches production. This is the core of \"Shift Left\" - moving validation earlier in your pipeline.</p>"},{"location":"validate/#the-three-validation-layers","title":"The Three Validation Layers","text":"Layer Command What It Checks When to Use Syntax <code>nthlayer apply --lint</code> PromQL query validity Every commit Policy <code>nthlayer validate-spec</code> Service spec compliance Every commit Contract <code>nthlayer verify</code> Metrics exist in Prometheus Before promotion"},{"location":"validate/#validation-flow","title":"Validation Flow","text":"<pre><code>service.yaml\n     \u2502\n     \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Policy Check   \u2502  nthlayer validate-spec\n\u2502  (OPA/Rego)     \u2502  \"Is the spec well-formed?\"\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  PromQL Lint    \u2502  nthlayer apply --lint\n\u2502  (pint)         \u2502  \"Are queries valid?\"\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Contract       \u2502  nthlayer verify\n\u2502  Verification   \u2502  \"Do metrics exist?\"\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u25bc\n    Deploy \u2713\n</code></pre>"},{"location":"validate/#quick-start","title":"Quick Start","text":""},{"location":"validate/#1-validate-service-spec-no-prometheus-required","title":"1. Validate Service Spec (No Prometheus Required)","text":"<pre><code># Check policy compliance\nnthlayer validate-spec services/payment-api.yaml\n\n# Output:\n# \u2713 Required fields present (name, team, tier, type)\n# \u2713 Tier value valid (critical)\n# \u2713 SLO objectives within range\n</code></pre>"},{"location":"validate/#2-lint-generated-promql","title":"2. Lint Generated PromQL","text":"<pre><code># Generate and lint in one step\nnthlayer apply services/payment-api.yaml --lint\n\n# Output:\n# Applied 4 resources \u2192 generated/payment-api/\n# Validating with pint...\n# \u2713 12 rules validated\n</code></pre>"},{"location":"validate/#3-verify-metrics-exist-requires-prometheus","title":"3. Verify Metrics Exist (Requires Prometheus)","text":"<pre><code># Verify against staging Prometheus\nnthlayer verify services/payment-api.yaml \\\n  --prometheus-url http://prometheus:9090\n\n# Output:\n# \u2713 http_requests_total\n# \u2713 http_request_duration_seconds_bucket\n# Contract verification passed\n</code></pre>"},{"location":"validate/#cicd-integration","title":"CI/CD Integration","text":"<p>Add all three checks to your pipeline:</p> <pre><code># GitHub Actions\njobs:\n  validate:\n    steps:\n      - name: Policy Check\n        run: nthlayer validate-spec services/*.yaml\n\n      - name: Generate &amp; Lint\n        run: nthlayer apply services/*.yaml --lint\n\n      - name: Verify Contracts\n        run: |\n          nthlayer verify services/*.yaml \\\n            --prometheus-url ${{ secrets.STAGING_PROMETHEUS }}\n</code></pre>"},{"location":"validate/#exit-codes","title":"Exit Codes","text":"<p>All validation commands use consistent exit codes:</p> Code Meaning Pipeline Action <code>0</code> All checks passed Continue <code>1</code> Warnings (non-blocking) Continue with caution <code>2</code> Errors (blocking) Fail pipeline"},{"location":"validate/#next-steps","title":"Next Steps","text":"<ul> <li>Contract Verification - Verify metrics exist</li> <li>Policy Validation - OPA/Rego policy checks</li> <li>PromQL Linting - Syntax and best practices</li> </ul>"},{"location":"validate/linting/","title":"PromQL Linting","text":"<p>Validate PromQL query syntax and best practices before they reach Prometheus.</p>"},{"location":"validate/linting/#overview","title":"Overview","text":"<p>NthLayer integrates with pint to validate generated Prometheus rules. This catches:</p> <ul> <li>Syntax errors - Invalid PromQL that Prometheus would reject</li> <li>Missing metrics - References to metrics that don't exist</li> <li>Best practice violations - Queries that work but could be improved</li> </ul>"},{"location":"validate/linting/#usage","title":"Usage","text":""},{"location":"validate/linting/#lint-during-apply","title":"Lint During Apply","text":"<pre><code>nthlayer apply services/api.yaml --lint\n</code></pre> <p>Output: <pre><code>Applied 4 resources in 0.3s \u2192 generated/api/\n\nValidating alerts with pint...\n  \u2713 12 rules validated\n\n  \u26a0 [promql/series] Line 45: metric \"http_errors_total\" not found\n</code></pre></p>"},{"location":"validate/linting/#lint-existing-files","title":"Lint Existing Files","text":"<pre><code># Lint a specific file\npint lint generated/api/alerts.yaml\n\n# Lint all generated rules\npint lint generated/*/alerts.yaml\n</code></pre>"},{"location":"validate/linting/#what-gets-checked","title":"What Gets Checked","text":""},{"location":"validate/linting/#syntax-validation","title":"Syntax Validation","text":"<pre><code># Invalid - missing closing brace\n- alert: HighLatency\n  expr: histogram_quantile(0.99, sum(rate(http_duration_bucket[5m]))\n</code></pre> <pre><code>ERROR: promql/syntax - unexpected end of input\n</code></pre>"},{"location":"validate/linting/#series-existence","title":"Series Existence","text":"<pre><code># Warning - metric may not exist\n- alert: HighErrors\n  expr: rate(custom_errors_total[5m]) &gt; 0.1\n</code></pre> <pre><code>WARNING: promql/series - metric \"custom_errors_total\" not found\n</code></pre>"},{"location":"validate/linting/#best-practices","title":"Best Practices","text":"<pre><code># Warning - histogram_quantile without sum by (le)\n- alert: SlowRequests\n  expr: histogram_quantile(0.99, rate(http_duration_bucket[5m])) &gt; 1\n</code></pre> <pre><code>WARNING: promql/aggregate - histogram_quantile should use sum by (le)\n</code></pre>"},{"location":"validate/linting/#configuration","title":"Configuration","text":""},{"location":"validate/linting/#pint-configuration","title":"pint Configuration","text":"<p>Create <code>.pint.hcl</code> in your repo root:</p> <pre><code>prometheus \"default\" {\n  uri     = \"http://prometheus:9090\"\n  timeout = \"30s\"\n}\n\nrule {\n  # Require runbook_url on all alerts\n  annotation \"runbook_url\" {\n    severity = \"warning\"\n    required = true\n  }\n}\n\nrule {\n  # Require severity label\n  label \"severity\" {\n    severity = \"warning\"\n    required = true\n  }\n}\n</code></pre>"},{"location":"validate/linting/#nthlayer-integration","title":"NthLayer Integration","text":"<p>NthLayer automatically:</p> <ol> <li>Detects if <code>pint</code> is installed</li> <li>Runs validation when <code>--lint</code> flag is provided</li> <li>Reports results with severity levels</li> <li>Returns appropriate exit codes</li> </ol>"},{"location":"validate/linting/#installing-pint","title":"Installing pint","text":"<pre><code># macOS\nbrew install cloudflare/tap/pint\n\n# Linux\ncurl -sL https://github.com/cloudflare/pint/releases/latest/download/pint-linux-amd64.tar.gz | tar xz\n\n# Verify installation\npint version\n</code></pre>"},{"location":"validate/linting/#cicd-integration","title":"CI/CD Integration","text":""},{"location":"validate/linting/#github-actions","title":"GitHub Actions","text":"<pre><code>- name: Install pint\n  run: |\n    curl -sL https://github.com/cloudflare/pint/releases/latest/download/pint-linux-amd64.tar.gz | tar xz\n    sudo mv pint /usr/local/bin/\n\n- name: Generate and Lint\n  run: nthlayer apply services/*.yaml --lint\n</code></pre>"},{"location":"validate/linting/#pre-commit-hook","title":"Pre-commit Hook","text":"<pre><code># .pre-commit-config.yaml\nrepos:\n  - repo: local\n    hooks:\n      - id: nthlayer-lint\n        name: NthLayer PromQL Lint\n        entry: nthlayer apply --lint\n        language: system\n        files: services/.*\\.yaml$\n</code></pre>"},{"location":"validate/linting/#common-issues","title":"Common Issues","text":""},{"location":"validate/linting/#pint-not-found","title":"\"pint not found\"","text":"<pre><code>\u26a0 pint not installed, skipping PromQL validation\n  Install: brew install cloudflare/tap/pint\n</code></pre> <p>Install pint or skip linting with <code>--no-lint</code>.</p>"},{"location":"validate/linting/#prometheus-connection-failed","title":"\"Prometheus connection failed\"","text":"<p>pint needs Prometheus access to verify metric existence:</p> <pre><code># Provide Prometheus URL\nexport PROMETHEUS_URL=http://prometheus:9090\nnthlayer apply services/api.yaml --lint\n</code></pre> <p>Or disable series checks in <code>.pint.hcl</code>:</p> <pre><code>checks {\n  disabled = [\"promql/series\"]\n}\n</code></pre>"},{"location":"validate/linting/#see-also","title":"See Also","text":"<ul> <li>pint Documentation</li> <li>nthlayer apply</li> <li>Contract Verification</li> </ul>"}]}
