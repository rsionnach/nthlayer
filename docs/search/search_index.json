{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"NthLayer","text":"<p>Reliability at build time, not incident time.</p> <p>Shift reliability left into your CI/CD pipeline. Validate before deploy, not after incidents.</p>"},{"location":"#the-reliability-pipeline","title":"The Reliability Pipeline","text":"<pre><code>   service.yaml\n        \u2502\n        \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Generate \u2502 \u2500\u2500\u25b6 \u2502  Validate \u2502 \u2500\u2500\u25b6 \u2502  Protect  \u2502 \u2500\u2500\u25b6 Deploy\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n   apply            verify           check-deploy\n   init             validate-spec    portfolio\n                    --lint\n</code></pre> Stage What Happens Exit Code Generate Create dashboards, alerts, SLOs from YAML - Validate Verify specs, lint PromQL, check contracts 1 if invalid Protect Block deploys when error budget exhausted 2 if blocked"},{"location":"#the-problem","title":"The Problem","text":"<p>Teams deploy code without reliability validation:</p> <ul> <li>Alerts created after the first incident</li> <li>Dashboards built after users complain</li> <li>SLOs defined after budget is exhausted</li> <li>No gates to prevent risky deploys</li> </ul>"},{"location":"#the-solution","title":"The Solution","text":"<p>NthLayer shifts reliability left - from incident response to CI/CD:</p> service.yaml<pre><code>name: payment-api\ntier: critical\ntype: api\ndependencies:\n  - postgresql\n  - redis\n</code></pre> <pre><code># Generate \u2192 Validate \u2192 Protect \u2192 Deploy\nnthlayer apply service.yaml --lint\nnthlayer verify service.yaml --prometheus-url $PROM_URL\nnthlayer check-deploy service.yaml --prometheus-url $PROM_URL\nkubectl apply -f generated/\n</code></pre>"},{"location":"#what-gets-generated","title":"What Gets Generated","text":"Output Description Dashboards Grafana dashboards with technology-aware panels Alerts Prometheus alert rules with best-practice thresholds SLOs OpenSLO-compatible definitions with error budgets Recording Rules Pre-aggregated metrics for performance PagerDuty Teams, schedules, and escalation policies"},{"location":"#key-features","title":"Key Features","text":""},{"location":"#deployment-gates","title":"Deployment Gates","text":"<p>Block deploys when error budget is exhausted:</p> <p></p> <pre><code>nthlayer check-deploy service.yaml --prometheus-url $PROM_URL\n# Exit code: 0=approved, 1=warning, 2=blocked\n</code></pre>"},{"location":"#slo-portfolio","title":"SLO Portfolio","text":"<p>Track reliability across your entire organization:</p> <p></p> <pre><code>nthlayer portfolio --path services/\n</code></pre>"},{"location":"#contract-verification","title":"Contract Verification","text":"<p>Verify declared metrics exist before deploy:</p> <p></p> <pre><code>nthlayer verify service.yaml --prometheus-url $PROM_URL\n</code></pre>"},{"location":"#23-technology-templates","title":"23 Technology Templates","text":"<p>Pre-built monitoring for:</p> <ul> <li>Databases: PostgreSQL, MySQL, MongoDB, Redis, Elasticsearch</li> <li>Message Queues: Kafka, RabbitMQ, NATS, Pulsar</li> <li>Proxies: Nginx, HAProxy, Traefik</li> <li>Infrastructure: Kubernetes, etcd, Consul</li> </ul>"},{"location":"#cicd-integration","title":"CI/CD Integration","text":".github/workflows/deploy.yml<pre><code>jobs:\n  deploy:\n    steps:\n      - name: Validate Specs\n        run: nthlayer validate-spec services/\n\n      - name: Generate &amp; Lint\n        run: nthlayer apply services/*.yaml --lint\n\n      - name: Verify Metrics\n        run: nthlayer verify services/*.yaml --prometheus-url $PROM_URL\n\n      - name: Check Deploy Gate\n        run: nthlayer check-deploy services/*.yaml --prometheus-url $PROM_URL\n\n      - name: Deploy\n        if: success()\n        run: kubectl apply -f generated/\n</code></pre> <p>Integrates with GitHub Actions, GitLab CI, ArgoCD, Tekton, and Jenkins.</p>"},{"location":"#get-started","title":"Get Started","text":"<ul> <li> <p> Installation</p> <p>Install NthLayer with pip in 30 seconds</p> <p> Install</p> </li> <li> <p> Quick Start</p> <p>Generate your first dashboard in 5 minutes</p> <p> Quick Start</p> </li> <li> <p> Validate</p> <p>Catch issues before they reach production</p> <p> Validation</p> </li> <li> <p> Protect</p> <p>Block risky deploys with error budget gates</p> <p> Protection</p> </li> </ul>"},{"location":"#the-google-sre-connection","title":"The Google SRE Connection","text":"<p>NthLayer automates concepts from the Google SRE Book:</p> SRE Concept Manual Process NthLayer Automation Production Readiness Review Multi-week checklist <code>nthlayer verify</code> in CI Error Budget Policy Spreadsheet tracking <code>nthlayer check-deploy</code> gates Release Engineering Manual runbooks Generated artifacts + GitOps Monitoring Standards Wiki pages <code>service.yaml</code> spec"},{"location":"architecture/","title":"Architecture","text":"<p>This page provides visual documentation of NthLayer's architecture, workflows, and integrations.</p>"},{"location":"architecture/#platform-architecture","title":"Platform Architecture","text":"<p>The NthLayer platform sits between your service definitions and your observability stack, generating the complete reliability infrastructure.</p> <pre><code>flowchart TB\n    subgraph Git[\"\ud83d\udcc1 Git Repository\"]\n        specs[\"services/*.yaml\"]\n    end\n\n    subgraph NthLayer[\"\u2699\ufe0f NthLayer Platform\"]\n        reslayer[\"ResLayer\\nSLOs &amp; Error Budgets\"]\n        govlayer[\"GovLayer\\nPolicy Enforcement\"]\n        obslayer[\"ObserveLayer\\nMonitoring\"]\n    end\n\n    subgraph Observability[\"\u2601\ufe0f Observability Stack\"]\n        prometheus[\"Prometheus\"]\n        grafana[\"Grafana\"]\n        pagerduty[\"PagerDuty\"]\n        loki[\"Loki\"]\n    end\n\n    specs --&gt; reslayer\n    specs --&gt; govlayer\n    specs --&gt; obslayer\n\n    reslayer --&gt; prometheus\n    obslayer --&gt; grafana\n    obslayer --&gt; pagerduty\n    obslayer --&gt; loki</code></pre>"},{"location":"architecture/#apply-workflow","title":"Apply Workflow","text":"<p>When you run <code>nthlayer apply</code>, the following artifacts are generated from your service specification:</p> <pre><code>flowchart LR\n    subgraph Input[\"\ud83d\udcc4 Input\"]\n        yaml[\"service.yaml\"]\n    end\n\n    subgraph Processing[\"\u2699\ufe0f NthLayer Processing\"]\n        parser[\"Spec Parser\"]\n        slo_gen[\"SLO Generator\"]\n        alert_gen[\"Alert Generator\"]\n        dash_gen[\"Dashboard Builder\"]\n        pd_gen[\"PagerDuty Setup\"]\n    end\n\n    subgraph Output[\"\ud83d\udce6 Generated Artifacts\"]\n        slos[\"slos.yaml\"]\n        alerts[\"alerts.yaml\"]\n        dashboard[\"dashboard.json\"]\n        recording[\"recording-rules.yaml\"]\n        pd_config[\"pagerduty-config.json\"]\n    end\n\n    yaml --&gt; parser\n    parser --&gt; slo_gen\n    parser --&gt; alert_gen\n    parser --&gt; dash_gen\n    parser --&gt; pd_gen\n\n    slo_gen --&gt; slos\n    slo_gen --&gt; recording\n    alert_gen --&gt; alerts\n    dash_gen --&gt; dashboard\n    pd_gen --&gt; pd_config</code></pre>"},{"location":"architecture/#integration-architecture","title":"Integration Architecture","text":"<p>NthLayer integrates with your existing observability stack without requiring changes to your infrastructure:</p> <pre><code>flowchart TB\n    subgraph User[\"\ud83d\udc64 User Environment\"]\n        developer[\"Developer\"]\n        cicd[\"CI/CD Pipeline\"]\n        k8s[\"Kubernetes\"]\n    end\n\n    subgraph CLI[\"\ud83d\udda5\ufe0f NthLayer CLI\"]\n        apply[\"nthlayer apply\"]\n        portfolio[\"nthlayer portfolio\"]\n        setup[\"nthlayer setup\"]\n    end\n\n    subgraph Metrics[\"\ud83d\udcca Metrics Stack\"]\n        prom[\"Prometheus\"]\n        grafana[\"Grafana Cloud\"]\n        loki[\"Loki\"]\n    end\n\n    subgraph Incidents[\"\ud83d\udea8 Incident Management\"]\n        pagerduty[\"PagerDuty\"]\n        slack[\"Slack\"]\n    end\n\n    developer --&gt; apply\n    cicd --&gt; apply\n\n    apply --&gt; prom\n    apply --&gt; grafana\n    apply --&gt; pagerduty\n\n    portfolio --&gt; prom\n    setup --&gt; grafana\n    setup --&gt; pagerduty\n\n    pagerduty --&gt; slack\n    prom --&gt; grafana</code></pre>"},{"location":"architecture/#slo-portfolio-flow","title":"SLO Portfolio Flow","text":"<p>The portfolio command aggregates SLO health across all services:</p> <pre><code>flowchart LR\n    subgraph Services[\"\ud83d\udcc1 Service Definitions\"]\n        svc1[\"payment-api.yaml\"]\n        svc2[\"checkout-service.yaml\"]\n        svc3[\"notification-worker.yaml\"]\n    end\n\n    subgraph Collection[\"\u2699\ufe0f Portfolio Collection\"]\n        scanner[\"Service Scanner\"]\n        aggregator[\"SLO Aggregator\"]\n        health[\"Health Calculator\"]\n    end\n\n    subgraph Output[\"\ud83d\udce4 Output\"]\n        text[\"Terminal Output\"]\n        json[\"JSON Export\"]\n        csv[\"CSV Export\"]\n    end\n\n    svc1 --&gt; scanner\n    svc2 --&gt; scanner\n    svc3 --&gt; scanner\n\n    scanner --&gt; aggregator\n    aggregator --&gt; health\n\n    health --&gt; text\n    health --&gt; json\n    health --&gt; csv</code></pre>"},{"location":"architecture/#technology-support","title":"Technology Support","text":"<p>NthLayer generates technology-specific monitoring for 18+ technologies:</p> <pre><code>flowchart TB\n    subgraph Databases[\"\ud83d\uddc4\ufe0f Databases\"]\n        postgres[\"PostgreSQL\"]\n        mysql[\"MySQL\"]\n        mongodb[\"MongoDB\"]\n        elasticsearch[\"Elasticsearch\"]\n    end\n\n    subgraph Caches[\"\u26a1 Caches &amp; Queues\"]\n        redis[\"Redis\"]\n        kafka[\"Kafka\"]\n        rabbitmq[\"RabbitMQ\"]\n        nats[\"NATS\"]\n    end\n\n    subgraph Infra[\"\ud83c\udf10 Infrastructure\"]\n        nginx[\"Nginx\"]\n        haproxy[\"HAProxy\"]\n        traefik[\"Traefik\"]\n        k8s[\"Kubernetes\"]\n    end</code></pre>"},{"location":"architecture/#data-flow-summary","title":"Data Flow Summary","text":"<pre><code>flowchart LR\n    A[\"service.yaml\"] --&gt; B[\"nthlayer apply\"]\n    B --&gt; C[\"Prometheus Alerts\"]\n    B --&gt; D[\"Grafana Dashboard\"]\n    B --&gt; E[\"PagerDuty Setup\"]\n    B --&gt; F[\"Recording Rules\"]\n    B --&gt; G[\"SLO Definitions\"]\n\n    H[\"nthlayer portfolio\"] --&gt; I[\"Scan services/\"]\n    I --&gt; J[\"Aggregate SLOs\"]\n    J --&gt; K[\"Health Report\"]</code></pre>"},{"location":"demo/","title":"Live Demo","text":""},{"location":"demo/#20-hours-of-sre-work-in-5-minutes","title":"20 Hours of SRE Work in 5 Minutes","text":"<p>Define your service once. NthLayer generates SLOs, alerts, dashboards, recording rules, and runbooks\u2014with technology-specific best practices built in.</p> <ul> <li> <p> 99.6% Time Savings</p> </li> <li> <p> Tech-Aware (PostgreSQL, Redis, Kafka)</p> </li> <li> <p> One Command for Everything</p> </li> <li> <p> Real-Time Error Budget Tracking</p> </li> </ul>"},{"location":"demo/#live-grafana-dashboards","title":"Live Grafana Dashboards","text":"<p>See auto-generated dashboards for 6 production services. Each dashboard includes SLO metrics, service health, and technology-specific panels.</p> <ul> <li> <p> payment-api</p> <p>PostgreSQL + Redis</p> <p> View Dashboard</p> </li> <li> <p> checkout-service</p> <p>MySQL + Redis</p> <p> View Dashboard</p> </li> <li> <p> notification-worker</p> <p>Worker + Redis</p> <p> View Dashboard</p> </li> <li> <p> analytics-stream</p> <p>Stream + MongoDB</p> <p> View Dashboard</p> </li> <li> <p> identity-service</p> <p>PostgreSQL + Redis</p> <p> View Dashboard</p> </li> <li> <p> search-api</p> <p>Elasticsearch + Redis</p> <p> View Dashboard</p> </li> </ul> <p>Dashboard Structure</p> <p>Each dashboard is organized into: SLO Metrics \u2192 Service Health \u2192 Dependencies</p>"},{"location":"demo/#generated-alerts","title":"Generated Alerts","text":"<p>118 production-ready Prometheus alerts across all services, sourced from awesome-prometheus-alerts.</p> <ul> <li> <p>payment-api \u00b7 15 PostgreSQL alerts</p> <p>PostgresqlDown, PostgresqlRestarted, SlowQueries...</p> <p> View on GitHub</p> </li> <li> <p>checkout-service \u00b7 26 MySQL + Redis alerts</p> <p>MysqlDown, RedisMemoryHigh, ReplicationLag...</p> <p> View on GitHub</p> </li> <li> <p>notification-worker \u00b7 12 Redis alerts</p> <p>RedisDown, RedisMemoryHigh, TooManyConnections...</p> <p> View on GitHub</p> </li> <li> <p>analytics-stream \u00b7 19 MongoDB + Redis alerts</p> <p>MongodbDown, CursorsTimeouts, ReplicasetLag...</p> <p> View on GitHub</p> </li> <li> <p>identity-service \u00b7 27 PostgreSQL + Redis alerts</p> <p>PostgresqlDown, DeadLocks, RedisRejected...</p> <p> View on GitHub</p> </li> <li> <p>search-api \u00b7 19 Elasticsearch alerts</p> <p>ClusterRed, JvmHeapHigh, DiskSpaceLow...</p> <p> View on GitHub</p> </li> </ul>"},{"location":"demo/#slo-portfolio","title":"SLO Portfolio","text":"<p>Track org-wide reliability with tier-based health scoring:</p> <pre><code>================================================================================\n  NthLayer SLO Portfolio\n================================================================================\n\nOrganization Health: 78% (14/18 services meeting SLOs)\n\nBy Tier:\n  Critical:  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2591\u2591  83% (5/6 services)\n  Standard:  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2591\u2591\u2591  75% (6/8 services)\n  Low:       \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2591\u2591\u2591  75% (3/4 services)\n\n--------------------------------------------------------------------------------\nServices Needing Attention:\n--------------------------------------------------------------------------------\n\n  payment-api (Tier 1)\n    availability: 156% budget burned - EXHAUSTED\n    Remaining: -12.5 hours\n\n  search-api (Tier 2)\n    latency-p99: 95% budget burned - WARNING\n    Remaining: 1.2 hours\n\n--------------------------------------------------------------------------------\nTotal: 18 services, 16 with SLOs, 45 SLOs\n</code></pre> <p>Cross-Vendor Aggregation</p> <p>Why this matters: PagerDuty can't give you this view\u2014they want you locked into their ecosystem. NthLayer aggregates SLOs across any backend (Prometheus, Datadog, etc.) in a single, vendor-neutral portfolio.</p>"},{"location":"demo/#pagerduty-integration","title":"PagerDuty Integration","text":"<p>Complete incident response setup with tier-based escalation policies.</p> <ul> <li> <p> Team Management</p> <p>Auto-creates teams with manager roles assigned to API key owner</p> </li> <li> <p> On-Call Schedules</p> <p>Primary, secondary, and manager schedules with weekly rotation</p> </li> <li> <p> Tier-Based Timing</p> <p>Critical: 5\u219215\u219230min | High: 15\u219230\u219260min | Low: 60min only</p> </li> <li> <p> Service Linking</p> <p>Services linked to escalation policies with urgency settings</p> </li> </ul>"},{"location":"demo/#support-models","title":"Support Models","text":"Model Description <code>self</code> Team handles all alerts 24/7 <code>shared</code> Team (day) + SRE (off-hours) <code>sre</code> SRE handles all alerts <code>business_hours</code> Team (9-5) + low-priority queue"},{"location":"demo/#what-gets-generated","title":"What Gets Generated","text":"<p>From a single <code>service.yaml</code>, NthLayer generates:</p> Output Description Example Dashboard 22 panels: health, SLOs, latency, errors, dependencies View JSON SLOs 3 SLOs with 30-day error budgets and burn rate calculations View YAML Alerts 15 PostgreSQL alerts with service labels and severity routing View YAML Recording Rules 21 pre-aggregated metrics for 10x faster dashboard queries View YAML"},{"location":"demo/#try-it-yourself","title":"Try It Yourself","text":"<pre><code># Install NthLayer\npipx install nthlayer\n\n# Interactive setup (configures Prometheus, Grafana, PagerDuty)\nnthlayer setup\n\n# Generate configs for your service\nnthlayer apply payment-api.yaml\n\n# View org-wide SLO health\nnthlayer portfolio\n</code></pre> <ul> <li> <p> Get Started</p> <p>Install NthLayer and generate your first reliability stack</p> <p> Installation Guide</p> </li> <li> <p> Full Documentation</p> <p>Comprehensive guides for all features</p> <p> Documentation</p> </li> </ul>"},{"location":"commands/","title":"Commands Overview","text":"<p>NthLayer provides a comprehensive CLI for managing your reliability stack.</p>"},{"location":"commands/#core-commands","title":"Core Commands","text":"Command Description <code>nthlayer apply</code> Generate all configs from service spec <code>nthlayer setup</code> Interactive first-time setup <code>nthlayer portfolio</code> View org-wide SLO health <code>nthlayer slo</code> Query and manage SLOs <code>nthlayer config</code> Manage configuration"},{"location":"commands/#quick-reference","title":"Quick Reference","text":"<pre><code># Generate configs\nnthlayer apply service.yaml\n\n# Interactive setup\nnthlayer setup\n\n# View portfolio\nnthlayer portfolio\n\n# Check SLO status\nnthlayer slo show service.yaml\nnthlayer slo collect service.yaml\n\n# Manage config\nnthlayer config show\nnthlayer config init\n</code></pre>"},{"location":"commands/#getting-help","title":"Getting Help","text":"<pre><code>nthlayer --help\nnthlayer &lt;command&gt; --help\n</code></pre>"},{"location":"commands/apply/","title":"nthlayer apply","text":"<p>Generate all reliability configs from a service specification.</p>"},{"location":"commands/apply/#usage","title":"Usage","text":"<pre><code>nthlayer apply &lt;service.yaml&gt; [options]\n</code></pre>"},{"location":"commands/apply/#options","title":"Options","text":"Option Description <code>--push</code> Push dashboard to Grafana after generation <code>--output-dir DIR</code> Output directory (default: <code>generated/&lt;service&gt;</code>) <code>--dry-run</code> Show what would be generated without writing"},{"location":"commands/apply/#examples","title":"Examples","text":""},{"location":"commands/apply/#basic-generation","title":"Basic Generation","text":"<pre><code>nthlayer apply payment-api.yaml\n</code></pre> <p>Output: <pre><code>Generated: generated/payment-api/\n\u251c\u2500\u2500 dashboard.json       # Grafana dashboard\n\u251c\u2500\u2500 alerts.yaml          # Prometheus alert rules\n\u251c\u2500\u2500 slos.yaml            # OpenSLO definitions\n\u2514\u2500\u2500 recording-rules.yaml # Prometheus recording rules\n</code></pre></p>"},{"location":"commands/apply/#push-to-grafana","title":"Push to Grafana","text":"<pre><code>nthlayer apply payment-api.yaml --push\n</code></pre> <p>Requires <code>NTHLAYER_GRAFANA_URL</code> and <code>NTHLAYER_GRAFANA_API_KEY</code> to be configured.</p>"},{"location":"commands/apply/#custom-output-directory","title":"Custom Output Directory","text":"<pre><code>nthlayer apply payment-api.yaml --output-dir ./configs/payment-api\n</code></pre>"},{"location":"commands/apply/#what-gets-generated","title":"What Gets Generated","text":""},{"location":"commands/apply/#dashboard-dashboardjson","title":"Dashboard (dashboard.json)","text":"<p>A Grafana dashboard with:</p> <ul> <li>SLO Metrics Row: Availability, latency, error budget</li> <li>Service Health Row: Request rate, active connections, saturation</li> <li>Dependencies Row: Panels for each configured dependency (PostgreSQL, Redis, etc.)</li> </ul>"},{"location":"commands/apply/#alerts-alertsyaml","title":"Alerts (alerts.yaml)","text":"<p>Prometheus alert rules including:</p> <ul> <li>High error rate alerts</li> <li>Latency threshold alerts</li> <li>Error budget burn rate alerts</li> <li>Dependency-specific alerts (e.g., PostgreSQL replication lag)</li> </ul>"},{"location":"commands/apply/#slos-slosyaml","title":"SLOs (slos.yaml)","text":"<p>OpenSLO-compatible definitions:</p> <pre><code>apiVersion: openslo/v1\nkind: SLO\nmetadata:\n  name: payment-api-availability\nspec:\n  service: payment-api\n  indicator:\n    metadata:\n      name: availability\n    spec:\n      ratioMetric:\n        good:\n          metricSource:\n            type: prometheus\n            spec:\n              query: sum(rate(http_requests_total{service=\"payment-api\",status!~\"5..\"}[5m]))\n        total:\n          metricSource:\n            type: prometheus\n            spec:\n              query: sum(rate(http_requests_total{service=\"payment-api\"}[5m]))\n  objectives:\n    - target: 0.9995\n      window: 30d\n</code></pre>"},{"location":"commands/apply/#recording-rules-recording-rulesyaml","title":"Recording Rules (recording-rules.yaml)","text":"<p>Pre-aggregated metrics for dashboard performance:</p> <pre><code>groups:\n  - name: payment-api-recording\n    rules:\n      - record: service:http_requests:rate5m\n        expr: sum(rate(http_requests_total{service=\"payment-api\"}[5m]))\n      - record: service:http_errors:rate5m\n        expr: sum(rate(http_requests_total{service=\"payment-api\",status=~\"5..\"}[5m]))\n</code></pre>"},{"location":"commands/apply/#see-also","title":"See Also","text":"<ul> <li>Service YAML Schema - Full spec reference</li> <li>CLI Reference - All commands</li> </ul>"},{"location":"commands/check-deploy/","title":"check-deploy","text":"<p>Check if deployment should be allowed based on error budget.</p>"},{"location":"commands/check-deploy/#synopsis","title":"Synopsis","text":"<pre><code>nthlayer check-deploy &lt;service-file&gt; [options]\n</code></pre>"},{"location":"commands/check-deploy/#description","title":"Description","text":"<p>The <code>check-deploy</code> command queries Prometheus for SLO metrics, calculates error budget consumption, and determines if deployment should proceed.</p> <p>This enables Shift Left reliability - catching issues before they reach production by blocking deploys when error budget is exhausted.</p>"},{"location":"commands/check-deploy/#exit-codes","title":"Exit Codes","text":"Code Result Meaning 0 Approved Budget healthy, safe to deploy 1 Warning Budget low, deploy with caution 2 Blocked Budget exhausted, do not deploy"},{"location":"commands/check-deploy/#options","title":"Options","text":"Option Description <code>--prometheus-url URL</code> Prometheus server URL (or use <code>PROMETHEUS_URL</code> env var) <code>--environment ENV</code> Environment name (dev, staging, prod) <code>--demo</code> Show demo output with sample data"},{"location":"commands/check-deploy/#examples","title":"Examples","text":""},{"location":"commands/check-deploy/#basic-check","title":"Basic Check","text":"<pre><code>nthlayer check-deploy services/payment-api.yaml \\\n  --prometheus-url http://prometheus:9090\n</code></pre>"},{"location":"commands/check-deploy/#with-environment","title":"With Environment","text":"<pre><code>nthlayer check-deploy services/api.yaml \\\n  --prometheus-url http://prometheus:9090 \\\n  --environment prod\n</code></pre>"},{"location":"commands/check-deploy/#cicd-integration","title":"CI/CD Integration","text":"<pre><code># In GitHub Actions, GitLab CI, etc.\nnthlayer check-deploy services/api.yaml \\\n  --prometheus-url \"$PROMETHEUS_URL\"\n\nif [ $? -eq 2 ]; then\n  echo \"Deployment blocked - error budget exhausted\"\n  exit 1\nfi\n</code></pre>"},{"location":"commands/check-deploy/#custom-thresholds","title":"Custom Thresholds","text":"<p>Override default tier-based thresholds with a <code>DeploymentGate</code> resource:</p> <pre><code># service.yaml\nresources:\n  - kind: DeploymentGate\n    name: custom-gate\n    spec:\n      thresholds:\n        warning: 30    # Warn when &lt;30% budget remaining\n        blocking: 5    # Block when &lt;5% budget remaining\n</code></pre>"},{"location":"commands/check-deploy/#conditional-policies","title":"Conditional Policies","text":"<p>Add time-based or context-aware conditions:</p> <pre><code>resources:\n  - kind: DeploymentGate\n    name: smart-gate\n    spec:\n      thresholds:\n        warning: 20\n        blocking: 10\n\n      conditions:\n        # Stricter during business hours\n        - name: business-hours\n          when: \"hour &gt;= 9 AND hour &lt;= 17 AND weekday\"\n          blocking: 15\n\n        # Complete freeze during holidays\n        - name: holiday-freeze\n          when: \"freeze_period('2024-12-20', '2025-01-02')\"\n          blocking: 100\n\n      exceptions:\n        # SRE can bypass gate\n        - team: sre-oncall\n          allow: always\n</code></pre>"},{"location":"commands/check-deploy/#condition-language","title":"Condition Language","text":"<p>The condition evaluator supports:</p>"},{"location":"commands/check-deploy/#comparisons","title":"Comparisons","text":"<pre><code>hour &gt;= 9\nbudget_remaining &lt; 20\ntier == 'critical'\n</code></pre>"},{"location":"commands/check-deploy/#boolean-operators","title":"Boolean Operators","text":"<pre><code>hour &gt;= 9 AND hour &lt;= 17\nweekday OR environment == 'dev'\nNOT freeze_period\n</code></pre>"},{"location":"commands/check-deploy/#built-in-functions","title":"Built-in Functions","text":"<pre><code>business_hours()                           # Mon-Fri 9-17\nweekday()                                  # Mon-Fri\nfreeze_period('2024-12-20', '2025-01-02') # Date range\n</code></pre>"},{"location":"commands/check-deploy/#available-variables","title":"Available Variables","text":"Variable Description <code>hour</code> Current hour (0-23) <code>weekday</code> True if Mon-Fri <code>date</code> Current date (YYYY-MM-DD) <code>budget_remaining</code> Budget remaining % <code>budget_consumed</code> Budget consumed % <code>tier</code> Service tier <code>environment</code> Deployment environment <code>downstream_count</code> Number of downstream services"},{"location":"commands/check-deploy/#environment-variables","title":"Environment Variables","text":"Variable Description <code>PROMETHEUS_URL</code> Prometheus server URL <code>PROMETHEUS_USERNAME</code> Basic auth username <code>PROMETHEUS_PASSWORD</code> Basic auth password"},{"location":"commands/check-deploy/#cicd-integrations","title":"CI/CD Integrations","text":"<p>See the CI/CD integration examples for:</p> <ul> <li>GitHub Actions</li> <li>ArgoCD (PreSync hook)</li> <li>GitLab CI</li> <li>Tekton</li> </ul>"},{"location":"commands/check-deploy/#see-also","title":"See Also","text":"<ul> <li>Deployment Gates Concept</li> <li>SLO Command</li> <li>Portfolio Command</li> </ul>"},{"location":"commands/config/","title":"nthlayer config","text":"<p>Manage NthLayer configuration.</p>"},{"location":"commands/config/#commands","title":"Commands","text":"<pre><code>nthlayer config show              # Show current configuration\nnthlayer config init              # Interactive configuration wizard\nnthlayer config set KEY VALUE     # Set a configuration value\n</code></pre>"},{"location":"commands/config/#nthlayer-config-show","title":"nthlayer config show","text":"<p>Display current configuration:</p> <pre><code>nthlayer config show\n</code></pre> <pre><code>============================================================\n  NthLayer Configuration\n============================================================\n\nConfig file: /Users/you/.nthlayer/config.yaml\n\nPrometheus:\n  Default profile: default\n  [default] *\n    Type: prometheus\n    URL: http://localhost:9090\n\nGrafana:\n  Default profile: default\n  [default] *\n    Type: grafana\n    URL: http://localhost:3000\n    Org ID: 1\n    API Key: ****\n\nAlerting:\n  PagerDuty: enabled\n    Escalation Policy: P123ABC\n  Slack: disabled\n  Datadog: disabled\n</code></pre>"},{"location":"commands/config/#reveal-secrets","title":"Reveal Secrets","text":"<pre><code>nthlayer config show --reveal-secrets\n</code></pre>"},{"location":"commands/config/#nthlayer-config-init","title":"nthlayer config init","text":"<p>Interactive wizard for advanced configuration:</p> <pre><code>nthlayer config init\n</code></pre> <p>This is the advanced version of <code>nthlayer setup</code> with options for:</p> <ul> <li>Multiple environment profiles</li> <li>Cloud secret backends (Vault, AWS, Azure, GCP, Doppler)</li> <li>Detailed alerting configuration</li> </ul>"},{"location":"commands/config/#nthlayer-config-set","title":"nthlayer config set","text":"<p>Set individual configuration values:</p> <pre><code># Set Prometheus URL\nnthlayer config set prometheus.profiles.default.url http://prometheus:9090\n\n# Set Grafana API key (prompts for secret)\nnthlayer config set grafana.profiles.default.api_key --secret\n\n# Enable PagerDuty\nnthlayer config set alerting.pagerduty.enabled true\n</code></pre>"},{"location":"commands/config/#configuration-file","title":"Configuration File","text":"<p>Located at <code>~/.nthlayer/config.yaml</code>:</p> <pre><code>prometheus:\n  default: default\n  profiles:\n    default:\n      name: default\n      type: prometheus\n      url: http://localhost:9090\n    production:\n      name: production\n      type: grafana-cloud\n      url: https://prometheus-prod.grafana.net\n      username: 12345\n      password_secret: prometheus/prod/password\n\ngrafana:\n  default: default\n  profiles:\n    default:\n      name: default\n      type: grafana\n      url: http://localhost:3000\n      org_id: 1\n      api_key_secret: grafana/api_key\n\nalerting:\n  pagerduty:\n    enabled: true\n    api_key_secret: pagerduty/api_key\n    default_escalation_policy: P123ABC\n  slack:\n    enabled: false\n    webhook_url_secret: slack/webhook_url\n    default_channel: \"#alerts\"\n  datadog:\n    enabled: false\n</code></pre>"},{"location":"commands/config/#environment-variables","title":"Environment Variables","text":"<p>Override configuration with environment variables:</p> <pre><code># Prometheus\nexport NTHLAYER_PROMETHEUS_URL=http://prometheus:9090\n\n# Grafana\nexport NTHLAYER_GRAFANA_URL=http://grafana:3000\nexport NTHLAYER_GRAFANA_API_KEY=glsa_xxxxx\nexport NTHLAYER_GRAFANA_ORG_ID=1\n\n# PagerDuty\nexport PAGERDUTY_API_KEY=u+xxxxx\n</code></pre>"},{"location":"commands/config/#multiple-profiles","title":"Multiple Profiles","text":"<p>Use different configurations for different environments:</p> <pre><code># Use production profile\nexport NTHLAYER_PROFILE=production\nnthlayer apply service.yaml\n\n# Or specify inline\nnthlayer apply service.yaml --profile production\n</code></pre>"},{"location":"commands/config/#see-also","title":"See Also","text":"<ul> <li>nthlayer setup - Quick setup wizard</li> <li>Integrations - Integration guides</li> </ul>"},{"location":"commands/generate-loki-alerts/","title":"generate-loki-alerts","text":"<p>Generate LogQL alert rules for Grafana Loki based on service dependencies.</p>"},{"location":"commands/generate-loki-alerts/#synopsis","title":"Synopsis","text":"<pre><code>nthlayer generate-loki-alerts &lt;service-file&gt; [options]\n</code></pre>"},{"location":"commands/generate-loki-alerts/#description","title":"Description","text":"<p>Automatically generates LogQL alert rules for Grafana Loki Ruler based on your service's declared dependencies. This extends NthLayer's \"generate from YAML\" pattern to logs.</p>"},{"location":"commands/generate-loki-alerts/#options","title":"Options","text":"Option Description <code>--output</code>, <code>-o</code> Output file path (default: <code>generated/{service}/loki-alerts.yaml</code>) <code>--dry-run</code> Preview alerts without writing file"},{"location":"commands/generate-loki-alerts/#examples","title":"Examples","text":""},{"location":"commands/generate-loki-alerts/#generate-alerts","title":"Generate Alerts","text":"<pre><code>nthlayer generate-loki-alerts services/payment-api.yaml\n</code></pre>"},{"location":"commands/generate-loki-alerts/#preview-without-writing","title":"Preview Without Writing","text":"<pre><code>nthlayer generate-loki-alerts services/api.yaml --dry-run\n</code></pre>"},{"location":"commands/generate-loki-alerts/#custom-output-path","title":"Custom Output Path","text":"<pre><code>nthlayer generate-loki-alerts services/api.yaml -o alerts/loki/api.yaml\n</code></pre>"},{"location":"commands/generate-loki-alerts/#supported-technologies","title":"Supported Technologies","text":"<p>NthLayer generates LogQL alerts for 15+ technologies:</p> Category Technologies Databases PostgreSQL, MySQL, MongoDB, Redis Message Queues Kafka, RabbitMQ, NATS, Pulsar Search Elasticsearch Orchestration Kubernetes Load Balancers Nginx, HAProxy, Traefik Service Discovery Consul, etcd"},{"location":"commands/generate-loki-alerts/#alert-types","title":"Alert Types","text":""},{"location":"commands/generate-loki-alerts/#database-alerts","title":"Database Alerts","text":"<ul> <li>Fatal/panic errors</li> <li>Connection failures</li> <li>Replication lag</li> <li>Deadlocks</li> <li>Slow queries</li> </ul>"},{"location":"commands/generate-loki-alerts/#message-queue-alerts","title":"Message Queue Alerts","text":"<ul> <li>Under-replicated partitions (Kafka)</li> <li>Memory/disk alarms (RabbitMQ)</li> <li>Consumer lag</li> <li>Broker failures</li> </ul>"},{"location":"commands/generate-loki-alerts/#kubernetes-alerts","title":"Kubernetes Alerts","text":"<ul> <li>OOMKilled containers</li> <li>CrashLoopBackOff</li> <li>Node not ready</li> <li>Probe failures</li> </ul>"},{"location":"commands/generate-loki-alerts/#output-format","title":"Output Format","text":"<p>Alerts are generated in Grafana Loki Ruler YAML format:</p> <pre><code>groups:\n  - name: payment-api\n    rules:\n      - alert: payment-api_postgresql_PostgresqlFatalError\n        expr: count_over_time({app=\"postgresql\", service=\"payment-api\"} |= \"FATAL\" [1m]) &gt; 0\n        for: 0m\n        labels:\n          severity: critical\n          service: payment-api\n          tier: critical\n          technology: postgresql\n        annotations:\n          summary: \"[payment-api/postgresql] PostgreSQL FATAL error detected\"\n          description: \"PostgreSQL logged a FATAL error...\"\n</code></pre>"},{"location":"commands/generate-loki-alerts/#integration-with-loki","title":"Integration with Loki","text":""},{"location":"commands/generate-loki-alerts/#deploy-to-loki-ruler","title":"Deploy to Loki Ruler","text":"<pre><code># Generate alerts\nnthlayer generate-loki-alerts services/api.yaml\n\n# Deploy to Loki (using mimirtool or Loki API)\nmimirtool rules load generated/api/loki-alerts.yaml\n</code></pre>"},{"location":"commands/generate-loki-alerts/#with-grafana-cloud","title":"With Grafana Cloud","text":"<pre><code># Generate\nnthlayer generate-loki-alerts services/api.yaml\n\n# Upload via Grafana Cloud API\ncurl -X POST \"https://your-instance.grafana.net/loki/api/v1/rules/nthlayer\" \\\n  -H \"Authorization: Bearer $GRAFANA_API_KEY\" \\\n  -H \"Content-Type: application/yaml\" \\\n  --data-binary @generated/api/loki-alerts.yaml\n</code></pre>"},{"location":"commands/generate-loki-alerts/#how-dependencies-are-detected","title":"How Dependencies Are Detected","text":"<p>Dependencies are extracted from your <code>service.yaml</code>:</p> <pre><code>resources:\n  - kind: Dependencies\n    name: external\n    spec:\n      databases:\n        - name: payment-db\n          type: postgresql\n        - name: cache\n          type: redis\n      services:\n        - name: kafka-cluster\n          type: kafka\n</code></pre>"},{"location":"commands/generate-loki-alerts/#see-also","title":"See Also","text":"<ul> <li>apply Command - Generate all artifacts including Loki alerts</li> <li>Loki Integration Guide</li> </ul>"},{"location":"commands/init/","title":"nthlayer init","text":"<p>Interactively create a new service specification file.</p>"},{"location":"commands/init/#synopsis","title":"Synopsis","text":"<pre><code>nthlayer init [options]\n</code></pre>"},{"location":"commands/init/#description","title":"Description","text":"<p>The <code>init</code> command guides you through creating a <code>service.yaml</code> file with interactive prompts. It auto-generates appropriate resources based on your selections.</p>"},{"location":"commands/init/#options","title":"Options","text":"Option Description <code>--output, -o PATH</code> Output file path (default: <code>service.yaml</code>) <code>--template NAME</code> Use a pre-built template <code>--no-interactive</code> Use defaults without prompts"},{"location":"commands/init/#interactive-mode","title":"Interactive Mode","text":"<pre><code>nthlayer init\n</code></pre> <p>The wizard prompts for:</p> <ol> <li>Service name - e.g., <code>payment-api</code></li> <li>Team - e.g., <code>platform</code></li> <li>Tier - critical, standard, or low</li> <li>Type - api, worker, stream, web, batch, or ml</li> <li>Dependencies - databases, caches, queues</li> </ol>"},{"location":"commands/init/#example-session","title":"Example Session","text":"<pre><code>\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502  NthLayer Service Generator                                  \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n\nService name: payment-api\nTeam: payments\n\nSelect service tier:\n  \u276f critical  - 99.95% availability, 5min escalation\n    standard  - 99.9% availability, 15min escalation\n    low       - 99.5% availability, business hours\n\nSelect service type:\n  \u276f api       - HTTP/REST API service\n    worker    - Background job processor\n    stream    - Event/stream processor\n    web       - Web application\n    batch     - Batch processing job\n    ml        - ML inference service\n\nSelect dependencies (space to toggle):\n  \u25c9 postgresql\n  \u25c9 redis\n  \u25cb kafka\n  \u25cb mongodb\n  \u25cb elasticsearch\n  \u25cb rabbitmq\n\n\u2713 Created services/payment-api.yaml\n</code></pre>"},{"location":"commands/init/#generated-output","title":"Generated Output","text":"<p>Based on your selections, <code>init</code> generates appropriate resources:</p>"},{"location":"commands/init/#critical-tier-api","title":"Critical Tier API","text":"<pre><code>service:\n  name: payment-api\n  team: payments\n  tier: critical\n  type: api\n\nresources:\n  # Availability SLO (99.95% for critical)\n  - kind: SLO\n    name: availability\n    spec:\n      objective: 99.95\n      window: 30d\n      indicator:\n        type: availability\n\n  # Latency SLO (auto-added for API type)\n  - kind: SLO\n    name: latency-p99\n    spec:\n      objective: 99.0\n      threshold_ms: 200\n      indicator:\n        type: latency\n        percentile: 99\n\n  # PagerDuty (auto-added for critical tier)\n  - kind: PagerDuty\n    name: alerting\n    spec:\n      urgency: high\n      auto_create: true\n\n  # Dependencies\n  - kind: Dependencies\n    name: deps\n    spec:\n      databases:\n        - type: postgresql\n          criticality: high\n      caches:\n        - type: redis\n          criticality: high\n</code></pre>"},{"location":"commands/init/#standard-tier-worker","title":"Standard Tier Worker","text":"<pre><code>service:\n  name: email-worker\n  team: notifications\n  tier: standard\n  type: worker\n\nresources:\n  - kind: SLO\n    name: availability\n    spec:\n      objective: 99.9\n      window: 30d\n</code></pre>"},{"location":"commands/init/#resource-auto-generation","title":"Resource Auto-Generation","text":"Selection Generated Resources Tier: critical Higher SLO targets, PagerDuty Tier: standard Standard SLO targets Tier: low Lower SLO targets Type: api Latency SLO Type: worker Job completion SLO Type: stream Throughput SLO Dependencies Dependencies resource"},{"location":"commands/init/#templates","title":"Templates","text":"<p>Use pre-built templates for common patterns:</p> <pre><code># List available templates\nnthlayer init --list-templates\n\n# Use a template\nnthlayer init --template api-with-postgres\n</code></pre>"},{"location":"commands/init/#available-templates","title":"Available Templates","text":"Template Description <code>api-basic</code> Simple API with availability SLO <code>api-with-postgres</code> API with PostgreSQL dependency <code>worker-basic</code> Background worker <code>stream-kafka</code> Kafka stream processor"},{"location":"commands/init/#non-interactive-mode","title":"Non-Interactive Mode","text":"<p>Generate with defaults:</p> <pre><code>nthlayer init --no-interactive \\\n  --name my-service \\\n  --team platform \\\n  --tier standard \\\n  --type api\n</code></pre>"},{"location":"commands/init/#see-also","title":"See Also","text":"<ul> <li>nthlayer apply - Generate configs from service spec</li> <li>Service YAML Schema - Full specification</li> <li>Quick Start - Getting started guide</li> </ul>"},{"location":"commands/portfolio/","title":"nthlayer portfolio","text":"<p>View SLO health across your entire organization.</p>"},{"location":"commands/portfolio/#usage","title":"Usage","text":"<pre><code>nthlayer portfolio [options]\n</code></pre>"},{"location":"commands/portfolio/#options","title":"Options","text":"Option Description <code>--format FORMAT</code> Output format: <code>text</code> (default), <code>json</code>, <code>csv</code> <code>--services-dir DIR</code> Directory to scan for services"},{"location":"commands/portfolio/#example-output","title":"Example Output","text":"<pre><code>nthlayer portfolio\n</code></pre> <pre><code>================================================================================\n  NthLayer SLO Portfolio\n================================================================================\n\nOrganization Health: 78% (14/18 services meeting SLOs)\n\nBy Tier:\n  Tier 1 (Critical):     83%  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591  5/6 services\n  Tier 2 (Standard):     75%  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591  6/8 services\n  Tier 3 (Low):          75%  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591  3/4 services\n\n--------------------------------------------------------------------------------\nServices Needing Attention:\n--------------------------------------------------------------------------------\n\n  payment-api (Tier 1)\n    availability: 156% budget burned - EXHAUSTED\n    Remaining: -12.5 hours\n\n  search-api (Tier 2)\n    latency-p99: 95% budget burned - WARNING\n    Remaining: 1.2 hours\n\n--------------------------------------------------------------------------------\nInsights:\n--------------------------------------------------------------------------------\n  - 2 services have no SLOs defined: legacy-api, internal-tools\n  - payment-api has aggressive targets (99.99%) - consider 99.95%\n\n--------------------------------------------------------------------------------\nTotal: 18 services, 16 with SLOs, 45 SLOs\n</code></pre>"},{"location":"commands/portfolio/#json-export","title":"JSON Export","text":"<p>For integration with other tools:</p> <pre><code>nthlayer portfolio --format json\n</code></pre> <pre><code>{\n  \"timestamp\": \"2024-12-06T10:30:00Z\",\n  \"total_services\": 18,\n  \"services_with_slos\": 16,\n  \"total_slos\": 45,\n  \"healthy_services\": 14,\n  \"org_health_percent\": 77.78,\n  \"by_tier\": [\n    {\n      \"tier\": 1,\n      \"tier_name\": \"Critical\",\n      \"total_services\": 6,\n      \"healthy_services\": 5,\n      \"health_percent\": 83.33\n    }\n  ],\n  \"services\": [\n    {\n      \"name\": \"payment-api\",\n      \"tier\": 1,\n      \"overall_status\": \"exhausted\",\n      \"slos\": [\n        {\n          \"name\": \"availability\",\n          \"status\": \"exhausted\",\n          \"budget_consumed_percent\": 156.0\n        }\n      ]\n    }\n  ]\n}\n</code></pre>"},{"location":"commands/portfolio/#csv-export","title":"CSV Export","text":"<p>For spreadsheet analysis:</p> <pre><code>nthlayer portfolio --format csv\n</code></pre> <pre><code>service,tier,slo,status,budget_consumed,budget_remaining_hours\npayment-api,1,availability,exhausted,156.0,-12.5\npayment-api,1,latency-p99,healthy,45.0,18.2\nsearch-api,2,availability,healthy,32.0,22.1\nsearch-api,2,latency-p99,warning,95.0,1.2\n</code></pre>"},{"location":"commands/portfolio/#health-status-levels","title":"Health Status Levels","text":"Status Budget Consumed Description Healthy &lt; 80% On track Warning 80-100% Approaching limit Critical 100-150% Over budget Exhausted &gt; 150% Severely over budget"},{"location":"commands/portfolio/#scanning-multiple-directories","title":"Scanning Multiple Directories","text":"<pre><code>nthlayer portfolio --services-dir ./services --services-dir ./legacy\n</code></pre> <p>Default search paths: - <code>./services</code> - <code>./examples/services</code></p>"},{"location":"commands/portfolio/#use-cases","title":"Use Cases","text":""},{"location":"commands/portfolio/#weekly-slo-review","title":"Weekly SLO Review","text":"<pre><code>nthlayer portfolio --format json &gt; slo-report-$(date +%Y%m%d).json\n</code></pre>"},{"location":"commands/portfolio/#cicd-gate","title":"CI/CD Gate","text":"<pre><code># Fail if any critical service is exhausted\nnthlayer portfolio --format json | jq -e '.services[] | select(.tier == 1 and .overall_status == \"exhausted\") | empty'\n</code></pre>"},{"location":"commands/portfolio/#stakeholder-reports","title":"Stakeholder Reports","text":"<pre><code>nthlayer portfolio --format csv &gt; monthly-slo-report.csv\n</code></pre>"},{"location":"commands/portfolio/#see-also","title":"See Also","text":"<ul> <li>SLOs &amp; Error Budgets - Understanding SLOs</li> <li>nthlayer slo - Per-service SLO commands</li> </ul>"},{"location":"commands/setup/","title":"nthlayer setup","text":"<p>Interactive first-time setup wizard for NthLayer.</p>"},{"location":"commands/setup/#usage","title":"Usage","text":"<pre><code>nthlayer setup [options]\n</code></pre>"},{"location":"commands/setup/#options","title":"Options","text":"Option Description <code>--quick</code> Use simplified setup (default) <code>--advanced</code> Use full configuration wizard <code>--test</code> Test connections only <code>--skip-service</code> Skip first service creation prompt"},{"location":"commands/setup/#quick-setup-mode","title":"Quick Setup Mode","text":"<p>The default mode configures the essentials:</p> <pre><code>nthlayer setup\n</code></pre> <pre><code>================================================================================\n  Welcome to NthLayer!\n  The missing layer of reliability - 20 hours of SRE work in 5 minutes\n================================================================================\n\nQuick Setup\n----------------------------------------\n1. Prometheus Configuration\n   Prometheus URL [http://localhost:9090]:\n   Does Prometheus require authentication? [y/N]:\n\n2. Grafana Configuration (optional)\n   Configure Grafana? [Y/n]: y\n   Grafana URL [http://localhost:3000]:\n   API Key (press Enter to skip): ****\n\n3. PagerDuty Configuration (optional)\n   Configure PagerDuty? [y/N]:\n\nTesting Connections\n----------------------------------------\n  Prometheus (http://localhost:9090)\n    [OK] Connected (Prometheus 2.45.0)\n\n  Grafana (http://localhost:3000)\n    [OK] Connected - Org: Main Org\n\nConfiguration saved to: ~/.nthlayer/config.yaml\n\nCreate your first service? [Y/n]:\n</code></pre>"},{"location":"commands/setup/#advanced-setup-mode","title":"Advanced Setup Mode","text":"<p>For power users with multiple environments:</p> <pre><code>nthlayer setup --advanced\n</code></pre> <p>This includes:</p> <ul> <li>Multiple Prometheus/Grafana profiles (dev, staging, prod)</li> <li>Cloud secret backends (Vault, AWS Secrets Manager, etc.)</li> <li>Detailed PagerDuty and Slack configuration</li> </ul>"},{"location":"commands/setup/#test-connections-only","title":"Test Connections Only","text":"<p>Verify your configuration:</p> <pre><code>nthlayer setup --test\n</code></pre> <pre><code>Testing Connections\n----------------------------------------\n  Prometheus (http://localhost:9090)\n    [OK] Connected (Prometheus 2.45.0)\n\n  Grafana (http://localhost:3000)\n    [OK] Connected - Org: Main Org\n\n  PagerDuty\n    [OK] Connected - 3 escalation policies\n\nAll configured services are operational!\n</code></pre>"},{"location":"commands/setup/#configuration-file","title":"Configuration File","text":"<p>Setup creates <code>~/.nthlayer/config.yaml</code>:</p> <pre><code>prometheus:\n  default: default\n  profiles:\n    default:\n      url: http://localhost:9090\n      type: prometheus\n\ngrafana:\n  default: default\n  profiles:\n    default:\n      url: http://localhost:3000\n      type: grafana\n      api_key_secret: grafana/api_key\n\nalerting:\n  pagerduty:\n    enabled: false\n  slack:\n    enabled: false\n</code></pre>"},{"location":"commands/setup/#environment-variables","title":"Environment Variables","text":"<p>Alternatively, configure via environment variables:</p> <pre><code>export NTHLAYER_PROMETHEUS_URL=http://prometheus:9090\nexport NTHLAYER_GRAFANA_URL=http://grafana:3000\nexport NTHLAYER_GRAFANA_API_KEY=glsa_xxxxx\nexport PAGERDUTY_API_KEY=u+xxxxx\n</code></pre>"},{"location":"commands/setup/#see-also","title":"See Also","text":"<ul> <li>nthlayer config - Manual configuration</li> <li>Quick Start - Full setup guide</li> </ul>"},{"location":"commands/slo/","title":"nthlayer slo","text":"<p>Query and manage SLOs for individual services.</p>"},{"location":"commands/slo/#commands","title":"Commands","text":"<pre><code>nthlayer slo show &lt;service.yaml&gt;     # Show SLO definitions\nnthlayer slo list &lt;service.yaml&gt;     # List SLOs briefly\nnthlayer slo collect &lt;service.yaml&gt;  # Query live metrics from Prometheus\n</code></pre>"},{"location":"commands/slo/#nthlayer-slo-show","title":"nthlayer slo show","text":"<p>Display detailed SLO information:</p> <pre><code>nthlayer slo show payment-api.yaml\n</code></pre> <pre><code>================================================================================\n  SLOs for payment-api\n================================================================================\n\navailability\n  Type: availability\n  Objective: 99.95%\n  Window: 30 days\n  Error Budget: 21.6 minutes/month\n\nlatency-p99\n  Type: latency\n  Objective: 99.0% of requests &lt; 200ms\n  Window: 30 days\n  Percentile: p99\n</code></pre>"},{"location":"commands/slo/#nthlayer-slo-list","title":"nthlayer slo list","text":"<p>Brief listing:</p> <pre><code>nthlayer slo list payment-api.yaml\n</code></pre> <pre><code>payment-api SLOs:\n  - availability: 99.95% (30d)\n  - latency-p99: 99.0% &lt; 200ms (30d)\n</code></pre>"},{"location":"commands/slo/#nthlayer-slo-collect","title":"nthlayer slo collect","text":"<p>Query live metrics from Prometheus:</p> <pre><code>nthlayer slo collect payment-api.yaml\n</code></pre> <pre><code>================================================================================\n  Live SLO Status: payment-api\n================================================================================\n\navailability\n  Current: 99.92%\n  Target: 99.95%\n  Status: WARNING (approaching budget)\n  Budget Consumed: 87.5%\n  Budget Remaining: 2.7 hours\n\nlatency-p99\n  Current: 185ms\n  Target: 200ms\n  Status: HEALTHY\n  Budget Consumed: 45.2%\n  Budget Remaining: 11.8 hours\n</code></pre>"},{"location":"commands/slo/#options","title":"Options","text":"Option Description <code>--prometheus-url URL</code> Prometheus server URL <code>--window DURATION</code> Query window (default: 30d)"},{"location":"commands/slo/#environment-variables","title":"Environment Variables","text":"<pre><code>export NTHLAYER_PROMETHEUS_URL=http://prometheus:9090\n</code></pre>"},{"location":"commands/slo/#understanding-slo-status","title":"Understanding SLO Status","text":"Status Meaning HEALTHY &lt; 80% budget consumed WARNING 80-100% budget consumed CRITICAL 100-150% budget consumed EXHAUSTED &gt; 150% budget consumed"},{"location":"commands/slo/#error-budget-calculation","title":"Error Budget Calculation","text":"<p>For a 99.95% availability SLO over 30 days:</p> <pre><code>Error Budget = (1 - 0.9995) \u00d7 30 days \u00d7 24 hours \u00d7 60 minutes\n             = 0.0005 \u00d7 43,200 minutes\n             = 21.6 minutes\n</code></pre>"},{"location":"commands/slo/#see-also","title":"See Also","text":"<ul> <li>nthlayer portfolio - Org-wide SLO view</li> <li>SLOs &amp; Error Budgets - Concepts</li> </ul>"},{"location":"commands/validate-metadata/","title":"validate-metadata","text":"<p>Validate Prometheus/Loki rule metadata beyond PromQL syntax.</p>"},{"location":"commands/validate-metadata/#synopsis","title":"Synopsis","text":"<pre><code>nthlayer validate-metadata &lt;file-or-directory&gt; [options]\n</code></pre>"},{"location":"commands/validate-metadata/#description","title":"Description","text":"<p>Enhanced validation that goes beyond PromQL syntax checking (pint). Validates:</p> <ul> <li>Required labels (severity, team, service)</li> <li>Required annotations (summary, description, runbook_url)</li> <li>Label value patterns (regex validation)</li> <li>Runbook URL format and accessibility</li> <li>Range query vs data retention limits</li> <li>Alert <code>for</code> duration bounds</li> </ul>"},{"location":"commands/validate-metadata/#options","title":"Options","text":"Option Description <code>--strict</code> Require runbook_url, team, and service labels <code>--check-urls</code> Actually check if runbook URLs are accessible (makes HTTP requests) <code>--use-promruval</code> Also run promruval if installed <code>--verbose</code>, <code>-v</code> Show detailed output with suggestions"},{"location":"commands/validate-metadata/#exit-codes","title":"Exit Codes","text":"Code Meaning 0 All rules passed 1 Warnings found (no errors) 2 Errors found"},{"location":"commands/validate-metadata/#examples","title":"Examples","text":""},{"location":"commands/validate-metadata/#basic-validation","title":"Basic Validation","text":"<pre><code>nthlayer validate-metadata generated/payment-api/alerts.yaml\n</code></pre>"},{"location":"commands/validate-metadata/#strict-mode","title":"Strict Mode","text":"<p>Requires runbook_url, team, and service labels:</p> <pre><code>nthlayer validate-metadata alerts.yaml --strict\n</code></pre>"},{"location":"commands/validate-metadata/#validate-directory","title":"Validate Directory","text":"<pre><code>nthlayer validate-metadata generated/ --strict --verbose\n</code></pre>"},{"location":"commands/validate-metadata/#check-url-accessibility","title":"Check URL Accessibility","text":"<p>Actually makes HTTP requests to verify runbook URLs are accessible:</p> <pre><code>nthlayer validate-metadata alerts.yaml --check-urls\n</code></pre>"},{"location":"commands/validate-metadata/#validators","title":"Validators","text":""},{"location":"commands/validate-metadata/#built-in-validators","title":"Built-in Validators","text":"Validator Description <code>hasRequiredLabels</code> Check for required labels <code>hasRequiredAnnotations</code> Check for required annotations <code>validSeverityLevel</code> Validate severity is one of: critical, warning, info, page, ticket <code>noEmptyLabels</code> Labels must have non-empty values <code>noEmptyAnnotations</code> Annotations must have non-empty values <code>labelMatchesPattern</code> Label values match regex patterns <code>validRunbookUrl</code> Runbook URL is well-formed <code>rangeQueryMaxDuration</code> Range queries don't exceed retention <code>alertForDuration</code> Alert <code>for</code> duration is reasonable <code>ruleNamePattern</code> Rule names follow naming convention"},{"location":"commands/validate-metadata/#default-mode","title":"Default Mode","text":"<p>Checks: - Required: <code>severity</code> label - Required: <code>summary</code>, <code>description</code> annotations - Valid severity level - No empty labels or annotations</p>"},{"location":"commands/validate-metadata/#strict-mode_1","title":"Strict Mode","text":"<p>Additional checks: - Required: <code>team</code>, <code>service</code> labels - Required: <code>runbook_url</code> annotation - Runbook URL format validation - Range query vs 15d retention - Alert <code>for</code> duration bounds (0s - 1h)</p>"},{"location":"commands/validate-metadata/#integration-with-cicd","title":"Integration with CI/CD","text":""},{"location":"commands/validate-metadata/#github-actions","title":"GitHub Actions","text":"<pre><code>- name: Validate alert metadata\n  run: |\n    nthlayer validate-metadata generated/ --strict\n</code></pre>"},{"location":"commands/validate-metadata/#pre-commit-hook","title":"Pre-commit Hook","text":"<pre><code>repos:\n  - repo: local\n    hooks:\n      - id: validate-metadata\n        name: Validate alert metadata\n        entry: nthlayer validate-metadata --strict\n        language: system\n        files: alerts\\.yaml$\n</code></pre>"},{"location":"commands/validate-metadata/#programmatic-usage","title":"Programmatic Usage","text":"<pre><code>from nthlayer.validation import (\n    MetadataValidator,\n    HasRequiredLabels,\n    ValidRunbookUrl,\n    validate_metadata,\n)\n\n# Quick validation\nresult = validate_metadata(\"alerts.yaml\", strict=True)\nif not result.passed:\n    for issue in result.issues:\n        print(f\"{issue.severity.value}: {issue.message}\")\n\n# Custom validators\nvalidator = MetadataValidator()\nvalidator.add_validator(HasRequiredLabels([\"severity\", \"team\", \"tier\"]))\nvalidator.add_validator(ValidRunbookUrl(check_accessibility=True))\n\nresult = validator.validate_file(\"alerts.yaml\")\n</code></pre>"},{"location":"commands/validate-metadata/#see-also","title":"See Also","text":"<ul> <li>lint Command - PromQL syntax validation with pint</li> <li>apply Command - Generate artifacts with optional validation</li> </ul>"},{"location":"commands/validate-spec/","title":"nthlayer validate-spec","text":"<p>Validate service specifications against organizational policies using OPA/Rego.</p>"},{"location":"commands/validate-spec/#synopsis","title":"Synopsis","text":"<pre><code>nthlayer validate-spec &lt;file-or-directory&gt; [options]\n</code></pre>"},{"location":"commands/validate-spec/#description","title":"Description","text":"<p>The <code>validate-spec</code> command checks service YAML files against policy rules. This catches configuration issues before they cause problems:</p> <ul> <li>Missing required fields</li> <li>Invalid tier or type values</li> <li>Critical services without proper SLOs</li> <li>Aggressive SLO targets that may be unrealistic</li> </ul>"},{"location":"commands/validate-spec/#options","title":"Options","text":"Option Description <code>--policy-dir PATH</code> Custom policy directory (default: <code>policies/</code>) <code>--verbose, -v</code> Show detailed policy evaluation"},{"location":"commands/validate-spec/#exit-codes","title":"Exit Codes","text":"Code Meaning <code>0</code> All checks passed <code>1</code> Warnings found (non-blocking) <code>2</code> Errors found (blocking)"},{"location":"commands/validate-spec/#examples","title":"Examples","text":""},{"location":"commands/validate-spec/#validate-a-single-file","title":"Validate a Single File","text":"<pre><code>nthlayer validate-spec services/payment-api.yaml\n</code></pre> <p>Output: <pre><code>\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502  Policy Validation: payment-api                              \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n\n  \u2713 Required fields present\n  \u2713 Tier value valid (critical)\n  \u2713 Type value valid (api)\n  \u2713 SLO objectives within range\n  \u2713 Critical tier requirements met\n\n  Result: PASSED (0 errors, 0 warnings)\n</code></pre></p>"},{"location":"commands/validate-spec/#validate-all-services","title":"Validate All Services","text":"<pre><code>nthlayer validate-spec services/\n</code></pre>"},{"location":"commands/validate-spec/#with-verbose-output","title":"With Verbose Output","text":"<pre><code>nthlayer validate-spec services/api.yaml --verbose\n</code></pre> <p>Output: <pre><code>Evaluating policies from: policies/\n\nPolicy: service.rego\n  \u2713 deny_missing_name: PASSED\n  \u2713 deny_missing_team: PASSED\n  \u2713 deny_invalid_tier: PASSED\n  \u2713 deny_invalid_type: PASSED\n  \u2713 deny_critical_without_slo: PASSED\n  \u2713 deny_critical_without_pagerduty: PASSED\n\nPolicy: slo.rego\n  \u2713 deny_invalid_objective: PASSED\n  \u26a0 warn_aggressive_objective: 99.99% may be unrealistic\n\nPolicy: dependencies.rego\n  \u2713 deny_missing_criticality: PASSED\n</code></pre></p>"},{"location":"commands/validate-spec/#built-in-policies","title":"Built-in Policies","text":"<p>NthLayer includes default policies in <code>policies/</code>:</p>"},{"location":"commands/validate-spec/#servicerego","title":"service.rego","text":"Rule Severity Description <code>deny_missing_name</code> Error Service must have a name <code>deny_missing_team</code> Error Service must have a team <code>deny_invalid_tier</code> Error Tier must be critical/standard/low <code>deny_invalid_type</code> Error Type must be api/worker/stream/web/batch/ml <code>deny_critical_without_slo</code> Error Critical tier requires SLO <code>deny_critical_without_pagerduty</code> Error Critical tier requires PagerDuty"},{"location":"commands/validate-spec/#slorego","title":"slo.rego","text":"Rule Severity Description <code>deny_invalid_objective</code> Error Objective must be 0-100 <code>warn_aggressive_objective</code> Warning Objectives &gt;99.99% flagged <code>warn_critical_low_availability</code> Warning Critical tier &lt;99.9% flagged"},{"location":"commands/validate-spec/#dependenciesrego","title":"dependencies.rego","text":"Rule Severity Description <code>warn_missing_criticality</code> Warning Dependencies should have criticality <code>deny_invalid_database_type</code> Error Database type must be known"},{"location":"commands/validate-spec/#custom-policies","title":"Custom Policies","text":"<p>Add custom Rego policies to your <code>policies/</code> directory:</p> <pre><code># policies/custom.rego\npackage nthlayer.custom\n\n# Deny services without runbook\ndeny_missing_runbook[msg] {\n    input.service.tier == \"critical\"\n    not input.service.runbook_url\n    msg := \"Critical services must have a runbook_url\"\n}\n\n# Warn about missing description\nwarn_missing_description[msg] {\n    not input.service.description\n    msg := \"Service should have a description\"\n}\n</code></pre>"},{"location":"commands/validate-spec/#using-conftest","title":"Using conftest","text":"<p>If conftest is installed, <code>validate-spec</code> uses it for evaluation. Otherwise, it falls back to a native Python implementation.</p>"},{"location":"commands/validate-spec/#install-conftest","title":"Install conftest","text":"<pre><code># macOS\nbrew install conftest\n\n# Linux\ncurl -sL https://github.com/open-policy-agent/conftest/releases/latest/download/conftest_Linux_x86_64.tar.gz | tar xz\nsudo mv conftest /usr/local/bin/\n</code></pre>"},{"location":"commands/validate-spec/#benefits-of-conftest","title":"Benefits of conftest","text":"<ul> <li>Full OPA/Rego support</li> <li>Faster evaluation</li> <li>Additional output formats (<code>--output json</code>)</li> </ul>"},{"location":"commands/validate-spec/#cicd-integration","title":"CI/CD Integration","text":""},{"location":"commands/validate-spec/#github-actions","title":"GitHub Actions","text":"<pre><code>- name: Validate Service Specs\n  run: nthlayer validate-spec services/\n</code></pre>"},{"location":"commands/validate-spec/#pre-commit-hook","title":"Pre-commit Hook","text":"<pre><code>repos:\n  - repo: local\n    hooks:\n      - id: validate-specs\n        name: Validate Service Specs\n        entry: nthlayer validate-spec\n        language: system\n        files: services/.*\\.yaml$\n</code></pre>"},{"location":"commands/validate-spec/#see-also","title":"See Also","text":"<ul> <li>Validation Overview</li> <li>Contract Verification</li> <li>conftest Documentation</li> </ul>"},{"location":"commands/verify/","title":"nthlayer verify","text":"<p>Verify that declared metrics exist in Prometheus before promoting to production.</p> <p>This implements the Contract Verification pattern - ensuring that metrics declared in <code>service.yaml</code> actually exist before deployment promotion.</p>"},{"location":"commands/verify/#usage","title":"Usage","text":"<pre><code>nthlayer verify &lt;service.yaml&gt; [options]\n</code></pre>"},{"location":"commands/verify/#options","title":"Options","text":"Option Description <code>--prometheus-url, -p URL</code> Target Prometheus URL <code>--env ENVIRONMENT</code> Environment name (dev, staging, prod) <code>--no-fail</code> Don't fail on missing metrics (always exit 0)"},{"location":"commands/verify/#environment-variables","title":"Environment Variables","text":"Variable Description <code>PROMETHEUS_URL</code> Default Prometheus URL (if <code>--prometheus-url</code> not provided) <code>PROMETHEUS_USERNAME</code> Basic auth username <code>PROMETHEUS_PASSWORD</code> Basic auth password"},{"location":"commands/verify/#exit-codes","title":"Exit Codes","text":"Code Meaning <code>0</code> All metrics verified <code>1</code> Optional metrics missing (warning) <code>2</code> Critical SLO metrics missing (block promotion)"},{"location":"commands/verify/#examples","title":"Examples","text":""},{"location":"commands/verify/#basic-verification","title":"Basic Verification","text":"<pre><code>nthlayer verify checkout-service.yaml --prometheus-url http://prometheus:9090\n</code></pre> <p>Output: <pre><code>\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 Contract Verification: checkout-service                                       \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n\nTarget: http://prometheus:9090\nService: checkout-service\n\nSLO Metrics (Critical):\n  \u2713 http_requests_total\n  \u2713 http_request_duration_seconds_bucket\n\nObservability Metrics (Optional):\n  \u2713 checkout_started_total\n  \u2713 checkout_completed_total\n\nSummary:\n  Total: 4 metrics\n  \u2713 Verified: 4\n\n\u2713 All declared metrics verified\nContract verification passed - safe to promote\n</code></pre></p>"},{"location":"commands/verify/#cicd-pipeline-integration","title":"CI/CD Pipeline Integration","text":"<pre><code># Verify against sandbox before promoting to production\nnthlayer verify service.yaml -p $SANDBOX_PROMETHEUS_URL\n\n# Exit code determines pipeline gate\nif [ $? -eq 2 ]; then\n  echo \"Critical metrics missing - blocking promotion\"\n  exit 1\nfi\n</code></pre>"},{"location":"commands/verify/#missing-metrics-output","title":"Missing Metrics Output","text":"<p>When critical metrics are missing:</p> <pre><code>SLO Metrics (Critical):\n  \u2713 http_requests_total\n  \u2717 payment_processed_total \u2190 MISSING\n\nSummary:\n  Total: 4 metrics\n  \u2713 Verified: 3\n  \u2717 Critical missing: 1\n\n\u2717 Critical SLO metrics missing - blocking promotion\n\nRecommendations:\n  \u2022 Ensure payment_processed_total is instrumented\n  \u2022 Run integration tests to generate traffic before re-verifying\n</code></pre>"},{"location":"commands/verify/#what-gets-verified","title":"What Gets Verified","text":""},{"location":"commands/verify/#slo-indicator-metrics-critical","title":"SLO Indicator Metrics (Critical)","text":"<p>Metrics extracted from SLO indicator queries in <code>service.yaml</code>:</p> <pre><code>resources:\n  - kind: SLO\n    name: availability\n    spec:\n      indicators:\n        - type: availability\n          success_ratio:\n            total_query: sum(rate(http_requests_total{service=\"checkout\"}[5m]))\n            good_query: sum(rate(http_requests_total{service=\"checkout\",status!~\"5..\"}[5m]))\n</code></pre> <p>Extracts: <code>http_requests_total</code> \u2192 Critical (blocks promotion if missing)</p>"},{"location":"commands/verify/#observability-metrics-optional","title":"Observability Metrics (Optional)","text":"<p>Metrics declared in the Observability resource:</p> <pre><code>resources:\n  - kind: Observability\n    name: observability\n    spec:\n      metrics:\n        - checkout_started_total\n        - checkout_completed_total\n</code></pre> <p>These are Optional (warning only if missing, doesn't block promotion)</p>"},{"location":"commands/verify/#philosophy","title":"Philosophy","text":"<p>\"Declarative First, Verify Later\"</p> Step Runtime Required? Description <code>nthlayer apply</code> No Generate configs from declarations (Shift Left) <code>nthlayer verify</code> Yes Verify contract before promotion <p>This solves the \"Chicken and Egg\" problem: - You can generate production-ready configs without the service running - You verify the contract in lower environments before promoting</p>"},{"location":"commands/verify/#tekton-pipeline-example","title":"Tekton Pipeline Example","text":"<pre><code>tasks:\n  - name: generate-configs\n    taskRef:\n      name: nthlayer-apply\n    params:\n      - name: service-file\n        value: services/checkout-service.yaml\n\n  - name: deploy-to-sandbox\n    runAfter: [generate-configs]\n    taskRef:\n      name: deploy\n\n  - name: verify-metrics\n    runAfter: [deploy-to-sandbox]\n    taskRef:\n      name: nthlayer-verify\n    params:\n      - name: service-file\n        value: services/checkout-service.yaml\n      - name: prometheus-url\n        value: $(params.sandbox-prometheus-url)\n\n  - name: deploy-to-production\n    runAfter: [verify-metrics]  # Blocked if verify fails\n    taskRef:\n      name: deploy\n</code></pre>"},{"location":"commands/verify/#github-actions-example","title":"GitHub Actions Example","text":"<pre><code>jobs:\n  verify-and-promote:\n    steps:\n      - name: Deploy to Staging\n        run: kubectl apply -f generated/\n\n      - name: Wait for Metrics\n        run: sleep 60  # Allow time for metrics to appear\n\n      - name: Verify Contract\n        run: |\n          nthlayer verify service.yaml \\\n            --prometheus-url ${{ secrets.STAGING_PROMETHEUS_URL }}\n\n      - name: Promote to Production\n        if: success()\n        run: kubectl apply -f generated/ --context production\n</code></pre>"},{"location":"commands/verify/#see-also","title":"See Also","text":"<ul> <li>Service YAML Schema - Full spec reference</li> <li>nthlayer apply - Generate configs</li> <li>CLI Reference - All commands</li> </ul>"},{"location":"concepts/deployment-gates/","title":"Deployment Gates","text":"<p>Deployment gates block or warn about deployments when error budget is exhausted. This is the core of NthLayer's Shift Left approach - catching reliability issues before they reach production.</p>"},{"location":"concepts/deployment-gates/#why-deployment-gates","title":"Why Deployment Gates?","text":"<p>Traditional monitoring tells you after a deployment causes problems. Deployment gates tell you before - enabling you to:</p> <ul> <li>Prevent incidents by blocking deploys when reliability is already degraded</li> <li>Make informed decisions with real-time error budget visibility</li> <li>Enforce SLO discipline across your organization</li> </ul>"},{"location":"concepts/deployment-gates/#how-it-works","title":"How It Works","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   CI/CD     \u2502\u2500\u2500\u2500\u2500\u25b6\u2502  NthLayer   \u2502\u2500\u2500\u2500\u2500\u25b6\u2502 Prometheus  \u2502\n\u2502  Pipeline   \u2502     \u2502 check-deploy \u2502     \u2502   Query     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                           \u2502\n                           \u25bc\n                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                    \u2502   Result    \u2502\n                    \u2502 0=Approved  \u2502\n                    \u2502 1=Warning   \u2502\n                    \u2502 2=Blocked   \u2502\n                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <ol> <li>Pipeline triggers: Your CI/CD pipeline calls <code>nthlayer check-deploy</code></li> <li>Query SLOs: NthLayer queries Prometheus for current SLI values</li> <li>Calculate budget: Error budget consumption is calculated</li> <li>Return decision: Exit code determines if deploy proceeds</li> </ol>"},{"location":"concepts/deployment-gates/#default-thresholds","title":"Default Thresholds","text":"<p>Thresholds are based on service tier:</p> Tier Warning Blocking Critical &lt;20% remaining &lt;10% remaining Standard &lt;20% remaining None (advisory) Low &lt;30% remaining None (advisory) <p>Critical services block deploys at 10% remaining budget. Standard and low tiers only warn.</p>"},{"location":"concepts/deployment-gates/#custom-policies","title":"Custom Policies","text":"<p>Override defaults with a <code>DeploymentGate</code> resource in your <code>service.yaml</code>:</p> <pre><code>resources:\n  - kind: DeploymentGate\n    name: custom-gate\n    spec:\n      thresholds:\n        warning: 30\n        blocking: 5\n</code></pre>"},{"location":"concepts/deployment-gates/#conditional-thresholds","title":"Conditional Thresholds","text":"<p>Apply different thresholds based on conditions:</p> <pre><code>resources:\n  - kind: DeploymentGate\n    name: smart-gate\n    spec:\n      thresholds:\n        warning: 20\n        blocking: 10\n\n      conditions:\n        # Stricter during business hours\n        - name: business-hours\n          when: \"hour &gt;= 9 AND hour &lt;= 17 AND weekday\"\n          blocking: 15\n\n        # Complete freeze during incidents\n        - name: incident-freeze\n          when: \"budget_remaining &lt; 5\"\n          blocking: 100\n</code></pre>"},{"location":"concepts/deployment-gates/#team-exceptions","title":"Team Exceptions","text":"<p>Allow specific teams to bypass gates:</p> <pre><code>spec:\n  exceptions:\n    - team: sre-oncall\n      allow: always\n</code></pre>"},{"location":"concepts/deployment-gates/#integration-points","title":"Integration Points","text":""},{"location":"concepts/deployment-gates/#cicd-pipelines","title":"CI/CD Pipelines","text":"<p>NthLayer integrates with:</p> <ul> <li>GitHub Actions - Reusable action</li> <li>ArgoCD - PreSync hook</li> <li>GitLab CI - Reusable template</li> <li>Tekton - Reusable task</li> </ul> <p>See examples/cicd/ for templates.</p>"},{"location":"concepts/deployment-gates/#manual-check","title":"Manual Check","text":"<p>Test locally before integrating:</p> <pre><code>nthlayer check-deploy services/api.yaml \\\n  --prometheus-url http://prometheus:9090\n\necho \"Exit code: $?\"\n</code></pre>"},{"location":"concepts/deployment-gates/#blast-radius-awareness","title":"Blast Radius Awareness","text":"<p>Gates consider downstream dependencies:</p> <pre><code>resources:\n  - kind: Dependencies\n    name: downstream\n    spec:\n      services:\n        - name: checkout-service\n          criticality: high\n        - name: analytics\n          criticality: low\n</code></pre> <p>High-criticality downstream services increase the gate's caution level.</p>"},{"location":"concepts/deployment-gates/#best-practices","title":"Best Practices","text":""},{"location":"concepts/deployment-gates/#1-start-with-advisory-mode","title":"1. Start with Advisory Mode","text":"<p>Begin with warnings only, then enable blocking:</p> <pre><code>spec:\n  thresholds:\n    warning: 20\n    blocking: null  # Advisory only\n</code></pre>"},{"location":"concepts/deployment-gates/#2-use-environment-specific-thresholds","title":"2. Use Environment-Specific Thresholds","text":"<p>Be lenient in dev, strict in prod:</p> <pre><code># dev environment\nspec:\n  thresholds:\n    warning: 50\n    blocking: null\n\n# prod environment\nspec:\n  thresholds:\n    warning: 20\n    blocking: 10\n</code></pre>"},{"location":"concepts/deployment-gates/#3-define-slo-queries","title":"3. Define SLO Queries","text":"<p>Gates need working SLO queries to calculate budget:</p> <pre><code>- kind: SLO\n  name: availability\n  spec:\n    objective: 99.95\n    window: 30d\n    indicator:\n      query: |\n        sum(rate(http_requests_total{status!~\"5..\"}[5m]))\n        /\n        sum(rate(http_requests_total[5m]))\n</code></pre>"},{"location":"concepts/deployment-gates/#4-test-before-production","title":"4. Test Before Production","text":"<p>Use the demo mode to see gate behavior:</p> <pre><code>nthlayer check-deploy services/api.yaml --demo\n</code></pre>"},{"location":"concepts/deployment-gates/#see-also","title":"See Also","text":"<ul> <li>check-deploy Command</li> <li>SLO Concepts</li> <li>Shift Left Philosophy</li> </ul>"},{"location":"concepts/service-specs/","title":"Service Specifications","text":"<p>A service spec is a YAML file that describes your service and its reliability requirements.</p>"},{"location":"concepts/service-specs/#structure","title":"Structure","text":"<pre><code># Basic metadata\nname: payment-api\nteam: payments\ntier: critical      # 1, 2, 3 or critical, standard, low\ntype: api           # api, worker, stream\n\n# Dependencies (optional)\ndependencies:\n  - postgresql\n  - redis\n\n# Custom resources (optional)\nresources:\n  - kind: SLO\n    name: availability\n    spec:\n      objective: 99.95\n      ...\n</code></pre>"},{"location":"concepts/service-specs/#required-fields","title":"Required Fields","text":"Field Description <code>name</code> Service identifier (lowercase, hyphens allowed) <code>tier</code> Priority level: <code>1</code>/<code>critical</code>, <code>2</code>/<code>standard</code>, <code>3</code>/<code>low</code> <code>type</code> Service type: <code>api</code>, <code>worker</code>, <code>stream</code>"},{"location":"concepts/service-specs/#optional-fields","title":"Optional Fields","text":"Field Description <code>team</code> Team responsible for the service <code>description</code> Human-readable description <code>dependencies</code> List of technology dependencies <code>resources</code> Custom SLO, alert, or PagerDuty configs"},{"location":"concepts/service-specs/#service-types","title":"Service Types","text":""},{"location":"concepts/service-specs/#api-type-api","title":"API (<code>type: api</code>)","text":"<p>HTTP/REST services with request/response patterns.</p> <p>Default Metrics:</p> <ul> <li><code>http_requests_total</code> - Request count by status</li> <li><code>http_request_duration_seconds</code> - Latency histogram</li> </ul> <p>Default SLOs:</p> <ul> <li>Availability: % of non-5xx responses</li> <li>Latency: p99 response time</li> </ul>"},{"location":"concepts/service-specs/#worker-type-worker","title":"Worker (<code>type: worker</code>)","text":"<p>Background job processors.</p> <p>Default Metrics:</p> <ul> <li><code>job_processed_total</code> - Jobs completed</li> <li><code>job_duration_seconds</code> - Processing time</li> <li><code>job_failed_total</code> - Failed jobs</li> </ul> <p>Default SLOs:</p> <ul> <li>Throughput: Jobs processed per minute</li> <li>Success rate: % of successful jobs</li> </ul>"},{"location":"concepts/service-specs/#stream-type-stream","title":"Stream (<code>type: stream</code>)","text":"<p>Event/message processors.</p> <p>Default Metrics:</p> <ul> <li><code>messages_processed_total</code> - Messages handled</li> <li><code>consumer_lag</code> - Messages behind</li> <li><code>processing_duration_seconds</code> - Processing time</li> </ul> <p>Default SLOs:</p> <ul> <li>Throughput: Messages per second</li> <li>Lag: Consumer lag in messages</li> </ul>"},{"location":"concepts/service-specs/#dependencies","title":"Dependencies","text":"<p>List technologies your service depends on:</p> <pre><code>dependencies:\n  - postgresql\n  - redis\n  - kafka\n</code></pre> <p>Each dependency adds:</p> <ul> <li>Dashboard panels with technology-specific metrics</li> <li>Alerts for common failure modes</li> <li>Recording rules for aggregation</li> </ul> <p>See Technologies for all 18 supported technologies.</p>"},{"location":"concepts/service-specs/#custom-resources","title":"Custom Resources","text":"<p>Override defaults or add custom configurations:</p>"},{"location":"concepts/service-specs/#custom-slo","title":"Custom SLO","text":"<pre><code>resources:\n  - kind: SLO\n    name: availability\n    spec:\n      objective: 99.99        # Override default\n      window: 7d              # Custom window\n      indicator:\n        type: availability\n        query: |\n          sum(rate(http_requests_total{service=\"payment-api\",status!~\"5..\"}[5m])) /\n          sum(rate(http_requests_total{service=\"payment-api\"}[5m]))\n</code></pre>"},{"location":"concepts/service-specs/#custom-alert","title":"Custom Alert","text":"<pre><code>resources:\n  - kind: Alert\n    name: high-latency\n    spec:\n      expr: |\n        histogram_quantile(0.99,\n          sum by (le) (rate(http_request_duration_seconds_bucket{service=\"payment-api\"}[5m]))\n        ) &gt; 0.5\n      for: 5m\n      severity: warning\n      annotations:\n        summary: \"High latency on payment-api\"\n</code></pre>"},{"location":"concepts/service-specs/#pagerduty","title":"PagerDuty","text":"<pre><code>resources:\n  - kind: PagerDuty\n    name: alerting\n    spec:\n      urgency: high\n      auto_create: true\n</code></pre>"},{"location":"concepts/service-specs/#environment-overrides","title":"Environment Overrides","text":"<p>Different settings per environment:</p> <pre><code># payment-api.yaml\nname: payment-api\ntier: critical\ntype: api\n\nenvironments:\n  production:\n    resources:\n      - kind: SLO\n        name: availability\n        spec:\n          objective: 99.99\n\n  staging:\n    resources:\n      - kind: SLO\n        name: availability\n        spec:\n          objective: 99.9\n</code></pre>"},{"location":"concepts/service-specs/#validation","title":"Validation","text":"<p>Validate your spec before applying:</p> <pre><code>nthlayer validate payment-api.yaml\n</code></pre> <pre><code>\u2713 payment-api.yaml is valid\n  - 2 SLOs defined\n  - 2 dependencies (postgresql, redis)\n  - PagerDuty integration enabled\n</code></pre>"},{"location":"concepts/service-specs/#examples","title":"Examples","text":"<p>See the examples/services directory for complete examples.</p>"},{"location":"concepts/shift-left/","title":"Reliability Shift Left","text":""},{"location":"concepts/shift-left/#what-is-shift-left","title":"What is Shift Left?","text":"<p>\"Shift Left\" means moving validation and testing earlier in the software development lifecycle. Instead of discovering issues in production, you catch them during development or CI/CD.</p> <p>Traditional approach: <pre><code>Code \u2192 Deploy \u2192 Monitor \u2192 Incident \u2192 Fix \u2192 Repeat\n                           \u2191\n                   \"We found out the hard way\"\n</code></pre></p> <p>Shift Left approach: <pre><code>Code \u2192 Validate \u2192 Verify \u2192 Gate \u2192 Deploy \u2192 Monitor\n         \u2191          \u2191        \u2191\n   \"Is it valid?\" \"Does it exist?\" \"Is it safe?\"\n</code></pre></p>"},{"location":"concepts/shift-left/#how-nthlayer-shifts-reliability-left","title":"How NthLayer Shifts Reliability Left","text":""},{"location":"concepts/shift-left/#1-contract-verification-nthlayer-verify","title":"1. Contract Verification (<code>nthlayer verify</code>)","text":"<p>Before deploying, verify that the metrics your SLOs depend on actually exist in Prometheus:</p> <pre><code>$ nthlayer verify service.yaml --prometheus-url $PROM_URL\n\nVerifying metrics for payment-api...\n\n  \u2713 http_requests_total{service=\"payment-api\"}\n  \u2713 http_request_duration_seconds_bucket{service=\"payment-api\"}\n  \u2717 http_requests_total{service=\"payment-api\",status=~\"5..\"}  NOT FOUND\n\nContract verification failed: 1 metric(s) not found\n</code></pre> <p>Pipeline integration: <pre><code># GitHub Actions\n- name: Verify SLO Metrics\n  run: nthlayer verify service.yaml --prometheus-url $PROM_URL\n  # Fails pipeline if metrics don't exist\n</code></pre></p>"},{"location":"concepts/shift-left/#2-deployment-gates-nthlayer-check-deploy","title":"2. Deployment Gates (<code>nthlayer check-deploy</code>)","text":"<p>Block deployments when error budget is exhausted:</p> <pre><code>$ nthlayer check-deploy service.yaml --prometheus-url $PROM_URL\n\n\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502  Deployment Gate Check                                       \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n\n  Service:       payment-api\n  Tier:          critical\n  Window:        30d\n\n  SLO Results:\n    availability   99.87%  (target: 99.95%)   budget: 42% remaining   \u26a0 WARNING\n    latency_p99    187ms   (target: 200ms)    budget: 78% remaining   \u2713 OK\n\n  Decision:  \u26a0 PROCEED WITH CAUTION\n</code></pre> <p>Exit codes: - <code>0</code> - Deploy approved - <code>1</code> - Warning (budget low, but allowed) - <code>2</code> - Blocked (budget exhausted)</p>"},{"location":"concepts/shift-left/#3-promql-validation-nthlayer-apply-lint","title":"3. PromQL Validation (<code>nthlayer apply --lint</code>)","text":"<p>Catch syntax errors before they reach Prometheus:</p> <pre><code>$ nthlayer apply service.yaml --lint\n\nApplied 4 resources in 0.3s \u2192 generated/payment-api/\n\nValidating alerts with pint...\n  \u2713 12 rules validated\n\n  \u26a0 [promql/series] Line 45: metric \"http_errors_total\" not found\n</code></pre>"},{"location":"concepts/shift-left/#the-google-sre-connection","title":"The Google SRE Connection","text":"<p>NthLayer automates concepts from the Google SRE Book:</p> SRE Concept Manual Process NthLayer Automation Production Readiness Review Multi-week checklist <code>nthlayer verify</code> in CI Error Budget Policy Spreadsheet tracking <code>nthlayer check-deploy</code> gates Release Engineering Manual runbooks Generated artifacts + GitOps Monitoring Standards Wiki pages <code>service.yaml</code> spec"},{"location":"concepts/shift-left/#cicd-pipeline-example","title":"CI/CD Pipeline Example","text":""},{"location":"concepts/shift-left/#tekton-pipeline","title":"Tekton Pipeline","text":"<pre><code>apiVersion: tekton.dev/v1\nkind: Pipeline\nmetadata:\n  name: deploy-with-reliability-gates\nspec:\n  tasks:\n    - name: generate\n      taskRef:\n        name: nthlayer-apply\n      params:\n        - name: service-file\n          value: service.yaml\n\n    - name: verify-metrics\n      taskRef:\n        name: nthlayer-verify\n      runAfter: [generate]\n\n    - name: check-budget\n      taskRef:\n        name: nthlayer-check-deploy\n      runAfter: [verify-metrics]\n\n    - name: deploy\n      taskRef:\n        name: kubectl-apply\n      runAfter: [check-budget]\n      # Only runs if all gates pass\n</code></pre>"},{"location":"concepts/shift-left/#github-actions","title":"GitHub Actions","text":"<pre><code>jobs:\n  deploy:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Install NthLayer\n        run: pip install nthlayer\n\n      - name: Generate &amp; Lint\n        run: nthlayer apply service.yaml --lint\n\n      - name: Verify Metrics Exist\n        run: nthlayer verify service.yaml --prometheus-url $PROM_URL\n        env:\n          PROM_URL: ${{ secrets.PROMETHEUS_URL }}\n\n      - name: Check Deployment Gate\n        run: nthlayer check-deploy service.yaml --prometheus-url $PROM_URL\n        env:\n          PROM_URL: ${{ secrets.PROMETHEUS_URL }}\n\n      - name: Deploy\n        if: success()\n        run: kubectl apply -f generated/\n</code></pre>"},{"location":"concepts/shift-left/#benefits","title":"Benefits","text":""},{"location":"concepts/shift-left/#prevent-dont-react","title":"Prevent, Don't React","text":"Traditional Shift Left Deploy first, monitor later Validate before deploy Alert after incident Block risky deploys SLOs as documentation SLOs as enforcement Manual PRR checklist Automated verification"},{"location":"concepts/shift-left/#measurable-outcomes","title":"Measurable Outcomes","text":"<p>Teams using reliability shift left typically see:</p> <ul> <li>60% reduction in incidents caused by missing monitoring</li> <li>80% faster SLO setup (5 min vs 20 hours)</li> <li>Zero deploys with missing metrics</li> <li>Reduced MTTR - dashboards exist from day 1</li> </ul>"},{"location":"concepts/shift-left/#see-also","title":"See Also","text":"<ul> <li>Contract Verification - Full <code>verify</code> command reference</li> <li>Deployment Gates - Full <code>check-deploy</code> reference</li> <li>SLO Concepts - Understanding SLOs and error budgets</li> </ul>"},{"location":"concepts/slos/","title":"SLOs &amp; Error Budgets","text":"<p>Service Level Objectives (SLOs) are the foundation of reliability engineering.</p>"},{"location":"concepts/slos/#what-is-an-slo","title":"What is an SLO?","text":"<p>An SLO is a target for service reliability, expressed as:</p> <p>\"99.9% of requests should succeed over a 30-day window\"</p> <p>Components:</p> <ul> <li>Objective: The target (99.9%)</li> <li>Indicator: What we measure (successful requests)</li> <li>Window: Time period (30 days)</li> </ul>"},{"location":"concepts/slos/#error-budgets","title":"Error Budgets","text":"<p>The error budget is the inverse of your SLO:</p> <pre><code>Error Budget = 100% - SLO Objective\n</code></pre> <p>For a 99.9% SLO over 30 days:</p> <pre><code>Error Budget = 0.1% \u00d7 30 days \u00d7 24 hours \u00d7 60 minutes\n             = 43.2 minutes of allowed downtime\n</code></pre>"},{"location":"concepts/slos/#how-nthlayer-uses-slos","title":"How NthLayer Uses SLOs","text":""},{"location":"concepts/slos/#1-automatic-generation","title":"1. Automatic Generation","text":"<p>Define your tier, get sensible defaults:</p> <pre><code>name: payment-api\ntier: critical  # Gets 99.95% availability target\ntype: api\n</code></pre>"},{"location":"concepts/slos/#2-dashboard-visualization","title":"2. Dashboard Visualization","text":"<p>Generated dashboards show:</p> <ul> <li>Current SLO compliance</li> <li>Error budget remaining</li> <li>Burn rate trends</li> </ul>"},{"location":"concepts/slos/#3-portfolio-view","title":"3. Portfolio View","text":"<p>See all services at once:</p> <pre><code>nthlayer portfolio\n</code></pre>"},{"location":"concepts/slos/#4-live-queries","title":"4. Live Queries","text":"<p>Query Prometheus for real-time status:</p> <pre><code>nthlayer slo collect payment-api.yaml\n</code></pre>"},{"location":"concepts/slos/#slo-types","title":"SLO Types","text":""},{"location":"concepts/slos/#availability-slo","title":"Availability SLO","text":"<p>Percentage of successful requests:</p> <pre><code>resources:\n  - kind: SLO\n    name: availability\n    spec:\n      objective: 99.95\n      window: 30d\n      indicator:\n        type: availability\n        query: |\n          sum(rate(http_requests_total{service=\"$service\",status!~\"5..\"}[5m])) /\n          sum(rate(http_requests_total{service=\"$service\"}[5m]))\n</code></pre>"},{"location":"concepts/slos/#latency-slo","title":"Latency SLO","text":"<p>Percentage of requests under a threshold:</p> <pre><code>resources:\n  - kind: SLO\n    name: latency-p99\n    spec:\n      objective: 99.0\n      window: 30d\n      threshold_ms: 200\n      indicator:\n        type: latency\n        percentile: 99\n        query: |\n          histogram_quantile(0.99,\n            sum by (le) (rate(http_request_duration_seconds_bucket{service=\"$service\"}[5m]))\n          )\n</code></pre>"},{"location":"concepts/slos/#throughput-slo","title":"Throughput SLO","text":"<p>Minimum requests/operations per second:</p> <pre><code>resources:\n  - kind: SLO\n    name: throughput\n    spec:\n      objective: 99.0\n      window: 30d\n      threshold_rps: 100\n      indicator:\n        type: throughput\n        query: sum(rate(http_requests_total{service=\"$service\"}[5m]))\n</code></pre>"},{"location":"concepts/slos/#tier-based-defaults","title":"Tier-Based Defaults","text":"Tier Availability Latency (p99) Error Budget Critical 99.95% 200ms 21.6 min/month Standard 99.9% 500ms 43.2 min/month Low 99.5% 1000ms 216 min/month"},{"location":"concepts/slos/#budget-consumption","title":"Budget Consumption","text":"<p>NthLayer tracks how much budget has been consumed:</p> Status Budget Consumed Action Healthy &lt; 80% Continue normal development Warning 80-100% Slow down, focus on stability Critical 100-150% Freeze changes, investigate Exhausted &gt; 150% Incident mode, all hands"},{"location":"concepts/slos/#best-practices","title":"Best Practices","text":""},{"location":"concepts/slos/#1-start-conservative","title":"1. Start Conservative","text":"<p>Begin with achievable targets and tighten over time:</p> <pre><code># Start here\ntier: standard  # 99.9%\n\n# After proving stability\ntier: critical  # 99.95%\n</code></pre>"},{"location":"concepts/slos/#2-match-business-impact","title":"2. Match Business Impact","text":"<p>Tier should reflect business criticality:</p> <ul> <li>Critical: Payment processing, authentication</li> <li>Standard: Main application features</li> <li>Low: Internal tools, analytics</li> </ul>"},{"location":"concepts/slos/#3-use-multiple-slos","title":"3. Use Multiple SLOs","text":"<p>Cover different failure modes:</p> <pre><code>resources:\n  - kind: SLO\n    name: availability\n    spec:\n      objective: 99.95\n\n  - kind: SLO\n    name: latency-p99\n    spec:\n      objective: 99.0\n      threshold_ms: 200\n\n  - kind: SLO\n    name: latency-p50\n    spec:\n      objective: 99.9\n      threshold_ms: 50\n</code></pre>"},{"location":"concepts/slos/#4-review-regularly","title":"4. Review Regularly","text":"<p>Use the portfolio view for weekly reviews:</p> <pre><code>nthlayer portfolio --format json &gt; slo-review-$(date +%Y%m%d).json\n</code></pre>"},{"location":"concepts/slos/#further-reading","title":"Further Reading","text":"<ul> <li>Google SRE Book - SLOs</li> <li>The Art of SLOs</li> </ul>"},{"location":"getting-started/first-service/","title":"Your First Service","text":"<p>Learn how to create a complete service specification.</p>"},{"location":"getting-started/first-service/#minimal-service","title":"Minimal Service","text":"<p>The simplest service spec:</p> <pre><code>name: my-api\ntier: standard\ntype: api\n</code></pre> <p>This generates default SLOs for a standard API (99.9% availability, 500ms p99 latency).</p>"},{"location":"getting-started/first-service/#complete-service-example","title":"Complete Service Example","text":"<pre><code>name: payment-api\nteam: payments\ntier: critical        # 1=critical, 2=standard, 3=low\ntype: api             # api, worker, stream\n\n# Technology dependencies\ndependencies:\n  - postgresql\n  - redis\n\n# Custom SLO overrides\nresources:\n  - kind: SLO\n    name: availability\n    spec:\n      objective: 99.95\n      window: 30d\n      indicator:\n        type: availability\n        query: |\n          sum(rate(http_requests_total{service=\"payment-api\",status!~\"5..\"}[5m])) /\n          sum(rate(http_requests_total{service=\"payment-api\"}[5m]))\n\n  - kind: SLO\n    name: latency-p99\n    spec:\n      objective: 99.0\n      window: 30d\n      threshold_ms: 200\n      indicator:\n        type: latency\n        percentile: 99\n\n  # PagerDuty configuration\n  - kind: PagerDuty\n    name: alerting\n    spec:\n      urgency: high\n      auto_create: true\n</code></pre>"},{"location":"getting-started/first-service/#service-tiers","title":"Service Tiers","text":"Tier Availability Latency (p99) Escalation 1 (Critical) 99.95% 200ms 5 min 2 (Standard) 99.9% 500ms 15 min 3 (Low) 99.5% 1000ms 30 min"},{"location":"getting-started/first-service/#service-types","title":"Service Types","text":"Type Description Key Metrics api HTTP/REST services Request rate, latency, error rate worker Background jobs Job throughput, duration, failure rate stream Event processors Messages/sec, lag, processing time"},{"location":"getting-started/first-service/#dependencies","title":"Dependencies","text":"<p>NthLayer generates monitoring for these technologies:</p> DatabasesMessage QueuesProxiesInfrastructure <ul> <li><code>postgresql</code> - Connections, replication, locks</li> <li><code>mysql</code> - Connections, queries, replication</li> <li><code>mongodb</code> - Connections, operations, replication</li> <li><code>redis</code> - Memory, connections, hit rate</li> <li><code>elasticsearch</code> - Cluster health, indexing, search</li> </ul> <ul> <li><code>kafka</code> - Consumer lag, partitions, throughput</li> <li><code>rabbitmq</code> - Queue depth, consumers, rates</li> <li><code>nats</code> - Connections, messages, subscriptions</li> <li><code>pulsar</code> - Throughput, backlog, storage</li> </ul> <ul> <li><code>nginx</code> - Requests, connections, upstream</li> <li><code>haproxy</code> - Backend health, response time</li> <li><code>traefik</code> - Requests, entrypoints</li> </ul> <ul> <li><code>kubernetes</code> - Pod health, resources</li> <li><code>etcd</code> - Leader, proposals, DB size</li> <li><code>consul</code> - Health checks, services</li> </ul>"},{"location":"getting-started/first-service/#generate-and-apply","title":"Generate and Apply","text":"<pre><code># Preview what will be generated\nnthlayer plan payment-api.yaml\n\n# Generate all configs\nnthlayer apply payment-api.yaml\n\n# Push dashboard to Grafana (if configured)\nnthlayer apply payment-api.yaml --push\n</code></pre>"},{"location":"getting-started/first-service/#next-steps","title":"Next Steps","text":"<ul> <li>nthlayer apply - Full apply options</li> <li>Technologies - All 18 templates</li> <li>Service YAML Schema - Complete schema reference</li> </ul>"},{"location":"getting-started/installation/","title":"Installation","text":""},{"location":"getting-started/installation/#requirements","title":"Requirements","text":"<ul> <li>Python 3.11 or higher</li> <li>pip or pipx</li> </ul>"},{"location":"getting-started/installation/#install-with-pipx-recommended","title":"Install with pipx (Recommended)","text":"<pre><code>pipx install nthlayer\n</code></pre> <p>This installs NthLayer in an isolated environment.</p>"},{"location":"getting-started/installation/#install-with-pip","title":"Install with pip","text":"<pre><code>pip install nthlayer\n</code></pre>"},{"location":"getting-started/installation/#verify-installation","title":"Verify Installation","text":"<pre><code>nthlayer --version\n</code></pre>"},{"location":"getting-started/installation/#development-installation","title":"Development Installation","text":"<p>For contributors:</p> <pre><code>git clone https://github.com/rsionnach/nthlayer.git\ncd nthlayer\npip install -e \".[dev]\"\n</code></pre>"},{"location":"getting-started/installation/#next-steps","title":"Next Steps","text":"<ul> <li>Quick Start - Generate your first configs</li> <li>Your First Service - Create a service spec</li> </ul>"},{"location":"getting-started/quick-start/","title":"Quick Start","text":"<p>Generate your complete reliability stack in 5 minutes.</p>"},{"location":"getting-started/quick-start/#1-install-nthlayer","title":"1. Install NthLayer","text":"<pre><code>pipx install nthlayer\n</code></pre>"},{"location":"getting-started/quick-start/#2-run-interactive-setup","title":"2. Run Interactive Setup","text":"<pre><code>nthlayer setup\n</code></pre> <p>This guides you through configuring:</p> <ul> <li>Prometheus - For metric discovery and SLO queries</li> <li>Grafana - For dashboard deployment (optional)</li> <li>PagerDuty - For alerting integration (optional)</li> </ul> <p>Example output: <pre><code>================================================================================\n  Welcome to NthLayer!\n================================================================================\n\nQuick Setup\n----------------------------------------\n1. Prometheus Configuration\n   Prometheus URL [http://localhost:9090]:\n\n2. Grafana Configuration (optional)\n   Configure Grafana? [Y/n]: y\n   Grafana URL [http://localhost:3000]:\n   API Key: ****\n\nTesting Connections\n----------------------------------------\n  Prometheus (http://localhost:9090)\n    [OK] Connected (Prometheus 2.45.0)\n\n  Grafana (http://localhost:3000)\n    [OK] Connected - Org: Main Org\n\nConfiguration saved to: ~/.nthlayer/config.yaml\n</code></pre></p>"},{"location":"getting-started/quick-start/#3-create-a-service-spec","title":"3. Create a Service Spec","text":"<p>Create <code>payment-api.yaml</code>:</p> <pre><code>name: payment-api\ntier: critical\ntype: api\nteam: payments\n\ndependencies:\n  - postgresql\n  - redis\n</code></pre>"},{"location":"getting-started/quick-start/#4-generate-configs","title":"4. Generate Configs","text":"<pre><code>nthlayer apply payment-api.yaml\n</code></pre> <p>Output: <pre><code>Generated: generated/payment-api/\n\u251c\u2500\u2500 dashboard.json       # Import to Grafana\n\u251c\u2500\u2500 alerts.yaml          # Add to Prometheus\n\u251c\u2500\u2500 slos.yaml            # OpenSLO format\n\u2514\u2500\u2500 recording-rules.yaml # Prometheus rules\n</code></pre></p>"},{"location":"getting-started/quick-start/#5-view-your-slo-portfolio","title":"5. View Your SLO Portfolio","text":"<pre><code>nthlayer portfolio\n</code></pre> <pre><code>================================================================================\n  NthLayer SLO Portfolio\n================================================================================\n\nOrganization Health: 100% (1/1 services meeting SLOs)\n\nBy Tier:\n  Critical:  100%  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588  1/1 services\n</code></pre>"},{"location":"getting-started/quick-start/#next-steps","title":"Next Steps","text":"<ul> <li>Your First Service - Detailed service spec guide</li> <li>Commands - Full CLI reference</li> <li>Technologies - 18 supported technologies</li> </ul>"},{"location":"integrations/cicd/","title":"CI/CD Integration","text":"<p>Integrate NthLayer into your deployment pipeline for automated reliability validation.</p>"},{"location":"integrations/cicd/#the-reliability-pipeline","title":"The Reliability Pipeline","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Generate \u2502 \u2192 \u2502 Validate \u2502 \u2192 \u2502  Protect \u2502 \u2192 \u2502  Deploy  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n  apply          validate-spec   check-deploy    kubectl\n                 verify                          argocd\n                 --lint\n</code></pre>"},{"location":"integrations/cicd/#github-actions","title":"GitHub Actions","text":""},{"location":"integrations/cicd/#complete-workflow","title":"Complete Workflow","text":"<pre><code>name: Deploy with Reliability Gates\n\non:\n  push:\n    branches: [main]\n    paths:\n      - 'services/**'\n\njobs:\n  validate:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Install NthLayer\n        run: pip install nthlayer\n\n      - name: Validate Service Specs\n        run: nthlayer validate-spec services/\n\n      - name: Generate Configs\n        run: nthlayer apply services/*.yaml --lint\n\n      - name: Upload Artifacts\n        uses: actions/upload-artifact@v4\n        with:\n          name: generated-configs\n          path: generated/\n\n  verify:\n    needs: validate\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Install NthLayer\n        run: pip install nthlayer\n\n      - name: Verify Metrics Exist\n        run: |\n          nthlayer verify services/*.yaml \\\n            --prometheus-url ${{ secrets.STAGING_PROMETHEUS_URL }}\n        env:\n          PROMETHEUS_USERNAME: ${{ secrets.PROMETHEUS_USERNAME }}\n          PROMETHEUS_PASSWORD: ${{ secrets.PROMETHEUS_PASSWORD }}\n\n  gate:\n    needs: verify\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Install NthLayer\n        run: pip install nthlayer\n\n      - name: Check Deployment Gate\n        id: gate\n        run: |\n          nthlayer check-deploy services/*.yaml \\\n            --prometheus-url ${{ secrets.PROD_PROMETHEUS_URL }}\n          echo \"exit_code=$?\" &gt;&gt; $GITHUB_OUTPUT\n        continue-on-error: true\n\n      - name: Block on Budget Exhausted\n        if: steps.gate.outputs.exit_code == '2'\n        run: |\n          echo \"::error::Deployment blocked - error budget exhausted\"\n          exit 1\n\n  deploy:\n    needs: gate\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Download Configs\n        uses: actions/download-artifact@v4\n        with:\n          name: generated-configs\n          path: generated/\n\n      - name: Deploy to Kubernetes\n        run: kubectl apply -f generated/\n</code></pre>"},{"location":"integrations/cicd/#reusable-action-coming-soon","title":"Reusable Action (Coming Soon)","text":"<pre><code>- uses: nthlayer/action@v1\n  with:\n    command: check-deploy\n    service-file: services/api.yaml\n    prometheus-url: ${{ secrets.PROMETHEUS_URL }}\n</code></pre>"},{"location":"integrations/cicd/#gitlab-ci","title":"GitLab CI","text":"<pre><code>stages:\n  - validate\n  - verify\n  - gate\n  - deploy\n\nvariables:\n  PIP_CACHE_DIR: \"$CI_PROJECT_DIR/.pip-cache\"\n\n.nthlayer:\n  image: python:3.11\n  before_script:\n    - pip install nthlayer\n\nvalidate:\n  extends: .nthlayer\n  stage: validate\n  script:\n    - nthlayer validate-spec services/\n    - nthlayer apply services/*.yaml --lint\n  artifacts:\n    paths:\n      - generated/\n\nverify:\n  extends: .nthlayer\n  stage: verify\n  script:\n    - nthlayer verify services/*.yaml --prometheus-url $STAGING_PROMETHEUS_URL\n\ngate:\n  extends: .nthlayer\n  stage: gate\n  script:\n    - |\n      nthlayer check-deploy services/*.yaml \\\n        --prometheus-url $PROD_PROMETHEUS_URL\n      EXIT_CODE=$?\n      if [ $EXIT_CODE -eq 2 ]; then\n        echo \"Deployment blocked - error budget exhausted\"\n        exit 1\n      fi\n  only:\n    - main\n\ndeploy:\n  stage: deploy\n  script:\n    - kubectl apply -f generated/\n  only:\n    - main\n  when: on_success\n</code></pre>"},{"location":"integrations/cicd/#argocd","title":"ArgoCD","text":""},{"location":"integrations/cicd/#presync-hook","title":"PreSync Hook","text":"<p>Block ArgoCD sync when error budget is exhausted:</p> <pre><code>apiVersion: batch/v1\nkind: Job\nmetadata:\n  name: nthlayer-gate\n  annotations:\n    argocd.argoproj.io/hook: PreSync\n    argocd.argoproj.io/hook-delete-policy: HookSucceeded\nspec:\n  template:\n    spec:\n      containers:\n        - name: check-deploy\n          image: ghcr.io/nthlayer/nthlayer:latest\n          command:\n            - nthlayer\n            - check-deploy\n            - /config/service.yaml\n            - --prometheus-url\n            - $(PROMETHEUS_URL)\n          envFrom:\n            - secretRef:\n                name: prometheus-credentials\n          volumeMounts:\n            - name: service-config\n              mountPath: /config\n      volumes:\n        - name: service-config\n          configMap:\n            name: service-yaml\n      restartPolicy: Never\n  backoffLimit: 0\n</code></pre>"},{"location":"integrations/cicd/#application-manifest","title":"Application Manifest","text":"<pre><code>apiVersion: argoproj.io/v1alpha1\nkind: Application\nmetadata:\n  name: payment-api\nspec:\n  source:\n    repoURL: https://github.com/org/repo\n    path: services/payment-api\n  syncPolicy:\n    automated:\n      prune: true\n      selfHeal: true\n    syncOptions:\n      - CreateNamespace=true\n</code></pre> <p>When the PreSync hook fails (exit code 2), ArgoCD blocks the sync.</p>"},{"location":"integrations/cicd/#tekton","title":"Tekton","text":""},{"location":"integrations/cicd/#task-definition","title":"Task Definition","text":"<pre><code>apiVersion: tekton.dev/v1\nkind: Task\nmetadata:\n  name: nthlayer-check-deploy\nspec:\n  params:\n    - name: service-file\n      type: string\n    - name: prometheus-url\n      type: string\n  steps:\n    - name: check\n      image: ghcr.io/nthlayer/nthlayer:latest\n      script: |\n        nthlayer check-deploy $(params.service-file) \\\n          --prometheus-url $(params.prometheus-url)\n\n        EXIT_CODE=$?\n        if [ $EXIT_CODE -eq 2 ]; then\n          echo \"Deployment blocked\"\n          exit 1\n        fi\n</code></pre>"},{"location":"integrations/cicd/#pipeline","title":"Pipeline","text":"<pre><code>apiVersion: tekton.dev/v1\nkind: Pipeline\nmetadata:\n  name: deploy-with-gates\nspec:\n  params:\n    - name: service-file\n      type: string\n    - name: prometheus-url\n      type: string\n\n  tasks:\n    - name: validate\n      taskRef:\n        name: nthlayer-validate\n\n    - name: generate\n      taskRef:\n        name: nthlayer-apply\n      runAfter: [validate]\n\n    - name: verify\n      taskRef:\n        name: nthlayer-verify\n      runAfter: [generate]\n\n    - name: gate\n      taskRef:\n        name: nthlayer-check-deploy\n      runAfter: [verify]\n      params:\n        - name: service-file\n          value: $(params.service-file)\n        - name: prometheus-url\n          value: $(params.prometheus-url)\n\n    - name: deploy\n      taskRef:\n        name: kubectl-apply\n      runAfter: [gate]\n</code></pre>"},{"location":"integrations/cicd/#jenkins","title":"Jenkins","text":"<pre><code>pipeline {\n    agent any\n\n    environment {\n        PROMETHEUS_URL = credentials('prometheus-url')\n    }\n\n    stages {\n        stage('Validate') {\n            steps {\n                sh 'pip install nthlayer'\n                sh 'nthlayer validate-spec services/'\n                sh 'nthlayer apply services/*.yaml --lint'\n            }\n        }\n\n        stage('Verify') {\n            steps {\n                sh \"\"\"\n                    nthlayer verify services/*.yaml \\\n                        --prometheus-url ${PROMETHEUS_URL}\n                \"\"\"\n            }\n        }\n\n        stage('Gate') {\n            steps {\n                script {\n                    def exitCode = sh(\n                        script: \"\"\"\n                            nthlayer check-deploy services/*.yaml \\\n                                --prometheus-url ${PROMETHEUS_URL}\n                        \"\"\",\n                        returnStatus: true\n                    )\n                    if (exitCode == 2) {\n                        error('Deployment blocked - error budget exhausted')\n                    }\n                }\n            }\n        }\n\n        stage('Deploy') {\n            steps {\n                sh 'kubectl apply -f generated/'\n            }\n        }\n    }\n}\n</code></pre>"},{"location":"integrations/cicd/#environment-variables","title":"Environment Variables","text":"<p>All CI/CD integrations support these environment variables:</p> Variable Description <code>PROMETHEUS_URL</code> Prometheus server URL <code>PROMETHEUS_USERNAME</code> Basic auth username <code>PROMETHEUS_PASSWORD</code> Basic auth password <code>GRAFANA_URL</code> Grafana server URL <code>GRAFANA_API_KEY</code> Grafana API key"},{"location":"integrations/cicd/#best-practices","title":"Best Practices","text":""},{"location":"integrations/cicd/#1-validate-early-protect-late","title":"1. Validate Early, Protect Late","text":"<pre><code>commit \u2192 validate-spec \u2192 apply --lint \u2192 verify \u2192 check-deploy \u2192 deploy\n           \u2191                               \u2191           \u2191\n       No Prometheus              Staging Prom   Prod Prom\n</code></pre>"},{"location":"integrations/cicd/#2-use-staging-for-verification","title":"2. Use Staging for Verification","text":"<p>Verify metrics exist in staging before checking production gates:</p> <pre><code>- name: Verify in Staging\n  run: nthlayer verify services/*.yaml --prometheus-url $STAGING_URL\n\n- name: Gate in Production\n  run: nthlayer check-deploy services/*.yaml --prometheus-url $PROD_URL\n</code></pre>"},{"location":"integrations/cicd/#3-cache-nthlayer-installation","title":"3. Cache NthLayer Installation","text":"<pre><code>- uses: actions/cache@v4\n  with:\n    path: ~/.cache/pip\n    key: ${{ runner.os }}-pip-nthlayer\n</code></pre>"},{"location":"integrations/cicd/#4-fail-fast","title":"4. Fail Fast","text":"<p>Put validation early in your pipeline to catch issues quickly.</p>"},{"location":"integrations/cicd/#see-also","title":"See Also","text":"<ul> <li>Deployment Gates</li> <li>Contract Verification</li> <li>Validation Overview</li> </ul>"},{"location":"integrations/grafana/","title":"Grafana Integration","text":"<p>NthLayer generates and optionally pushes dashboards to Grafana.</p>"},{"location":"integrations/grafana/#configuration","title":"Configuration","text":""},{"location":"integrations/grafana/#via-setup-wizard","title":"Via Setup Wizard","text":"<pre><code>nthlayer setup\n</code></pre>"},{"location":"integrations/grafana/#via-environment-variables","title":"Via Environment Variables","text":"<pre><code>export NTHLAYER_GRAFANA_URL=http://grafana:3000\nexport NTHLAYER_GRAFANA_API_KEY=glsa_xxxxxxxxxxxx\nexport NTHLAYER_GRAFANA_ORG_ID=1  # Optional, default: 1\n</code></pre>"},{"location":"integrations/grafana/#via-config-file","title":"Via Config File","text":"<pre><code># ~/.nthlayer/config.yaml\ngrafana:\n  default: default\n  profiles:\n    default:\n      url: http://localhost:3000\n      type: grafana\n      org_id: 1\n      api_key_secret: grafana/api_key\n</code></pre>"},{"location":"integrations/grafana/#supported-backends","title":"Supported Backends","text":"Type Description <code>grafana</code> Self-hosted Grafana <code>grafana-cloud</code> Grafana Cloud"},{"location":"integrations/grafana/#creating-an-api-key","title":"Creating an API Key","text":"<ol> <li>Go to Administration &gt; Service accounts</li> <li>Create a new service account</li> <li>Add a token with Editor role</li> <li>Copy the token (starts with <code>glsa_</code>)</li> </ol>"},{"location":"integrations/grafana/#dashboard-generation","title":"Dashboard Generation","text":""},{"location":"integrations/grafana/#generate-only-default","title":"Generate Only (Default)","text":"<pre><code>nthlayer apply payment-api.yaml\n</code></pre> <p>Creates <code>generated/payment-api/dashboard.json</code> - import manually to Grafana.</p>"},{"location":"integrations/grafana/#auto-push-to-grafana","title":"Auto-Push to Grafana","text":"<pre><code>nthlayer apply payment-api.yaml --push\n</code></pre> <p>Pushes directly to Grafana API.</p>"},{"location":"integrations/grafana/#dashboard-structure","title":"Dashboard Structure","text":"<p>Generated dashboards include:</p>"},{"location":"integrations/grafana/#slo-metrics-row","title":"SLO Metrics Row","text":"<ul> <li>Availability - Current vs target</li> <li>Error Budget - Remaining budget gauge</li> <li>Latency P99 - Current latency vs threshold</li> </ul>"},{"location":"integrations/grafana/#service-health-row","title":"Service Health Row","text":"<ul> <li>Request Rate - Requests per second</li> <li>Error Rate - 5xx errors percentage</li> <li>Active Connections - Current connections</li> <li>Saturation - Resource utilization</li> </ul>"},{"location":"integrations/grafana/#dependencies-row","title":"Dependencies Row","text":"<p>One row per dependency with technology-specific panels:</p> <ul> <li>PostgreSQL: Connections, replication lag, locks</li> <li>Redis: Memory usage, hit rate, connections</li> <li>Kafka: Consumer lag, partition status</li> </ul>"},{"location":"integrations/grafana/#dashboard-variables","title":"Dashboard Variables","text":"<p>Dashboards include variables for filtering:</p> Variable Description <code>$service</code> Service name <code>$environment</code> Environment (dev/staging/prod)"},{"location":"integrations/grafana/#manual-import","title":"Manual Import","text":"<p>If not using <code>--push</code>:</p> <ol> <li>Go to Dashboards &gt; Import</li> <li>Upload <code>generated/&lt;service&gt;/dashboard.json</code></li> <li>Select Prometheus data source</li> <li>Click Import</li> </ol>"},{"location":"integrations/grafana/#testing-connection","title":"Testing Connection","text":"<pre><code>nthlayer setup --test\n</code></pre> <pre><code>  Grafana (http://localhost:3000)\n    [OK] Connected - Org: Main Org\n</code></pre>"},{"location":"integrations/grafana/#troubleshooting","title":"Troubleshooting","text":""},{"location":"integrations/grafana/#invalid-api-key","title":"Invalid API Key","text":"<pre><code>[FAIL] Invalid API key\n</code></pre> <ul> <li>Verify token starts with <code>glsa_</code></li> <li>Check token has Editor role</li> <li>Ensure token isn't expired</li> </ul>"},{"location":"integrations/grafana/#dashboard-already-exists","title":"Dashboard Already Exists","text":"<p>Dashboards are upserted by UID. Existing dashboards with the same UID are updated.</p>"},{"location":"integrations/grafana/#wrong-organization","title":"Wrong Organization","text":"<p>Set <code>NTHLAYER_GRAFANA_ORG_ID</code> if using multiple orgs:</p> <pre><code>export NTHLAYER_GRAFANA_ORG_ID=2\n</code></pre>"},{"location":"integrations/mimir/","title":"Mimir/Cortex Integration","text":"<p>Push alert rules directly to Grafana Mimir or Cortex via the Ruler API.</p>"},{"location":"integrations/mimir/#overview","title":"Overview","text":"<p>NthLayer can push generated alert rules directly to Mimir or Cortex, eliminating the need for manual file deployment. This is ideal for GitOps workflows where you want to:</p> <ol> <li>Generate alerts from <code>service.yaml</code></li> <li>Push directly to Mimir/Cortex Ruler API</li> <li>Rules become active immediately</li> </ol>"},{"location":"integrations/mimir/#setup","title":"Setup","text":""},{"location":"integrations/mimir/#environment-variables","title":"Environment Variables","text":"<pre><code># Required: Mimir Ruler API URL\nexport MIMIR_RULER_URL=https://your-mimir:8080\n\n# Optional: Multi-tenant setups\nexport MIMIR_TENANT_ID=your-tenant\n\n# Optional: Authentication\nexport MIMIR_API_KEY=your-api-key          # Bearer token\n# OR\nexport MIMIR_USERNAME=your-username        # Basic auth\nexport MIMIR_PASSWORD=your-password\n</code></pre>"},{"location":"integrations/mimir/#usage","title":"Usage","text":""},{"location":"integrations/mimir/#push-alerts-to-mimir","title":"Push Alerts to Mimir","text":"<pre><code>nthlayer apply service.yaml --push-ruler\n</code></pre> <p>Output: <pre><code>Applied 4 resources in 0.3s \u2192 generated/payment-api/\n\nPushing alerts to Mimir Ruler...\n  URL: https://mimir:8080\n  Tenant: my-tenant\n  \u2713 Pushed 2 rule group(s) to namespace 'payment-api'\n</code></pre></p>"},{"location":"integrations/mimir/#combined-with-grafana-push","title":"Combined with Grafana Push","text":"<pre><code># Push dashboards to Grafana AND alerts to Mimir\nnthlayer apply service.yaml --push --push-ruler\n</code></pre>"},{"location":"integrations/mimir/#api-details","title":"API Details","text":"<p>NthLayer uses the Mimir Ruler API:</p> Endpoint Method Description <code>/api/v1/rules/{namespace}</code> POST Create/update rule groups <code>/api/v1/rules/{namespace}</code> DELETE Delete all rules in namespace <code>/api/v1/rules/{namespace}/{groupName}</code> DELETE Delete specific group <code>/api/v1/rules</code> GET List all rules <p>The namespace is set to the service name from <code>service.yaml</code>.</p>"},{"location":"integrations/mimir/#tekton-pipeline-example","title":"Tekton Pipeline Example","text":"<pre><code>apiVersion: tekton.dev/v1\nkind: Task\nmetadata:\n  name: nthlayer-apply\nspec:\n  params:\n    - name: service-file\n      type: string\n  steps:\n    - name: generate-and-push\n      image: python:3.11-slim\n      env:\n        - name: MIMIR_RULER_URL\n          valueFrom:\n            secretKeyRef:\n              name: mimir-credentials\n              key: url\n        - name: MIMIR_TENANT_ID\n          valueFrom:\n            secretKeyRef:\n              name: mimir-credentials\n              key: tenant-id\n        - name: MIMIR_API_KEY\n          valueFrom:\n            secretKeyRef:\n              name: mimir-credentials\n              key: api-key\n      script: |\n        pip install nthlayer\n        nthlayer apply $(params.service-file) --push-ruler --lint\n</code></pre>"},{"location":"integrations/mimir/#github-actions-example","title":"GitHub Actions Example","text":"<pre><code>jobs:\n  deploy-alerts:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Install NthLayer\n        run: pip install nthlayer\n\n      - name: Generate and Push Alerts\n        env:\n          MIMIR_RULER_URL: ${{ secrets.MIMIR_RULER_URL }}\n          MIMIR_TENANT_ID: ${{ secrets.MIMIR_TENANT_ID }}\n          MIMIR_API_KEY: ${{ secrets.MIMIR_API_KEY }}\n        run: |\n          nthlayer apply service.yaml --push-ruler --lint\n</code></pre>"},{"location":"integrations/mimir/#multi-tenant-setup","title":"Multi-Tenant Setup","text":"<p>For Mimir multi-tenant deployments, set the <code>MIMIR_TENANT_ID</code>:</p> <pre><code>export MIMIR_TENANT_ID=team-payments\nnthlayer apply payment-api.yaml --push-ruler\n</code></pre> <p>This sets the <code>X-Scope-OrgID</code> header on all API requests.</p>"},{"location":"integrations/mimir/#cortex-compatibility","title":"Cortex Compatibility","text":"<p>The Ruler API is compatible with both Grafana Mimir and Cortex. The same configuration works for either:</p> <pre><code># Mimir\nexport MIMIR_RULER_URL=https://mimir.example.com:8080\n\n# Cortex\nexport MIMIR_RULER_URL=https://cortex.example.com:9009\n</code></pre>"},{"location":"integrations/mimir/#troubleshooting","title":"Troubleshooting","text":""},{"location":"integrations/mimir/#connection-refused","title":"Connection Refused","text":"<pre><code>\u2717 Mimir error: Failed to connect to Mimir at https://mimir:8080/api/v1/rules/payment-api\n</code></pre> <ul> <li>Verify <code>MIMIR_RULER_URL</code> is correct</li> <li>Check network connectivity</li> <li>Ensure Ruler component is enabled in Mimir</li> </ul>"},{"location":"integrations/mimir/#authentication-failed","title":"Authentication Failed","text":"<pre><code>\u2717 Failed to push rules: 401 Unauthorized\n</code></pre> <ul> <li>Verify <code>MIMIR_API_KEY</code> or <code>MIMIR_USERNAME</code>/<code>MIMIR_PASSWORD</code></li> <li>Check tenant ID is correct for multi-tenant setups</li> </ul>"},{"location":"integrations/mimir/#invalid-yaml","title":"Invalid YAML","text":"<pre><code>\u2717 Failed to push rules: 400 Bad Request - invalid rule syntax\n</code></pre> <ul> <li>Run <code>nthlayer apply service.yaml --lint</code> first to validate</li> <li>Check PromQL queries are valid</li> </ul>"},{"location":"integrations/mimir/#see-also","title":"See Also","text":"<ul> <li>Prometheus Integration - Query metrics for verification</li> <li>Grafana Integration - Push dashboards</li> <li>CLI Reference - Full command options</li> </ul>"},{"location":"integrations/pagerduty/","title":"PagerDuty Integration","text":"<p>NthLayer can create and manage PagerDuty teams, services, and escalation policies.</p>"},{"location":"integrations/pagerduty/#configuration","title":"Configuration","text":""},{"location":"integrations/pagerduty/#via-setup-wizard","title":"Via Setup Wizard","text":"<pre><code>nthlayer setup\n</code></pre>"},{"location":"integrations/pagerduty/#via-environment-variable","title":"Via Environment Variable","text":"<pre><code>export PAGERDUTY_API_KEY=u+xxxxxxxxxxxxxxxxxx\n</code></pre>"},{"location":"integrations/pagerduty/#via-config-file","title":"Via Config File","text":"<pre><code># ~/.nthlayer/config.yaml\nalerting:\n  pagerduty:\n    enabled: true\n    api_key_secret: pagerduty/api_key\n    default_escalation_policy: P123ABC\n</code></pre>"},{"location":"integrations/pagerduty/#getting-an-api-key","title":"Getting an API Key","text":"<ol> <li>Go to Integrations &gt; API Access Keys</li> <li>Create a new REST API Key</li> <li>Select Full Access permissions</li> <li>Copy the key (starts with <code>u+</code>)</li> </ol>"},{"location":"integrations/pagerduty/#service-spec-configuration","title":"Service Spec Configuration","text":"<pre><code>name: payment-api\nteam: payments\ntier: critical\ntype: api\n\nresources:\n  - kind: PagerDuty\n    name: alerting\n    spec:\n      urgency: high           # high or low\n      auto_create: true       # Create team/service automatically\n      escalation_policy: P123ABC  # Optional: use existing policy\n</code></pre>"},{"location":"integrations/pagerduty/#what-gets-created","title":"What Gets Created","text":"<p>When <code>auto_create: true</code>:</p>"},{"location":"integrations/pagerduty/#team","title":"Team","text":"<pre><code>Name: payments\nDescription: Auto-created by NthLayer\n</code></pre>"},{"location":"integrations/pagerduty/#escalation-policy","title":"Escalation Policy","text":"<pre><code>Name: payments-escalation\nRules:\n  - Escalate to team \"payments\" after 5 minutes (critical)\n  - Escalate to team \"payments\" after 15 minutes (standard)\n</code></pre>"},{"location":"integrations/pagerduty/#service","title":"Service","text":"<pre><code>Name: payment-api\nDescription: payment-api reliability alerts\nEscalation Policy: payments-escalation\nUrgency: high\n</code></pre>"},{"location":"integrations/pagerduty/#tier-based-escalation","title":"Tier-Based Escalation","text":"Tier Urgency Escalation Time Critical (1) High 5 minutes Standard (2) Low 15 minutes Low (3) Low 30 minutes"},{"location":"integrations/pagerduty/#manual-setup","title":"Manual Setup","text":"<p>To use existing PagerDuty resources:</p> <pre><code>resources:\n  - kind: PagerDuty\n    name: alerting\n    spec:\n      auto_create: false\n      service_id: PXXXXXX\n      escalation_policy: PXXXXXX\n</code></pre>"},{"location":"integrations/pagerduty/#alert-integration","title":"Alert Integration","text":"<p>Generated Prometheus alerts include PagerDuty annotations:</p> <pre><code>- alert: PaymentApiHighErrorRate\n  annotations:\n    pagerduty_service: payment-api\n    runbook_url: https://wiki.example.com/runbooks/payment-api\n</code></pre>"},{"location":"integrations/pagerduty/#testing-connection","title":"Testing Connection","text":"<pre><code>nthlayer setup --test\n</code></pre> <pre><code>  PagerDuty\n    [OK] Connected - 3 escalation policies\n</code></pre>"},{"location":"integrations/pagerduty/#troubleshooting","title":"Troubleshooting","text":""},{"location":"integrations/pagerduty/#invalid-api-key","title":"Invalid API Key","text":"<pre><code>[FAIL] Invalid API key\n</code></pre> <ul> <li>Verify key starts with <code>u+</code></li> <li>Check key has Full Access</li> <li>Ensure key isn't revoked</li> </ul>"},{"location":"integrations/pagerduty/#team-already-exists","title":"Team Already Exists","text":"<p>NthLayer checks for existing teams by name and reuses them.</p>"},{"location":"integrations/pagerduty/#permission-denied","title":"Permission Denied","text":"<p>Ensure API key has permissions to:</p> <ul> <li>Create/update teams</li> <li>Create/update services</li> <li>Create/update escalation policies</li> </ul>"},{"location":"integrations/prometheus/","title":"Prometheus Integration","text":"<p>NthLayer uses Prometheus for metric discovery, SLO queries, and alert rules.</p>"},{"location":"integrations/prometheus/#configuration","title":"Configuration","text":""},{"location":"integrations/prometheus/#via-setup-wizard","title":"Via Setup Wizard","text":"<pre><code>nthlayer setup\n</code></pre>"},{"location":"integrations/prometheus/#via-environment-variables","title":"Via Environment Variables","text":"<pre><code>export NTHLAYER_PROMETHEUS_URL=http://prometheus:9090\n\n# If authentication required\nexport NTHLAYER_METRICS_USER=admin\nexport NTHLAYER_METRICS_PASSWORD=secret\n</code></pre>"},{"location":"integrations/prometheus/#via-config-file","title":"Via Config File","text":"<pre><code># ~/.nthlayer/config.yaml\nprometheus:\n  default: default\n  profiles:\n    default:\n      url: http://localhost:9090\n      type: prometheus\n    production:\n      url: https://prometheus-prod.example.com\n      type: prometheus\n      username: admin\n      password_secret: prometheus/password\n</code></pre>"},{"location":"integrations/prometheus/#supported-backends","title":"Supported Backends","text":"Type Description <code>prometheus</code> Standard Prometheus server <code>mimir</code> Grafana Mimir <code>grafana-cloud</code> Grafana Cloud Prometheus"},{"location":"integrations/prometheus/#what-nthlayer-generates","title":"What NthLayer Generates","text":""},{"location":"integrations/prometheus/#alert-rules","title":"Alert Rules","text":"<pre><code>groups:\n  - name: payment-api-alerts\n    rules:\n      - alert: PaymentApiHighErrorRate\n        expr: |\n          sum(rate(http_requests_total{service=\"payment-api\",status=~\"5..\"}[5m])) /\n          sum(rate(http_requests_total{service=\"payment-api\"}[5m])) &gt; 0.01\n        for: 5m\n        labels:\n          severity: critical\n          service: payment-api\n        annotations:\n          summary: High error rate on payment-api\n          description: Error rate is {{ $value | humanizePercentage }}\n</code></pre>"},{"location":"integrations/prometheus/#recording-rules","title":"Recording Rules","text":"<pre><code>groups:\n  - name: payment-api-recording\n    rules:\n      - record: service:http_requests:rate5m\n        expr: sum(rate(http_requests_total{service=\"payment-api\"}[5m]))\n      - record: service:http_errors:rate5m\n        expr: sum(rate(http_requests_total{service=\"payment-api\",status=~\"5..\"}[5m]))\n      - record: service:http_latency_p99:5m\n        expr: |\n          histogram_quantile(0.99,\n            sum by (le) (rate(http_request_duration_seconds_bucket{service=\"payment-api\"}[5m]))\n          )\n</code></pre>"},{"location":"integrations/prometheus/#slo-queries","title":"SLO Queries","text":"<p>NthLayer queries Prometheus for live SLO status:</p> <pre><code>nthlayer slo collect payment-api.yaml\n</code></pre> <p>Uses queries like:</p> <pre><code># Availability over 30 days\navg_over_time(\n  (\n    sum(rate(http_requests_total{service=\"payment-api\",status!~\"5..\"}[5m])) /\n    sum(rate(http_requests_total{service=\"payment-api\"}[5m]))\n  )[30d:5m]\n)\n</code></pre>"},{"location":"integrations/prometheus/#metric-discovery","title":"Metric Discovery","text":"<p>NthLayer discovers available metrics to customize dashboards:</p> <pre><code># Discovers metrics matching service label\nnthlayer plan payment-api.yaml --discover\n</code></pre>"},{"location":"integrations/prometheus/#testing-connection","title":"Testing Connection","text":"<pre><code>nthlayer setup --test\n</code></pre> <pre><code>  Prometheus (http://localhost:9090)\n    [OK] Connected (Prometheus 2.45.0)\n</code></pre>"},{"location":"integrations/prometheus/#troubleshooting","title":"Troubleshooting","text":""},{"location":"integrations/prometheus/#connection-refused","title":"Connection Refused","text":"<pre><code>[FAIL] Connection refused - is Prometheus running?\n</code></pre> <ul> <li>Verify Prometheus is running: <code>curl http://localhost:9090/-/healthy</code></li> <li>Check firewall rules</li> <li>Verify URL is correct</li> </ul>"},{"location":"integrations/prometheus/#authentication-failed","title":"Authentication Failed","text":"<pre><code>[FAIL] Authentication required\n</code></pre> <ul> <li>Set <code>NTHLAYER_METRICS_USER</code> and <code>NTHLAYER_METRICS_PASSWORD</code></li> <li>Or configure in <code>~/.nthlayer/config.yaml</code></li> </ul>"},{"location":"integrations/prometheus/#no-metrics-found","title":"No Metrics Found","text":"<ul> <li>Ensure your application exports metrics with <code>service</code> label</li> <li>Check metric names match expected patterns</li> </ul>"},{"location":"integrations/technologies/","title":"Supported Technologies","text":"<p>NthLayer includes pre-built monitoring templates for 18 technologies.</p>"},{"location":"integrations/technologies/#overview","title":"Overview","text":"Category Technologies Databases PostgreSQL, MySQL, MongoDB, Redis, Elasticsearch Message Queues Kafka, RabbitMQ, NATS, Pulsar Proxies/Load Balancers Nginx, HAProxy, Traefik Infrastructure Kubernetes, etcd, Consul"},{"location":"integrations/technologies/#databases","title":"Databases","text":""},{"location":"integrations/technologies/#postgresql","title":"PostgreSQL","text":"<pre><code>dependencies:\n  - postgresql\n</code></pre> <p>Generated Panels:</p> Panel Metric Active Connections <code>pg_stat_activity_count</code> Replication Lag <code>pg_replication_lag</code> Transactions/sec <code>pg_stat_database_xact_commit</code> Cache Hit Ratio <code>pg_stat_database_blks_hit</code> Dead Tuples <code>pg_stat_user_tables_n_dead_tup</code> <p>Alerts:</p> <ul> <li>High connection count (&gt; 80% of max)</li> <li>Replication lag &gt; 30s</li> <li>Low cache hit ratio (&lt; 90%)</li> </ul>"},{"location":"integrations/technologies/#mysql-mariadb","title":"MySQL / MariaDB","text":"<pre><code>dependencies:\n  - mysql\n  # or\n  - mariadb\n</code></pre> <p>Generated Panels:</p> Panel Metric Connections <code>mysql_global_status_threads_connected</code> Queries/sec <code>mysql_global_status_queries</code> Slow Queries <code>mysql_global_status_slow_queries</code> Replication Lag <code>mysql_slave_status_seconds_behind_master</code>"},{"location":"integrations/technologies/#mongodb","title":"MongoDB","text":"<pre><code>dependencies:\n  - mongodb\n</code></pre> <p>Generated Panels:</p> Panel Metric Connections <code>mongodb_connections</code> Operations/sec <code>mongodb_op_counters_total</code> Replication Lag <code>mongodb_replset_member_replication_lag</code> Document Operations <code>mongodb_mongod_metrics_document_total</code>"},{"location":"integrations/technologies/#redis","title":"Redis","text":"<pre><code>dependencies:\n  - redis\n</code></pre> <p>Generated Panels:</p> Panel Metric Memory Usage <code>redis_memory_used_bytes</code> Connected Clients <code>redis_connected_clients</code> Hit Rate <code>redis_keyspace_hits_total / (hits + misses)</code> Commands/sec <code>redis_commands_processed_total</code> Evictions <code>redis_evicted_keys_total</code>"},{"location":"integrations/technologies/#elasticsearch","title":"Elasticsearch","text":"<pre><code>dependencies:\n  - elasticsearch\n</code></pre> <p>Generated Panels:</p> Panel Metric Cluster Health <code>elasticsearch_cluster_health_status</code> JVM Heap <code>elasticsearch_jvm_memory_used_bytes</code> Indexing Rate <code>elasticsearch_indices_indexing_index_total</code> Search Rate <code>elasticsearch_indices_search_query_total</code> Pending Tasks <code>elasticsearch_cluster_health_number_of_pending_tasks</code>"},{"location":"integrations/technologies/#message-queues","title":"Message Queues","text":""},{"location":"integrations/technologies/#kafka","title":"Kafka","text":"<pre><code>dependencies:\n  - kafka\n</code></pre> <p>Generated Panels:</p> Panel Metric Consumer Lag <code>kafka_consumer_group_lag</code> Messages/sec <code>kafka_server_brokertopicmetrics_messagesin_total</code> Partitions <code>kafka_topic_partitions</code> Under-replicated <code>kafka_server_replicamanager_underreplicatedpartitions</code> <p>Alerts:</p> <ul> <li>Consumer lag &gt; 10,000 messages</li> <li>Under-replicated partitions &gt; 0</li> </ul>"},{"location":"integrations/technologies/#rabbitmq","title":"RabbitMQ","text":"<pre><code>dependencies:\n  - rabbitmq\n  # or\n  - rabbit\n</code></pre> <p>Generated Panels:</p> Panel Metric Queue Messages <code>rabbitmq_queue_messages</code> Consumers <code>rabbitmq_queue_consumers</code> Publish Rate <code>rabbitmq_channel_messages_published_total</code> Connections <code>rabbitmq_connections</code> Memory <code>rabbitmq_node_mem_used</code>"},{"location":"integrations/technologies/#nats","title":"NATS","text":"<pre><code>dependencies:\n  - nats\n</code></pre> <p>Generated Panels:</p> Panel Metric Connections <code>nats_connections</code> Messages In/Out <code>nats_messages_total</code> Bytes In/Out <code>nats_bytes_total</code> Subscriptions <code>nats_subscriptions</code> Slow Consumers <code>nats_slow_consumers</code>"},{"location":"integrations/technologies/#pulsar","title":"Pulsar","text":"<pre><code>dependencies:\n  - pulsar\n</code></pre> <p>Generated Panels:</p> Panel Metric Throughput In <code>pulsar_throughput_in</code> Throughput Out <code>pulsar_throughput_out</code> Message Backlog <code>pulsar_msg_backlog</code> Subscriptions <code>pulsar_subscriptions_count</code> Storage Size <code>pulsar_storage_size</code>"},{"location":"integrations/technologies/#proxies-load-balancers","title":"Proxies / Load Balancers","text":""},{"location":"integrations/technologies/#nginx","title":"Nginx","text":"<pre><code>dependencies:\n  - nginx\n</code></pre> <p>Generated Panels:</p> Panel Metric Requests/sec <code>nginx_http_requests_total</code> Active Connections <code>nginx_connections_active</code> Response Codes <code>nginx_http_requests_total</code> by status Request Duration <code>nginx_http_request_duration_seconds</code> Upstream Response Time <code>nginx_upstream_response_time</code>"},{"location":"integrations/technologies/#haproxy","title":"HAProxy","text":"<pre><code>dependencies:\n  - haproxy\n</code></pre> <p>Generated Panels:</p> Panel Metric Request Rate <code>haproxy_frontend_http_requests_total</code> Active Connections <code>haproxy_frontend_current_sessions</code> Response Time <code>haproxy_backend_response_time_average_seconds</code> Backend Status <code>haproxy_backend_up</code> Error Rate <code>haproxy_backend_http_responses_total{code=\"5xx\"}</code> Queue Length <code>haproxy_backend_current_queue</code>"},{"location":"integrations/technologies/#traefik","title":"Traefik","text":"<pre><code>dependencies:\n  - traefik\n</code></pre> <p>Generated Panels:</p> Panel Metric Requests/sec <code>traefik_service_requests_total</code> Request Duration <code>traefik_service_request_duration_seconds</code> Response Codes <code>traefik_service_requests_total</code> by code Open Connections <code>traefik_service_open_connections</code> Entrypoint Requests <code>traefik_entrypoint_requests_total</code>"},{"location":"integrations/technologies/#infrastructure","title":"Infrastructure","text":""},{"location":"integrations/technologies/#kubernetes","title":"Kubernetes","text":"<pre><code>dependencies:\n  - kubernetes\n</code></pre> <p>Generated Panels:</p> Panel Metric Pod Status <code>kube_pod_status_phase</code> Container Restarts <code>kube_pod_container_status_restarts_total</code> CPU Usage <code>container_cpu_usage_seconds_total</code> Memory Usage <code>container_memory_usage_bytes</code> PVC Usage <code>kubelet_volume_stats_used_bytes</code>"},{"location":"integrations/technologies/#etcd","title":"etcd","text":"<pre><code>dependencies:\n  - etcd\n</code></pre> <p>Generated Panels:</p> Panel Metric Leader Status <code>etcd_server_has_leader</code> DB Size <code>etcd_mvcc_db_total_size_in_bytes</code> Proposals <code>etcd_server_proposals_committed_total</code> WAL Fsync <code>etcd_disk_wal_fsync_duration_seconds</code> Network Peer RTT <code>etcd_network_peer_round_trip_time_seconds</code>"},{"location":"integrations/technologies/#consul","title":"Consul","text":"<pre><code>dependencies:\n  - consul\n</code></pre> <p>Generated Panels:</p> Panel Metric Leader <code>consul_raft_leader</code> Peers <code>consul_raft_peers</code> Services <code>consul_catalog_services</code> Health Checks <code>consul_health_checks_critical</code> RPC Rate <code>consul_rpc_request</code>"},{"location":"integrations/technologies/#adding-custom-technologies","title":"Adding Custom Technologies","text":"<p>See Service Specifications for extending with your own configurations.</p>"},{"location":"protect/","title":"Protect","text":"<p>Block risky deploys before they cause incidents.</p> <p>NthLayer's protection layer enforces reliability policies in production. When error budget is exhausted, deployments are blocked - automatically.</p>"},{"location":"protect/#the-protection-stack","title":"The Protection Stack","text":"Feature Command What It Does Deployment Gates <code>nthlayer check-deploy</code> Block deploys when budget exhausted SLO Portfolio <code>nthlayer portfolio</code> Org-wide reliability visibility Error Budgets <code>nthlayer slo collect</code> Real-time budget consumption"},{"location":"protect/#why-deployment-gates","title":"Why Deployment Gates?","text":"<p>Traditional monitoring tells you after a deployment causes problems:</p> <pre><code>Deploy \u2192 Incident \u2192 Page \u2192 Investigate \u2192 Rollback \u2192 Postmortem\n                      \u2191\n               \"The deploy broke it\"\n</code></pre> <p>Deployment gates tell you before:</p> <pre><code>Check Budget \u2192 Block/Allow \u2192 Deploy\n      \u2191\n  \"Budget exhausted - don't deploy\"\n</code></pre>"},{"location":"protect/#quick-start","title":"Quick Start","text":""},{"location":"protect/#1-check-before-deploy","title":"1. Check Before Deploy","text":"<pre><code>nthlayer check-deploy services/payment-api.yaml \\\n  --prometheus-url http://prometheus:9090\n</code></pre> <p>Output: <pre><code>\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502  Deployment Gate: payment-api                                \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n\n  Tier:          critical\n  Window:        30d\n\n  SLO Status:\n    availability   99.87%  (target: 99.95%)   42% remaining   \u26a0 WARNING\n    latency_p99    187ms   (target: 200ms)    78% remaining   \u2713 OK\n\n  Decision: \u26a0 PROCEED WITH CAUTION\n  Exit code: 1\n</code></pre></p>"},{"location":"protect/#2-view-portfolio-health","title":"2. View Portfolio Health","text":"<pre><code>nthlayer portfolio --path services/\n</code></pre> <p>Output: <pre><code>\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502  NthLayer SLO Portfolio                                      \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n\n  Organization Health: 78% (14/18 services meeting SLOs)\n\n  By Tier:\n    Critical:  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2591\u2591  83% (5/6 services)\n    Standard:  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2591\u2591\u2591  75% (6/8 services)\n    Low:       \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2591\u2591\u2591  75% (3/4 services)\n\n  \u26a0 Services Needing Attention:\n    payment-api    availability  156% burned  EXHAUSTED\n    search-api     latency       95% burned   WARNING\n</code></pre></p>"},{"location":"protect/#exit-codes","title":"Exit Codes","text":"<p>Deployment gates use exit codes for CI/CD integration:</p> Code Decision Pipeline Action <code>0</code> Approved Deploy proceeds <code>1</code> Warning Deploy with caution <code>2</code> Blocked Fail pipeline"},{"location":"protect/#tier-based-thresholds","title":"Tier-Based Thresholds","text":"<p>Default thresholds vary by service tier:</p> Tier Warning Blocking Critical &lt;20% remaining &lt;10% remaining Standard &lt;20% remaining None (advisory) Low &lt;30% remaining None (advisory) <p>Critical services block deploys at 10% remaining budget. Lower tiers only warn.</p>"},{"location":"protect/#custom-policies","title":"Custom Policies","text":"<p>Override defaults with a <code>DeploymentGate</code> resource:</p> <pre><code>resources:\n  - kind: DeploymentGate\n    name: strict-gate\n    spec:\n      thresholds:\n        warning: 30\n        blocking: 15\n\n      conditions:\n        # Stricter during business hours\n        - name: business-hours\n          when: \"hour &gt;= 9 AND hour &lt;= 17 AND weekday\"\n          blocking: 20\n\n        # Complete freeze during incidents\n        - name: low-budget\n          when: \"budget_remaining &lt; 5\"\n          blocking: 100\n</code></pre>"},{"location":"protect/#cicd-integration","title":"CI/CD Integration","text":""},{"location":"protect/#github-actions","title":"GitHub Actions","text":"<pre><code>jobs:\n  deploy:\n    steps:\n      - name: Check Deployment Gate\n        run: |\n          nthlayer check-deploy services/api.yaml \\\n            --prometheus-url ${{ secrets.PROMETHEUS_URL }}\n\n      - name: Deploy\n        if: success()  # Only if gate passed\n        run: kubectl apply -f generated/\n</code></pre>"},{"location":"protect/#argocd-presync-hook","title":"ArgoCD PreSync Hook","text":"<pre><code>apiVersion: batch/v1\nkind: Job\nmetadata:\n  name: deployment-gate\n  annotations:\n    argocd.argoproj.io/hook: PreSync\nspec:\n  template:\n    spec:\n      containers:\n        - name: check\n          image: ghcr.io/nthlayer/nthlayer:latest\n          command:\n            - nthlayer\n            - check-deploy\n            - /config/service.yaml\n            - --prometheus-url\n            - $(PROMETHEUS_URL)\n</code></pre>"},{"location":"protect/#the-google-sre-connection","title":"The Google SRE Connection","text":"<p>NthLayer automates the Error Budget Policy from the Google SRE Book:</p> <p>\"If our SLO says we can have 0.1% downtime per month, and we've already used 0.08%, we should be very careful about deploying new features.\"</p> SRE Concept Manual Process NthLayer Automation Error Budget Policy Spreadsheet tracking <code>nthlayer check-deploy</code> Release Freeze Calendar reminders Automatic blocking Budget Visibility Monthly reports <code>nthlayer portfolio</code>"},{"location":"protect/#next-steps","title":"Next Steps","text":"<ul> <li>Deployment Gates - Full command reference</li> <li>SLO Portfolio - Organization-wide view</li> <li>Error Budgets - Understanding SLOs</li> <li>CI/CD Integration - Pipeline examples</li> </ul>"},{"location":"reference/cli/","title":"CLI Reference","text":"<p>Complete command-line interface reference.</p>"},{"location":"reference/cli/#global-options","title":"Global Options","text":"<pre><code>nthlayer [--help] [--version] &lt;command&gt;\n</code></pre> Option Description <code>--help</code> Show help message <code>--version</code> Show version number"},{"location":"reference/cli/#commands","title":"Commands","text":""},{"location":"reference/cli/#apply","title":"apply","text":"<p>Generate reliability configs from service spec.</p> <pre><code>nthlayer apply &lt;service.yaml&gt; [options]\n</code></pre> Option Description <code>--push</code> Push dashboard to Grafana <code>--push-ruler</code> Push alerts to Mimir/Cortex Ruler API <code>--output-dir DIR</code> Custom output directory <code>--dry-run</code> Preview without writing <code>--lint</code> Validate generated alerts with pint"},{"location":"reference/cli/#setup","title":"setup","text":"<p>Interactive first-time setup.</p> <pre><code>nthlayer setup [options]\n</code></pre> Option Description <code>--quick</code> Simplified setup (default) <code>--advanced</code> Full configuration wizard <code>--test</code> Test connections only <code>--skip-service</code> Skip first service creation"},{"location":"reference/cli/#portfolio","title":"portfolio","text":"<p>View org-wide SLO health.</p> <pre><code>nthlayer portfolio [options]\n</code></pre> Option Description <code>--format FORMAT</code> Output: text, json, csv <code>--services-dir DIR</code> Directory to scan"},{"location":"reference/cli/#slo","title":"slo","text":"<p>SLO management commands.</p> <pre><code>nthlayer slo &lt;subcommand&gt; &lt;service.yaml&gt;\n</code></pre> Subcommand Description <code>show</code> Display SLO definitions <code>list</code> Brief SLO listing <code>collect</code> Query live metrics <p>Options for <code>collect</code>:</p> Option Description <code>--prometheus-url URL</code> Prometheus server <code>--window DURATION</code> Query window"},{"location":"reference/cli/#config","title":"config","text":"<p>Configuration management.</p> <pre><code>nthlayer config &lt;subcommand&gt;\n</code></pre> Subcommand Description <code>show</code> Show current config <code>init</code> Interactive wizard <code>set KEY VALUE</code> Set config value <p>Options for <code>show</code>:</p> Option Description <code>--reveal-secrets</code> Show secret values"},{"location":"reference/cli/#plan","title":"plan","text":"<p>Preview what would be generated.</p> <pre><code>nthlayer plan &lt;service.yaml&gt;\n</code></pre>"},{"location":"reference/cli/#validate","title":"validate","text":"<p>Validate service spec.</p> <pre><code>nthlayer validate &lt;service.yaml&gt;\n</code></pre>"},{"location":"reference/cli/#generate-dashboard","title":"generate-dashboard","text":"<p>Generate dashboard only.</p> <pre><code>nthlayer generate-dashboard &lt;service.yaml&gt; [options]\n</code></pre> Option Description <code>--push</code> Push to Grafana"},{"location":"reference/cli/#generate-alerts","title":"generate-alerts","text":"<p>Generate alerts only.</p> <pre><code>nthlayer generate-alerts &lt;service.yaml&gt;\n</code></pre>"},{"location":"reference/cli/#generate-slo","title":"generate-slo","text":"<p>Generate SLO definitions only.</p> <pre><code>nthlayer generate-slo &lt;service.yaml&gt;\n</code></pre>"},{"location":"reference/cli/#generate-recording-rules","title":"generate-recording-rules","text":"<p>Generate recording rules only.</p> <pre><code>nthlayer generate-recording-rules &lt;service.yaml&gt;\n</code></pre>"},{"location":"reference/cli/#setup-pagerduty","title":"setup-pagerduty","text":"<p>Configure PagerDuty for service.</p> <pre><code>nthlayer setup-pagerduty &lt;service.yaml&gt; [options]\n</code></pre> Option Description <code>--api-key KEY</code> PagerDuty API key <code>--dry-run</code> Preview changes"},{"location":"reference/cli/#verify","title":"verify","text":"<p>Verify declared metrics exist in Prometheus (contract verification).</p> <pre><code>nthlayer verify &lt;service.yaml&gt; [options]\n</code></pre> Option Description <code>--prometheus-url, -p URL</code> Target Prometheus URL <code>--env ENVIRONMENT</code> Environment name <code>--no-fail</code> Don't fail on missing metrics <p>Exit codes: - <code>0</code> = All metrics verified - <code>1</code> = Optional metrics missing (warning) - <code>2</code> = Critical SLO metrics missing (block)</p>"},{"location":"reference/cli/#check-deploy","title":"check-deploy","text":"<p>Check deployment gate based on error budget.</p> <pre><code>nthlayer check-deploy &lt;service.yaml&gt; [options]\n</code></pre> Option Description <code>--prometheus-url, -p URL</code> Target Prometheus URL <code>--env ENVIRONMENT</code> Environment name <code>--auto-env</code> Auto-detect environment <p>Exit codes: - <code>0</code> = Approved (budget healthy) - <code>1</code> = Warning (budget 10-20% remaining) - <code>2</code> = Blocked (budget &lt; 10% for critical tier)</p>"},{"location":"reference/cli/#lint","title":"lint","text":"<p>Lint generated Prometheus rules.</p> <pre><code>nthlayer lint &lt;alerts.yaml&gt;\n</code></pre> <p>Uses pint for validation.</p>"},{"location":"reference/cli/#init","title":"init","text":"<p>Create new service spec from template.</p> <pre><code>nthlayer init [options]\n</code></pre> Option Description <code>--name NAME</code> Service name <code>--team TEAM</code> Team name <code>--template TEMPLATE</code> Template name"},{"location":"reference/cli/#list-templates","title":"list-templates","text":"<p>Show available templates.</p> <pre><code>nthlayer list-templates\n</code></pre>"},{"location":"reference/cli/#secrets","title":"secrets","text":"<p>Secret management commands.</p> <pre><code>nthlayer secrets &lt;subcommand&gt;\n</code></pre> Subcommand Description <code>list</code> List available secrets <code>verify</code> Verify required secrets <code>set PATH</code> Set a secret <code>get PATH</code> Get a secret <code>migrate SOURCE TARGET</code> Migrate secrets"},{"location":"reference/cli/#environment-variables","title":"Environment Variables","text":"Variable Description <code>PROMETHEUS_URL</code> Prometheus server URL (for verify command) <code>PROMETHEUS_USERNAME</code> Prometheus basic auth username <code>PROMETHEUS_PASSWORD</code> Prometheus basic auth password <code>NTHLAYER_PROMETHEUS_URL</code> Prometheus server URL (legacy) <code>NTHLAYER_GRAFANA_URL</code> Grafana server URL <code>NTHLAYER_GRAFANA_API_KEY</code> Grafana API key <code>NTHLAYER_GRAFANA_ORG_ID</code> Grafana organization ID <code>MIMIR_RULER_URL</code> Mimir/Cortex Ruler API URL <code>MIMIR_TENANT_ID</code> Mimir tenant ID (multi-tenant) <code>MIMIR_API_KEY</code> Mimir API key (if auth required) <code>PAGERDUTY_API_KEY</code> PagerDuty API key <code>NTHLAYER_PROFILE</code> Config profile to use"},{"location":"reference/cli/#exit-codes","title":"Exit Codes","text":"Code Meaning <code>0</code> Success <code>1</code> General error <code>2</code> Invalid arguments <code>3</code> Configuration error <code>4</code> Connection error"},{"location":"reference/service-yaml/","title":"Service YAML Schema","text":"<p>Complete reference for service specification files.</p>"},{"location":"reference/service-yaml/#full-schema","title":"Full Schema","text":"<pre><code># Required fields\nname: string              # Service identifier (lowercase, hyphens)\ntier: integer | string    # 1/2/3 or critical/standard/low\ntype: string              # api, worker, stream\n\n# Optional fields\nteam: string              # Team name\ndescription: string       # Human-readable description\n\n# Technology dependencies\ndependencies:\n  - string                # postgresql, redis, kafka, etc.\n\n# Custom resource definitions\nresources:\n  - kind: string          # SLO, Alert, PagerDuty, Dependencies\n    name: string          # Resource identifier\n    spec: object          # Resource-specific configuration\n\n# Environment-specific overrides\nenvironments:\n  production: object      # Override for production\n  staging: object         # Override for staging\n</code></pre>"},{"location":"reference/service-yaml/#field-reference","title":"Field Reference","text":""},{"location":"reference/service-yaml/#name","title":"name","text":"<p>Required | <code>string</code></p> <p>Service identifier. Must be:</p> <ul> <li>Lowercase letters, numbers, hyphens only</li> <li>Cannot start or end with hyphen</li> <li>Unique within your organization</li> </ul> <pre><code>name: payment-api        # Valid\nname: Payment-API        # Invalid (uppercase)\nname: -payment-api       # Invalid (starts with hyphen)\n</code></pre>"},{"location":"reference/service-yaml/#tier","title":"tier","text":"<p>Required | <code>integer</code> or <code>string</code></p> <p>Service priority level:</p> Value Meaning Default SLO <code>1</code> / <code>critical</code> Business-critical 99.95% <code>2</code> / <code>standard</code> Important 99.9% <code>3</code> / <code>low</code> Best-effort 99.5% <pre><code>tier: 1\n# or\ntier: critical\n</code></pre>"},{"location":"reference/service-yaml/#type","title":"type","text":"<p>Required | <code>string</code></p> <p>Service type determines default metrics and SLOs:</p> Type Description <code>api</code> HTTP/REST service <code>worker</code> Background job processor <code>stream</code> Event/message processor"},{"location":"reference/service-yaml/#team","title":"team","text":"<p>Optional | <code>string</code></p> <p>Team responsible for the service. Used for:</p> <ul> <li>PagerDuty team creation</li> <li>Dashboard grouping</li> <li>Alert routing</li> </ul> <pre><code>team: payments\n</code></pre>"},{"location":"reference/service-yaml/#dependencies","title":"dependencies","text":"<p>Optional | <code>list[string]</code></p> <p>Technology dependencies. Each adds dashboard panels and alerts.</p> <pre><code>dependencies:\n  - postgresql\n  - redis\n  - kafka\n</code></pre> <p>Supported values: See Technologies</p>"},{"location":"reference/service-yaml/#resources","title":"resources","text":"<p>Optional | <code>list[Resource]</code></p> <p>Custom resource definitions.</p>"},{"location":"reference/service-yaml/#slo-resource","title":"SLO Resource","text":"<pre><code>resources:\n  - kind: SLO\n    name: availability      # Unique name\n    spec:\n      objective: 99.95      # Target percentage\n      window: 30d           # Time window\n      threshold_ms: 200     # For latency SLOs\n      indicator:\n        type: availability  # availability, latency, throughput\n        percentile: 99      # For latency SLOs\n        query: |            # PromQL query\n          sum(rate(...))\n</code></pre>"},{"location":"reference/service-yaml/#alert-resource","title":"Alert Resource","text":"<pre><code>resources:\n  - kind: Alert\n    name: high-error-rate\n    spec:\n      expr: |               # PromQL expression\n        sum(rate(http_requests_total{status=~\"5..\"}[5m])) /\n        sum(rate(http_requests_total[5m])) &gt; 0.01\n      for: 5m               # Duration before firing\n      severity: critical    # critical, warning, info\n      labels:\n        team: payments\n      annotations:\n        summary: \"High error rate\"\n        description: \"{{ $value | humanizePercentage }}\"\n</code></pre>"},{"location":"reference/service-yaml/#pagerduty-resource","title":"PagerDuty Resource","text":"<pre><code>resources:\n  - kind: PagerDuty\n    name: alerting\n    spec:\n      urgency: high         # high, low\n      auto_create: true     # Create team/service automatically\n      service_id: PXXXXXX   # Use existing service\n      escalation_policy: PXXXXXX\n</code></pre>"},{"location":"reference/service-yaml/#dependencies-resource","title":"Dependencies Resource","text":"<pre><code>resources:\n  - kind: Dependencies\n    name: upstream\n    spec:\n      services:\n        - name: user-service\n          criticality: high\n        - name: inventory-service\n          criticality: medium\n</code></pre>"},{"location":"reference/service-yaml/#environments","title":"environments","text":"<p>Optional | <code>object</code></p> <p>Environment-specific overrides:</p> <pre><code>environments:\n  production:\n    tier: critical\n    resources:\n      - kind: SLO\n        name: availability\n        spec:\n          objective: 99.99\n\n  staging:\n    tier: standard\n    resources:\n      - kind: SLO\n        name: availability\n        spec:\n          objective: 99.5\n</code></pre>"},{"location":"reference/service-yaml/#complete-example","title":"Complete Example","text":"<pre><code>name: payment-api\nteam: payments\ntier: critical\ntype: api\ndescription: Handles payment processing\n\ndependencies:\n  - postgresql\n  - redis\n\nresources:\n  - kind: SLO\n    name: availability\n    spec:\n      objective: 99.95\n      window: 30d\n      indicator:\n        type: availability\n        query: |\n          sum(rate(http_requests_total{service=\"payment-api\",status!~\"5..\"}[5m])) /\n          sum(rate(http_requests_total{service=\"payment-api\"}[5m]))\n\n  - kind: SLO\n    name: latency-p99\n    spec:\n      objective: 99.0\n      window: 30d\n      threshold_ms: 200\n      indicator:\n        type: latency\n        percentile: 99\n        query: |\n          histogram_quantile(0.99,\n            sum by (le) (rate(http_request_duration_seconds_bucket{service=\"payment-api\"}[5m]))\n          )\n\n  - kind: Alert\n    name: high-error-rate\n    spec:\n      expr: |\n        sum(rate(http_requests_total{service=\"payment-api\",status=~\"5..\"}[5m])) /\n        sum(rate(http_requests_total{service=\"payment-api\"}[5m])) &gt; 0.01\n      for: 5m\n      severity: critical\n\n  - kind: PagerDuty\n    name: alerting\n    spec:\n      urgency: high\n      auto_create: true\n\nenvironments:\n  production:\n    resources:\n      - kind: SLO\n        name: availability\n        spec:\n          objective: 99.99\n</code></pre>"},{"location":"reference/service-yaml/#validation","title":"Validation","text":"<pre><code>nthlayer validate payment-api.yaml\n</code></pre>"},{"location":"validate/","title":"Validate","text":"<p>Catch reliability issues before deploy, not after incidents.</p> <p>NthLayer's validation layer ensures your reliability configuration is correct before it reaches production. This is the core of \"Shift Left\" - moving validation earlier in your pipeline.</p>"},{"location":"validate/#the-three-validation-layers","title":"The Three Validation Layers","text":"Layer Command What It Checks When to Use Syntax <code>nthlayer apply --lint</code> PromQL query validity Every commit Policy <code>nthlayer validate-spec</code> Service spec compliance Every commit Contract <code>nthlayer verify</code> Metrics exist in Prometheus Before promotion"},{"location":"validate/#validation-flow","title":"Validation Flow","text":"<pre><code>service.yaml\n     \u2502\n     \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Policy Check   \u2502  nthlayer validate-spec\n\u2502  (OPA/Rego)     \u2502  \"Is the spec well-formed?\"\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  PromQL Lint    \u2502  nthlayer apply --lint\n\u2502  (pint)         \u2502  \"Are queries valid?\"\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Contract       \u2502  nthlayer verify\n\u2502  Verification   \u2502  \"Do metrics exist?\"\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u25bc\n    Deploy \u2713\n</code></pre>"},{"location":"validate/#quick-start","title":"Quick Start","text":""},{"location":"validate/#1-validate-service-spec-no-prometheus-required","title":"1. Validate Service Spec (No Prometheus Required)","text":"<pre><code># Check policy compliance\nnthlayer validate-spec services/payment-api.yaml\n\n# Output:\n# \u2713 Required fields present (name, team, tier, type)\n# \u2713 Tier value valid (critical)\n# \u2713 SLO objectives within range\n# \u2713 Critical tier has PagerDuty configured\n</code></pre>"},{"location":"validate/#2-lint-generated-promql","title":"2. Lint Generated PromQL","text":"<pre><code># Generate and lint in one step\nnthlayer apply services/payment-api.yaml --lint\n\n# Output:\n# Applied 4 resources \u2192 generated/payment-api/\n# Validating with pint...\n# \u2713 12 rules validated\n</code></pre>"},{"location":"validate/#3-verify-metrics-exist-requires-prometheus","title":"3. Verify Metrics Exist (Requires Prometheus)","text":"<pre><code># Verify against staging Prometheus\nnthlayer verify services/payment-api.yaml \\\n  --prometheus-url http://prometheus:9090\n\n# Output:\n# \u2713 http_requests_total\n# \u2713 http_request_duration_seconds_bucket\n# Contract verification passed\n</code></pre>"},{"location":"validate/#cicd-integration","title":"CI/CD Integration","text":"<p>Add all three checks to your pipeline:</p> <pre><code># GitHub Actions\njobs:\n  validate:\n    steps:\n      - name: Policy Check\n        run: nthlayer validate-spec services/*.yaml\n\n      - name: Generate &amp; Lint\n        run: nthlayer apply services/*.yaml --lint\n\n      - name: Verify Contracts\n        run: |\n          nthlayer verify services/*.yaml \\\n            --prometheus-url ${{ secrets.STAGING_PROMETHEUS }}\n</code></pre>"},{"location":"validate/#exit-codes","title":"Exit Codes","text":"<p>All validation commands use consistent exit codes:</p> Code Meaning Pipeline Action <code>0</code> All checks passed Continue <code>1</code> Warnings (non-blocking) Continue with caution <code>2</code> Errors (blocking) Fail pipeline"},{"location":"validate/#next-steps","title":"Next Steps","text":"<ul> <li>Contract Verification - Verify metrics exist</li> <li>Policy Validation - OPA/Rego policy checks</li> <li>PromQL Linting - Syntax and best practices</li> </ul>"},{"location":"validate/linting/","title":"PromQL Linting","text":"<p>Validate PromQL query syntax and best practices before they reach Prometheus.</p>"},{"location":"validate/linting/#overview","title":"Overview","text":"<p>NthLayer integrates with pint to validate generated Prometheus rules. This catches:</p> <ul> <li>Syntax errors - Invalid PromQL that Prometheus would reject</li> <li>Missing metrics - References to metrics that don't exist</li> <li>Best practice violations - Queries that work but could be improved</li> </ul>"},{"location":"validate/linting/#usage","title":"Usage","text":""},{"location":"validate/linting/#lint-during-apply","title":"Lint During Apply","text":"<pre><code>nthlayer apply services/api.yaml --lint\n</code></pre> <p>Output: <pre><code>Applied 4 resources in 0.3s \u2192 generated/api/\n\nValidating alerts with pint...\n  \u2713 12 rules validated\n\n  \u26a0 [promql/series] Line 45: metric \"http_errors_total\" not found\n</code></pre></p>"},{"location":"validate/linting/#lint-existing-files","title":"Lint Existing Files","text":"<pre><code># Lint a specific file\npint lint generated/api/alerts.yaml\n\n# Lint all generated rules\npint lint generated/*/alerts.yaml\n</code></pre>"},{"location":"validate/linting/#what-gets-checked","title":"What Gets Checked","text":""},{"location":"validate/linting/#syntax-validation","title":"Syntax Validation","text":"<pre><code># Invalid - missing closing brace\n- alert: HighLatency\n  expr: histogram_quantile(0.99, sum(rate(http_duration_bucket[5m]))\n</code></pre> <pre><code>ERROR: promql/syntax - unexpected end of input\n</code></pre>"},{"location":"validate/linting/#series-existence","title":"Series Existence","text":"<pre><code># Warning - metric may not exist\n- alert: HighErrors\n  expr: rate(custom_errors_total[5m]) &gt; 0.1\n</code></pre> <pre><code>WARNING: promql/series - metric \"custom_errors_total\" not found\n</code></pre>"},{"location":"validate/linting/#best-practices","title":"Best Practices","text":"<pre><code># Warning - histogram_quantile without sum by (le)\n- alert: SlowRequests\n  expr: histogram_quantile(0.99, rate(http_duration_bucket[5m])) &gt; 1\n</code></pre> <pre><code>WARNING: promql/aggregate - histogram_quantile should use sum by (le)\n</code></pre>"},{"location":"validate/linting/#configuration","title":"Configuration","text":""},{"location":"validate/linting/#pint-configuration","title":"pint Configuration","text":"<p>Create <code>.pint.hcl</code> in your repo root:</p> <pre><code>prometheus \"default\" {\n  uri     = \"http://prometheus:9090\"\n  timeout = \"30s\"\n}\n\nrule {\n  # Require runbook_url on all alerts\n  annotation \"runbook_url\" {\n    severity = \"warning\"\n    required = true\n  }\n}\n\nrule {\n  # Require severity label\n  label \"severity\" {\n    severity = \"warning\"\n    required = true\n  }\n}\n</code></pre>"},{"location":"validate/linting/#nthlayer-integration","title":"NthLayer Integration","text":"<p>NthLayer automatically:</p> <ol> <li>Detects if <code>pint</code> is installed</li> <li>Runs validation when <code>--lint</code> flag is provided</li> <li>Reports results with severity levels</li> <li>Returns appropriate exit codes</li> </ol>"},{"location":"validate/linting/#installing-pint","title":"Installing pint","text":"<pre><code># macOS\nbrew install cloudflare/tap/pint\n\n# Linux\ncurl -sL https://github.com/cloudflare/pint/releases/latest/download/pint-linux-amd64.tar.gz | tar xz\n\n# Verify installation\npint version\n</code></pre>"},{"location":"validate/linting/#cicd-integration","title":"CI/CD Integration","text":""},{"location":"validate/linting/#github-actions","title":"GitHub Actions","text":"<pre><code>- name: Install pint\n  run: |\n    curl -sL https://github.com/cloudflare/pint/releases/latest/download/pint-linux-amd64.tar.gz | tar xz\n    sudo mv pint /usr/local/bin/\n\n- name: Generate and Lint\n  run: nthlayer apply services/*.yaml --lint\n</code></pre>"},{"location":"validate/linting/#pre-commit-hook","title":"Pre-commit Hook","text":"<pre><code># .pre-commit-config.yaml\nrepos:\n  - repo: local\n    hooks:\n      - id: nthlayer-lint\n        name: NthLayer PromQL Lint\n        entry: nthlayer apply --lint\n        language: system\n        files: services/.*\\.yaml$\n</code></pre>"},{"location":"validate/linting/#common-issues","title":"Common Issues","text":""},{"location":"validate/linting/#pint-not-found","title":"\"pint not found\"","text":"<pre><code>\u26a0 pint not installed, skipping PromQL validation\n  Install: brew install cloudflare/tap/pint\n</code></pre> <p>Install pint or skip linting with <code>--no-lint</code>.</p>"},{"location":"validate/linting/#prometheus-connection-failed","title":"\"Prometheus connection failed\"","text":"<p>pint needs Prometheus access to verify metric existence:</p> <pre><code># Provide Prometheus URL\nexport PROMETHEUS_URL=http://prometheus:9090\nnthlayer apply services/api.yaml --lint\n</code></pre> <p>Or disable series checks in <code>.pint.hcl</code>:</p> <pre><code>checks {\n  disabled = [\"promql/series\"]\n}\n</code></pre>"},{"location":"validate/linting/#see-also","title":"See Also","text":"<ul> <li>pint Documentation</li> <li>nthlayer apply</li> <li>Contract Verification</li> </ul>"}]}
