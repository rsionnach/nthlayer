======================================================================
  Task 5: Test & Validate All Services with SDK Builder
======================================================================

Testing 5 services...

======================================================================
  Testing: payment-api
======================================================================

1. Parsing examples/services/payment-api.yaml...
   ✅ Parsed: payment-api
      Team: payments
      Type: api
      Tier: critical
      Resources: 6

2. Building dashboard with SDK...
   ✅ Dashboard built
      Title: payment-api - Service Dashboard
      UID: payment-api-overview
      Panels: 18
      Schema: v36

3. Panel breakdown:
   • availability (timeseries)
   • latency-p95 (timeseries)
   • latency-p99 (timeseries)
   • Request Rate (timeseries)
   • Error Rate (timeseries)
   • Request Latency (p95) (timeseries)
   • PostgreSQL Connections (timeseries)
   • Active Queries (timeseries)
   • Cache Hit Ratio (gauge)
   • Transaction Rate (timeseries)
   • Database Size (timeseries)
   • Query Duration (p95) (timeseries)
   • Deadlocks (timeseries)
   • Replication Lag (timeseries)
   • Disk I/O (timeseries)
   • Table Bloat (timeseries)
   • Index Hit Ratio (gauge)
   • Connection Pool Utilization (timeseries)

   Summary:
   - timeseries: 16 panels
   - gauge: 2 panels

4. Output:
   File: generated/payment-api/dashboard-sdk.json
   Size: 17,534 bytes

5. Validating JSON structure...
   ✅ All required keys present
   ✅ All panels have queries

======================================================================
  ✅ payment-api: SUCCESS
======================================================================

======================================================================
  Testing: checkout-service
======================================================================

1. Parsing examples/services/checkout-service.yaml...
   ✅ Parsed: checkout-service
      Team: commerce
      Type: api
      Tier: critical
      Resources: 6

2. Building dashboard with SDK...

======================================================================
  ❌ checkout-service: FAILED
======================================================================

Error: 'No template found for technology: mysql'
Traceback (most recent call last):
  File "/Users/robfox/trellis/test_all_services_sdk.py", line 52, in test_service
    dashboard_payload = builder.build()
  File "/Users/robfox/trellis/src/nthlayer/dashboards/builder_sdk.py", line 86, in build
    tech_panels = self._build_technology_panels()
  File "/Users/robfox/trellis/src/nthlayer/dashboards/builder_sdk.py", line 218, in _build_technology_panels
    template = get_template(db_type)
  File "/Users/robfox/trellis/src/nthlayer/dashboards/templates/__init__.py", line 47, in get_template
    raise KeyError(f"No template found for technology: {technology}")
KeyError: 'No template found for technology: mysql'

======================================================================
  Testing: notification-worker
======================================================================

1. Parsing examples/services/notification-worker.yaml...
   ✅ Parsed: notification-worker
      Team: platform
      Type: worker
      Tier: high
      Resources: 6

2. Building dashboard with SDK...
   ✅ Dashboard built
      Title: notification-worker - Service Dashboard
      UID: notification-worker-overview
      Panels: 16
      Schema: v36

3. Panel breakdown:
   • delivery-success (timeseries)
   • processing-latency-p95 (timeseries)
   • queue-lag (timeseries)
   • Request Rate (timeseries)
   • Error Rate (timeseries)
   • Request Latency (p95) (timeseries)
   • Redis Memory Usage (stat)
   • Cache Hit Rate (gauge)
   • Redis Connections (stat)
   • Connected Clients (timeseries)
   • Evicted Keys (timeseries)
   • Cache Hits vs Misses (timeseries)
   • Expired Keys (timeseries)
   • Network I/O (timeseries)
   • Slow Commands (timeseries)
   • Memory Fragmentation (gauge)

   Summary:
   - timeseries: 12 panels
   - stat: 2 panels
   - gauge: 2 panels

4. Output:
   File: generated/notification-worker/dashboard-sdk.json
   Size: 14,031 bytes

5. Validating JSON structure...
   ✅ All required keys present
   ✅ All panels have queries

======================================================================
  ✅ notification-worker: SUCCESS
======================================================================

======================================================================
  Testing: analytics-stream
======================================================================

1. Parsing examples/services/analytics-stream.yaml...
   ✅ Parsed: analytics-stream
      Team: data
      Type: stream-processor
      Tier: high
      Resources: 6

2. Building dashboard with SDK...
   ✅ Dashboard built
      Title: analytics-stream - Service Dashboard
      UID: analytics-stream-overview
      Panels: 19
      Schema: v36

3. Panel breakdown:
   • processing-availability (timeseries)
   • stream-lag (timeseries)
   • event-latency-p99 (timeseries)
   • Request Rate (timeseries)
   • Error Rate (timeseries)
   • Request Latency (p95) (timeseries)
   • MongoDB Connections (timeseries)
   • MongoDB Operations/sec (timeseries)
   • MongoDB Query Duration (p95) (timeseries)
   • Redis Memory Usage (stat)
   • Cache Hit Rate (gauge)
   • Redis Connections (stat)
   • Connected Clients (timeseries)
   • Evicted Keys (timeseries)
   • Cache Hits vs Misses (timeseries)
   • Expired Keys (timeseries)
   • Network I/O (timeseries)
   • Slow Commands (timeseries)
   • Memory Fragmentation (gauge)

   Summary:
   - timeseries: 15 panels
   - stat: 2 panels
   - gauge: 2 panels

4. Output:
   File: generated/analytics-stream/dashboard-sdk.json
   Size: 17,013 bytes

5. Validating JSON structure...
   ✅ All required keys present
   ✅ All panels have queries

======================================================================
  ✅ analytics-stream: SUCCESS
======================================================================

======================================================================
  Testing: identity-service
======================================================================

1. Parsing examples/services/identity-service.yaml...
   ✅ Parsed: identity-service
      Team: identity
      Type: api
      Tier: critical
      Resources: 6

2. Building dashboard with SDK...
   ✅ Dashboard built
      Title: identity-service - Service Dashboard
      UID: identity-service-overview
      Panels: 28
      Schema: v36

3. Panel breakdown:
   • availability (timeseries)
   • latency-p95 (timeseries)
   • latency-p99 (timeseries)
   • Request Rate (timeseries)
   • Error Rate (timeseries)
   • Request Latency (p95) (timeseries)
   • PostgreSQL Connections (timeseries)
   • Active Queries (timeseries)
   • Cache Hit Ratio (gauge)
   • Transaction Rate (timeseries)
   • Database Size (timeseries)
   • Query Duration (p95) (timeseries)
   • Deadlocks (timeseries)
   • Replication Lag (timeseries)
   • Disk I/O (timeseries)
   • Table Bloat (timeseries)
   • Index Hit Ratio (gauge)
   • Connection Pool Utilization (timeseries)
   • Redis Memory Usage (stat)
   • Cache Hit Rate (gauge)
   • Redis Connections (stat)
   • Connected Clients (timeseries)
   • Evicted Keys (timeseries)
   • Cache Hits vs Misses (timeseries)
   • Expired Keys (timeseries)
   • Network I/O (timeseries)
   • Slow Commands (timeseries)
   • Memory Fragmentation (gauge)

   Summary:
   - timeseries: 22 panels
   - gauge: 4 panels
   - stat: 2 panels

4. Output:
   File: generated/identity-service/dashboard-sdk.json
   Size: 26,725 bytes

5. Validating JSON structure...
   ✅ All required keys present
   ✅ All panels have queries

======================================================================
  ✅ identity-service: SUCCESS
======================================================================

======================================================================
  FINAL SUMMARY
======================================================================

Services tested: 5
Successful: 4
Failed: 1

Results by service:

✅ payment-api               18 panels    17,534 bytes
❌ checkout-service           0 panels         0 bytes
   ⚠️  'No template found for technology: mysql'
✅ notification-worker       16 panels    14,031 bytes
✅ analytics-stream          19 panels    17,013 bytes
✅ identity-service          28 panels    26,725 bytes

Total panels generated: 81
Total output size: 75,303 bytes (73.5 KB)

Success rate: 80%

======================================================================
  ⚠️  SOME TESTS FAILED
======================================================================
