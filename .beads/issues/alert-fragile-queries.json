{
  "id": "alert-fragile-queries",
  "type": "bug",
  "title": "Generated alerts have fragile queries that cause false positives on Prometheus restart",
  "description": "Pint linting reveals that some awesome-prometheus-alerts templates lack a 'for' duration, making them fire immediately when Prometheus restarts (before metrics are stable). This causes false positive alerts.",
  "status": "resolved",
  "resolved_at": "2026-01-14T00:00:00Z",
  "resolution": "Added validation in src/nthlayer/alerts/validator.py that sets minimum 'for' duration of 1m when alerts have 0m/0s duration",
  "priority": "P3",
  "tags": ["bug", "alerts", "pint", "awesome-prometheus-alerts"],
  "created_at": "2026-01-14T00:00:00Z",
  "discovered_during": "UAT pint linting of generated alerts",
  "source": "awesome-prometheus-alerts templates",
  "affected_alerts": [
    {
      "name": "MongodbReplicationHeadroom",
      "issue": "No 'for' duration - fires immediately on Prometheus restart",
      "file": "generated/alerts/analytics-stream.yaml:48-49"
    },
    {
      "name": "RedisDisconnectedSlaves",
      "issue": "No 'for' duration - fires immediately on Prometheus restart",
      "file": "generated/alerts/payment-api-with-deps.yaml:227-228"
    }
  ],
  "root_cause": "Upstream awesome-prometheus-alerts templates missing 'for' duration on some alerts",
  "proposed_fix": [
    "Option 1: Add default 'for: 5m' to alerts that lack it during generation",
    "Option 2: Fork/patch upstream templates with appropriate 'for' durations",
    "Option 3: Add configurable default 'for' duration in NthLayer alert generation"
  ],
  "pint_rule": "promql/fragile",
  "severity_from_pint": "Warning",
  "example": {
    "current": "expr: count without (instance, job) (redis_connected_slaves) - sum without (instance, job) (redis_connected_slaves) - 1 > 0",
    "fix": "Add 'for: 5m' to prevent false positives during Prometheus restart"
  }
}
