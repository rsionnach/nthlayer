{
  "id": "loki-alerts-label-mismatch",
  "type": "bug",
  "title": "Loki alerts use hardcoded 'app' label instead of configurable label",
  "description": "generate-loki-alerts produces LogQL queries with hardcoded {app=\"service-name\"} selector, but many environments use different labels like 'service', 'application', or 'container'. This causes alerts to never match logs.",
  "status": "open",
  "priority": "P2",
  "tags": ["bug", "loki", "alerts", "configuration"],
  "created_at": "2026-01-14T00:00:00Z",
  "discovered_during": "UAT testing on Synology stack",
  "affected_files": [
    "src/nthlayer/loki/alerts.py",
    "src/nthlayer/cli/generate_loki.py"
  ],
  "symptoms": [
    "Generated Loki alerts use {app=\"payment-api\"} selector",
    "UAT Loki stack uses {service=\"payment-api\"} label",
    "Alerts will never fire because label doesn't match"
  ],
  "root_cause": "Loki alert templates hardcode 'app' as the service label name without configuration option",
  "proposed_fix": [
    "Add 'loki_service_label' config option (default: 'app')",
    "Support label configuration in service.yaml observability section",
    "Allow environment variable override (NTHLAYER_LOKI_SERVICE_LABEL)"
  ],
  "example": {
    "current": "{app=\"payment-api\"} |~ \"error\"",
    "expected": "{service=\"payment-api\"} |~ \"error\"",
    "config_needed": "loki_service_label: service"
  }
}
