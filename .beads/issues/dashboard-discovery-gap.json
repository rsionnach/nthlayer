{
  "id": "dashboard-discovery-gap",
  "type": "bug",
  "title": "Dashboard CLI commands don't support Prometheus metric discovery",
  "description": "DashboardBuilderSDK supports prometheus_url for metric discovery, but CLI commands (apply, generate-dashboard) don't expose this option. Results in placeholder 'Needs Instrumentation' panels instead of real metrics.",
  "status": "completed",
  "priority": "P1",
  "tags": ["bug", "compatibility", "dashboard", "discovery"],
  "created_at": "2026-01-14T00:00:00Z",
  "completed_at": "2026-01-14T00:00:00Z",
  "discovered_during": "UAT testing on Synology stack",
  "affected_files": [
    "src/nthlayer/cli/dashboard.py",
    "src/nthlayer/cli/apply.py",
    "src/nthlayer/dashboards/builder_sdk.py:build_dashboard()",
    "src/nthlayer/orchestrator.py:_generate_dashboard()",
    "src/nthlayer/demo.py"
  ],
  "symptoms": [
    "Service Health panels show 'Add metrics: http.requests_total'",
    "Dependency panels show 'Needs Instrumentation' guidance",
    "Only SLO panels have real queries (from service.yaml)"
  ],
  "root_cause": "build_dashboard() wrapper and CLI commands don't pass prometheus_url to DashboardBuilderSDK, so metric resolver can't discover actual metrics",
  "resolution": {
    "changes": [
      "Added prometheus_url parameter to build_dashboard() wrapper in builder_sdk.py",
      "Added --prometheus-url/-p option to generate-dashboard command in demo.py",
      "Added --prometheus-url/-p option to apply command in demo.py",
      "Updated apply_command() in apply.py to accept and pass prometheus_url",
      "Updated ServiceOrchestrator to accept prometheus_url and pass to dashboard generation",
      "Both commands support NTHLAYER_PROMETHEUS_URL environment variable as fallback"
    ],
    "verified": "Tested against UAT Prometheus at http://192.168.1.10:9090 - resolution summary shows '2 resolved' for http metrics"
  }
}
